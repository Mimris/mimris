"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[747],{7621:(t,e,i)=>{i.d(e,{Aw:()=>k,D7:()=>m,Gk:()=>N,Iy:()=>y,JT:()=>E,Ke:()=>S,NZ:()=>l,N_:()=>O,Of:()=>p,Or:()=>R,P1:()=>d,PE:()=>B,R5:()=>u,St:()=>z,T5:()=>r,V2:()=>c,VI:()=>T,VJ:()=>L,Wn:()=>V,YJ:()=>n,Z2:()=>x,Zk:()=>M,aX:()=>g,bP:()=>F,bR:()=>o,cK:()=>w,eS:()=>A,es:()=>v,h2:()=>D,jg:()=>K,ke:()=>I,or:()=>h,pD:()=>f,rw:()=>a,vM:()=>P,yF:()=>b,yp:()=>C}),function(){let t,e,i,s,n,l,r,o,h,a,u,d,c,g,f,m,p,y,x,w,b,v,k,P,S,M,N,C,L,T,A,D,F,O,R,B,E,I,V,z,K,X,j,G,Y,U,q,H,W,_,J,Z,$,Q;let tt="object"==typeof globalThis&&globalThis||"object"==typeof global&&global.global===global&&global||"object"==typeof self&&self.self===self&&self||{};void 0===tt.requestAnimationFrame&&(void 0===tt.setImmediate?tt.requestAnimationFrame=t=>tt.setTimeout(t,0):tt.requestAnimationFrame=tt.setImmediate);class te{static hr=void 0!==tt.navigator&&void 0!==tt.navigator.platform&&null!==tt.navigator.platform.match(/(iPhone|iPod|iPad|Mac)/i);static Nk(t,e,i){let s=-1;return function(){let n=this,l=arguments;-1!==s&&te.Og(s),s=te.ar(()=>{s=-1,i||t.apply(n,l)},e),i&&!s&&t.apply(n,l)}}static ar(t,e){return tt.setTimeout(t,e)}static Og(t){tt.clearTimeout(t)}static fs(t){return tt.document.createElement(t)}static o(t){throw Error(t)}static D(t,e){let i="The object is frozen, so its properties cannot be set: "+t.toString();void 0!==e&&(i+="  to value: "+e),te.o(i)}static rE(t,e,i,s){}static s(t,e,i,s){}static lE(t,e,i){}static lc(t,e,i){if(null===t||"object"!=typeof t){let s=te.oC(e);void 0!==i&&(s+="."+i),te.te(t,"object",s)}}static S(t,e,i){te.s(t,"function",e,i)}static hE(t,e,i){}static te(t,e,i,s){}static _(t,e,i,s){let n=te.oC(i);void 0!==s&&(n+="."+s),te.o(n+" is not in the range "+e+": "+t)}static Ie(t){}static cr(t,e){}static li(t){tt.console&&tt.console.log(t)}static H(t){return null!==t&&"object"==typeof t}static ot(t){return"function"==typeof t}static Ck=[];static rt(){let t=te.Ck.pop();return void 0===t?[]:t}static tt(t){t.length=0,te.Ck.push(t)}static aE=Object.freeze([]);static oC(t){return null===t?"*":"string"==typeof t?t:te.ot(t)?t.name:""}static Vn(t){return te.ot(t)?t.className?t.className:t.name:te.H(t)&&t.constructor?te.Vn(t.constructor):typeof t}static Xh(t,e){return null==e||""===e?null:te.H(t)&&e in t||t[e]?t[e]:null}static toString(t){let e=t;return te.H(t)&&(t.text?e=t.text:t.name?e=t.name:void 0!==t.key?e=t.key:void 0!==t.id?e=t.id:t.constructor===Object&&(t.Text?e=t.Text:t.Name?e=t.Name:void 0!==t.Key?e=t.Key:void 0!==t.Id?e=t.Id:void 0!==t.ID&&(e=t.ID))),void 0===e?"undefined":null===e?"null":e.toString()}static fw(t,e){if(t.hasOwnProperty(e))return!0;let i=Object.getPrototypeOf(t);for(;i&&i!==Function;){if(i.hasOwnProperty(e))return!0;let t=i.cE;if(t&&t[e])return!0;i=Object.getPrototypeOf(i)}return!1}static XD(t){let e=[],i=0;for(i=0;i<256;i++)e[i]=i;let s=0,n=0;for(i=0;i<256;i++)s=(s+e[i]+119)%256,n=e[i],e[i]=e[s],e[s]=n;i=0,s=0;let l="";for(let r=0;r<t.length;r++)s=(s+e[i=(i+1)%256])%256,n=e[i],e[i]=e[s],e[s]=n,l+=String.fromCharCode(t.charCodeAt(r)^e[(e[i]+e[s])%256]);return l}static YD(t){let e="0123456789abcdef",i=[];for(let t=0;t<256;t++)i[e.charAt(t>>4)+e.charAt(15&t)]=String.fromCharCode(t);t.length%2&&(t="0"+t);let s=[],n=0;for(let e=0;e<t.length;e+=2)s[n++]=i[t.substring(e,e+2)];let l=s.join("");return""===l?"0":l}static Rs(t){return te.XD(te.YD(t))}static color1="@COLOR1";static color2="@COLOR2";static uw="32ab5ff3b26f42dc0ed90f21402913b5"}te.vfo="29e646fdb26f";class ti{Lk;constructor(){this.Lk=[]}toString(){return this.Lk.join("")}add(t){""!==t&&this.Lk.push(t)}}class ts{}class tn{g;constructor(){this.g=[]}[Symbol.iterator](){return this.g.values()}key;value;get iterator(){return this}reset(){}next(){return!1}hasNext(){return!1}first(){return null}any(){return!1}all(){return!0}each(){return this}map(t){return this}filter(){return this}get count(){return 0}xl(){}toString(){return"EmptyIterator"}static instance=new tn}class tl{constructor(t){this.key=-1,this.value=t}[Symbol.iterator](){return[this.value].values()}key;value;get iterator(){return this}reset(){this.key=-1}next(){return -1===this.key&&(this.key=0,!0)}hasNext(){return this.next()}first(){return this.key=0,this.value}any(t){return this.key=-1,t(this.value)}all(t){return this.key=-1,t(this.value)}each(t){return this.key=-1,t(this.value),this}map(t){return new tl(t(this.value))}filter(t){return t(this.value)?new tl(this.value):tn.instance}get count(){return 1}xl(){this.value=null}toString(){return"SingletonIterator("+this.value+")"}}class tr{$t;vs;jt;Ft;constructor(t){this.$t=t,this.vs=null,t.fr=null,this.jt=t.ht,this.Ft=-1}[Symbol.iterator](){return null===this.vs?this.$t.r.values():this.$t.r.filter(this.vs).values()}key;value;get iterator(){return this}get predicate(){return this.vs}set predicate(t){this.vs=t}reset(){let t=this.$t;t.fr=null,this.jt=t.ht,this.Ft=-1}next(){let t=this.$t;if(t.ht!==this.jt){if(this.key<0)return!1;te.Ie(t)}let e=t.r,i=e.length,s=++this.Ft,n=this.vs;if(null!==n)for(;s<i;){let t=e[s];if(n(t))return this.Ft=s,this.key=s,this.value=t,!0;s++}else{if(s<i)return this.key=s,this.value=e[s],!0;this.xl()}return!1}hasNext(){return this.next()}first(){let t=this.$t;this.jt=t.ht,this.Ft=0;let e=t.r,i=e.length,s=this.vs;if(null!==s){let t=0;for(;t<i;){let i=e[t];if(s(i))return this.Ft=t,this.key=t,this.value=i,i;t++}return null}if(!(i>0))return null;{let t=e[0];return this.key=0,this.value=t,t}}any(t){let e=this.$t;e.fr=null;let i=e.ht;this.Ft=-1;let s=e.r,n=s.length,l=this.vs;for(let r=0;r<n;r++){let n=s[r];if(!(null!==l&&!l(n))){if(t(n))return!0;e.ht!==i&&te.Ie(e)}}return!1}all(t){let e=this.$t;e.fr=null;let i=e.ht;this.Ft=-1;let s=e.r,n=s.length,l=this.vs;for(let r=0;r<n;r++){let n=s[r];if(!(null!==l&&!l(n))){if(!t(n))return!1;e.ht!==i&&te.Ie(e)}}return!0}each(t){let e=this.$t;e.fr=null;let i=e.ht;this.Ft=-1;let s=e.r,n=s.length,l=this.vs;for(let r=0;r<n;r++){let n=s[r];(null===l||l(n))&&(t(n),e.ht!==i&&te.Ie(e))}return this}map(t){let e=this.$t;e.fr=null;let i=e.ht;this.Ft=-1;let s=[],n=e.r,l=n.length,r=this.vs;for(let o=0;o<l;o++){let l=n[o];(null===r||r(l))&&(s.push(t(l)),e.ht!==i&&te.Ie(e))}let o=new th;return o.r=s,o.Ee(),o.iterator}filter(t){let e=this.$t;e.fr=null;let i=e.ht;this.Ft=-1;let s=[],n=e.r,l=n.length,r=this.vs;for(let o=0;o<l;o++){let l=n[o];(null===r||r(l))&&(t(l)&&s.push(l),e.ht!==i&&te.Ie(e))}let o=new th;return o.r=s,o.Ee(),o.iterator}get count(){let t=this.vs;if(null===t)return this.$t.r.length;{let e=0,i=this.$t.r,s=i.length;for(let n=0;n<s;n++)t(i[n])&&e++;return e}}xl(){this.key=-1,this.value=null,this.jt=-1,this.vs=null,this.$t.fr=this}toString(){return"ListIterator@"+this.Ft+"/"+this.$t.count}}class to{$t;jt;Ft;constructor(t){this.$t=t,t.ur=null,this.jt=t.ht,this.Ft=t.r.length}[Symbol.iterator](){return this.$t.r.reverse().values()}key;value;get iterator(){return this}reset(){let t=this.$t;t.ur=null,this.jt=t.ht,this.Ft=t.r.length}next(){let t=this.$t;if(t.ht!==this.jt){if(this.key<0)return!1;te.Ie(t)}let e=--this.Ft;return e>=0?(this.key=e,this.value=t.r[e],!0):(this.xl(),!1)}hasNext(){return this.next()}first(){let t=this.$t;this.jt=t.ht;let e=t.r,i=e.length-1;if(this.Ft=i,!(i>=0))return null;{let t=e[i];return this.key=i,this.value=t,t}}any(t){let e=this.$t;e.ur=null;let i=e.ht,s=e.r,n=s.length;this.Ft=n;for(let l=n-1;l>=0;l--){if(t(s[l]))return!0;e.ht!==i&&te.Ie(e)}return!1}all(t){let e=this.$t;e.ur=null;let i=e.ht,s=e.r,n=s.length;this.Ft=n;for(let l=n-1;l>=0;l--){if(!t(s[l]))return!1;e.ht!==i&&te.Ie(e)}return!0}each(t){let e=this.$t;e.ur=null;let i=e.ht,s=e.r,n=s.length;this.Ft=n;for(let l=n-1;l>=0;l--)t(s[l]),e.ht!==i&&te.Ie(e);return this}map(t){let e=this.$t;e.ur=null;let i=e.ht,s=[],n=e.r,l=n.length;this.Ft=l;for(let r=l-1;r>=0;r--){let l=n[r];s.push(t(l)),e.ht!==i&&te.Ie(e)}let r=new th;return r.r=s,r.Ee(),r.iterator}filter(t){let e=this.$t;e.ur=null;let i=e.ht,s=[],n=e.r,l=n.length;this.Ft=l;for(let r=l-1;r>=0;r--){let l=n[r];t(l)&&s.push(l),e.ht!==i&&te.Ie(e)}let r=new th;return r.r=s,r.Ee(),r.iterator}get count(){return this.$t.r.length}xl(){this.key=-1,this.value=null,this.jt=-1,this.$t.ur=this}toString(){return"ListIteratorBackwards("+this.Ft+"/"+this.$t.count+")"}}class th{h;r;ht;fr;ur;constructor(t){tu.qi(this),this.h=!1,this.r=[],this.ht=0,this.fr=null,this.ur=null,void 0!==t&&this.addAll(t)}[Symbol.iterator](){return this.r.values()}Ee(){let t=this.ht;++t>0x3b9ac9ff&&(t=0),this.ht=t}u(){return this.h=!0,this}At(){return this.h=!1,this}toString(){return"List()#"+tu.us(this)}add(t){return this.h&&te.D(this,t),this.r.push(t),this.Ee(),this}push(t){this.add(t)}addAll(t){if(null===t)return this;this.h&&te.D(this);let e=this.r;if(Array.isArray(t)){let i=t.length;for(let s=0;s<i;s++){let i=t[s];e.push(i)}}else{let i=t.iterator;for(;i.next();){let t=i.value;e.push(t)}}return this.Ee(),this}clear(){this.h&&te.D(this),this.r.length=0,this.Ee()}contains(t){return this.has(t)}has(t){return null!==t&&-1!==this.r.indexOf(t)}indexOf(t){return null===t?-1:this.r.indexOf(t)}elt(t){let e=this.r;return(t<0||t>=e.length)&&te._(t,"0 <= i < length",th,"elt:i"),e[t]}get(t){return this.elt(t)}setElt(t,e){let i=this.r;(t<0||t>=i.length)&&te._(t,"0 <= i < length",th,"setElt:i"),this.h&&te.D(this,t),i[t]=e}set(t,e){this.setElt(t,e)}first(){let t=this.r;return 0===t.length?null:t[0]}last(){let t=this.r,e=t.length;return e>0?t[e-1]:null}pop(){this.h&&te.D(this);let t=this.r;return t.length>0?t.pop():null}any(t){let e=this.r,i=this.ht,s=e.length;for(let n=0;n<s;n++){if(t(e[n]))return!0;this.ht!==i&&te.Ie(this)}return!1}all(t){let e=this.r,i=this.ht,s=e.length;for(let n=0;n<s;n++){if(!t(e[n]))return!1;this.ht!==i&&te.Ie(this)}return!0}each(t){let e=this.r,i=this.ht,s=e.length;for(let n=0;n<s;n++)t(e[n]),this.ht!==i&&te.Ie(this);return this}map(t){let e=new th,i=[],s=this.r,n=this.ht,l=s.length;for(let e=0;e<l;e++)i.push(t(s[e])),this.ht!==n&&te.Ie(this);return e.r=i,e.Ee(),e}filter(t){let e=new th,i=[],s=this.r,n=this.ht,l=s.length;for(let e=0;e<l;e++){let l=s[e];t(l)&&i.push(l),this.ht!==n&&te.Ie(this)}return e.r=i,e.Ee(),e}insertAt(t,e){t<0&&te._(t,">= 0",th,"insertAt:i"),this.h&&te.D(this,t);let i=this.r;t>=i.length?i.push(e):i.splice(t,0,e),this.Ee()}remove(t){return this.delete(t)}delete(t){if(null===t)return!1;this.h&&te.D(this,t);let e=this.r,i=e.indexOf(t);return -1!==i&&(i===e.length-1?e.pop():e.splice(i,1),this.Ee(),!0)}removeAt(t){let e=this.r;(t<0||t>=e.length)&&te._(t,"0 <= i < length",th,"removeAt:i"),this.h&&te.D(this,t),t===e.length-1?e.pop():e.splice(t,1),this.Ee()}removeRange(t,e){let i=this.r,s=i.length;if(t<0)t=0;else if(t>=s)return this;if(e<0||(e>=s&&(e=s-1),t>e))return this;this.h&&te.D(this);let n=t,l=e+1;for(;l<s;)i[n++]=i[l++];return i.length=s-(e-t+1),this.Ee(),this}copy(){let t=new th,e=this.r;return e.length>0&&(t.r=Array.prototype.slice.call(e)),t}toArray(){let t=this.r,e=this.count,i=Array(e);for(let s=0;s<e;s++)i[s]=t[s];return i}get rC(){return this.r}toSet(){let t=new tu,e=this.r,i=this.count;for(let s=0;s<i;s++)t.add(e[s]);return t}sort(t){return this.h&&te.D(this),this.r.sort(t),this.Ee(),this}sortRange(t,e,i){let s=this.r,n=s.length;void 0===e&&(e=0),void 0===i&&(i=n),this.h&&te.D(this);let l=i-e;if(l<=1)return this;if((e<0||e>=n-1)&&te._(e,"0 <= from < length",th,"sortRange:from"),2===l){let i=s[e],n=s[e+1];return t(i,n)>0&&(s[e]=n,s[e+1]=i,this.Ee()),this}if(0===e){if(i>=n)s.sort(t);else{let e=s.slice(0,i);e.sort(t);for(let t=0;t<i;t++)s[t]=e[t]}}else if(i>=n){let i=s.slice(e);i.sort(t);for(let t=e;t<n;t++)s[t]=i[t-e]}else{let n=s.slice(e,i);n.sort(t);for(let t=e;t<i;t++)s[t]=n[t-e]}return this.Ee(),this}reverse(){return this.h&&te.D(this),this.r.reverse(),this.Ee(),this}get count(){return this.r.length}get size(){return this.r.length}get length(){return this.r.length}get iterator(){if(this.r.length<=0)return tn.instance;let t=this.fr;return null!==t?(t.reset(),t):new tr(this)}get iteratorBackwards(){if(this.r.length<=0)return tn.instance;let t=this.ur;return null!==t?(t.reset(),t):new to(this)}}class ta{Co;ni;constructor(t){this.Co=t,this.ni=t.g.values()}[Symbol.iterator](){return this.Co.g.values()}key;value;get iterator(){return this}reset(){let t=this.Co;this.ni=t.g.values()}next(){let t=this.ni.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return 0===this.Co.g.size?null:(this.ni=this.Co.g.values(),this.ni.next().value)}any(t){return this.Co.any(t)}all(t){return this.Co.all(t)}each(t){return this.Co.each(t),this}map(t){let e=new th;return this.Co.g.forEach(i=>e.add(t(i))),e.iterator}filter(t){let e=new th;return this.Co.g.forEach(i=>{t(i)&&e.add(i)}),e.iterator}get count(){return this.Co.count}xl(){this.key=null,this.value=null,this.ni=null}toString(){return"SetIterator"}}class tu{h;g;constructor(t){this.h=!1,this.g=new Set,void 0!==t&&this.addAll(t)}[Symbol.iterator](){return this.g.values()}values(){return this.g.values()}u(){return this.h=!0,this}At(){return this.h=!1,this}toString(){return"Set()#"+tu.us(this)}add(t){return null===t||this.g.add(t),this}addAll(t){if(null===t)return this;if(Array.isArray(t)){let e=t.length;for(let i=0;i<e;i++){let e=t[i];null!==e&&this.g.add(e)}}else{let e=t.iterator;for(;e.next();){let t=e.value;null!==t&&this.g.add(t)}}return this}has(t){return this.g.has(t)}contains(t){return this.has(t)}containsAll(t){if(null===t)return!0;let e=t.iterator;for(;e.next();)if(!this.has(e.value))return!1;return!0}containsAny(t){if(null===t)return!0;let e=t.iterator;for(;e.next();)if(this.has(e.value))return!0;return!1}first(){return 0===this.g.size?null:this.g.values().next().value}any(t){for(let e of this.g)if(t(e))return!0;return!1}all(t){for(let e of this.g)if(!t(e))return!1;return!0}each(t){for(let e of this.g)t(e);return this}map(t){let e=new tu;for(let i of this.g)e.add(t(i));return e}filter(t){let e=new tu;for(let i of this.g)t(i)&&e.add(i);return e}delete(t){return this.h&&te.D(this),this.g.delete(t)}remove(t){return this.delete(t)}removeAll(t){if(null===t)return this;if(this.h&&te.D(this),Array.isArray(t)){let e=t.length;for(let i=0;i<e;i++)this.delete(t[i])}else{let e=t.iterator;for(;e.next();)this.delete(e.value)}return this}retainAll(t){if(null===t||0===this.count)return this;this.h&&te.D(this);let e=new tu;e.addAll(t);let i=[],s=this.iterator;for(;s.next();){let t=s.value;e.has(t)||i.push(t)}return this.removeAll(i),this}clear(){this.h&&te.D(this),this.g.clear()}copy(){let t=new tu;return this.g.forEach(e=>t.add(e)),t}toArray(){return Array.from(this.g)}toList(){let t=new th;return this.g.forEach(e=>t.add(e)),t}get count(){return this.g.size}get size(){return this.g.size}get iterator(){return this.g.size<=0?tn.instance:new ta(this)}entries(){return this.g.entries()}keys(){return this.g.keys()}forEach(t,e){return this.g.forEach(t,e)}static dw=1;static qi(t){t.__gohashid=tu.dw++}static us(t){return t.__gohashid}}class td{Z;ni;constructor(t){this.Z=t,this.ni=t.g.keys()}[Symbol.iterator](){return this.Z.g.keys()}key;value;get iterator(){return this}reset(){let t=this.Z;this.ni=t.g.keys()}next(){let t=this.ni.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return 0===this.Z.g.size?null:(this.ni=this.Z.g.keys(),this.ni.next().value)}any(t){for(let e of this.Z.g)if(t(e[0]))return!0;return!1}all(t){for(let e of this.Z.g)if(!t(e[0]))return!1;return!0}each(t){for(let e of this.Z.g)t(e[0]);return this}map(t){let e=this.Z,i=new th;for(let s of e.g)i.add(t(s[0]));return i.iterator}filter(t){let e=this.Z,i=new th;for(let s of e.g){let e=s[0];t(e)&&i.add(e)}return i.iterator}get count(){return this.Z.size}xl(){this.key=null,this.value=null,this.ni=null}toString(){return"MapKeySetIterator"}}class tc extends tu{Z;constructor(t){super(),tu.qi(this),this.h=!0,this.Z=t}[Symbol.iterator](){return this.g.keys()}values(){return this.g.keys()}u(){return this}At(){return this}toString(){return"MapKeySet("+this.Z.toString()+")"}add(t){te.o("This Set is read-only: "+this.toString())}has(t){return this.Z.has(t)}contains(t){return this.has(t)}delete(t){te.o("This Set is read-only: "+this.toString())}remove(t){return this.delete(t)}clear(){te.o("This Set is read-only: "+this.toString())}first(){return 0===this.Z.g.size?null:this.Z.g.keys().next().value}any(t){for(let e of this.Z.g)if(t(e[0]))return!0;return!1}all(t){for(let e of this.Z.g)if(!t(e[0]))return!1;return!0}each(t){for(let e of this.Z.g)t(e[0]);return this}map(t){let e=new tu;for(let i of this.Z.g)e.add(t(i[0]));return e}filter(t){let e=new tu;for(let i of this.Z.g){let s=i[0];t(s)&&e.add(s)}return e}copy(){return new tc(this.Z)}toSet(){let t=new tu;for(let e of this.Z.g)t.add(e[0]);return t}toArray(){let t=this.Z.g,e=Array(t.size),i=0;for(let s of t)e[i]=s[0],i++;return e}toList(){let t=new th;for(let e of this.Z.g)t.add(e[0]);return t}get count(){return this.Z.size}get size(){return this.Z.size}get iterator(){return this.Z.size<=0?tn.instance:new td(this.Z)}}class tg{Z;ni;constructor(t){this.Z=t,this.ni=t.g.values()}[Symbol.iterator](){return this.Z.g.values()}key;value;get iterator(){return this}reset(){let t=this.Z;this.ni=t.g.values()}next(){let t=this.ni.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return 0===this.Z.g.size?null:(this.ni=this.Z.g.values(),this.ni.next().value)}any(t){for(let e of this.Z.g)if(t(e[1]))return!0;return!1}all(t){for(let e of this.Z.g)if(!t(e[1]))return!1;return!0}each(t){for(let e of this.Z.g)t(e[1]);return this}map(t){let e=this.Z,i=new th;for(let s of e.g)i.add(t(s[1]));return i.iterator}filter(t){let e=this.Z,i=new th;for(let s of e.g){let e=s[1];t(e)&&i.add(e)}return i.iterator}get count(){return this.Z.size}xl(){this.key=null,this.value=null,this.ni=null}toString(){return"MapValueSetIterator"}}class tf{constructor(t,e){this.key=t,this.value=e}toString(){return"{"+this.key+":"+this.value+"}"}key;value}class tm{Z;ni;constructor(t){this.Z=t,this.ni=t.g.entries()}[Symbol.iterator](){return this.Z.g.entries()}key;value;get iterator(){return this}reset(){let t=this.Z;this.ni=t.g.entries()}next(){let t=this.ni.next();return t.done?(this.key=null,this.value=null,!1):(this.key=t.value[0],this.value=t.value[1],!0)}hasNext(){return this.next()}first(){if(0===this.Z.g.size)return null;this.ni=this.Z.g.entries();let t=this.ni.next().value;return this.key=t[0],this.value=t[1],new tf(t[0],t[1])}any(t){return this.Z.any(t)}all(t){return this.Z.all(t)}each(t){return this.Z.each(t),this}map(t){let e=new th,i=null;return this.Z.g.forEach((s,n)=>{null===i?i=new tf(n,s):(i.key=n,i.value=s),e.add(t(i))}),e.iterator}filter(t){let e=new th,i=null;return this.Z.g.forEach((s,n)=>{null===i?i=new tf(n,s):(i.key=n,i.value=s),t(i)&&(e.add(i),i=null)}),e.iterator}get count(){return this.Z.size}xl(){this.key=null,this.value=null,this.ni=null}toString(){return"MapIterator"}}class tp{h;g;constructor(t){tu.qi(this),this.h=!1,this.g=new Map,void 0!==t&&this.addAll(t)}[Symbol.iterator](){return this.g.entries()}entries(){return this.g.entries()}u(){return this.h=!0,this}At(){return this.h=!1,this}toString(){return"Map()#"+tu.us(this)}set(t,e){return this.h&&te.D(this,t),this.g.set(t,e),this}add(t,e){return this.set(t,e)}addAll(t){if(null===t)return this;if(this.h&&te.D(this),Array.isArray(t)){let e=t.length;for(let i=0;i<e;i++){let e=t[i];this.set(e.key,e.value)}}else if(t instanceof tp){let e=t.iterator;for(;e.next();)this.set(e.key,e.value)}else{let e=t.iterator;for(;e.next();){let t=e.value;this.set(t.key,t.value)}}return this}first(){if(0===this.g.size)return null;let t=this.g.entries().next().value;return new tf(t[0],t[1])}any(t){let e=null;for(let[i,s]of this.g)if(null===e?e=new tf(i,s):(e.key=i,e.value=s),t(e))return!0;return!1}all(t){let e=null;for(let[i,s]of this.g)if(null===e?e=new tf(i,s):(e.key=i,e.value=s),!t(e))return!1;return!0}each(t){let e=null;for(let[i,s]of this.g)null===e?e=new tf(i,s):(e.key=i,e.value=s),t(e);return this}map(t){let e=new tp,i=null;for(let[s,n]of this.g)null===i?i=new tf(s,n):(i.key=s,i.value=n),e.set(s,t(i));return e}filter(t){let e=new tp,i=null;for(let[s,n]of this.g)null===i?i=new tf(s,n):(i.key=s,i.value=n),t(i)&&e.set(s,n);return e}has(t){return this.g.has(t)}contains(t){return this.has(t)}get(t){let e=this.g.get(t);return void 0===e?null:e}getValue(t){return this.get(t)}delete(t){return null!==t&&(this.h&&te.D(this,t),this.g.delete(t))}remove(t){return this.delete(t)}clear(){this.h&&te.D(this),this.g.clear()}copy(){let t=new tp;return t.g=new Map(this.g),t}toArray(){let t=this.g,e=Array(t.size),i=0;for(let s of t)e[i]=new tf(s[0],s[1]),i++;return e}toKeySet(){return new tc(this)}get count(){return this.g.size}get size(){return this.g.size}get iterator(){return this.g.size<=0?tn.instance:new tm(this)}get iteratorKeys(){return this.count<=0?tn.instance:new td(this)}keys(){return this.g.keys()}get iteratorValues(){return this.count<=0?tn.instance:new tg(this)}values(){return this.g.values()}forEach(t,e){return this.g.forEach(t,e)}}class ty{p;w;h;constructor(t,e){void 0===t?(this.p=0,this.w=0):"number"==typeof t&&"number"==typeof e?(this.p=t,this.w=e):te.o("Invalid arguments to Point constructor: "+t+", "+e),this.h=!1}a(t){return this.p=t.p,this.w=t.w,this}i(t,e){return this.p=t,this.w=e,this}setTo(t,e){return this.p=t,this.w=e,this}set(t){return this.p=t.p,this.w=t.w,this}copy(){let t=new ty;return t.p=this.p,t.w=this.w,t}it(){return this.h=!0,Object.freeze(this),this}N(){return this.h||Object.isFrozen(this)?this:this.copy().u()}u(){return this.h||(this.h=!0),this}At(){return this.h&&(Object.isFrozen(this)&&te.o("cannot thaw constant: "+this),this.h=!1),this}gw(t){}static parse(t){if("string"!=typeof t)return new ty;{let e=t.split(" "),i=0,s=0;for(;""===e[i];)i++;let n=e[i++];n&&(s=parseFloat(n));let l=0;for(;""===e[i];)i++;return(n=e[i++])&&(l=parseFloat(n)),new ty(s,l)}}static stringify(t){return t.x.toString()+" "+t.y.toString()}static stringifyFixed(t){return te.s(t,"number",ty,"stringifyFixed:digits"),e=>e.x.toFixed(t)+" "+e.y.toFixed(t)}toString(){return"Point("+this.x+","+this.y+")"}equals(t){return t instanceof ty&&this.p===t.x&&this.w===t.y}equalTo(t,e){return this.p===t&&this.w===e}equalsApprox(t){return tP.f(this.p,t.x)&&tP.f(this.w,t.y)}add(t){return this.p+=t.x,this.w+=t.y,this}subtract(t){return this.p-=t.x,this.w-=t.y,this}offset(t,e){return this.p+=t,this.w+=e,this}rotate(t){if(0===t)return this;let e=this.p,i=this.w;if(0===e&&0===i)return this;let s=0,n=0;if(t>=360?t-=360:t<0&&(t+=360),90===t)s=0,n=1;else if(180===t)s=-1,n=0;else if(270===t)s=0,n=-1;else{let e=t*Math.PI/180;s=Math.cos(e),n=Math.sin(e)}return this.p=s*e-n*i,this.w=n*e+s*i,this}scale(t,e){return this.p*=t,this.w*=e,this}distanceSquaredPoint(t){let e=t.x-this.p,i=t.y-this.w;return e*e+i*i}distanceSquared(t,e){let i=t-this.p,s=e-this.w;return i*i+s*s}normalize(){let t=this.p,e=this.w,i=Math.sqrt(t*t+e*e);return i>0&&(this.p=t/i,this.w=e/i),this}directionPoint(t){return this.lC(t.x-this.p,t.y-this.w)}direction(t,e){return this.lC(t-this.p,e-this.w)}lC(t,e){if(0===t)return e>0?90:270*(e<0);if(0===e)return t>0?0:180;{if(isNaN(t)||isNaN(e))return 0;let i=180*Math.atan(Math.abs(e/t))/Math.PI;return t<0?e<0?i+=180:i=180-i:e<0&&(i=360-i),i}}static compareWithLineSegment(t,e,i,s,n,l){return tP.hu(t,e,i,s,n,l)}compareWithLineSegmentPoint(t,e){return tP.hu(t.x,t.y,e.x,e.y,this.x,this.y)}static intersectingLineSegments(t,e,i,s,n,l,r,o){return tP.au(t,e,i,s,n,l,r,o)}projectOntoLineSegment(t,e,i,s){return tP.bl(t,e,i,s,this.p,this.w,this),this}projectOntoLineSegmentPoint(t,e){return tP.bl(t.x,t.y,e.x,e.y,this.p,this.w,this),this}snapToGrid(t,e,i,s){return tP.Ig(this.p,this.w,t,e,i,s,this),this}snapToGridPoint(t,e){return tP.Ig(this.p,this.w,t.x,t.y,e.width,e.height,this),this}setRectSpot(t,e){return this.p=t.x+e.x*t.width+e.offsetX,this.w=t.y+e.y*t.height+e.offsetY,this}setSpot(t,e,i,s,n){return this.p=t+n.x*i+n.offsetX,this.w=e+n.y*s+n.offsetY,this}F(t){return t.xt(this),this}Be(t){return t._e(this),this}static distanceLineSegmentSquared(t,e,i,s,n,l){let r=n-i,o=l-s,h=r*r+o*o,a=i-t,u=s-e,d=-a*r-u*o;if(d<=0||d>=h)return Math.min(a*a+u*u,(r=n-t)*r+(o=l-e)*o);{let t=r*u-o*a;return t*t/h}}static distanceSquared(t,e,i,s){let n=i-t,l=s-e;return n*n+l*l}static direction(t,e,i,s){let n=i-t,l=s-e;if(0===n)return l>0?90:270*(l<0);if(0===l)return n>0?0:180;{if(isNaN(n)||isNaN(l))return 0;let t=180*Math.atan(Math.abs(l/n))/Math.PI;return n<0?l<0?t+=180:t=180-t:l<0&&(t=360-t),t}}get x(){return this.p}set x(t){this.p=t}get y(){return this.w}set y(t){this.w=t}isReal(){return isFinite(this.x)&&isFinite(this.y)}static Lo=new ty(0,0).it();static hC=new ty(-1/0,-1/0).it();static aC=new ty(1/0,1/0).it();static cC=new ty(6,6).it();static Ak=new ty(NaN,NaN).it();static Tk=[];static l(){let t=ty.Tk.pop();return void 0===t?new ty:t}static X(t,e){let i=ty.Tk.pop();return void 0===i?new ty(t,e):(i.x=t,i.y=e,i)}static e(t){ty.Tk.push(t)}}class tx{j;q;h;constructor(t,e){void 0===t?(this.j=0,this.q=0):"number"==typeof t&&(t>=0||isNaN(t))&&"number"==typeof e&&(e>=0||isNaN(e))?(this.j=t,this.q=e):te.o("Invalid arguments to Size constructor: "+t+", "+e),this.h=!1}a(t){return this.j=t.j,this.q=t.q,this}i(t,e){return this.j=t,this.q=e,this}setTo(t,e){return this.j=t,this.q=e,this}set(t){return this.j=t.j,this.q=t.q,this}copy(){let t=new tx;return t.j=this.j,t.q=this.q,t}it(){return this.h=!0,Object.freeze(this),this}N(){return this.h||Object.isFrozen(this)?this:this.copy().u()}u(){return this.h||(this.h=!0),this}At(){return this.h&&(Object.isFrozen(this)&&te.o("cannot thaw constant: "+this),this.h=!1),this}gw(t){}static parse(t){if("string"!=typeof t)return new tx;{let e=t.split(" "),i=0,s=0;for(;""===e[i];)i++;let n=e[i++];n&&(s=parseFloat(n));let l=0;for(;""===e[i];)i++;return(n=e[i++])&&(l=parseFloat(n)),new tx(s,l)}}static stringify(t){return t.width.toString()+" "+t.height.toString()}static stringifyFixed(t){return te.s(t,"number",tx,"stringifyFixed:digits"),e=>e.width.toFixed(t)+" "+e.height.toFixed(t)}toString(){return"Size("+this.width+","+this.height+")"}equals(t){return t instanceof tx&&this.j===t.width&&this.q===t.height}equalTo(t,e){return this.j===t&&this.q===e}equalsApprox(t){return tP.f(this.j,t.width)&&tP.f(this.q,t.height)}inflate(t,e){let i=this.width+t;this.j=i>=0?i:0;let s=this.height+e;return this.q=s>=0?s:0,this}get width(){return this.j}set width(t){t<0&&te._(t,">= 0",tx,"width"),this.j=t}get height(){return this.q}set height(t){t<0&&te._(t,">= 0",tx,"height"),this.q=t}isReal(){return isFinite(this.width)&&isFinite(this.height)}static hc=new tx(0,0).it();static Dk=new tx(1,1).it();static fC=new tx(6,6).it();static cu=new tx(8,8).it();static uC=new tx(10,10).it();static Fk=new tx(1/0,1/0).it();static mw=new tx(NaN,NaN).it();static dC=[];static l(){let t=tx.dC.pop();return void 0===t?new tx:t}static e(t){tx.dC.push(t)}}class tw{p;w;j;q;h;constructor(t,e,i,s){if(void 0===t)this.p=0,this.w=0,this.j=0,this.q=0;else if("number"==typeof t&&"number"==typeof e&&"number"==typeof i&&(i>=0||isNaN(i))&&"number"==typeof s&&(s>=0||isNaN(s)))this.p=t,this.w=e,this.j=i,this.q=s;else if(t instanceof ty){let i=t.x,s=t.y;if(e instanceof ty){let t=e.x,n=e.y;this.p=Math.min(i,t),this.w=Math.min(s,n),this.j=Math.abs(i-t),this.q=Math.abs(s-n)}else e instanceof tx?(this.p=i,this.w=s,this.j=e.width,this.q=e.height):te.o("Incorrect second argument supplied to Rect constructor "+e)}else te.o("Invalid arguments to Rect constructor: "+t+", "+e+", "+i+", "+s);this.h=!1}a(t){return this.p=t.p,this.w=t.w,this.j=t.j,this.q=t.q,this}i(t,e,i,s){return this.p=t,this.w=e,this.j=i,this.q=s,this}zn(t,e){return this.j=t,this.q=e,this}setTo(t,e,i,s){return this.p=t,this.w=e,this.j=i,this.q=s,this}set(t){return this.p=t.p,this.w=t.w,this.j=t.j,this.q=t.q,this}setPoint(t){return this.p=t.x,this.w=t.y,this}setSize(t){return this.j=t.width,this.q=t.height,this}copy(){let t=new tw;return t.p=this.p,t.w=this.w,t.j=this.j,t.q=this.q,t}it(){return this.h=!0,Object.freeze(this),this}N(){return this.h||Object.isFrozen(this)?this:this.copy().u()}u(){return this.h||(this.h=!0),this}At(){return this.h&&(Object.isFrozen(this)&&te.o("cannot thaw constant: "+this),this.h=!1),this}gw(t){}static parse(t){if("string"!=typeof t)return new tw;{let e=t.split(" "),i=0,s=0;for(;""===e[i];)i++;let n=e[i++];n&&(s=parseFloat(n));let l=0;for(;""===e[i];)i++;(n=e[i++])&&(l=parseFloat(n));let r=0;for(;""===e[i];)i++;(n=e[i++])&&(r=parseFloat(n));let o=0;for(;""===e[i];)i++;return(n=e[i++])&&(o=parseFloat(n)),new tw(s,l,r,o)}}static stringify(t){return t.x.toString()+" "+t.y.toString()+" "+t.width.toString()+" "+t.height.toString()}static stringifyFixed(t){return te.s(t,"number",tw,"stringifyFixed:digits"),e=>e.x.toFixed(t)+" "+e.y.toFixed(t)+" "+e.width.toFixed(t)+" "+e.height.toFixed(t)}toString(){return"Rect("+this.x+","+this.y+","+this.width+","+this.height+")"}equals(t){return t instanceof tw&&this.p===t.x&&this.w===t.y&&this.j===t.width&&this.q===t.height}equalTo(t,e,i,s){return this.p===t&&this.w===e&&this.j===i&&this.q===s}equalsApprox(t){return tP.f(this.p,t.x)&&tP.f(this.w,t.y)&&tP.f(this.j,t.width)&&tP.f(this.q,t.height)}equalsApproxTo(t,e,i,s){return tP.f(this.p,t)&&tP.f(this.w,e)&&tP.f(this.j,i)&&tP.f(this.q,s)}equalsApproxClose(t){return tP.Y(this.p,t.x)&&tP.Y(this.w,t.y)&&tP.Y(this.j,t.width)&&tP.Y(this.q,t.height)}containsPoint(t){return this.p<=t.x&&this.p+this.j>=t.x&&this.w<=t.y&&this.w+this.q>=t.y}containsRect(t){return this.p<=t.x&&t.x+t.width<=this.p+this.j&&this.w<=t.y&&t.y+t.height<=this.w+this.q}contains(t,e,i,s){return void 0===i&&(i=0),void 0===s&&(s=0),this.p<=t&&t+i<=this.p+this.j&&this.w<=e&&e+s<=this.w+this.q}offset(t,e){return this.p+=t,this.w+=e,this}inflate(t,e){return this.pw(e,t,e,t)}addMargin(t){return this.pw(t.top,t.right,t.bottom,t.left)}subtractMargin(t){return this.pw(-t.top,-t.right,-t.bottom,-t.left)}grow(t,e,i,s){return this.pw(t,e,i,s)}pw(t,e,i,s){let n=this.j;e+s<=-n?(this.p+=n/2,this.j=0):(this.p-=s,this.j+=e+s);let l=this.q;return t+i<=-l?(this.w+=l/2,this.q=0):(this.w-=t,this.q+=t+i),this}intersectRect(t){return this.gC(t.x,t.y,t.width,t.height)}intersect(t,e,i,s){return this.gC(t,e,i,s)}gC(t,e,i,s){let n=Math.max(this.p,t),l=Math.max(this.w,e),r=Math.min(this.p+this.j,t+i),o=Math.min(this.w+this.q,e+s);return this.p=n,this.w=l,this.j=Math.max(0,r-n),this.q=Math.max(0,o-l),this}intersectsRect(t){return this.intersects(t.x,t.y,t.width,t.height)}intersects(t,e,i,s){let n=this.j,l=this.p;if(n!==1/0&&i!==1/0&&(n+=l,isNaN(i+=t)||isNaN(n)||l>i||t>n))return!1;let r=this.q,o=this.w;return!(r!==1/0&&s!==1/0&&(r+=o,isNaN(s+=e)||isNaN(r)||o>s||e>r))}intersectsRectPlus(t,e){let i=this.j,s=t.width+e+e,n=this.p,l=t.x-e;if(i+=n,n>(s+=l)||l>i)return!1;let r=this.q,o=t.height+e+e,h=this.w,a=t.y-e;return r+=h,!(h>(o+=a)||a>r)}unionPoint(t){return this.unionNoCheck(t.x,t.y,0,0)}unionRect(t){return this.unionNoCheck(t.p,t.w,t.j,t.q)}union(t,e,i,s){return void 0===i&&(i=0),void 0===s&&(s=0),this.unionNoCheck(t,e,i,s)}unionNoCheck(t,e,i,s){let n=Math.min(this.p,t),l=Math.min(this.w,e),r=Math.max(this.p+this.j,t+i),o=Math.max(this.w+this.q,e+s);return this.p=n,this.w=l,this.j=r-n,this.q=o-l,this}setSpot(t,e,i){return this.p=t-i.offsetX-i.x*this.j,this.w=e-i.offsetY-i.y*this.q,this}static contains(t,e,i,s,n,l,r,o){return void 0===r&&(r=0),void 0===o&&(o=0),t<=n&&n+r<=t+i&&e<=l&&l+o<=e+s}static intersects(t,e,i,s,n,l,r,o){let h=i,a=r;if(h+=t,t>(a+=n)||n>h)return!1;let u=s,d=o;return u+=e,!(e>(d+=l)||l>u)}static intersectsLineSegment(t,e,i,s,n,l,r,o){return tP.mC(t,e,i,s,n,l,r,o)}get x(){return this.p}set x(t){this.p=t}get y(){return this.w}set y(t){this.w=t}get width(){return this.j}set width(t){t<0&&te._(t,">= 0",tw,"width"),this.j=t}get height(){return this.q}set height(t){t<0&&te._(t,">= 0",tw,"height"),this.q=t}get left(){return this.p}set left(t){this.p=t}get top(){return this.w}set top(t){this.w=t}get right(){return this.p+this.j}set right(t){this.p+=t-(this.p+this.j)}get bottom(){return this.w+this.q}set bottom(t){this.w+=t-(this.w+this.q)}get position(){return new ty(this.p,this.w)}set position(t){this.p=t.x,this.w=t.y}get size(){return new tx(this.j,this.q)}set size(t){this.j=t.width,this.q=t.height}get center(){return new ty(this.p+this.j/2,this.w+this.q/2)}set center(t){this.p=t.x-this.j/2,this.w=t.y-this.q/2}get centerX(){return this.p+this.j/2}set centerX(t){this.p=t-this.j/2}get centerY(){return this.w+this.q/2}set centerY(t){this.w=t-this.q/2}isReal(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)}isEmpty(){return 0===this.width&&0===this.height}static Eg=new tw(0,0,0,0).it();static KD=new tw(NaN,NaN,NaN,NaN).it();static Rk=[];static l(){let t=tw.Rk.pop();return void 0===t?new tw:t}static X(t,e,i,s){let n=tw.Rk.pop();return void 0===n?new tw(t,e,i,s):n.i(t,e,i,s)}static e(t){tw.Rk.push(t)}}class tb{rn;ln;hn;an;h;constructor(t,e,i,s){void 0===t?(this.rn=0,this.ln=0,this.hn=0,this.an=0):void 0===e?(e=t,i=t,s=t,this.top=t,this.right=e,this.bottom=i,this.left=s):void 0===i?(i=t,s=e,this.top=t,this.right=e,this.bottom=i,this.left=s):void 0!==s?(this.top=t,this.right=e,this.bottom=i,this.left=s):te.o("Invalid arguments to Margin constructor: "+t+", "+e+", "+i+", "+s),this.h=!1}a(t){return this.rn=t.rn,this.ln=t.ln,this.hn=t.hn,this.an=t.an,this}setTo(t,e,i,s){return this.rn=t,this.ln=e,this.hn=i,this.an=s,this}set(t){return this.rn=t.rn,this.ln=t.ln,this.hn=t.hn,this.an=t.an,this}copy(){let t=new tb;return t.rn=this.rn,t.ln=this.ln,t.hn=this.hn,t.an=this.an,t}it(){return this.h=!0,Object.freeze(this),this}N(){return this.h||Object.isFrozen(this)?this:this.copy().u()}u(){return this.h||(this.h=!0),this}At(){return this.h&&(Object.isFrozen(this)&&te.o("cannot thaw constant: "+this),this.h=!1),this}gw(t){}static parse(t){if("string"!=typeof t)return new tb;{let e=t.split(" "),i=0,s=NaN;for(;""===e[i];)i++;let n=e[i++];if(n&&(s=parseFloat(n)),isNaN(s))return new tb;let l=NaN;for(;""===e[i];)i++;if((n=e[i++])&&(l=parseFloat(n)),isNaN(l))return new tb(s);let r=NaN;for(;""===e[i];)i++;if((n=e[i++])&&(r=parseFloat(n)),isNaN(r))return new tb(s,l);let o=NaN;for(;""===e[i];)i++;return(n=e[i++])&&(o=parseFloat(n)),isNaN(o)?new tb(s,l):new tb(s,l,r,o)}}static stringify(t){return t.top.toString()+" "+t.right.toString()+" "+t.bottom.toString()+" "+t.left.toString()}static stringifyFixed(t){return te.s(t,"number",tb,"stringifyFixed:digits"),e=>e.top.toFixed(t)+" "+e.right.toFixed(t)+" "+e.bottom.toFixed(t)+" "+e.left.toFixed(t)}toString(){return"Margin("+this.top+","+this.right+","+this.bottom+","+this.left+")"}equals(t){return t instanceof tb&&this.rn===t.top&&this.ln===t.right&&this.hn===t.bottom&&this.an===t.left}equalTo(t,e,i,s){return this.rn===t&&this.ln===e&&this.hn===i&&this.an===s}equalsApprox(t){return tP.f(this.rn,t.top)&&tP.f(this.ln,t.right)&&tP.f(this.hn,t.bottom)&&tP.f(this.an,t.left)}get top(){return this.rn}set top(t){this.rn=t}get right(){return this.ln}set right(t){this.ln=t}get bottom(){return this.hn}set bottom(t){this.hn=t}get left(){return this.an}set left(t){this.an=t}isReal(){return isFinite(this.top)&&isFinite(this.right)&&isFinite(this.bottom)&&isFinite(this.left)}static Bg=new tb(0,0,0,0).it();static pC=new tb(2,2,2,2).it();static yC=[];static l(){let t=tb.yC.pop();return void 0===t?new tb:t}static e(t){tb.yC.push(t)}}class tv{p;w;Os;Is;h;constructor(t,e,i,s){void 0===t?(this.p=0,this.w=0,this.Os=0,this.Is=0):(void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),this.x=t,this.y=e,this.offsetX=i,this.offsetY=s),this.h=!1}a(t){return this.p=t.p,this.w=t.w,this.Os=t.Os,this.Is=t.Is,this}setTo(t,e,i,s){return this.p=t,this.w=e,this.Os=i,this.Is=s,this}set(t){return this.p=t.p,this.w=t.w,this.Os=t.Os,this.Is=t.Is,this}copy(){let t=new tv;return t.p=this.p,t.w=this.w,t.Os=this.Os,t.Is=this.Is,t}it(){return this.h=!0,Object.freeze(this),this}N(){return this.h||Object.isFrozen(this)?this:this.copy().u()}u(){return this.h||(this.h=!0),this}At(){return this.h&&(Object.isFrozen(this)&&te.o("cannot thaw constant: "+this),this.h=!1),this}gw(t){}Ue(t){return this.p=NaN,this.w=NaN,this.Os=t,this}fE(t,e){(isNaN(t)||t>1||t<0)&&te._(t,"0 <= "+e+" <= 1",tv,e)}uE(t,e){(isNaN(t)||t===1/0||t===-1/0)&&te._(t,"real number, not NaN or Infinity",tv,e)}static parse(t){if("string"!=typeof t)return new tv;{if("None"===(t=t.trim()))return tv.None;if("TopLeft"===t)return tv.TopLeft;if("Top"===t||"TopCenter"===t||"MiddleTop"===t)return tv.TopCenter;if("TopRight"===t)return tv.TopRight;if("Left"===t||"LeftCenter"===t||"MiddleLeft"===t)return tv.LeftCenter;if("Center"===t)return tv.Center;if("Right"===t||"RightCenter"===t||"MiddleRight"===t)return tv.RightCenter;if("BottomLeft"===t)return tv.BottomLeft;if("Bottom"===t||"BottomCenter"===t||"MiddleBottom"===t)return tv.BottomCenter;if("BottomRight"===t)return tv.BottomRight;if("TopSide"===t)return tv.TopSide;if("LeftSide"===t)return tv.LeftSide;if("RightSide"===t)return tv.RightSide;if("BottomSide"===t)return tv.BottomSide;if("TopBottomSides"===t)return tv.TopBottomSides;if("LeftRightSides"===t)return tv.LeftRightSides;if("TopLeftSides"===t)return tv.TopLeftSides;if("TopRightSides"===t)return tv.TopRightSides;if("BottomLeftSides"===t)return tv.BottomLeftSides;if("BottomRightSides"===t)return tv.BottomRightSides;if("NotTopSide"===t)return tv.NotTopSide;if("NotLeftSide"===t)return tv.NotLeftSide;if("NotRightSide"===t)return tv.NotRightSide;if("NotBottomSide"===t)return tv.NotBottomSide;if("AllSides"===t)return tv.AllSides;if("Default"===t)return tv.Default;let e=t.split(" "),i=0,s=0;for(;""===e[i];)i++;let n=e[i++];void 0!==n&&n.length>0&&(s=parseFloat(n));let l=0;for(;""===e[i];)i++;void 0!==(n=e[i++])&&n.length>0&&(l=parseFloat(n));let r=0;for(;""===e[i];)i++;void 0!==(n=e[i++])&&n.length>0&&(r=parseFloat(n));let o=0;for(;""===e[i];)i++;return void 0!==(n=e[i++])&&n.length>0&&(o=parseFloat(n)),new tv(s,l,r,o)}}static stringify(t){return t.isSpot()?t.x.toString()+" "+t.y.toString()+" "+t.offsetX.toString()+" "+t.offsetY.toString():t.toString()}static stringifyFixed(t){return te.s(t,"number",tv,"stringifyFixed:digits"),e=>e.x.toFixed(t)+" "+e.y.toFixed(t)+" "+e.offsetX.toFixed(t)+" "+e.offsetY.toFixed(t)}toString(){return this.isSpot()?0===this.Os&&0===this.Is?"Spot("+this.x+","+this.y+")":"Spot("+this.x+","+this.y+","+this.offsetX+","+this.offsetY+")":this.equals(tv.None)?"None":this.equals(tv.TopLeft)?"TopLeft":this.equals(tv.TopCenter)?"Top":this.equals(tv.TopRight)?"TopRight":this.equals(tv.LeftCenter)?"Left":this.equals(tv.Center)?"Center":this.equals(tv.RightCenter)?"Right":this.equals(tv.BottomLeft)?"BottomLeft":this.equals(tv.BottomCenter)?"Bottom":this.equals(tv.BottomRight)?"BottomRight":this.equals(tv.TopSide)?"TopSide":this.equals(tv.LeftSide)?"LeftSide":this.equals(tv.RightSide)?"RightSide":this.equals(tv.BottomSide)?"BottomSide":this.equals(tv.TopBottomSides)?"TopBottomSides":this.equals(tv.LeftRightSides)?"LeftRightSides":this.equals(tv.TopLeftSides)?"TopLeftSides":this.equals(tv.TopRightSides)?"TopRightSides":this.equals(tv.BottomLeftSides)?"BottomLeftSides":this.equals(tv.BottomRightSides)?"BottomRightSides":this.equals(tv.NotTopSide)?"NotTopSide":this.equals(tv.NotLeftSide)?"NotLeftSide":this.equals(tv.NotRightSide)?"NotRightSide":this.equals(tv.NotBottomSide)?"NotBottomSide":this.equals(tv.AllSides)?"AllSides":this.equals(tv.Default)?"Default":"None"}equals(t){return t instanceof tv&&(this.p===t.x||isNaN(this.p)&&isNaN(t.x))&&(this.w===t.y||isNaN(this.w)&&isNaN(t.y))&&this.Os===t.offsetX&&this.Is===t.offsetY}opposite(){return new tv(.5-(this.p-.5),.5-(this.w-.5),-this.Os,-this.Is)}includesSide(t){if(!this.isSide())return!1;if(!t.isSide()){if(t.equals(tv.Left))t=tv.LeftSide;else if(t.equals(tv.Right))t=tv.RightSide;else if(t.equals(tv.Top))t=tv.TopSide;else{if(!t.equals(tv.Bottom))return!1;t=tv.BottomSide}}let e=this.Is,i=t.offsetY;return(e&i)===i}get x(){return this.p}set x(t){this.p=t}get y(){return this.w}set y(t){this.w=t}get offsetX(){return this.Os}set offsetX(t){this.Os=t}get offsetY(){return this.Is}set offsetY(t){this.Is=t}isSpot(){return!isNaN(this.x)&&!isNaN(this.y)}isNoSpot(){return isNaN(this.x)||isNaN(this.y)}isSide(){return isNaN(this.x)&&isNaN(this.y)&&1===this.offsetX&&0!==this.offsetY}isNone(){return isNaN(this.x)&&isNaN(this.y)&&0===this.offsetX&&0===this.offsetY}isDefault(){return isNaN(this.x)&&isNaN(this.y)&&-1===this.offsetX&&0===this.offsetY}static None=new tv(0,0,0,0).Ue(0).it();static Default=new tv(0,0,-1,0).Ue(-1).it();static TopLeft=new tv(0,0,0,0).it();static TopCenter=new tv(.5,0,0,0).it();static TopRight=new tv(1,0,0,0).it();static LeftCenter=new tv(0,.5,0,0).it();static Center=new tv(.5,.5,0,0).it();static RightCenter=new tv(1,.5,0,0).it();static BottomLeft=new tv(0,1,0,0).it();static BottomCenter=new tv(.5,1,0,0).it();static BottomRight=new tv(1,1,0,0).it();static MiddleTop=tv.TopCenter;static MiddleLeft=tv.LeftCenter;static MiddleRight=tv.RightCenter;static MiddleBottom=tv.BottomCenter;static Top=tv.TopCenter;static Left=tv.LeftCenter;static Right=tv.RightCenter;static Bottom=tv.BottomCenter;static TopSide=new tv(0,0,1,1).Ue(1).it();static LeftSide=new tv(0,0,1,2).Ue(1).it();static RightSide=new tv(0,0,1,4).Ue(1).it();static BottomSide=new tv(0,0,1,8).Ue(1).it();static TopBottomSides=new tv(0,0,1,9).Ue(1).it();static LeftRightSides=new tv(0,0,1,6).Ue(1).it();static TopLeftSides=new tv(0,0,1,3).Ue(1).it();static TopRightSides=new tv(0,0,1,5).Ue(1).it();static BottomLeftSides=new tv(0,0,1,10).Ue(1).it();static BottomRightSides=new tv(0,0,1,12).Ue(1).it();static NotTopSide=new tv(0,0,1,14).Ue(1).it();static NotLeftSide=new tv(0,0,1,13).Ue(1).it();static NotRightSide=new tv(0,0,1,11).Ue(1).it();static NotBottomSide=new tv(0,0,1,7).Ue(1).it();static AllSides=new tv(0,0,1,15).Ue(1).it();static vk=new tv(.156,.156).it();static Ok=new tv(.844,.844).it();static wC=[];static l(){let t=tv.wC.pop();return void 0===t?new tv:t}static e(t){tv.wC.push(t)}}class tk{m11;m12;m21;m22;dx;dy;constructor(){this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0}set(t){return this.m11=t.m11,this.m12=t.m12,this.m21=t.m21,this.m22=t.m22,this.dx=t.dx,this.dy=t.dy,this}setTo(t,e,i,s,n,l){return this.m11=t,this.m12=e,this.m21=i,this.m22=s,this.dx=n,this.dy=l,this}copy(){let t=new tk;return t.m11=this.m11,t.m12=this.m12,t.m21=this.m21,t.m22=this.m22,t.dx=this.dx,t.dy=this.dy,t}toString(){return"Transform("+this.m11+","+this.m12+","+this.m21+","+this.m22+","+this.dx+","+this.dy+")"}equals(t){return this.m11===t.m11&&this.m12===t.m12&&this.m21===t.m21&&this.m22===t.m22&&this.dx===t.dx&&this.dy===t.dy}Ik(){return 0===this.dx&&0===this.dy&&1===this.m11&&0===this.m12&&0===this.m21&&1===this.m22}Ii(){return this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0,this}ac(t){let e=this.m11*t.m11+this.m21*t.m12,i=this.m12*t.m11+this.m22*t.m12,s=this.m11*t.m21+this.m21*t.m22,n=this.m12*t.m21+this.m22*t.m22;return this.dx=this.m11*t.dx+this.m21*t.dy+this.dx,this.dy=this.m12*t.dx+this.m22*t.dy+this.dy,this.m11=e,this.m12=i,this.m21=s,this.m22=n,this}xC(t){let e=1/(t.m11*t.m22-t.m12*t.m21),i=t.m22*e,s=-t.m12*e,n=-t.m21*e,l=t.m11*e,r=e*(t.m21*t.dy-t.m22*t.dx),o=e*(t.m12*t.dx-t.m11*t.dy),h=this.m11*i+this.m21*s,a=this.m12*i+this.m22*s,u=this.m11*n+this.m21*l,d=this.m12*n+this.m22*l;return this.dx=this.m11*r+this.m21*o+this.dx,this.dy=this.m12*r+this.m22*o+this.dy,this.m11=h,this.m12=a,this.m21=u,this.m22=d,this}yw(){let t=1/(this.m11*this.m22-this.m12*this.m21),e=this.m22*t,i=-this.m12*t,s=-this.m21*t,n=this.m11*t,l=t*(this.m21*this.dy-this.m22*this.dx),r=t*(this.m12*this.dx-this.m11*this.dy);return this.m11=e,this.m12=i,this.m21=s,this.m22=n,this.dx=l,this.dy=r,this}ds(t,e,i){if(t>=360?t-=360:t<0&&(t+=360),0===t)return this;this.Es(e,i);let s=0,n=0;if(90===t)s=0,n=1;else if(180===t)s=-1,n=0;else if(270===t)s=0,n=-1;else{let e=t*Math.PI/180;s=Math.cos(e),n=Math.sin(e)}let l=this.m11*s+this.m21*n,r=this.m12*s+this.m22*n,o=-(this.m11*n)+this.m21*s,h=-(this.m12*n)+this.m22*s;return this.m11=l,this.m12=r,this.m21=o,this.m22=h,this.Es(-e,-i),this}Es(t,e){return this.dx+=this.m11*t+this.m21*e,this.dy+=this.m12*t+this.m22*e,this}nt(t,e){return void 0===e&&(e=t),this.m11*=t,this.m12*=t,this.m21*=e,this.m22*=e,this}GD(){if(1===this.m11&&0===this.m12)return 0;let t=180*Math.atan2(this.m12,this.m11)/Math.PI;return t<0&&(t+=360),t}xt(t){let e=t.x,i=t.y;return t.i(e*this.m11+i*this.m21+this.dx,e*this.m12+i*this.m22+this.dy)}_e(t){let e=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*e,s=-this.m12*e,n=-this.m21*e,l=this.m11*e,r=t.x-this.dx,o=t.y-this.dy;return t.i(r*i+o*n,r*s+o*l)}ww(t){let e=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*e,s=-this.m12*e,n=-this.m21*e,l=this.m11*e,r=e*(this.m21*this.dy-this.m22*this.dx),o=e*(this.m12*this.dx-this.m11*this.dy),h=1.25*t.x,a=1.2*t.y;return t.i(h*i+a*n+r,h*s+a*l+o)}Ug(t){let e=t.x,i=t.y,s=e+t.width,n=i+t.height,l=this.m11,r=this.m12,o=this.m21,h=this.m22,a=this.dx,u=this.dy,d=e*l+i*o+a,c=e*r+i*h+u,g=s*l+i*o+a,f=s*r+i*h+u,m=e*l+n*o+a,p=e*r+n*h+u,y=s*l+n*o+a,x=s*r+n*h+u,w=d,b=d,v=c,k=c;return w=Math.min(w,g),b=Math.max(b,g),v=Math.min(v,f),k=Math.max(k,f),w=Math.min(w,m),b=Math.max(b,m),v=Math.min(v,p),k=Math.max(k,p),w=Math.min(w,y),b=Math.max(b,y),v=Math.min(v,x),k=Math.max(k,x),t.i(w,v,b-w,k-v),t}static bC=[];static l(){let t=tk.bC.pop();return void 0===t?new tk:t}static e(t){tk.bC.push(t)}static Ek="54a702f3e53909c447824c6706603faf4c"}let tP={HD:"7da71ca0ad381e90",Xn:(Math.sqrt(2)-1)/3*4,kC:null,xw:t=>{if(t<=0)return 0;let e=tP.kC;if(null===e){e=[];for(let t=0;t<=2e3;t++)e[t]=Math.sqrt(t);tP.kC=e}if(!(t<1))return t<=2e3?e[0|t]:Math.sqrt(t);{let i=1/t;return i<=2e3?1/e[0|i]:Math.sqrt(t)}},f:(t,e)=>{let i=t-e;return i<.5&&i>-.5},Y:(t,e)=>{let i=t-e;return i<5e-8&&i>-5e-8},Ei:(t,e,i,s,n,l,r)=>{n<=0&&(n=1e-6);let o=0,h=0,a=0,u=0;if(t<i?(h=t,o=i):(h=i,o=t),e<s?(u=e,a=s):(u=s,a=e),t===i)return u<=r&&r<=a&&t-n<=l&&l<=t+n;if(e===s)return h<=l&&l<=o&&e-n<=r&&r<=e+n;let d=o+n,c=h-n;if(c<=l&&l<=d){let o=a+n,h=u-n;if(h<=r&&r<=o){if(d-c>o-h){if(!(t-i>n)&&!(i-t>n))return!0;{let o=(s-e)/(i-t)*(l-t)+e;if(o-n<=r&&r<=o+n)return!0}}else{if(!(e-s>n)&&!(s-e>n))return!0;let o=(i-t)/(s-e)*(r-e)+t;if(o-n<=l&&l<=o+n)return!0}}}return!1},bw:(t,e,i,s,n,l,r,o,h,a,u,d)=>{if(tP.Ei(t,e,r,o,d,i,s)&&tP.Ei(t,e,r,o,d,n,l))return tP.Ei(t,e,r,o,d,a,u);{let c=(t+i)/2,g=(e+s)/2,f=(i+n)/2,m=(s+l)/2,p=(n+r)/2,y=(l+o)/2,x=(c+f)/2,w=(g+m)/2,b=(f+p)/2,v=(m+y)/2,k=(x+b)/2,P=(w+v)/2;return tP.bw(t,e,c,g,x,w,k,P,h,a,u,d)||tP.bw(k,P,b,v,p,y,r,o,h,a,u,d)}},PC:(t,e,i,s,n,l,r,o,h)=>{let a=(i+n)/2,u=(s+l)/2;return h.i((((t+i)/2+a)/2+(a+(n+r)/2)/2)/2,(((e+s)/2+u)/2+(u+(l+o)/2)/2)/2),h},jD:(t,e,i,s,n,l,r,o)=>{let h=(i+n)/2,a=(s+l)/2;return ty.direction(((t+i)/2+h)/2,((e+s)/2+a)/2,(h+(n+r)/2)/2,(a+(l+o)/2)/2)},fu:(t,e,i,s,n,l,r,o,h,a)=>{if(tP.Ei(t,e,r,o,h,i,s)&&tP.Ei(t,e,r,o,h,n,l))a.unionNoCheck(t,e,0,0),a.unionNoCheck(r,o,0,0);else{let u=(t+i)/2,d=(e+s)/2,c=(i+n)/2,g=(s+l)/2,f=(n+r)/2,m=(l+o)/2,p=(u+c)/2,y=(d+g)/2,x=(c+f)/2,w=(g+m)/2,b=(p+x)/2,v=(y+w)/2;tP.fu(t,e,u,d,p,y,b,v,h,a),tP.fu(b,v,x,w,f,m,r,o,h,a)}return a},Yn:(t,e,i,s,n,l,r,o,h,a)=>{if(tP.Ei(t,e,r,o,h,i,s)&&tP.Ei(t,e,r,o,h,n,l))0===a.length&&(a.push(t),a.push(e)),a.push(r),a.push(o);else{let u=(t+i)/2,d=(e+s)/2,c=(i+n)/2,g=(s+l)/2,f=(n+r)/2,m=(l+o)/2,p=(u+c)/2,y=(d+g)/2,x=(c+f)/2,w=(g+m)/2,b=(p+x)/2,v=(y+w)/2;tP.Yn(t,e,u,d,p,y,b,v,h,a),tP.Yn(b,v,x,w,f,m,r,o,h,a)}return a},Bk:(t,e,i,s,n,l,r,o,h,a)=>{if(tP.Ei(t,e,n,l,a,i,s))return tP.Ei(t,e,n,l,a,o,h);{let u=(t+i)/2,d=(e+s)/2,c=(i+n)/2,g=(s+l)/2,f=(u+c)/2,m=(d+g)/2;return tP.Bk(t,e,u,d,f,m,r,o,h,a)||tP.Bk(f,m,c,g,n,l,r,o,h,a)}},dE:(t,e,i,s,n,l,r)=>(r.i(((t+i)/2+(i+n)/2)/2,((e+s)/2+(s+l)/2)/2),r),Uk:(t,e,i,s,n,l,r,o)=>{if(tP.Ei(t,e,n,l,r,i,s))o.unionNoCheck(t,e,0,0),o.unionNoCheck(n,l,0,0);else{let h=(t+i)/2,a=(e+s)/2,u=(i+n)/2,d=(s+l)/2,c=(h+u)/2,g=(a+d)/2;tP.Uk(t,e,h,a,c,g,r,o),tP.Uk(c,g,u,d,n,l,r,o)}return o},Vg:(t,e,i,s,n,l,r,o)=>{if(tP.Ei(t,e,n,l,r,i,s))0===o.length&&(o.push(t),o.push(e)),o.push(n),o.push(l);else{let h=(t+i)/2,a=(e+s)/2,u=(i+n)/2,d=(s+l)/2,c=(h+u)/2,g=(a+d)/2;tP.Vg(t,e,h,a,c,g,r,o),tP.Vg(c,g,u,d,n,l,r,o)}return o},zg:(t,e,i,s,n,l,r,o,h,a,u,d,c,g)=>{if(tP.Ei(t,e,r,o,c,i,s)&&tP.Ei(t,e,r,o,c,n,l)){if(!tP.au(t,e,r,o,h,a,u,d))return!1;let i=(t-r)*(a-d)-(e-o)*(h-u);if(0===i)return!1;let s=((t*o-e*r)*(h-u)-(t-r)*(h*d-a*u))/i,n=((t*o-e*r)*(a-d)-(e-o)*(h*d-a*u))/i;return g.i(s,n),!0}{let f=(t+i)/2,m=(e+s)/2,p=(i+n)/2,y=(s+l)/2,x=(n+r)/2,w=(l+o)/2,b=(f+p)/2,v=(m+y)/2,k=(p+x)/2,P=(y+w)/2,S=(b+k)/2,M=(v+P)/2,N=1/0,C=!1,L=0,T=0;if(tP.zg(t,e,f,m,b,v,S,M,h,a,u,d,c,g)){let t=(g.x-h)**2+(g.y-a)**2;t<N&&(N=t,C=!0,L=g.x,T=g.y)}if(tP.zg(S,M,k,P,x,w,r,o,h,a,u,d,c,g)){let t=(g.x-h)**2+(g.y-a)**2;t<N&&(N=t,C=!0,L=g.x,T=g.y)}return C&&(g.x=L,g.y=T),C}},Xg:(t,e,i,s,n,l,r,o,h,a,u,d,c)=>{let g=0;if(tP.Ei(t,e,r,o,c,i,s)&&tP.Ei(t,e,r,o,c,n,l)){let i=(t-r)*(a-d)-(e-o)*(h-u);if(0===i)return g;let s=((t*o-e*r)*(h-u)-(t-r)*(h*d-a*u))/i,n=((t*o-e*r)*(a-d)-(e-o)*(h*d-a*u))/i;if(s>=u)return g;let l=0,c=0;if((h>u?h-u:u-h)<(a>d?a-d:d-a)){if(e<o?(l=e,c=o):(l=o,c=e),n<l||n>c)return g}else if(t<r?(l=t,c=r):(l=r,c=t),s<l||s>c)return g;i>0?g++:i<0&&g--}else{let f=(t+i)/2,m=(e+s)/2,p=(i+n)/2,y=(s+l)/2,x=(n+r)/2,w=(l+o)/2,b=(f+p)/2,v=(m+y)/2,k=(p+x)/2,P=(y+w)/2,S=(b+k)/2,M=(v+P)/2;g+=tP.Xg(t,e,f,m,b,v,S,M,h,a,u,d,c),g+=tP.Xg(S,M,k,P,x,w,r,o,h,a,u,d,c)}return g},bl:(t,e,i,s,n,l,r)=>{if(tP.Y(t,i)){let i=0,n=0;return e<s?(i=e,n=s):(i=s,n=e),l<i?(r.i(t,i),!1):l>n?(r.i(t,n),!1):(r.i(t,l),!0)}if(tP.Y(e,s)){let s=0,l=0;return t<i?(s=t,l=i):(s=i,l=t),n<s?(r.i(s,e),!1):n>l?(r.i(l,e),!1):(r.i(n,e),!0)}{let o=(i-t)**2+(s-e)**2,h=((t-n)*(t-i)+(e-l)*(e-s))/o;if(h<-5e-6)return r.i(t,e),!1;if(h>1.000005)return r.i(i,s),!1;{let n=t+h*(i-t),l=e+h*(s-e);return r.i(n,l),!0}}},Kn:(t,e,i,s,n,l,r,o,h)=>{if(tP.f(t,i)&&tP.f(e,s))return h.i(t,e),!1;if(tP.Y(n,r)){if(tP.Y(t,i))return tP.bl(t,e,i,s,n,l,h),!1;{let l=(s-e)/(i-t)*(n-t)+e;return tP.bl(t,e,i,s,n,l,h)}}{let a=(o-l)/(r-n);if(tP.Y(t,i)){let i=a*(t-n)+l,r=0,o=0;return e<s?(r=e,o=s):(r=s,o=e),i<r?(h.i(t,r),!1):i>o?(h.i(t,o),!1):(h.i(t,i),!0)}{let r=(s-e)/(i-t);if(tP.Y(a,r))return tP.bl(t,e,i,s,n,l,h),!1;{let o=(r*t-a*n+l-e)/(r-a);if(tP.Y(r,0)){let s=0,n=0;return t<i?(s=t,n=i):(s=i,n=t),o<s?(h.i(s,e),!1):o>n?(h.i(n,e),!1):(h.i(o,e),!0)}{let n=r*(o-t)+e;return tP.bl(t,e,i,s,o,n,h)}}}}},gE:(t,e,i,s,n)=>tP.Kn(i.x,i.y,s.x,s.y,t.x,t.y,e.x,e.y,n),mE:(t,e,i,s,n,l,r,o,h,a)=>{let u=1/0;function d(i,s){let n=(i-t)**2+(s-e)**2;n<u&&(u=n,h.i(i,s))}d(h.x,h.y);let c=0,g=0,f=0,m=0;n<r?(c=n,g=r):(c=r,g=n),l<o?(f=n,m=r):(f=r,m=n);let p=(g-c)/2+a,y=(m-f)/2+a,x=(n+r)/2,w=(l+o)/2;if(0===p||0===y)return h;if(tP.f(t,i)){let t=1-(i-x)**2/(p*p);if(t<0)return h;let e=Math.sqrt(t);d(i,y*e+w),d(i,-y*e+w)}else{let n=(s-e)/(i-t),l=1/(p*p)+n*n/(y*y),r=2*n*(e-n*t)/(y*y)-2*n*w/(y*y)-2*x/(p*p),o=r*r-4*l*(2*n*t*w/(y*y)-2*e*w/(y*y)+w*w/(y*y)+x*x/(p*p)-1+(e-n*t)*(e-n*t)/(y*y));if(o<0)return h;let a=Math.sqrt(o),u=(-r+a)/(2*l);d(u,n*u-n*t+e);let c=(-r-a)/(2*l);d(c,n*c-n*t+e)}return h},kl:(t,e,i,s,n,l,r,o,h)=>{let a=1e21,u=t,d=e;if(tP.Kn(t,e,t,s,n,l,r,o,h)){let t=(h.x-n)**2+(h.y-l)**2;t<a&&(a=t,u=h.x,d=h.y)}if(tP.Kn(i,e,i,s,n,l,r,o,h)){let t=(h.x-n)**2+(h.y-l)**2;t<a&&(a=t,u=h.x,d=h.y)}if(tP.Kn(t,e,i,e,n,l,r,o,h)){let t=(h.x-n)**2+(h.y-l)**2;t<a&&(a=t,u=h.x,d=h.y)}if(tP.Kn(t,s,i,s,n,l,r,o,h)){let t=(h.x-n)**2+(h.y-l)**2;t<a&&(a=t,u=h.x,d=h.y)}return h.i(u,d),a<1e21},kw:(t,e,i)=>tP.mC(t.x,t.y,t.width,t.height,e.x,e.y,i.x,i.y),mC:(t,e,i,s,n,l,r,o)=>{let h=t+i,a=e+s;if(n===r){let i=0,s=0;return l<o?(i=l,s=o):(i=o,s=l),t<=n&&n<=h&&i<=a&&s>=e}if(l===o){let i=0,s=0;return n<r?(i=n,s=r):(i=r,s=n),e<=l&&l<=a&&i<=h&&s>=t}return!!(tw.contains(t,e,i,s,n,l)||tw.contains(t,e,i,s,r,o)||tP.au(t,e,h,e,n,l,r,o)||tP.au(h,e,h,a,n,l,r,o)||tP.au(h,a,t,a,n,l,r,o)||tP.au(t,a,t,e,n,l,r,o))},au:(t,e,i,s,n,l,r,o)=>t===i&&e===s&&n===r&&l===o?t===n&&e===l:tP.hu(t,e,i,s,n,l)*tP.hu(t,e,i,s,r,o)<=0&&tP.hu(n,l,r,o,t,e)*tP.hu(n,l,r,o,i,s)<=0,hu:(t,e,i,s,n,l)=>{let r=i-t,o=s-e,h=n-t,a=l-e,u=h*o-a*r;return 0===u&&(u=h*r+a*o)>0&&(h-=r,a-=o,(u=h*r+a*o)<0&&(u=0)),u},Yg:t=>(t<0&&(t+=360),t>=360&&(t-=360),t),SC:(t,e,i,s,n,l)=>{let r=Math.PI;l||(s=r/180*s,n=r/180*n);let o=s>n?-1:1,h=[],a=r/2,u=s,d=Math.min(2*r,Math.abs(n-s));if(d<1e-5){let s=u+o*Math.min(d,a),n=t+i*Math.cos(u),l=e+i*Math.sin(u),r=t+i*Math.cos(s),c=e+i*Math.sin(s),g=(n+r)/2,f=(l+c)/2;return h.push([n,l,g,f,g,f,r,c]),h}for(;d>1e-5;){let s=u+o*Math.min(d,a);h.push(tP.qD(i,u,s,t,e)),d-=Math.abs(s-u),u=s}return h},qD:(t,e,i,s,n)=>{let l=(i-e)/2,r=t*Math.cos(l),o=t*Math.sin(l),h=-o,a=r*r+h*h,u=a+r*r+h*o,d=4/3*(Math.sqrt(2*a*u)-u)/(r*o-h*r),c=r-d*h,g=h+d*r,f=-g,m=l+e,p=Math.cos(m),y=Math.sin(m);return[s+t*Math.cos(e),n+t*Math.sin(e),s+c*p-g*y,n+c*y+g*p,s+c*p-f*y,n+c*y+f*p,s+t*Math.cos(i),n+t*Math.sin(i)]},Ig:(t,e,i,s,n,l,r)=>{let o=Math.floor((t-i)/n)*n+i,h=Math.floor((e-s)/l)*l+s,a=o;o+n-t<n/2&&(a=o+n);let u=h;return h+l-e<l/2&&(u=h+l),r.i(a,u),r},MC:(t,e)=>{let i=Math.max(t,e),s=Math.min(t,e),n=1,l=1;do n=i%s,l=s,i=s,s=n;while(n>0);return l},WD:(t,e,i,s)=>{let n=i<0,l=s<0,r=0,o=0,h=0;t<e?(o=1,h=0):(o=0,h=1);let a=0,u=0,d=0,c=0;return a=0===(r=o)?t:e,d=0===r?i:s,(0===r?n:l)&&(d=-d),u=0===(r=h)?t:e,c=0===r?i:s,(0===r?n:l)&&(c=-c),tP.JD(a,u,d,c,0,0)},JD:(t,e,i,s,n,l)=>{let r=0;if(s>0){if(i>0){let o=t*t,h=e*e,a=t*i,u=e*s,d=-h+u,c=-h+Math.sqrt(a*a+u*u),g=d;for(let t=0;t<0x2540be3ff&&(g=.5*(d+c))!==d&&g!==c;++t){let t=a/(g+o),e=u/(g+h),i=t*t+e*e-1;if(i>0)d=g;else if(i<0)c=g;else break}n=o*i/(g+o),l=h*s/(g+h);let f=n-i,m=l-s;r=Math.sqrt(f*f+m*m)}else n=0,l=e,r=Math.abs(s-e)}else{let s=t*t-e*e,o=t*i;if(o<s){let h=o/s;n=t*h,l=e*Math.sqrt(Math.abs(1-h*h));let a=n-i;r=Math.sqrt(a*a+l*l)}else n=t,l=0,r=Math.abs(i-t)}return r},Gn:new ts,Kg:new ts,dr:new ts,gr:0,Gg:100};tP.za=tP.HD;var tS=((t=tS||{})[t.Line=1]="Line",t[t.Rectangle=2]="Rectangle",t[t.Ellipse=3]="Ellipse",t[t.Path=4]="Path",t),tM=((e=tM||{})[e.None=0]="None",e[e.Default=1]="Default",e[e.Fill=2]="Fill",e[e.Uniform=6]="Uniform",e);class tN{n;Hg;jg;cc;uu;du;Hn;jn;qn;$;ke;Pe;ie;ee;Bs;fc;uc;constructor(t){tu.qi(this),this.n=2,void 0===t&&(t=4),this.$=t,this.ke=0,this.Pe=0,this.ie=0,this.ee=0,4===t?this.Bs=new th:this.Bs=tN.Pw,this.Hg=this.Bs.ht,this.jg=new tw().u(),this.cc=null,this.uu=null,this.du=NaN,this.Hn=tv.TopLeft,this.jn=tv.BottomRight,this.fc=NaN,this.uc=NaN,this.qn=2}copy(){let t=new tN;if(t.n=-2&this.n,t.$=this.$,t.ke=this.ke,t.Pe=this.Pe,t.ie=this.ie,t.ee=this.ee,4===this.$){let e=this.Bs.r,i=t.Bs;for(let t=0;t<e.length;t++){let s=e[t];i.add(s.copy())}t.Bs=i}else t.Bs=this.Bs;return t.Hg=this.Hg,t.jg.a(this.jg),t.cc=this.cc,t.uu=this.uu,t.du=this.du,t.Hn=this.Hn.N(),t.jn=this.jn.N(),t.fc=this.fc,t.uc=this.uc,t.qn=this.qn,t}static Line=1;static Rectangle=2;static Ellipse=3;static Path=4;static Pw=new th().u();get h(){return(1&this.n)!=0}set h(t){t?this.n|=1:this.n&=-2}get kt(){return(2&this.n)!=0}set kt(t){t?this.n|=2:this.n&=-3}u(){if(this.h=!0,4!==this.type)return this;let t=this.figures;for(let e of(t.u(),t))e.u();return this}equalsApprox(t){if(!(t instanceof tN))return!1;if(this.type!==t.type)return 1===this.type&&4===t.type?this.NC(t):1===t.type&&4===this.type&&t.NC(this);if(4!==this.type)return tP.f(this.startX,t.startX)&&tP.f(this.startY,t.startY)&&tP.f(this.endX,t.endX)&&tP.f(this.endY,t.endY);{let e=this.figures.r,i=t.figures.r,s=e.length;if(s!==i.length)return!1;for(let t=0;t<s;t++){let s=e[t],n=i[t];if(!s.equalsApprox(n))return!1}return!0}}NC(t){if(1!==this.type||4!==t.type)return!1;if(1===t.figures.count){let e=t.figures.elt(0);if(1===e.segments.count&&tP.f(this.startX,e.startX)&&tP.f(this.startY,e.startY)){let t=e.segments.elt(0);if(2===t.type&&tP.f(this.endX,t.endX)&&tP.f(this.endY,t.endY))return!0}}return!1}static stringify(t){return t.toString()}static stringifyFixed(t){return te.s(t,"number",tN,"stringifyFixed:digits"),e=>e.toString(t)}hi(t){t in tS?this.type=t:te.cr(this,t)}toString(t){let e;void 0===t&&(t=-1);let i=e=>0===e?"0":e.toFixed(t);switch(this.type){case 1:return t<0?"M"+this.startX.toString()+" "+this.startY.toString()+"L"+this.endX.toString()+" "+this.endY.toString():"M"+i(this.startX)+" "+i(this.startY)+"L"+i(this.endX)+" "+i(this.endY);case 2:return(e=new tw(this.startX,this.startY,0,0)).union(this.endX,this.endY,0,0),t<0?"M"+e.x.toString()+" "+e.y.toString()+"H"+e.right.toString()+"V"+e.bottom.toString()+"H"+e.left.toString()+"z":"M"+i(e.x)+" "+i(e.y)+"H"+i(e.right)+"V"+i(e.bottom)+"H"+i(e.left)+"z";case 3:if((e=new tw(this.startX,this.startY,0,0)).union(this.endX,this.endY,0,0),t<0){let t=e.left.toString()+" "+(e.y+e.height/2).toString(),i=e.right.toString()+" "+(e.y+e.height/2).toString();return"M"+t+"A"+(e.width/2).toString()+" "+(e.height/2).toString()+" 0 0 1 "+i+"A"+(e.width/2).toString()+" "+(e.height/2).toString()+" 0 0 1 "+t}{let t=i(e.left)+" "+i(e.y+e.height/2),s=i(e.right)+" "+i(e.y+e.height/2);return"M"+t+"A"+i(e.width/2)+" "+i(e.height/2)+" 0 0 1 "+s+"A"+i(e.width/2)+" "+i(e.height/2)+" 0 0 1 "+t}case 4:let s="",n=this.figures.r,l=n.length;for(let e=0;e<l;e++){let i=n[e];e>0&&(s+=" x "),i.isFilled&&(s+="F "),s+=i.toString(t)}return s;default:return tS[this.type]}}static fillPath(t){"string"!=typeof t&&te.te(t,"string",tN,"fillPath:str");let e=t.split(/[Xx]/),i=e.length,s="";for(let t=0;t<i;t++){let i=e[t];if(null!==i.match(/[Ff]/)){0===t?s+=i:s+="X"+(" "===i[0]?"":" ")+i;continue}s+=(0===t?"":"X ")+"F"+(" "===i[0]?"":" ")+i}return s}static qg="UuBbMmZzLlHhVvCcSsQqTtAaFfXx";static parse(t,e){void 0===e&&(e=!1),"string"!=typeof t&&te.te(t,"string",tN,"parse:str");let i=RegExp("(["+tN.qg+"])(["+tN.qg+"])","gm"),s=RegExp("(["+tN.qg+"])([^s])","gm"),n=RegExp("([^s])(["+tN.qg+"])","gm"),l=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/,/gm," ")).replace(i,"$1 $2")).replace(i,"$1 $2")).replace(s,"$1 $2")).replace(n,"$1 $2")).replace(/([0-9])([+\-])/gm,"$1 $2")).replace(/[\s\r\t\n]+/gm," ")).replace(/^\s+|\s+$/g,"")).split(" ");for(let t=0;t<l.length;t++){let e=l[t];if(null!==e.match(/(\.[0-9]*)(\.)/gm)){let i=te.rt(),s="",n=!1;for(let t=0;t<e.length;t++){let l=e[t];"."!==l||n?"."===l?(i.push(s),s="."):s+=l:(n=!0,s+=l)}i.push(s),l.splice(t,1);for(let e=0;e<i.length;e++)l.splice(t+e,0,i[e]);t+=i.length-1,te.tt(i)}}let r=-1,o="",h="",a=new ty(0,0),u=new ty(0,0),d=new ty(0,0),c=!0;function g(){return r>=x-1||null!==l[r+1].match(S)||(c=!1,!1)}function f(){return l[++r]}function m(t){let e=parseFloat(f()),i=parseFloat(f());o===o.toLowerCase()&&(e=d.x+e,i=d.y+i),t.i(e,i)}function p(){return m(d),d}function y(){let t=h.toLowerCase();return"c"===t||"s"===t||"q"===t||"t"===t?new ty(2*d.x-u.x,2*d.y-u.y):new ty(d.x,d.y)}let x=l.length,w=it.CC(null),b=!1,v=!1,k=!1,P=!0,S=RegExp("["+tN.qg+"]");for(;!(r>=x-1);){if(h=o,""===(o=f()))continue;c=!0;let e=!1;switch(o.toUpperCase()){case"X":P=!0,b=!1,v=!1;break;case"M":let i=p();for(null===w.Si||!0===P?(w.gu(i.x,i.y,b,!1,!v,k),P=!1):w.$D(i.x,i.y),a.a(d);!g();){let t=p();w.mr(t.x,t.y)}break;case"L":for(;!g();){let t=p();w.mr(t.x,t.y)}c&&(e=!0);break;case"H":for(;!g();)d.i((o===o.toLowerCase()?d.x:0)+parseFloat(f()),d.y),w.mr(d.x,d.y);break;case"V":for(;!g();)d.i(d.x,(o===o.toLowerCase()?d.y:0)+parseFloat(f())),w.mr(d.x,d.y);c&&(e=!0);break;case"C":for(;!g();){let t=new ty;m(t);let e=(m(u),u),i=p();w.pr(t.x,t.y,e.x,e.y,i.x,i.y)}c&&(e=!0);break;case"S":for(;!g();){let t=y(),e=(m(u),u),i=p();w.pr(t.x,t.y,e.x,e.y,i.x,i.y)}c&&(e=!0);break;case"Q":for(;!g();){let t=(m(u),u),e=p();w.Sw(t.x,t.y,e.x,e.y)}c&&(e=!0);break;case"T":for(;!g();){let t=y();u.a(t);let e=p();w.Sw(t.x,t.y,e.x,e.y),u.a(e)}c&&(e=!0);break;case"B":for(;!g();){let t=parseFloat(f()),e=parseFloat(f()),i=parseFloat(f()),s=parseFloat(f()),n=parseFloat(f()),l=n,r=!1;g()||(l=parseFloat(f()),g()||(r=0!==parseFloat(f()))),o===o.toLowerCase()&&(i+=d.x,s+=d.y),w.ZD(t,e,i,s,n,l,r)}c&&(e=!0);break;case"A":for(;!g();){let t=Math.abs(parseFloat(f())),e=Math.abs(parseFloat(f())),i=parseFloat(f()),s=!1,n=!1,l=0,r=0,h=f();1===h.length?(s=!!parseFloat(h),n=!!parseFloat(f()),l=parseFloat(f())):2===h.length?(s=!!parseFloat(h[0]),n=!!parseFloat(h[1]),l=parseFloat(f())):(s=!!parseFloat(h[0]),n=!!parseFloat(h[1]),l=parseFloat(h.slice(2))),r=parseFloat(f()),o===o.toLowerCase()&&(l=d.x+l,r=d.y+r),d.i(l,r),w.QD(t,e,i,s,n,l,r)}c&&(e=!0);break;case"Z":w._D(),d.a(a);break;case"F":{let t="",e=1;for(;l[r+e];){if("0"===l[r+e]){k=!0,e++;continue}if(null!==l[r+e].match(/[Uu]/)||null===l[r+e].match(S)){e++;continue}t=l[r+e];break}t.match(/[Mm]/)?b=!0:w.tF();break}case"U":{let t="",e=1;for(;l[r+e];){if(null!==l[r+e].match(/[Ff]/)||null===l[r+e].match(S)){e++;continue}t=l[r+e];break}t.match(/[Mm]/)?v=!0:w.iF(!1);break}default:if("0"===o||"1"===o)break;te.li("Unknown geometry command: "+o)}if(e){te.li(`Bad geometry command: ${o}, next token: ${f()},
string: ${t}`);break}}let M=w.Wg;if(it.LC(w),e){let t=M.figures.iterator;for(;t.next();)t.value.isFilled=!0}return M}static AC(t,e){let i=t.length,s=ty.l();for(let n=0;n<i;n++){let i=t[n];s.x=i[0],s.y=i[1],e.xt(s),i[0]=s.x,i[1]=s.y,s.x=i[2],s.y=i[3],e.xt(s),i[2]=s.x,i[3]=s.y,s.x=i[4],s.y=i[5],e.xt(s),i[4]=s.x,i[5]=s.y,s.x=i[6],s.y=i[7],e.xt(s),i[6]=s.x,i[7]=s.y}ty.e(s)}Vk(){if(this.kt)return!0;if(4===this.type){let t=this.figures;if(this.Hg!==t.ht)return!0;let e=this.figures.r,i=e.length;for(let t=0;t<i;t++)if(e[t].Vk())return!0}return!1}Mw(){if(this.kt=!1,this.cc=null,this.uu=null,this.du=NaN,4===this.type){let t=this.figures;this.Hg=t.ht;let e=this.figures.r,i=e.length;for(let t=0;t<i;t++)e[t].eF()}let t=this.jg;t.At(),isNaN(this.fc)||isNaN(this.uc)?t.i(0,0,0,0):t.i(0,0,this.fc,this.uc),this.TC(t,!1),t.unionNoCheck(0,0,0,0),t.u()}computeBoundsWithoutOrigin(){let t=new tw;return this.TC(t,!0),t}TC(t,e){switch(this.type){case 1:case 2:case 3:e?t.i(this.ke,this.Pe,0,0):t.unionNoCheck(this.ke,this.Pe,0,0),t.unionNoCheck(this.ie,this.ee,0,0);break;case 4:let i=this.figures,s=i.r,n=i.length;for(let i=0;i<n;i++){let n=s[i];e&&0===i?t.i(n.startX,n.startY,0,0):t.unionNoCheck(n.startX,n.startY,0,0);let l=n.segments.r,r=l.length,o=n.startX,h=n.startY;for(let e=0;e<r;e++){let i=l[e];switch(i.type){case 2:case 1:o=i.endX,h=i.endY,t.unionNoCheck(o,h,0,0);break;case 3:tP.fu(o,h,i.point1X,i.point1Y,i.point2X,i.point2Y,i.endX,i.endY,.5,t),o=i.endX,h=i.endY;break;case 4:tP.Uk(o,h,i.point1X,i.point1Y,i.endX,i.endY,.5,t),o=i.endX,h=i.endY;break;case 5:case 6:let s=5===i.type?i.Ao(n):i.Yh(n,o,h),r=s.length;if(0===r){o=5===i.type?i.centerX:i.endX,h=5===i.type?i.centerY:i.endY,t.unionNoCheck(o,h,0,0);break}let a=null;for(let e=0;e<r;e++)a=s[e],tP.fu(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],.5,t);null!==a&&(o=a[6],h=a[7]);break;default:te.o("Unknown Segment type: "+i.type)}}}break;default:te.o("Unknown Geometry type: "+this.type)}}sF(t,e){let i=this.bounds,s=t/i.width,n=e/i.height;return isFinite(s)||(s=1),isFinite(n)||(n=1),1===s&&1===n?this:this.copy().scale(s,n)}normalize(){this.h&&te.D(this);let t=this.computeBoundsWithoutOrigin();return this.offset(-t.x,-t.y),new ty(-t.x,-t.y)}offset(t,e){return this.h&&te.D(this),this.F(1,0,0,1,t,e),this}scale(t,e){return this.h&&te.D(this),this.F(t,0,0,e,0,0),this}rotate(t,e,i){this.h&&te.D(this),void 0===e&&(e=0),void 0===i&&(i=0);let s=tk.l();return s.Ii(),s.ds(t,e,i),this.F(s.m11,s.m12,s.m21,s.m22,s.dx,s.dy),tk.e(s),this}F(t,e,i,s,n,l){let r=0,o=0;switch(this.type){case 1:case 2:case 3:r=this.ke,o=this.Pe,this.ke=r*t+o*i+n,this.Pe=r*e+o*s+l,r=this.ie,o=this.ee,this.ie=r*t+o*i+n,this.ee=r*e+o*s+l;break;case 4:let h=this.figures.r,a=h.length;for(let u=0;u<a;u++){let a=h[u];r=a.startX,o=a.startY,a.startX=r*t+o*i+n,a.startY=r*e+o*s+l;let d=a.segments.r,c=d.length;for(let h=0;h<c;h++){let a=d[h];switch(a.type){case 2:case 1:r=a.endX,o=a.endY,a.endX=r*t+o*i+n,a.endY=r*e+o*s+l;break;case 3:r=a.point1X,o=a.point1Y,a.point1X=r*t+o*i+n,a.point1Y=r*e+o*s+l,r=a.point2X,o=a.point2Y,a.point2X=r*t+o*i+n,a.point2Y=r*e+o*s+l,r=a.endX,o=a.endY,a.endX=r*t+o*i+n,a.endY=r*e+o*s+l;break;case 4:r=a.point1X,o=a.point1Y,a.point1X=r*t+o*i+n,a.point1Y=r*e+o*s+l,r=a.endX,o=a.endY,a.endX=r*t+o*i+n,a.endY=r*e+o*s+l;break;case 5:if(r=a.centerX,o=a.centerY,a.centerX=r*t+o*i+n,a.centerY=r*e+o*s+l,0!==e){let i=180*Math.atan2(e,t)/Math.PI;i<0&&(i+=360),a.startAngle+=i}t<0&&(a.startAngle=180-a.startAngle,a.sweepAngle=-a.sweepAngle),s<0&&(a.startAngle=-a.startAngle,a.sweepAngle=-a.sweepAngle),a.radiusX*=Math.sqrt(t*t+i*i),void 0!==a.radiusY&&(a.radiusY*=Math.sqrt(e*e+s*s));break;case 6:if(r=a.endX,o=a.endY,a.endX=r*t+o*i+n,a.endY=r*e+o*s+l,0===a.radiusX||0===a.radiusY)break;if(0!==e){let i=180*Math.atan2(e,t)/Math.PI;i<0&&(i+=360),a.xAxisRotation+=i}t<0&&(a.xAxisRotation=180-a.xAxisRotation,a.isClockwiseArc=!a.isClockwiseArc),s<0&&(a.xAxisRotation=-a.xAxisRotation,a.isClockwiseArc=!a.isClockwiseArc),a.radiusX*=Math.sqrt(t*t+i*i),a.radiusY*=Math.sqrt(e*e+s*s);break;default:te.o("Unknown Segment type: "+a.type)}}}}return this.kt=!0,this}containsPoint(t,e){void 0===e&&(e=0);let i=this.ke,s=this.Pe,n=this.ie,l=this.ee;switch(this.type){case 1:return tP.Ei(i,s,n,l,e,t.x,t.y);case 2:{let r=Math.min(i,n)-e,o=Math.min(s,l)-e,h=Math.abs(n-i)+2*e,a=Math.abs(l-s)+2*e,u=tw.X(r,o,h,a),d=u.containsPoint(t);return tw.e(u),d}case 3:{let r=Math.min(i,n)-e,o=Math.min(s,l)-e,h=(Math.abs(n-i)+2*e)/2,a=(Math.abs(l-s)+2*e)/2;return!(h<=0)&&!(a<=0)&&(r=t.x-(r+h))*r/(h*h)+(o=t.y-(o+a))*o/(a*a)<=1}case 4:return this.zk(t,e,!0,!1);default:return!1}}zk(t,e,i,s){let n=t.x,l=t.y,r=this.bounds.x-20,o=0,h=0,a=0,u=0,d=0,c=0,g=this.figures.r,f=g.length;for(let t=0;t<f;t++){let u=g[t],f=!u.isEvenOdd;if(u.isFilled){if(i&&u.Xk(n,l,e))return!0}else{if(u.Xk(n,l,s?e:e+2))return!0;continue}let m=u.segments;h=u.startX,a=u.startY;let p=h,y=a,x=m.r;for(let t=0;t<=m.length;t++){let e,i;switch(t!==m.length?(i=(e=x[t]).type,d=e.endX,c=e.endY):(i=2,d=p,c=y),i){case 1:{let t=this.Nw(n,l,r,l,h,a,p,y);if(isNaN(t))return!0;o+=t,p=d,y=c;break}case 2:{let t=this.Nw(n,l,r,l,h,a,d,c);if(isNaN(t))return!0;o+=t;break}case 3:o+=tP.Xg(h,a,e.point1X,e.point1Y,e.point2X,e.point2Y,d,c,r,l,n,l,.5);break;case 4:{let t=(h+2*e.point1X)/3,i=(a+2*e.point1Y)/3,s=(2*e.point1X+d)/3,u=(2*e.point1Y+c)/3;o+=tP.Xg(h,a,t,i,s,u,d,c,r,l,n,l,.5);break}case 5:case 6:{let t=5===e.type?e.Ao(u):e.Yh(u,h,a),i=t.length;if(0===i){let t=this.Nw(n,l,r,l,h,a,5===e.type?e.centerX:e.endX,5===e.type?e.centerY:e.endY);if(isNaN(t))return!0;o+=t;break}let s=null;for(let e=0;e<i;e++){if(s=t[e],0===e){let t=this.Nw(n,l,r,l,h,a,s[0],s[1]);if(isNaN(t))return!0;o+=t}o+=tP.Xg(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],r,l,n,l,.5)}null!==s&&(d=s[6],c=s[7]);break}default:te.o("Unknown Segment type: "+e.type)}h=d,a=c}if(f){if(0!==o)return!0}else if(o%2!=0)return!0;o=0}return!1}Nw(t,e,i,s,n,l,r,o){if(tP.Ei(n,l,r,o,.05,t,e))return NaN;let h=(t-i)*(l-o);if(0===h)return 0;let a=((t*s-e*i)*(n-r)-(t-i)*(n*o-l*r))/h,u=(t*s-e*i)*(l-o)/h;if(a>=t)return 0;if((n>r?n-r:r-n)<(l>o?l-o:o-l)){if(l<o){if(u<l||u>o)return 0}else if(u<o||u>l)return 0}else if(n<r){if(a<n||a>r)return 0}else if(a<r||a>n)return 0;return h>0?1:-1}DC(t,e,i){let s=this.figures.r,n=s.length;for(let l=0;l<n;l++)if(s[l].Xk(t,e,i))return!0;return!1}getPointAlongPath(t,e){if(t<0?t=0:t>1&&(t=1),void 0===e&&(e=new ty),1===this.type)return e.i(this.startX+t*(this.endX-this.startX),this.startY+t*(this.endY-this.startY)),e;let i=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,l=i.length,r=n*t,o=0;for(let t=0;t<l;t++){let n=s[t],l=n.length;for(let s=0;s<l;s++){let l=n[s];if(o+l>=r){let n=r-o,h=0===l?0:n/l,a=i[t],u=a[2*s],d=a[2*s+1],c=a[2*s+2],g=a[2*s+3];return e.i(u+(c-u)*h,d+(g-d)*h),e}o+=l}}return e}getAngleAlongPath(t){if(t<0?t=0:t>1&&(t=1),1===this.type)return 180*Math.atan2(this.endY-this.startY,this.endX-this.startX)/Math.PI;let e=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=e.length,l=s*t,r=0;for(let t=0;t<n;t++){let s=i[t],n=s.length;for(let i=0;i<n;i++){let n=s[i];if(r+n>=l){let s=e[t],n=s[2*i],l=s[2*i+1],r=s[2*i+2],o=s[2*i+3];return 1>Math.abs(r-n)&&1>Math.abs(o-l)?0:1>Math.abs(r-n)?o-l>=0?90:270:1>Math.abs(o-l)?r-n>=0?0:180:180*Math.atan2(o-l,r-n)/Math.PI}r+=n}}return NaN}getPointAndAngleAlongPath(t,e){if(t<0?t=0:t>1&&(t=1),void 0===e&&(e=[]),e.length=3,1===this.type)return e[0]=this.startX+t*(this.endX-this.startX),e[1]=this.startY+t*(this.endY-this.startY),e[2]=180*Math.atan2(this.endY-this.startY,this.endX-this.startX)/Math.PI,e;let i=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,l=i.length,r=n*t,o=0;for(let t=0;t<l;t++){let n=s[t],l=n.length;for(let s=0;s<l;s++){let l=n[s];if(o+l>=r){let n;let h=r-o,a=0===l?0:h/l,u=i[t],d=u[2*s],c=u[2*s+1],g=u[2*s+2],f=u[2*s+3];return e[0]=d+(g-d)*a,e[1]=c+(f-c)*a,n=1>Math.abs(g-d)&&1>Math.abs(f-c)?0:1>Math.abs(g-d)?f-c>=0?90:270:1>Math.abs(f-c)?g-d>=0?0:180:180*Math.atan2(f-c,g-d)/Math.PI,e[2]=n,e}o+=l}}return e}getFractionForPoint(t){if(1===this.type){let e=this.startX,i=this.startY,s=this.endX,n=this.endY;if(e===s&&i===n)return 0;{let l=t.x,r=t.y,o=0,h=0;if(e===s)return i<n?(o=i,h=n):(o=n,h=i),r<=o?+(o!==i):r>=h?+(h!==i):Math.abs(r-i)/(h-o);if(i===n)return e<s?(o=e,h=s):(o=s,h=e),l<=o?+(o!==e):l>=h?+(h!==e):Math.abs(l-e)/(h-o);{let t=(s-e)**2+(n-i)**2,o=ty.l();tP.bl(e,i,s,n,l,r,o);let h=o.x,a=o.y;return ty.e(o),Math.sqrt(((h-e)**2+(a-i)**2)/t)}}}if(2===this.type){let e=this.startX,i=this.startY,s=this.endX,n=this.endY;if(e===s&&i===n)return 0;{let l=s-e,r=n-i,o=2*l+2*r,h=t.x,a=t.y;h=Math.min(Math.max(h,e),s),a=Math.min(Math.max(a,i),n);let u=Math.abs(h-e),d=Math.abs(h-s),c=Math.abs(a-i),g=Math.abs(a-n),f=Math.min(u,d,c,g);if(f===c)return h/o;if(f===d)return(l+a)/o;if(f===g)return(2*l+r-h)/o;if(f===u)return(2*l+2*r-a)/o}}else{let e=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=ty.l(),l=1/0,r=0,o=0,h=e.length,a=0,u=0;for(let s=0;s<h;s++){let h=e[s],d=i[s],c=h.length;for(let e=0;e<c;e+=2){let i=h[e],s=h[e+1];if(0===e){a=i,u=s;continue}tP.bl(a,u,i,s,t.x,t.y,n);let c=(n.x-t.x)**2+(n.y-t.y)**2;c<l&&(l=c,r=o+Math.sqrt((n.x-a)**2+(n.y-u)**2)),o+=d[(e-2)/2],a=i,u=s}}ty.e(n);let d=r/s;return d<0?0:d>1?1:d}return 0}get flattenedSegments(){return this.FC(),this.cc}FC(){if(null===this.cc){let t=this.cc=[],e=this.uu=[];this.nF(t,e)}}get flattenedLengths(){return this.FC(),this.uu}get flattenedTotalLength(){let t=this.du;if(isNaN(t)){if(1===this.type){let e=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);t=Math.sqrt(e*e+i*i)}else if(2===this.type)t=2*Math.abs(this.endX-this.startX)+2*Math.abs(this.endY-this.startY);else{let e=this.flattenedLengths,i=e.length;t=0;for(let s=0;s<i;s++){let i=e[s],n=i.length;for(let e=0;e<n;e++)t+=i[e]}}this.du=t}return t}Yk(t){let e=[],i=0,s=0,n=t.length;for(let l=0;l<n;l+=2){let n=t[l],r=t[l+1];if(0===l){i=n,s=r;continue}let o=Math.sqrt(ty.distanceSquared(i,s,n,r));e.push(o),i=n,s=r}return e}nF(t,e){let i=[],s=[];if(1===this.type)i.push(this.startX),i.push(this.startY),i.push(this.endX),i.push(this.endY),t.push(i),s.push(Math.sqrt((this.startX-this.endX)**2+(this.startY-this.endY)**2)),e.push(s);else if(2===this.type)i.push(this.startX),i.push(this.startY),i.push(this.endX),i.push(this.startY),i.push(this.endX),i.push(this.endY),i.push(this.startX),i.push(this.endY),i.push(this.startX),i.push(this.startY),t.push(i),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),e.push(s);else if(3===this.type){let s=new tC;s.startX=this.endX,s.startY=(this.startY+this.endY)/2;let n=new tT(5);n.startAngle=0,n.sweepAngle=360,n.centerX=(this.startX+this.endX)/2,n.centerY=(this.startY+this.endY)/2,n.radiusX=Math.abs(this.startX-this.endX)/2,n.radiusY=Math.abs(this.startY-this.endY)/2,s.add(n);let l=n.Ao(s),r=l.length;if(0===r)i.push(n.centerX),i.push(n.centerY);else{let t=s.startX,e=s.startY;for(let s=0;s<r;s++){let n=l[s];tP.Yn(t,e,n[2],n[3],n[4],n[5],n[6],n[7],.5,i),t=n[6],e=n[7]}}t.push(i),e.push(this.Yk(i))}else{let s=this.figures.iterator;for(;s.next();){let n=s.value;(i=[]).push(n.startX),i.push(n.startY);let l=n.startX,r=n.startY,o=l,h=r,a=n.segments.r,u=a.length;for(let s=0;s<u;s++){let u=a[s];switch(u.type){case 1:i.length>=4&&(t.push(i),e.push(this.Yk(i))),(i=[]).push(u.endX),i.push(u.endY),l=u.endX,r=u.endY,o=l,h=r;break;case 2:i.push(u.endX),i.push(u.endY),l=u.endX,r=u.endY;break;case 3:tP.Yn(l,r,u.point1X,u.point1Y,u.point2X,u.point2Y,u.endX,u.endY,.5,i),l=u.endX,r=u.endY;break;case 4:tP.Vg(l,r,u.point1X,u.point1Y,u.endX,u.endY,.5,i),l=u.endX,r=u.endY;break;case 5:{let t=u.Ao(n),e=t.length;if(0===e){i.push(u.centerX),i.push(u.centerY),l=u.centerX,r=u.centerY;break}for(let s=0;s<e;s++){let e=t[s];tP.Yn(l,r,e[2],e[3],e[4],e[5],e[6],e[7],.5,i),l=e[6],r=e[7]}break}case 6:{let t=u.Yh(n,l,r),e=t.length,s=u.endX,o=u.endY;if(0===e){i.push(s),i.push(o),l=s,r=o;break}for(let s=0;s<e;s++){let e=t[s];tP.Yn(l,r,e[2],e[3],e[4],e[5],e[6],e[7],.5,i),l=e[6],r=e[7]}break}default:te.o("Segment not of valid type: "+u.type)}u.isClosed&&(i.push(o),i.push(h))}i.length>=4&&(t.push(i),e.push(this.Yk(i)))}}}get type(){return this.$}set type(t){this.$!==t&&(this.h&&te.D(this,t),this.$=t,4===t?this.Bs=new th:(null===tN.Pw&&(tN.Pw=new th().u()),this.Bs=tN.Pw),this.kt=!0)}get startX(){return this.ke}set startX(t){this.ke!==t&&(this.h&&te.D(this,t),this.ke=t,this.kt=!0)}get startY(){return this.Pe}set startY(t){this.Pe!==t&&(this.h&&te.D(this,t),this.Pe=t,this.kt=!0)}get endX(){return this.ie}set endX(t){this.ie!==t&&(this.h&&te.D(this,t),this.ie=t,this.kt=!0)}get endY(){return this.ee}set endY(t){this.ee!==t&&(this.h&&te.D(this,t),this.ee=t,this.kt=!0)}get figures(){return this.Bs}set figures(t){this.Bs!==t&&(this.h&&te.D(this,t),this.Bs=t,this.kt=!0)}add(t){return this.Bs.add(t),this}setSpots(t,e,i,s,n,l,r,o){return this.h&&te.D(this),this.Hn=new tv(t,e,n,l).u(),this.jn=new tv(i,s,r,o).u(),this}get spot1(){return this.Hn}set spot1(t){this.h&&te.D(this,t),this.Hn=t.N()}get spot2(){return this.jn}set spot2(t){this.h&&te.D(this,t),this.jn=t.N()}get defaultStretch(){return this.qn}set defaultStretch(t){this.qn=t}get bounds(){return this.Vk()&&this.Mw(),this.jg}}tN.stringify=tN.stringify,tN.stringifyFixed=tN.stringifyFixed,tN.fillPath=tN.fillPath,tN.parse=tN.parse;class tC{n;ke;Pe;dc;Jg;Ve;constructor(t,e,i,s,n){void 0===i&&(i=!0),void 0===s&&(s=!0),void 0===n&&(n=!1),this.n=2|4*!!i|8*!!s|16*!!n,void 0!==t?this.ke=t:this.ke=0,void 0!==e?this.Pe=e:this.Pe=0,this.dc=new th,this.Jg=this.dc.ht,this.Ve=null}copy(){let t=new tC;t.n=-2&this.n,t.ke=this.ke,t.Pe=this.Pe;let e=this.dc.r,i=e.length,s=t.dc;for(let t=0;t<i;t++){let i=e[t].copy();s.add(i)}return t.Jg=this.Jg,t.Ve=this.Ve,t}equalsApprox(t){if(!(t instanceof tC)||!tP.f(this.startX,t.startX)||!tP.f(this.startY,t.startY))return!1;let e=this.segments.r,i=t.segments.r,s=e.length;if(s!==i.length)return!1;for(let t=0;t<s;t++){let s=e[t],n=i[t];if(!s.equalsApprox(n))return!1}return!0}toString(t){void 0===t&&(t=-1);let e="";if(t<0)e="M"+this.startX.toString()+" "+this.startY.toString();else{let i=e=>0===e?"0":e.toFixed(t);e="M"+i(this.startX)+" "+i(this.startY)}let i=this.segments.r,s=i.length;for(let n=0;n<s;n++)e+=" "+i[n].toString(t);return e}get h(){return(1&this.n)!=0}set h(t){t?this.n|=1:this.n&=-2}get kt(){return(2&this.n)!=0}set kt(t){t?this.n|=2:this.n&=-3}u(){this.h=!0;let t=this.segments;t.u();let e=t.r,i=t.length;for(let t=0;t<i;t++)e[t].u();return this}Vk(){if(this.kt)return!0;let t=this.segments;if(this.Jg!==t.ht)return!0;for(let e of t)if(e.kt)return!0;return!1}eF(){this.kt=!1,this.Ve=null;let t=this.segments;for(let e of(this.Jg=t.ht,t))e.kt=!1,e.Us=null}get isFilled(){return(4&this.n)!=0}set isFilled(t){this.h&&te.D(this,t),t?this.n|=4:this.n&=-5}get isShadowed(){return(8&this.n)!=0}set isShadowed(t){this.h&&te.D(this,t),t?this.n|=8:this.n&=-9}get isEvenOdd(){return(16&this.n)!=0}set isEvenOdd(t){this.h&&te.D(this,t),t?this.n|=16:this.n&=-17}get startX(){return this.ke}set startX(t){this.h&&te.D(this,t),this.ke=t,this.Ve=null,this.kt=!0}get startY(){return this.Pe}set startY(t){this.h&&te.D(this,t),this.Pe=t,this.Ve=null,this.kt=!0}get segments(){return this.dc}set segments(t){this.h&&te.D(this,t),this.dc=t,this.Ve=null,this.kt=!0}add(t){return this.dc.add(t),this.Ve=null,this}Xk(t,e,i){let s=this.startX,n=this.startY,l=s,r=n,o=this.segments.r,h=o.length;for(let a=0;a<h;a++){let h=o[a];switch(h.type){case 1:l=h.endX,r=h.endY,s=h.endX,n=h.endY;break;case 2:if(tP.Ei(s,n,h.endX,h.endY,i,t,e))return!0;s=h.endX,n=h.endY;break;case 3:if(tP.bw(s,n,h.point1X,h.point1Y,h.point2X,h.point2Y,h.endX,h.endY,.5,t,e,i))return!0;s=h.endX,n=h.endY;break;case 4:if(tP.Bk(s,n,h.point1X,h.point1Y,h.endX,h.endY,.5,t,e,i))return!0;s=h.endX,n=h.endY;break;case 5:case 6:let u=5===h.type?h.Ao(this):h.Yh(this,s,n),d=u.length,c=5===h.type?h.centerX:h.endX,g=5===h.type?h.centerY:h.endY;if(0===d){if(tP.Ei(s,n,c,g,i,t,e))return!0;s=c,n=g;break}let f=null;for(let l=0;l<d;l++)if(f=u[l],0===l&&tP.Ei(s,n,f[0],f[1],i,t,e)||tP.bw(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],.5,t,e,i))return!0;null!==f&&(s=f[6],n=f[7]);break;default:te.o("Unknown Segment type: "+h.type)}if(h.isClosed&&(s!==l||n!==r)&&tP.Ei(s,n,l,r,i,t,e))return!0}return!1}}var tL=((i=tL||{})[i.Move=1]="Move",i[i.Line=2]="Line",i[i.Bezier=3]="Bezier",i[i.QuadraticBezier=4]="QuadraticBezier",i[i.Arc=5]="Arc",i[i.SvgArc=6]="SvgArc",i);class tT{$;n;ie;ee;cn;Pl;Sl;yr;Us;constructor(t,e,i,s,n,l,r,o){if(tu.qi(this),void 0===t&&(t=2),this.$=t,this.n=2,void 0!==e?this.ie=e:this.ie=0,void 0!==i?this.ee=i:this.ee=0,void 0===s&&(s=0),void 0===n&&(n=0),void 0===l&&(l=0),void 0===r&&(r=0),6===t){let t=l;(t%=360)<0&&(t+=360),this.cn=t,this.Pl=0,this.Sl=Math.max(s,0),this.yr=Math.max(n,0),"boolean"==typeof r?r&&(this.isLargeArc=!0):"number"==typeof r&&r&&(this.isLargeArc=!0),o&&(this.isClockwiseArc=!0)}else this.cn=s,this.Pl=n,5===t&&(l=Math.max(l,0)),this.Sl=l,"number"==typeof r?(5===t&&(r=Math.max(r,0)),this.yr=r):this.yr=0;this.Us=null}copy(){let t=new tT;return t.$=this.$,t.n=-2&this.n,t.ie=this.ie,t.ee=this.ee,t.cn=this.cn,t.Pl=this.Pl,t.Sl=this.Sl,t.yr=this.yr,t}equalsApprox(t){if(!(t instanceof tT)||this.type!==t.type||this.isClosed!==t.isClosed)return!1;switch(this.type){case 1:case 2:return tP.f(this.endX,t.endX)&&tP.f(this.endY,t.endY);case 3:return tP.f(this.endX,t.endX)&&tP.f(this.endY,t.endY)&&tP.f(this.point1X,t.point1X)&&tP.f(this.point1Y,t.point1Y)&&tP.f(this.point2X,t.point2X)&&tP.f(this.point2Y,t.point2Y);case 4:return tP.f(this.endX,t.endX)&&tP.f(this.endY,t.endY)&&tP.f(this.point1X,t.point1X)&&tP.f(this.point1Y,t.point1Y);case 5:return tP.f(this.startAngle,t.startAngle)&&tP.f(this.sweepAngle,t.sweepAngle)&&tP.f(this.centerX,t.centerX)&&tP.f(this.centerY,t.centerY)&&tP.f(this.radiusX,t.radiusX)&&tP.f(this.radiusY,t.radiusY);case 6:return this.isClockwiseArc===t.isClockwiseArc&&this.isLargeArc===t.isLargeArc&&tP.f(this.xAxisRotation,t.xAxisRotation)&&tP.f(this.endX,t.endX)&&tP.f(this.endY,t.endY)&&tP.f(this.radiusX,t.radiusX)&&tP.f(this.radiusY,t.radiusY);default:return!1}}hi(t){t in tL?this.type=t:te.cr(this,t)}toString(t){void 0===t&&(t=-1);let e=e=>0===e?"0":e.toFixed(t),i="";switch(this.type){case 1:i=t<0?"M"+this.endX.toString()+" "+this.endY.toString():"M"+e(this.endX)+" "+e(this.endY);break;case 2:i=t<0?"L"+this.endX.toString()+" "+this.endY.toString():"L"+e(this.endX)+" "+e(this.endY);break;case 3:i=t<0?"C"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.point2X.toString()+" "+this.point2Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():"C"+e(this.point1X)+" "+e(this.point1Y)+" "+e(this.point2X)+" "+e(this.point2Y)+" "+e(this.endX)+" "+e(this.endY);break;case 4:i=t<0?"Q"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():"Q"+e(this.point1X)+" "+e(this.point1Y)+" "+e(this.endX)+" "+e(this.endY);break;case 5:i=t<0?"B"+this.startAngle.toString()+" "+this.sweepAngle.toString()+" "+this.centerX.toString()+" "+this.centerY.toString()+" "+this.radiusX.toString()+" "+this.radiusY.toString():"B"+e(this.startAngle)+" "+e(this.sweepAngle)+" "+e(this.centerX)+" "+e(this.centerY)+" "+e(this.radiusX)+" "+e(this.radiusY);break;case 6:i=t<0?"A"+this.radiusX.toString()+" "+this.radiusY.toString()+" "+this.xAxisRotation.toString()+" "+ +!!this.isLargeArc+" "+ +!!this.isClockwiseArc+" "+this.endX.toString()+" "+this.endY.toString():"A"+e(this.radiusX)+" "+e(this.radiusY)+" "+e(this.xAxisRotation)+" "+ +!!this.isLargeArc+" "+ +!!this.isClockwiseArc+" "+e(this.endX)+" "+e(this.endY);break;default:i=tL[this.type]}return i+(this.isClosed?"z":"")}static Move=1;static Line=2;static Bezier=3;static QuadraticBezier=4;static Arc=5;static SvgArc=6;get h(){return(1&this.n)!=0}set h(t){t?this.n|=1:this.n&=-2}get kt(){return(2&this.n)!=0}set kt(t){t?this.n|=2:this.n&=-3}u(){return this.h=!0,this}close(){return this.isClosed=!0,this}Ao(t){if(null!==this.Us&&!1===t.kt)return this.Us;let e=this.radiusX,i=this.radiusY;if(void 0===i&&(i=e),0===e||0===i)return this.Us=[],this.Us;let s=this.cn,n=this.Pl,l=tP.SC(0,0,e<i?e:i,this.startAngle,this.startAngle+this.sweepAngle,!1);if(e!==i){let t=tk.l();t.Ii(),e<i?t.nt(1,i/e):t.nt(e/i,1),tN.AC(l,t),tk.e(t)}let r=l.length;for(let t=0;t<r;t++){let e=l[t];e[0]+=s,e[1]+=n,e[2]+=s,e[3]+=n,e[4]+=s,e[5]+=n,e[6]+=s,e[7]+=n}return this.Us=l,this.Us}Yh(t,e,i){if(null!==this.Us&&!1===t.kt)return this.Us;if(0===this.radiusX||0===this.radiusY)return this.Us=[],this.Us;let s=this.Sl,n=this.yr;0===s&&(s=1e-4),0===n&&(n=1e-4);let l=this.cn*(Math.PI/180),r=this.isLargeArc,o=this.isClockwiseArc,h=this.ie,a=this.ee,u=Math.cos(l),d=Math.sin(l),c=u*(e-h)/2+d*(i-a)/2,g=-d*(e-h)/2+u*(i-a)/2,f=c*c/(s*s)+g*g/(n*n);f>1&&(s*=Math.sqrt(f),n*=Math.sqrt(f));let m=(r===o?-1:1)*Math.sqrt((s*s*n*n-s*s*g*g-n*n*c*c)/(s*s*g*g+n*n*c*c));isNaN(m)&&(m=0);let p=m*s*g/n,y=-(m*n)*c/s;isNaN(p)&&(p=0),isNaN(y)&&(y=0);let x=(e+h)/2+u*p-d*y,w=(i+a)/2+d*p+u*y,b=(t,e)=>Math.sqrt(t*t+e*e),v=(t,e,i,s)=>(t*i+e*s)/(b(t,e)*b(i,s)),k=(t,e,i,s)=>(t*s<e*i?-1:1)*Math.acos(v(t,e,i,s)),P=k(1,0,(c-p)/s,(g-y)/n),S=(c-p)/s,M=(g-y)/n,N=(-c-p)/s,C=(-g-y)/n,L=k(S,M,N,C),T=v(S,M,N,C);T<=-1?L=Math.PI:T>=1&&(L=0),!o&&L>0&&(L-=2*Math.PI),o&&L<0&&(L+=2*Math.PI);let A=s>n?s:n,D=s>n?1:s/n,F=s>n?n/s:1,O=tP.SC(0,0,A,P,P+L,!0),R=tk.l();return R.Ii(),R.Es(x,w),R.ds(this.cn,0,0),R.nt(D,F),tN.AC(O,R),tk.e(R),this.Us=O,this.Us}get isClosed(){return(8&this.n)!=0}set isClosed(t){this.isClosed!==t&&(t?this.n|=8:this.n&=-9,this.kt=!0)}get type(){return this.$}set type(t){this.h&&te.D(this,t),this.$=t,this.kt=!0}get endX(){return this.ie}set endX(t){this.h&&te.D(this,t),this.ie=t,this.kt=!0}get endY(){return this.ee}set endY(t){this.h&&te.D(this,t),this.ee=t,this.kt=!0}get point1X(){return this.cn}set point1X(t){this.h&&te.D(this,t),this.cn=t,this.kt=!0}get point1Y(){return this.Pl}set point1Y(t){this.h&&te.D(this,t),this.Pl=t,this.kt=!0}get point2X(){return this.Sl}set point2X(t){this.h&&te.D(this,t),this.Sl=t,this.kt=!0}get point2Y(){return this.yr}set point2Y(t){this.h&&te.D(this,t),this.yr=t,this.kt=!0}get centerX(){return this.cn}set centerX(t){this.h&&te.D(this,t),this.cn=t,this.kt=!0}get centerY(){return this.Pl}set centerY(t){this.h&&te.D(this,t),this.Pl=t,this.kt=!0}get radiusX(){return this.Sl}set radiusX(t){t<0&&te._(t,">= zero",tT,"radiusX"),this.h&&te.D(this,t),this.Sl=t,this.kt=!0}get radiusY(){return this.yr}set radiusY(t){t<0&&te._(t,">= zero",tT,"radiusY"),this.h&&te.D(this,t),this.yr=t,this.kt=!0}get startAngle(){return this.ie}set startAngle(t){this.h&&te.D(this,t),(t%=360)<0&&(t+=360),this.ie=t,this.kt=!0}get sweepAngle(){return this.ee}set sweepAngle(t){this.h&&te.D(this,t),t>360&&(t=360),t<-360&&(t=-360),this.ee=t,this.kt=!0}get isClockwiseArc(){return(4&this.n)!=0}set isClockwiseArc(t){this.h&&te.D(this,t),t?this.n|=4:this.n&=-5,this.kt=!0}get isLargeArc(){return(16&this.n)!=0}set isLargeArc(t){this.h&&te.D(this,t),t?this.n|=16:this.n&=-17,this.kt=!0}get xAxisRotation(){return this.cn}set xAxisRotation(t){this.h&&te.D(this,t),(t%=360)<0&&(t+=360),this.cn=t,this.kt=!0}}class tA{L;Cw;Lw;$g;Zg;Qg;_g;tm;im;em;sm;nm;om;rm;To;lm;hm;am;Se;constructor(){this.L=null,this.Cw=new ty(0,0).u(),this.Lw=new ty(0,0).u(),this.$g=0,this.Zg=0,this.Qg=1,this._g="",this.tm="",this.im=!1,this.em=!1,this.sm=0,this.nm=0,this.om=!1,this.rm=!1,this.To=!1,this.lm=null,this.hm=0,this.am=null,this.Se=null}copy(){let t=new tA;return this.clone(t)}clone(t){return t.L=this.L,t.Cw.a(this.viewPoint),t.Lw.a(this.documentPoint),t.$g=this.$g,t.Zg=this.Zg,t.Qg=this.Qg,t._g=this._g,t.tm=this.tm,t.im=this.im,t.em=this.em,t.sm=this.sm,t.nm=this.nm,t.om=this.om,t.rm=this.rm,t.To=this.To,t.lm=this.lm,t.hm=this.hm,t.am=this.am,t.Se=this.Se,t}toString(){let t="^";return 0!==this.modifiers&&(t+="M:"+this.modifiers),0!==this.button&&(t+="B:"+this.button),""!==this.key&&(t+="K:"+this.key),0!==this.clickCount&&(t+="C:"+this.clickCount),0!==this.delta&&(t+="D:"+this.delta),this.handled&&(t+="h"),this.bubbles&&(t+="b"),null!==this.documentPoint&&(t+="@"+this.documentPoint.toString()),t}get diagram(){return this.L}set diagram(t){this.L=t}get viewPoint(){return this.Cw}set viewPoint(t){this.Cw.a(t)}get documentPoint(){return this.Lw}set documentPoint(t){this.Lw.a(t)}getMultiTouchViewPoint(t,e){let i=this.diagram;return null===i||i.RC(this.event,t,e),e}getMultiTouchDocumentPoint(t,e){let i=this.diagram;return null===i||(i.RC(this.event,t,e),e.a(i.transformViewToDoc(e))),e}get modifiers(){return this.$g}set modifiers(t){this.$g=t}get button(){return this.Zg}set button(t){if(this.Zg=t,null===this.event)switch(t){case 0:this.buttons=1;return;case 1:this.buttons=4;return;case 2:this.buttons=2;return}}get buttons(){return this.Qg}set buttons(t){this.Qg=t}get key(){return this._g}set key(t){this._g=t}get code(){return this.tm}set code(t){this.tm=t}get down(){return this.im}set down(t){this.im=t}get up(){return this.em}set up(t){this.em=t}get clickCount(){return this.sm}set clickCount(t){this.sm=t}get delta(){return this.nm}set delta(t){this.nm=t}get isMultiTouch(){return this.om}set isMultiTouch(t){this.om=t}get handled(){return this.rm}set handled(t){this.rm=t}get bubbles(){return this.To}set bubbles(t){this.To=t}get event(){return this.lm}set event(t){this.lm=t}get isTouchEvent(){let t=this.event;return null!==t&&("touch"===t.pointerType||"pen"===t.pointerType)}get timestamp(){return this.hm}set timestamp(t){this.hm=t}get targetDiagram(){return this.am}set targetDiagram(t){this.am=t}get targetObject(){return this.Se}set targetObject(t){this.Se=t}get control(){return(1&this.modifiers)!=0}set control(t){this.modifiers=t?1|this.modifiers:-2&this.modifiers}get shift(){return(4&this.modifiers)!=0}set shift(t){this.modifiers=t?4|this.modifiers:-5&this.modifiers}get alt(){return(2&this.modifiers)!=0}set alt(t){this.modifiers=t?2|this.modifiers:-3&this.modifiers}get meta(){return(8&this.modifiers)!=0}set meta(t){this.modifiers=t?8|this.modifiers:-9&this.modifiers}get left(){let t=this.event;return null!==t&&("mousedown"===t.type||"mouseup"===t.type||"pointerdown"===t.type||"pointerup"===t.type)?0===this.button:(1&this.buttons)!=0}set left(t){t?this.buttons|=1:this.buttons&=-2}get right(){let t=this.event;return null!==t&&("mousedown"===t.type||"mouseup"===t.type||"pointerdown"===t.type||"pointerup"===t.type)?2===this.button:(2&this.buttons)!=0}set right(t){t?this.buttons|=2:this.buttons&=-3}get middle(){let t=this.event;return null!==t&&("mousedown"===t.type||"mouseup"===t.type||"pointerdown"===t.type||"pointerup"===t.type)?1===this.button:(4&this.buttons)!=0}set middle(t){t?this.buttons|=4:this.buttons&=-5}get commandKey(){let t=this.code,e=this.key;return"cxvyzagCXVYZAG".includes(e)?e.toLowerCase():"KeyC"===t?"c":"KeyX"===t?"x":"KeyV"===t?"v":"KeyY"===t?"y":"KeyZ"===t?"z":"KeyA"===t?"a":"KeyG"===t?"g":""!==t?t:e}}class tD{L;Nt;cm;fm;constructor(){this.L=null,this.Nt="",this.cm=null,this.fm=null}copy(){let t=new tD;return t.L=this.L,t.Nt=this.Nt,t.cm=this.cm,t.fm=this.fm,t}toString(){let t="*"+this.name;return null!==this.subject&&(t+=":"+this.subject.toString()),null!==this.parameter&&(t+="("+this.parameter.toString()+")"),t}get diagram(){return this.L}set diagram(t){this.L=t}get name(){return this.Nt}set name(t){this.Nt=t}get subject(){return this.cm}set subject(t){this.cm=t}get parameter(){return this.fm}set parameter(t){this.fm=t}}var tF=((s=tF||{})[s.Transaction=1]="Transaction",s[s.Property=2]="Property",s[s.Insert=3]="Insert",s[s.Remove=4]="Remove",s);class tO{mu;um;fn;Mi;L;pu;gc;mc;pc;yc;constructor(){this.mu=2,this.um="",this.fn="",this.Mi=null,this.L=null,this.pu=null,this.gc=null,this.mc=null,this.pc=null,this.yc=null}static Transaction=1;static Property=2;static Insert=3;static Remove=4;clear(){this.Mi=null,this.L=null,this.pu=null,this.gc=null,this.mc=null,this.pc=null,this.yc=null}copy(){let t=new tO;t.mu=this.mu,t.um=this.um,t.fn=this.fn,t.Mi=this.Mi,t.L=this.L,t.pu=this.pu;let e=this.gc;return te.H(e)&&te.ot(e.copyFrozen)?t.gc=e.copyFrozen():t.gc=e,e=this.mc,te.H(e)&&te.ot(e.copyFrozen)?t.mc=e.copyFrozen():t.mc=e,e=this.pc,te.H(e)&&te.ot(e.copyFrozen)?t.pc=e.copyFrozen():t.pc=e,e=this.yc,te.H(e)&&te.ot(e.copyFrozen)?t.yc=e.copyFrozen():t.yc=e,t}hi(t){t in tF?this.change=t:te.cr(this,t)}toString(){let t="";return 1===this.change?t+="* ":2===this.change?t+=null!==this.model?"!m":"!d":t+=(null!==this.model?"!m":"!d")+this.change,this.propertyName&&"string"==typeof this.propertyName&&(t+=" "+this.propertyName),this.modelChange&&this.modelChange!==this.propertyName&&(t+=" "+this.modelChange),t+=": ",1===this.change?null!==this.oldValue&&(t+=" "+this.oldValue):(null!==this.object&&(t+=te.toString(this.object)),null!==this.oldValue&&(t+="  old: "+te.toString(this.oldValue)),null!==this.oldParam&&(t+=" "+this.oldParam),null!==this.newValue&&(t+="  new: "+te.toString(this.newValue)),null!==this.newParam&&(t+=" "+this.newParam)),t}getValue(t){return t?this.oldValue:this.newValue}getParam(t){return t?this.oldParam:this.newParam}canUndo(){return null!==this.model||null!==this.diagram}undo(){this.canUndo()&&(null!==this.model?this.model.changeState(this,!0):null!==this.diagram&&this.diagram.vC(this,!0))}canRedo(){return null!==this.model||null!==this.diagram}redo(){this.canRedo()&&(null!==this.model?this.model.changeState(this,!1):null!==this.diagram&&this.diagram.vC(this,!1))}get model(){return this.Mi}set model(t){this.Mi=t}get diagram(){return this.L}set diagram(t){this.L=t}get change(){return this.mu}set change(t){this.mu=t}get modelChange(){return this.um}set modelChange(t){this.um=t}get propertyName(){return this.fn}set propertyName(t){this.fn=t}get isTransactionFinished(){return 1===this.mu&&("CommittedTransaction"===this.fn||"FinishedUndo"===this.fn||"FinishedRedo"===this.fn)}get object(){return this.pu}set object(t){this.pu=t}get oldValue(){return this.gc}set oldValue(t){this.gc=t}get oldParam(){return this.mc}set oldParam(t){this.mc=t}get newValue(){return this.pc}set newValue(t){this.pc=t}get newParam(){return this.yc}set newParam(t){this.yc=t}}class tR{OC;Nt;Kk;constructor(){this.OC=new th().u(),this.Nt="",this.Kk=!1}toString(t){let e="Transaction: "+this.name+" "+this.changes.count.toString()+(this.isComplete?"":", incomplete");if(void 0!==t&&t>0){let t=this.changes.count;for(let i=0;i<t;i++){let t=this.changes.elt(i);null!==t&&(e+=`
  `+t.toString())}}return e}clear(){let t=this.changes;t.At();for(let e=t.count-1;e>=0;e--){let i=t.elt(e);null!==i&&i.clear()}t.clear(),t.u()}canUndo(){return this.isComplete}undo(){if(this.canUndo())for(let t=this.changes.count-1;t>=0;t--){let e=this.changes.elt(t);null!==e&&e.undo()}}canRedo(){return this.isComplete}redo(){if(!this.canRedo())return;let t=this.changes.count;for(let e=0;e<t;e++){let t=this.changes.elt(e);null!==t&&t.redo()}}oF(t){let e=this.changes;for(let i=e.count-1;i>=t;i--){let t=e.elt(i);null!==t&&t.undo(),e.At(),e.removeAt(i)}e.u()}optimize(){if(!this.isComplete)return;let t=this.changes;t.At();let e=new tp;for(let i=0;i<t.count;i++){let s=t.elt(i);if(null===s||2!==s.change||!s.object)continue;let n=e.get(s.object);n||(n=new tp,e.set(s.object,n));let l=n.get(s.propertyName);null===l?n.set(s.propertyName,-1):(l>0&&t.setElt(l,null),n.set(s.propertyName,i))}let i=0;for(let e=0;e<t.count;e++){let s=t.elt(e);null!==s&&(e>i&&t.setElt(i,s),i++)}for(;t.length>i;)t.pop();t.u()}get changes(){return this.OC}get name(){return this.Nt}set name(t){this.Nt=t}get isComplete(){return this.Kk}set isComplete(t){this.Kk=t}}class tB{Aw;Bi;IC;Vs;Gk;dm;Wn;Hk;jk;un;wc;Tw;zs;Dw;Fw;gm;Rw;constructor(t){this.Aw=new tu,this.Bi=!1,this.IC=new th().u(),this.Vs=-1,this.Gk=999,this.zs=!1,this.dm=null,this.Wn=0,this.Hk=!1,this.jk=23,this.un=new th().u(),this.wc=new th,this.Tw=!0,this.Dw=!1,this.Fw=!1,this.gm=!1,this.Rw=!1,t&&Object.assign(this,t)}toString(t){let e="UndoManager "+this.historyIndex+"<"+this.history.count+"<="+this.maxHistoryLength;e+="[";let i=this.nestedTransactionNames.count;for(let t=0;t<i;t++)t>0&&(e+=" "),e+=this.nestedTransactionNames.elt(t);if(e+="]",void 0!==t&&t>0){i=this.history.count;for(let s=0;s<i;s++)e+=`
 `+this.history.elt(s).toString(t-1)}return e}clear(){let t=this.history;t.At();for(let e=t.count-1;e>=0;e--){let i=t.elt(e);null!==i&&i.clear()}t.clear(),this.Vs=-1,t.u(),this.zs=!1,this.dm=null,this.Wn=0,this.un.At(),this.un.clear(),this.un.u(),this.wc.clear(),this.Dw=!1,this.Fw=!1,this.gm=!1,this.Rw=!1}copyProperties(t){this.isEnabled=t.isEnabled,this.maxHistoryLength=t.maxHistoryLength,this.mm=t.mm}addModel(t){this.Aw.add(t)}removeModel(t){this.Aw.delete(t)}startTransaction(t){if(void 0===t&&(t=""),null===t&&(t=""),this.isUndoingRedoing)return!1;!0===this.Tw&&(this.Tw=!1,this.Wn++,this.Ml||this.Nl("StartingFirstTransaction",t,this.currentTransaction),this.Wn>0&&this.Wn--),this.isEnabled&&(this.un.At(),this.un.add(t),this.un.u(),null===this.currentTransaction?this.wc.add(0):this.wc.add(this.currentTransaction.changes.count)),this.Wn++;let e=1===this.transactionLevel;return e&&(this.Ml||this.Nl("StartedTransaction",t,this.currentTransaction)),e}commitTransaction(t){return void 0===t&&(t=""),this.EC(!0,t)}rollbackTransaction(){return this.EC(!1,"")}EC(t,e){if(this.isUndoingRedoing)return!1;this.mm&&this.transactionLevel<1&&te.li("Ending transaction without having started a transaction: "+e);let i=1===this.transactionLevel,s=this.currentTransaction;i&&t&&(this.Ml||this.Nl("CommittingTransaction",e,s));let n=0;if(this.transactionLevel>0&&(this.Wn--,this.isEnabled)){let t=this.un.count;t>0&&(""===e&&(e=this.un.elt(0)),this.un.At(),this.un.removeAt(t-1),this.un.u());let i=this.wc.count;i>0&&(n=this.wc.elt(i-1),this.wc.removeAt(i-1))}if(!i)return this.isEnabled&&!t&&null!==s&&s.oF(n),!1;if(t){if(this.gm=!1,null===s&&""!==e&&(s=this.currentTransaction),this.isEnabled&&null!==s){let t=s;t.isComplete||(t.isComplete=!0,t.name=e),this.discardHistoryAfterIndex();let i=this.history;i.At();let n=this.maxHistoryLength;if(n>=0){if(0===n)i.clear();else if(i.count>=n){let t=i.elt(0);null!==t&&t.clear(),i.removeAt(0),this.Vs--}}0!==n&&(0===i.count||i.get(i.count-1)!==t)&&(i.add(t),this.Vs++),i.u(),s=t}this.Ml||this.Nl("CommittedTransaction",e,s)}else{this.zs=!0;try{this.isEnabled&&null!==s&&(s.isComplete=!0,s.undo())}finally{this.Ml||this.Nl("RolledBackTransaction",e,s),this.zs=!1}null!==s&&s.clear()}return this.dm=null,this.vw&&this.clear(),this.vw=!1,this.Ow=!1,!0}discardHistoryAfterIndex(){if(this.isUndoingRedoing||!this.canRedo())return;let t=this.history;t.At();for(let e=t.count-1;e>this.historyIndex;e--){let i=t.elt(e);null!==i&&i.clear(),t.removeAt(e),this.gm=!0}t.u()}pE(t){this.Wn+=t,this.Wn<0&&(this.Wn=0)}canUndo(){if(!this.isEnabled||this.transactionLevel>0)return!1;let t=this.transactionToUndo;return!!(null!==t&&t.canUndo())}undo(){if(!this.canUndo())return;let t=this.transactionToUndo;try{this.zs=!0,this.Nl("StartingUndo","Undo",t),this.Vs--,t.undo()}catch(t){te.li("undo error: "+t.toString())}finally{this.Nl("FinishedUndo","Undo",t),this.zs=!1}}canRedo(){if(!this.isEnabled||this.transactionLevel>0)return!1;let t=this.transactionToRedo;return!!(null!==t&&t.canRedo())}redo(){if(!this.canRedo())return;let t=this.transactionToRedo;try{this.zs=!0,this.Nl("StartingRedo","Redo",t),this.Vs++,t.redo()}catch(t){te.li("redo error: "+t.toString())}finally{this.Nl("FinishedRedo","Redo",t),this.zs=!1}}Nl(t,e,i){void 0===i&&(i=null);let s=new tO;s.change=1,s.propertyName=t,s.object=i,s.oldValue=e;let n=this.models;for(;n.next();){let t=n.value;s.model=t,t.rF(s)}}handleChanged(t){if(this.isEnabled&&!this.isUndoingRedoing&&!this.skipsEvent(t)){let e=this.currentTransaction;null===e&&(e=new tR,this.dm=e);let i=t.copy(),s=e.changes;if(s.At(),s.add(i),s.u(),this.mm&&this.jk>0&&this.transactionLevel<=0&&!this.Tw){let e=t.diagram;if(null!==e&&!1===e.Kh)return;te.li("Change not within a transaction: "+i.toString()),this.jk--}}}skipsEvent(t){if(null===t||1===t.change)return!0;let e=t.object;if(null===e)return!1;if(void 0!==e.layer){let t=e.layer;if(null!==t&&t.isTemporary)return!0}else if(e.isTemporary)return!0;return!1}get models(){return this.Aw.iterator}get isEnabled(){return this.Bi}set isEnabled(t){this.Bi=t}get transactionToUndo(){return this.historyIndex>=0&&this.historyIndex<=this.history.count-1?this.history.elt(this.historyIndex):null}get transactionToRedo(){return this.historyIndex<this.history.count-1?this.history.elt(this.historyIndex+1):null}get isUndoingRedoing(){return this.zs}get history(){return this.IC}get maxHistoryLength(){return this.Gk}set maxHistoryLength(t){this.Gk=t}get historyIndex(){return this.Vs}get currentTransaction(){return this.dm}get transactionLevel(){return this.Wn}get isInTransaction(){return this.Wn>0}get mm(){return this.Hk}set mm(t){this.Hk=t}get nestedTransactionNames(){return this.un}get vw(){return this.Dw}set vw(t){this.Dw=t}get Ow(){return this.Fw}set Ow(t){this.Fw=t}get Ml(){return this.Rw}set Ml(t){this.Rw=t}get isJustDiscarded(){return this.gm}}class tE{L;Nt;Bi;qk;Wk;pm;BC;constructor(){tu.qi(this),this.L=eh.ym(),this.Nt="",this.Bi=!0,this.qk=!1,this.Wk=null,this.BC=new tA,this.pm=-1}get diagram(){return this.L}set diagram(t){t instanceof eh&&(this.L=t)}toString(){return""!==this.name?this.name+" Tool":te.Vn(this.constructor)}updateAdornments(t){}canStart(){return this.isEnabled}doStart(){}doActivate(){this.isActive=!0}doDeactivate(){this.isActive=!1}doStop(){}doCancel(){this.transactionResult=null,this.stopTool()}stopTool(){let t=this.diagram;t.currentTool===this&&(t.currentTool=null,t.currentCursor="")}doMouseDown(){!this.isActive&&this.canStart()&&this.doActivate()}doMouseMove(){}doMouseUp(){this.stopTool()}doMouseWheel(){}canStartMultiTouch(){return!0}standardPinchZoomStart(){let t=this.diagram,e=t.lastInput,i=e.getMultiTouchViewPoint(0,ty.X(NaN,NaN)),s=e.getMultiTouchViewPoint(1,ty.X(NaN,NaN));if(!i.isReal()||!s.isReal()){ty.e(i),ty.e(s);return}if(this.doCancel(),t.getInputOption("hasGestureZoom")){t.Jk=t.scale;let n=s.x-i.x,l=s.y-i.y;t.$k=Math.sqrt(n*n+l*l),e.bubbles=!1}ty.e(i),ty.e(s)}standardPinchZoomMove(){let t=this.diagram,e=t.lastInput,i=e.getMultiTouchViewPoint(0,ty.X(NaN,NaN)),s=e.getMultiTouchViewPoint(1,ty.X(NaN,NaN));if(!i.isReal()||!s.isReal()){ty.e(i),ty.e(s);return}if(this.doCancel(),t.getInputOption("hasGestureZoom")){let n=s.x-i.x,l=s.y-i.y,r=Math.sqrt(n*n+l*l)/t.$k,o=new ty((Math.min(s.x,i.x)+Math.max(s.x,i.x))/2,(Math.min(s.y,i.y)+Math.max(s.y,i.y))/2),h=t.Jk*r,a=t.commandHandler;if(h!==t.scale&&a.canResetZoom(h)){let e=t.zoomPoint;t.zoomPoint=o,a.resetZoom(h),t.zoomPoint=e}e.bubbles=!1}ty.e(i),ty.e(s)}doKeyDown(){"Escape"===this.diagram.lastInput.code&&this.doCancel()}doKeyUp(){}startTransaction(t){return void 0===t&&(t=this.name),this.transactionResult=null,this.diagram.startTransaction(t)}stopTransaction(){let t=this.diagram;return null===this.transactionResult?t.rollbackTransaction():t.commitTransaction(this.transactionResult)}standardMouseSelect(){let t=this.diagram;if(!t.allowSelect)return;let e=t.lastInput,i=t.findPartAt(e.documentPoint,!1);if(null!==i){if(te.hr?e.meta:e.control){t.v("ChangingSelection",t.selection);let e=i;for(;null!==e&&!e.canSelect();)e=e.containingGroup;null!==e&&(e.isSelected=!e.isSelected),t.v("ChangedSelection",t.selection)}else if(e.shift){if(!i.isSelected){t.v("ChangingSelection",t.selection);let e=i;for(;null!==e&&!e.canSelect();)e=e.containingGroup;null!==e&&(e.isSelected=!0),t.v("ChangedSelection",t.selection)}}else if(!i.isSelected){let e=i;for(;null!==e&&!e.canSelect();)e=e.containingGroup;null!==e&&t.select(e)}}else!e.left||(te.hr?e.meta:e.control)||e.shift||t.clearSelection()}standardMouseClick(t,e){void 0===t&&(t=null),void 0===e&&(e=t=>!t.layer?.isTemporary);let i=this.diagram,s=i.lastInput,n=i.findObjectAt(s.documentPoint,t,e);return s.targetObject=n,this.lF(n,s,i),s.handled}lF(t,e,i){if(e.handled=!1,null!==t&&!t.isEnabledObject())return;let s=0;e.left?s=1===e.clickCount?1:2===e.clickCount?2:1:e.right&&1===e.clickCount&&(s=3);let n="ObjectSingleClicked";if(null!==t){switch(s){case 1:n="ObjectSingleClicked";break;case 2:n="ObjectDoubleClicked";break;case 3:n="ObjectContextClicked"}0!==s&&i.v(n,t)}else{switch(s){case 1:n="BackgroundSingleClicked";break;case 2:n="BackgroundDoubleClicked";break;case 3:n="BackgroundContextClicked"}0!==s&&i.v(n)}if(null!==t)for(;null!==t;){let i=null;switch(s){case 1:i=t.click;break;case 2:i=t.doubleClick?t.doubleClick:t.click;break;case 3:i=t.contextClick}if(null!==i&&(i(e,t),e.handled))break;t=t.panel}else{let t=null;switch(s){case 1:t=i.click;break;case 2:t=i.doubleClick?i.doubleClick:i.click;break;case 3:t=i.contextClick}null!==t&&t(e)}}standardMouseOver(){let t=this.diagram,e=t.lastInput;if(!0===t.animationManager.xi)return;let i=t.skipsUndoManager;t.skipsUndoManager=!0;let s=t.viewportBounds.containsPoint(e.documentPoint)?t.findObjectAt(e.documentPoint,null,null):null;e.event&&("pointercancel"===e.event.type||"pointerout"===e.event.type)&&(s=null),e.targetObject=s;let n=!1;if(s!==t.xc){let i=t.xc,l=i;for(t.xc=s,this.doCurrentObjectChanged(i,s),e.handled=!1;null!==i;){let t=i.mouseLeave;if(null!==t&&(s===i||null!==s&&s.isContainedBy(i)||(t(e,i,s),n=!0,e.handled)))break;i=i.panel}for(i=l,e.handled=!1;null!==s;){let t=s.mouseEnter;if(null!==t&&(i===s||null!==i&&i.isContainedBy(s)||(t(e,s,i),n=!0,e.handled)))break;s=s.panel}s=t.xc}if(null!==s){let i=s,l="";for(;null!==i&&""===(l=i.cursor);)i=i.panel;for(t.currentCursor=l,e.handled=!1,i=s;null!==i;){let t=i.mouseOver;if(null!==t&&(t(e,i),n=!0,e.handled))break;i=i.panel}}else{this.doUpdateCursor(null);let i=t.mouseOver;null!==i&&(i(e),n=!0)}n&&t.requestUpdate(),t.skipsUndoManager=i}doUpdateCursor(t){let e=this.diagram;e&&(e.currentCursor="")}doCurrentObjectChanged(t,e){}standardMouseWheel(){let t=this.diagram,e=t.lastInput,i=e.delta;if(0===i||!t.documentBounds.isReal())return;let s=t.commandHandler,n=t.toolManager.mouseWheelBehavior;if(null!==s&&(2===n&&!e.shift||1===n&&e.control)){if(i>0?s.canIncreaseZoom():s.canDecreaseZoom()){let n=t.zoomPoint;t.zoomPoint=e.viewPoint,i>0?s.increaseZoom():s.decreaseZoom(),t.zoomPoint=n}e.bubbles=!1}else if(2===n&&e.shift||1===n&&!e.control){let s=t.position.copy(),n=e.event,l=n.deltaMode,r=n.deltaX,o=n.deltaY,h="pixel";if(0===r&&0===o||e.shift)!e.shift&&t.allowVerticalScroll?(i=3*i*t.scrollVerticalLineChange,t.scroll(h,i>0?"up":"down",Math.abs(i))):e.shift&&t.allowHorizontalScroll&&(i=3*i*t.scrollHorizontalLineChange,t.scroll(h,i>0?"left":"right",Math.abs(i)));else{switch(l){case 0:h="pixel";break;case 1:h="line";break;case 2:h="page"}0!==r&&t.allowHorizontalScroll&&(r=t.scrollHorizontalLineChange/16*r,t.scroll(h,r>0?"right":"left",Math.abs(r))),0!==o&&t.allowVerticalScroll&&(o=t.scrollVerticalLineChange/16*o,t.scroll(h,o>0?"down":"up",Math.abs(o)))}this.doWheelChange(t,s,e)}}doWheelChange(t,e,i){t.position.equals(e)&&0===i.event.wheelDeltaX||(i.bubbles=!1)}standardWaitAfter(t,e){void 0===e&&(e=this.diagram.lastInput),this.cancelWaitAfter();let i=this,s=e.clone(this.BC);this.pm=te.ar(()=>i.doWaitAfter(s),t)}cancelWaitAfter(){-1!==this.pm&&te.Og(this.pm),this.pm=-1}doWaitAfter(t){}findToolHandleAt(t,e){let i=this.diagram.findObjectAt(t,t=>{for(;null!==t&&!(t.panel instanceof il);)t=t.panel;return t});return null===i?null:i.part.category===e?i:null}isBeyondDragSize(t,e){let i=this.diagram;void 0===t&&(t=i.firstInput.viewPoint),void 0===e&&(e=i.lastInput.viewPoint);let s=i.toolManager.dragSize,n=s.width,l=s.height;return i.firstInput.isTouchEvent&&(n+=6,l+=6),Math.abs(e.x-t.x)>n||Math.abs(e.y-t.y)>l}get name(){return this.Nt}set name(t){te.s(t,"string",tE,"name"),this.Nt=t}get isEnabled(){return this.Bi}set isEnabled(t){te.s(t,"boolean",tE,"isEnabled"),this.Bi=t}get isActive(){return this.qk}set isActive(t){te.s(t,"boolean",tE,"isActive"),this.qk=t}get transactionResult(){return this.Wk}set transactionResult(t){null!==t&&te.s(t,"string",tE,"transactionResult"),this.Wk=t}}var tI=((n=tI||{})[n.Scroll=1]="Scroll",n[n.Zoom=2]="Zoom",n[n.None=3]="None",n),tV=((l=tV||{})[l.Zoom=1]="Zoom",l[l.Cancel=2]="Cancel",l[l.None=3]="None",l);class tz extends tE{UC;VC;zC;Zk;Qk;_k;tP;iP;eP;sP;wm;Gh;constructor(t){super(),this.name="ToolManager",this.UC=new th,this.VC=new th,this.zC=new th,this.Zk=850,this.Qk=850,this._k=new tx(2,2).it(),this.tP=5e3,this.iP=1,this.eP=1,this.sP=null,this.wm=null,this.Gh=-1,t&&Object.assign(this,t)}static WheelScroll=1;static WheelZoom=2;static WheelNone=3;static GestureZoom=1;static GestureCancel=2;static GestureNone=3;get mouseWheelBehavior(){return this.iP}set mouseWheelBehavior(t){this.iP=t}get gestureBehavior(){return this.eP}set gestureBehavior(t){this.eP=t}initializeStandardTools(){}updateAdornments(t){let e=this.currentToolTip;if(e instanceof il&&this.wm===t){let i=e.adornedObject;(null!==t?null!==i&&i.part===t:null===i)?this.showToolTip(e,i):this.hideToolTip()}}doMouseDown(){let t=this.diagram,e=t.lastInput;if(e.isTouchEvent&&2===this.gestureBehavior&&(e.bubbles=!1),e.isMultiTouch){if(this.cancelWaitAfter(),3===this.gestureBehavior){e.bubbles=!0;return}if(2===this.gestureBehavior)return;if(t.currentTool.canStartMultiTouch()){t.currentTool.standardPinchZoomStart();return}}t.undoManager;let i=this.mouseDownTools.length;for(let e=0;e<i;e++){let i=this.mouseDownTools.elt(e);if(i.diagram=this.diagram,i.canStart()){t.doFocus(),t.currentTool=i,t.currentTool===i&&(i.isActive||i.doActivate(),i.doMouseDown());return}}1===t.lastInput.button&&(1===this.mouseWheelBehavior?this.mouseWheelBehavior=2:2===this.mouseWheelBehavior&&(this.mouseWheelBehavior=1)),this.doActivate(),this.standardWaitAfter(this.holdDelay,e)}doMouseMove(){let t=this.diagram,e=t.lastInput;if(e.isMultiTouch){if(3===this.gestureBehavior){e.bubbles=!0;return}if(2===this.gestureBehavior)return;if(t.currentTool.canStartMultiTouch()){t.currentTool.standardPinchZoomMove();return}}if(this.isActive){let e=this.mouseMoveTools.length;for(let i=0;i<e;i++){let e=this.mouseMoveTools.elt(i);if(e.diagram=this.diagram,e.canStart()){t.doFocus(),t.currentTool=e,t.currentTool===e&&(e.isActive||e.doActivate(),e.doMouseMove());return}}}this.standardMouseActivity(t);let i=e.event;null===i||"pointermove"!==i.type&&i.cancelable||(e.bubbles=!0)}standardMouseActivity(t){this.standardMouseOver(),this.isBeyondDragSize()&&this.standardWaitAfter(this.isActive?this.holdDelay:this.hoverDelay,t.lastInput)}doCurrentObjectChanged(t,e){let i=this.currentToolTip;null!==i&&(null!==e&&i instanceof il&&(e===i||e.isContainedBy(i))||this.hideToolTip())}doWaitAfter(t){let e=this.diagram;if(e.hF()&&(this.doMouseHover(),this.isActive||this.doToolTip(),t.isTouchEvent&&!e.lastInput.handled)){let i=t.copy();i.button=2,e.lastInput=i,e.Iw=!0,e.doMouseUp();return}}doMouseHover(){let t=this.diagram,e=t.lastInput;null===e.targetObject&&(e.targetObject=t.findObjectAt(e.documentPoint,null,null));let i=e.targetObject;if(null!==i)for(e.handled=!1;null!==i;){let t=this.isActive?i.mouseHold:i.mouseHover;if(null!==t&&(t(e,i),e.handled))break;i=i.panel}else{let i=this.isActive?t.mouseHold:t.mouseHover;null!==i&&i(e)}}doToolTip(){let t=this.diagram,e=t.lastInput;null===e.targetObject&&(e.targetObject=t.findObjectAt(e.documentPoint,null,null));let i=e.targetObject;if(null!==i){let t=this.currentToolTip;if(t instanceof il&&(i===t||i.isContainedBy(t)))return;for(;null!==i;){let t=i.toolTip;if(null!==t){this.showToolTip(t,i);return}i=i.panel}this.hideToolTip()}else{let e=t.toolTip;null!==e?this.showToolTip(e,null):this.hideToolTip()}}showToolTip(t,e){let i=this.diagram;if(t!==this.currentToolTip&&this.hideToolTip(),t instanceof il){t.layerName="Tool",t.selectable=!1,t.scale=1/i.scale,t.category="ToolTip",t.hasPlaceholder()&&(t.placeholder.scale=i.scale);let s=t.diagram;null!==s&&s!==i&&s.remove(t),i.add(t),null!==e?t.adornedObject=e:t.data=i.model,t.ensureBounds(),this.positionToolTip(t,e)}else t instanceof t0&&t!==this.currentToolTip&&null!==t.show&&t.show(e,i,this);this.currentToolTip=t,-1!==this.Gh&&(te.Og(this.Gh),this.Gh=-1);let s=this.toolTipDuration;if(s>0&&s!==1/0){let t=this;this.Gh=te.ar(()=>t.hideToolTip(),s)}}positionToolTip(t,e){if(t.hasPlaceholder())return;let i=this.diagram,s=i.lastInput.documentPoint.copy(),n=t.measuredBounds,l=i.viewportBounds;i.lastInput.isTouchEvent&&(s.x-=n.width),s.x+n.width>l.right&&(s.x-=n.width+5/i.scale),s.x<l.x&&(s.x=l.x),s.y+20/i.scale+n.height>l.bottom?s.y-=n.height+5/i.scale:s.y+=20/i.scale,s.y<l.y&&(s.y=l.y),t.position=s}hideToolTip(){-1!==this.Gh&&(te.Og(this.Gh),this.Gh=-1);let t=this.diagram,e=this.currentToolTip;null!==e&&(e instanceof il?(t.remove(e),null!==this.wm&&this.wm.removeAdornment(e.category),e.data=null,e.adornedObject=null):e instanceof t0&&null!==e.hide&&e.hide(t,this),this.currentToolTip=null)}get currentToolTip(){return this.sP}set currentToolTip(t){this.sP=t,this.wm=null!==t&&t instanceof il?t.adornedPart:null}doMouseUp(){this.cancelWaitAfter();let t=this.diagram;if(this.isActive){let e=this.mouseUpTools.length;for(let i=0;i<e;i++){let e=this.mouseUpTools.elt(i);if(e.diagram=this.diagram,e.canStart()){t.doFocus(),t.currentTool=e,t.currentTool===e&&(e.isActive||e.doActivate(),e.doMouseUp());return}}}t.doFocus(),this.doDeactivate()}doMouseWheel(){this.standardMouseWheel()}doKeyDown(){let t=this.diagram;null!==t.commandHandler&&t.commandHandler.doKeyDown()}doKeyUp(){let t=this.diagram;null!==t.commandHandler&&t.commandHandler.doKeyUp()}findTool(t){te.s(t,"string",tz,"findTool:name");let e=this.mouseDownTools.length;for(let i=0;i<e;i++){let e=this.mouseDownTools.elt(i);if(e.name===t)return e}e=this.mouseMoveTools.length;for(let i=0;i<e;i++){let e=this.mouseMoveTools.elt(i);if(e.name===t)return e}e=this.mouseUpTools.length;for(let i=0;i<e;i++){let e=this.mouseUpTools.elt(i);if(e.name===t)return e}return null}replaceTool(t,e){te.s(t,"string",tz,"replaceTool:name"),null!==e&&(e.diagram=this.diagram);let i=this.mouseDownTools.length;for(let s=0;s<i;s++){let i=this.mouseDownTools.elt(s);if(i.name===t)return null!==e?this.mouseDownTools.setElt(s,e):this.mouseDownTools.removeAt(s),i}i=this.mouseMoveTools.length;for(let s=0;s<i;s++){let i=this.mouseMoveTools.elt(s);if(i.name===t)return null!==e?this.mouseMoveTools.setElt(s,e):this.mouseMoveTools.removeAt(s),i}i=this.mouseUpTools.length;for(let s=0;s<i;s++){let i=this.mouseUpTools.elt(s);if(i.name===t)return null!==e?this.mouseUpTools.setElt(s,e):this.mouseUpTools.removeAt(s),i}return null}replaceStandardTool(t,e,i){this.Qt(t,e,i)}Qt(t,e,i){te.s(t,"string",tz,"replaceStandardTool:name"),null!==e&&(e.name=t,e.diagram=this.diagram),this.findTool(t)?this.replaceTool(t,e):null!==e&&i.add(e)}get mouseDownTools(){return this.UC}get mouseMoveTools(){return this.VC}get mouseUpTools(){return this.zC}get hoverDelay(){return this.Zk}set hoverDelay(t){te.s(t,"number",tz,"hoverDelay"),this.Zk=t}get holdDelay(){return this.Qk}set holdDelay(t){te.s(t,"number",tz,"holdDelay"),this.Qk=t}get dragSize(){return this._k}set dragSize(t){this._k=t.N()}get toolTipDuration(){return this.tP}set toolTipDuration(t){te.s(t,"number",tz,"toolTipDuration"),this.tP=t}get actionTool(){return this.findTool("Action")}set actionTool(t){this.Qt("Action",t,this.mouseDownTools)}get relinkingTool(){return this.findTool("Relinking")}set relinkingTool(t){this.Qt("Relinking",t,this.mouseDownTools)}get linkReshapingTool(){return this.findTool("LinkReshaping")}set linkReshapingTool(t){this.Qt("LinkReshaping",t,this.mouseDownTools)}get resizingTool(){return this.findTool("Resizing")}set resizingTool(t){this.Qt("Resizing",t,this.mouseDownTools)}get rotatingTool(){return this.findTool("Rotating")}set rotatingTool(t){this.Qt("Rotating",t,this.mouseDownTools)}get linkingTool(){return this.findTool("Linking")}set linkingTool(t){this.Qt("Linking",t,this.mouseMoveTools)}get draggingTool(){return this.findTool("Dragging")}set draggingTool(t){this.Qt("Dragging",t,this.mouseMoveTools)}get dragSelectingTool(){return this.findTool("DragSelecting")}set dragSelectingTool(t){this.Qt("DragSelecting",t,this.mouseMoveTools)}get panningTool(){return this.findTool("Panning")}set panningTool(t){this.Qt("Panning",t,this.mouseMoveTools)}get contextMenuTool(){return this.findTool("ContextMenu")}set contextMenuTool(t){this.Qt("ContextMenu",t,this.mouseUpTools)}get textEditingTool(){return this.findTool("TextEditing")}set textEditingTool(t){this.Qt("TextEditing",t,this.mouseUpTools)}get clickCreatingTool(){return this.findTool("ClickCreating")}set clickCreatingTool(t){this.Qt("ClickCreating",t,this.mouseUpTools)}get clickSelectingTool(){return this.findTool("ClickSelecting")}set clickSelectingTool(t){this.Qt("ClickSelecting",t,this.mouseUpTools)}}class tK extends tE{nP;oP;dn;rP;lP;hP;aP;bc;xm;cP;Hh;wr;XC;fP;yu;wu;uP;dP;gP;mP;constructor(t){super(),this.name="Dragging",this.nP=!0,this.mP=!0,this.oP=!0,this.dn=null,this.rP=null,this.lP=null,this.hP=null,this.aP=!1,this.yu=!1,this.bc=new ty(NaN,NaN),this.xm=new ty,this.cP=!0,this.Hh=100,this.wr=[],this.XC=new tu().u(),this.fP=new ec,this.wu=null,this.uP="copy",this.dP="",this.gP="no-drop",t&&Object.assign(this,t)}get isCopyEnabled(){return this.nP}set isCopyEnabled(t){te.s(t,"boolean",tK,"isCopyEnabled"),this.nP=t}get copiesEffectiveCollection(){return this.oP}set copiesEffectiveCollection(t){te.s(t,"boolean",tK,"copiesEffectiveCollection"),this.oP=t}get dragOptions(){return this.fP}set dragOptions(t){this.fP=t}get isGridSnapEnabled(){return this.dragOptions.isGridSnapEnabled}set isGridSnapEnabled(t){te.s(t,"boolean",tK,"isGridSnapEnabled"),this.dragOptions.isGridSnapEnabled=t}get isComplexRoutingRealtime(){return this.cP}set isComplexRoutingRealtime(t){this.cP=t;let e=this.diagram.findRouter("AvoidsLinks");null!==e&&(e.isRealtime=t)}get isGridSnapRealtime(){return this.dragOptions.isGridSnapRealtime}set isGridSnapRealtime(t){te.s(t,"boolean",tK,"isGridSnapRealtime"),this.dragOptions.isGridSnapRealtime=t}get gridSnapCellSize(){return this.dragOptions.gridSnapCellSize}set gridSnapCellSize(t){this.dragOptions.gridSnapCellSize.equals(t)||(t=t.N(),this.dragOptions.gridSnapCellSize=t)}get gridSnapCellSpot(){return this.dragOptions.gridSnapCellSpot}set gridSnapCellSpot(t){this.dragOptions.gridSnapCellSpot.equals(t)||(t=t.N(),this.dragOptions.gridSnapCellSpot=t)}get gridSnapOrigin(){return this.dragOptions.gridSnapOrigin}set gridSnapOrigin(t){this.dragOptions.gridSnapOrigin.equals(t)||(t=t.N(),this.dragOptions.gridSnapOrigin=t)}get dragsLink(){return this.dragOptions.dragsLink}set dragsLink(t){te.s(t,"boolean",tK,"dragsLink"),this.dragOptions.dragsLink=t}get dragsTree(){return this.dragOptions.dragsTree}set dragsTree(t){te.s(t,"boolean",tK,"dragsTree"),this.dragOptions.dragsTree=t}get copyCursor(){return this.uP}set copyCursor(t){this.uP=t}get moveCursor(){return this.dP}set moveCursor(t){this.dP=t}get nodropCursor(){return this.gP}set nodropCursor(t){this.gP=t}get currentPart(){return this.rP}set currentPart(t){this.rP=t}get copiedParts(){return this.hP}set copiedParts(t){this.hP=t}get draggedParts(){return this.lP}set draggedParts(t){this.lP=t}get draggingParts(){return null!==this.copiedParts?this.copiedParts.toKeySet():null!==this.draggedParts?this.draggedParts.toKeySet():this.XC}get draggedLink(){return this.diagram.draggedLink}set draggedLink(t){this.diagram.draggedLink=t}get isDragOutStarted(){return this.aP}set isDragOutStarted(t){this.aP=t}get startPoint(){return this.xm}set startPoint(t){this.xm.equals(t)||this.xm.a(t)}get delay(){return this.Hh}set delay(t){te.s(t,"number",tK,"delay"),this.Hh=t}canStart(){if(!this.isEnabled)return!1;let t=this.diagram;if(null===t||t.isReadOnly&&!t.allowDragOut||!t.allowMove&&!t.allowCopy&&!t.allowDragOut||!t.allowSelect)return!1;let e=t.lastInput;return!!e.left&&(t.currentTool===this||!!this.isBeyondDragSize()&&(!e.isTouchEvent||!(e.timestamp-t.firstInput.timestamp<this.Hh)))&&null!==this.findDraggablePart()}findDraggablePart(){let t=this.diagram,e=t.findPartAt(t.firstInput.documentPoint,!1);if(null===e)return null;for(;null!==e&&!e.canSelect();)e=e.containingGroup;return null!==e&&(e.canMove()||e.canCopy())?e:null}standardMouseSelect(){let t=this.diagram;if(!t.allowSelect)return;let e=t.findPartAt(t.firstInput.documentPoint,!1);if(null!==e){for(;null!==e&&!e.canSelect();)e=e.containingGroup;if(this.currentPart=e,null!==this.currentPart&&!this.currentPart.isSelected){t.v("ChangingSelection",t.selection);let e=t.lastInput;(te.hr?e.meta:e.control)||e.shift||t.clearSelection(!0),this.currentPart.isSelected=!0,t.v("ChangedSelection",t.selection)}}}doActivate(){let t=this.diagram;this.wu=null,null===this.currentPart&&this.standardMouseSelect();let e=this.currentPart;if(null===e||!e.canMove()&&!e.canCopy())return;t.cacheGroupExternalLinks(!0),tK.wt=null,this.isActive=!0,this.bc.set(t.position),this.pP(t.selection),this.wr.length=0,t.animationManager.stopAnimation();let i=this.computeEffectiveCollection(t.selection,this.dragOptions);this.draggedParts=i,this.mP=!!this.diagram.layout.isRealtime,this.diagram.layout.isRealtime=!1,t.kc=!0,!0===t.getRenderingHint("temporaryPixelRatio")&&t.avgSpf>30&&t.Ew(),t.YC(this.draggedParts),t.xu=!0,this.startTransaction("Drag"),this.startPoint=t.firstInput.documentPoint,t.isMouseCaptured=!0,t.allowDragOut&&this.aF()}pP(t){if(!this.dragsLink)return;let e=this.diagram,i=e.model.bm(),s=t.first();i&&1===t.count&&s instanceof ic&&this.mayDragLink(s)?(this.draggedLink=s,this.draggedLink.canRelinkFrom()&&this.draggedLink.canRelinkTo()&&this.draggedLink.clearAdornments(),this.dn=e.toolManager.findTool("Relinking"),null===this.dn&&(this.dn=new tY,this.dn.diagram=e),this.dn.originalLink=this.draggedLink):(this.draggedLink=null,this.dn=null)}mayDragLink(t){let e=this.diagram;return null!==e&&e.allowRelink}computeEffectiveCollection(t,e){return this.diagram.commandHandler.computeEffectiveCollection(t,e)}Xs(t){return new eu(void 0===t?ty.Lo:this.isGridSnapEnabled?new ty(Math.round(1e3*t.x)/1e3,Math.round(1e3*t.y)/1e3):t.copy())}doDeactivate(){this.isActive=!1;let t=this.diagram;this.diagram.layout.isRealtime=this.mP,t.xu=!1,t.Cl=!0,t.cacheGroupExternalLinks(!1),t.stopAutoScroll(),this.yP(),t.wP(this.draggedParts),this.wu=null,this.currentPart=null,this.draggedParts=null,this.isDragOutStarted=!1,this.yu=!1,tK.cF(),this.KC(),this.bc.i(NaN,NaN),null!==tK.jh&&(tK.jh.currentCursor=""),tK.jh=null,tK.wt=null,this.Ll(),t.isMouseCaptured=!1,t.currentCursor="",t.kc=!1,this.stopTransaction(),t.xP(!0)}stopTransaction(){let t=this.diagram,e=super.stopTransaction();return e&&null!==t.undoManager.transactionToUndo&&t.undoManager.transactionToUndo.optimize(),e}yP(){let t=this.diagram,e=t.skipsUndoManager;t.skipsUndoManager=!0;let i=t.lastInput;this.GC(i,null),t.skipsUndoManager=e,this.wr.length=0}HC(){this.Ll(),this.bP();let t=this.diagram;this.bc.isReal()&&(t.position=this.bc),t.stopAutoScroll()}doCancel(){this.Ll(),this.bP();let t=this.diagram;this.bc.isReal()&&(t.position=this.bc),this.stopTool()}doKeyDown(){let t=this.diagram;if(!this.isActive)return;let e=t.lastInput,i=t.previousInput;"Escape"===e.code?this.doCancel():(e.code!==i.code||e.modifiers!==i.modifiers)&&this.doMouseMove()}doKeyUp(){this.isActive&&this.doMouseMove()}fF(t,e){let i=1/0,s=1/0,n=-1/0,l=-1/0,r=t.iterator;for(;r.next();){let t=r.value;if(!t.isVisible())continue;let e=t.location,o=e.x,h=e.y;isNaN(o)||isNaN(h)||(o<i&&(i=o),h<s&&(s=h),o>n&&(n=o),h>l&&(l=h))}return i===1/0?e.i(0,0,0,0):e.i(i,s,n-i,l-s),e}kP(t){if(null!==this.copiedParts)return;let e=this.diagram;if(t&&(e.isReadOnly||e.isModelReadOnly)||null===this.draggedParts)return;let i=e.undoManager;i.isEnabled&&i.isInTransaction?null!==i.currentTransaction&&i.currentTransaction.changes.count>0&&(e.undoManager.rollbackTransaction(),e.startTransaction("Drag")):this.bP(),e.skipsUndoManager=!t,e.partManager.addsToTemporaryLayer=!t,this.startPoint=e.firstInput.documentPoint;let s=this.copiesEffectiveCollection?this.draggedParts.toKeySet():e.selection,n=e.copyParts(s,e,!0),l=new tp,r=this.draggedParts.iterator;for(;r.next();){let t=r.key;if(t.Me()&&t.canCopy()){let e=n.get(t);if(null===e)continue;e.location=t.location,e.ensureBounds(),l.set(e,this.Xs(e.location))}}let o=n.iterator;for(;o.next();){let t=o.value;t instanceof ic&&t.canCopy()&&l.set(t,this.Xs())}if(this.copiedParts=l,this.pP(l.toKeySet()),null!==this.draggedLink){let t=this.draggedLink,e=t.routeBounds;t.xr(this.startPoint.x-(e.x+e.width/2),this.startPoint.y-(e.y+e.height/2))}this.doUpdateCursor(null)}Ll(){let t=this.diagram;if(null!==this.copiedParts){if(t.removeParts(this.copiedParts.toKeySet(),!1),this.copiedParts=null,null!==this.draggedParts){let t=this.draggedParts.iterator;for(;t.next();)t.key instanceof ic&&(t.value.point=new ty(0,0))}this.doUpdateCursor(null)}t.skipsUndoManager=!1,t.partManager.addsToTemporaryLayer=!1,this.startPoint=t.firstInput.documentPoint}KC(){null!==this.draggedLink&&(this.dragsLink&&null!==this.dn&&(this.dn.stopDraggingMouseMove(),this.dn.originalLink=null),this.draggedLink=null,this.dn=null)}Pc(t,e){if(null===t)return;let i=this.diagram,s=this.startPoint,n=ty.l();n.a(i.lastInput.documentPoint),this.moveParts(t,n.subtract(s),e),ty.e(n),!0===i.getRenderingHint("temporaryPixelRatio")&&null===i.Al&&i.avgSpf>30&&(i.Ew(),i.bu())}moveParts(t,e,i){void 0===i&&(i=!1);let s=this.diagram;null!==s&&s.PP(t,e,this.dragOptions,i)}bP(){if(null===this.draggedParts)return;let t=this.diagram,e=this.draggedParts.iterator;for(;e.next();){let t=e.key;t.Me()&&(t.location=e.value.point)}for(e=this.draggedParts.iterator;e.next();){let t=e.key;if(t instanceof ic&&t.suspendsRouting){let i=e.value.point;this.draggedParts.set(t,this.Xs()),t.xr(-i.x,-i.y)}}t.maybeUpdate()}uF(t){if(null===t)return!0;let e=t.part;return!!(null===e||e instanceof il||e.layer?.isTemporary||this.draggedParts&&this.draggedParts.has(e)||this.copiedParts&&this.copiedParts.has(e))}SP(t){let e=this.diagram;this.dragsLink&&(null!==this.draggedLink&&(this.draggedLink.fromNode=null,this.draggedLink.toNode=null),this.jC(!1));let i=this.findDragOverObject(t),s=e.lastInput;s.targetObject=i,this.doUpdateCursor(i);let n=e.skipsUndoManager,l=!1;try{if(e.skipsUndoManager=!0,l=this.GC(s,i),!this.isActive&&null===tK.wt)return;let n=null!==i?i.part:null;if(null===n||e.handlesDragDropForTopLevelParts&&n.isTopLevel&&!(n instanceof ib)){let t=e.mouseDragOver;null!==t&&(t(s),l=!0)}if(!this.isActive&&null===tK.wt||(this.doDragOver(t,i),!this.isActive&&null===tK.wt))return}finally{e.skipsUndoManager=n,l&&e.maybeUpdate()}this.wu=i,!e.isReadOnly&&(e.allowMove||e.allowCopy)&&(e.allowHorizontalScroll||e.allowVerticalScroll)&&e.doAutoScroll(s.viewPoint)}findDragOverObject(t){return this.diagram.MP(t,null,t=>!this.uF(t))}doUpdateCursor(t){let e=this.diagram;(null===t||this.wu!==t)&&(!this.diagram.currentTool.isActive||this.mayCopy()?e.currentCursor=this.copyCursor:this.mayMove()?e.currentCursor=this.moveCursor:this.mayDragOut()&&(e.currentCursor=this.nodropCursor))}GC(t,e){let i=!1,s=this.wr.length,n=s>0?this.wr[0]:null;if(e===n)return!1;t.handled=!1;for(let n=0;n<s;n++){let s=this.wr[n],l=s.mouseDragLeave;if(null!==l&&(l(t,s,e),i=!0,t.handled))break}if(this.wr.length=0,!this.isActive&&null===tK.wt||null===e)return i;t.handled=!1;let l=e;for(;null!==l;)this.wr.push(l),l=this.qC(l);s=this.wr.length;for(let e=0;e<s;e++){let s=this.wr[e],l=s.mouseDragEnter;if(null!==l&&(l(t,s,n),i=!0,t.handled))break}return i}yE(t,e){return null!==t&&!!(t===e||t.isContainedBy(e)||e instanceof ib&&!(t instanceof ib)&&e.handlesDragDropForMembers&&t.part?.isMemberOf(e))}qC(t){let e=t.panel;if(null!==e)return e;if(t instanceof ii&&!(t instanceof ib)){let e=t.containingGroup;if(null!==e&&e.handlesDragDropForMembers)return e}return null}WC(t,e){let i=this.diagram,s=this.dn;if(null===s)return null;let n=s.portGravity,l=i.findObjectsNear(t,n,t=>s.findValidLinkablePort(t,e)),r=ty.l(),o=1/0,h=null;for(let e=l.iterator;e.next();){let i=e.value;if(null===i.part)continue;let s=i.getDocumentPoint(tv.Center,r),n=t.distanceSquaredPoint(s);n<o&&(h=i,o=n)}return ty.e(r),h}jC(t){let e=this.draggedLink;if(null!==e){if(e.pointsCount<2)return;let i=this.diagram;if(i.isReadOnly)return;let s=this.dn;if(null===s)return;let n=null,l=null;null===e.fromNode&&null!==(n=this.WC(e.getPoint(0),!1))&&(l=n.part);let r=null,o=null;null===e.toNode&&null!==(r=this.WC(e.getPoint(e.pointsCount-1),!0))&&(o=r.part),s.isValidLink(l,n,o,r)?t?(e.defaultFromPoint=e.getPoint(0),e.defaultToPoint=e.getPoint(e.pointsCount-1),e.suspendsRouting=!1,e.fromNode=l,null!==n&&(e.fromPortId=n.portId),e.toNode=o,null!==r&&(e.toPortId=r.portId),e.fromPort!==i.NP&&i.v("LinkRelinked",e,i.NP),e.toPort!==i.CP&&i.v("LinkRelinked",e,i.CP)):s.doDraggingMouseMove(l,n,o,r):s.doDraggingMouseMove(null,null,null,null)}}doDragOver(t,e){}JC(t){let e=this.diagram;this.dragsLink&&this.jC(!0),this.yP();let i=this.findDragOverObject(t),s=e.lastInput;if(s.targetObject=i,null!==i){s.handled=!1;let t=i;for(;null!==t;){let e=t.mouseDrop;if(null!==e&&(e(s,t),s.handled))break;this.dF(s,t),t=this.qC(t)}}else{let t=e.mouseDrop;null!==t&&t(s)}if(!this.isActive&&null===tK.wt)return;let n=this.copiedParts||this.draggedParts;if(null!==n){let t=n.iterator;for(;t.next();){let e=t.key;e instanceof io&&e.linksConnected.each(t=>t.suspendsRouting=!1)}}if(this.doDropOnto(t,i),!this.isActive&&null===tK.wt)return;let l=tw.l(),r=e.selection.iterator;for(;r.next();){let t=r.value;t instanceof io&&this.gF(e,t,l)}tw.e(l)}dF(t,e){let i=this.diagram,s=e.part;if(i.handlesDragDropForTopLevelParts&&null!==s&&s.isTopLevel&&!(s instanceof ib)){let e=i.mouseDrop;null!==e&&e(t)}}gF(t,e,i){if(!e.canAvoid())return;let s=!1;i=e.getAvoidableRect(i),t.viewportBounds.containsRect(i)&&(s=!0);let n=this.copiedParts||this.draggedParts;if(null===n)return;let l=t.LP(i,t=>t.part,t=>t instanceof ic,!0,t=>t instanceof ic,s);if(0===l.count)return;let r=l.iterator;for(;r.next();){let t=r.value;n.has(t)&&n.has(e)||!t.isMemberOf(e)&&t.isAvoiding&&t.invalidateRoute()}}doDropOnto(t,e){}doMouseMove(){if(!this.isActive)return;let t=this.diagram,e=t.lastInput;this.simulatedMouseMove(e.event,e.documentPoint,e.targetDiagram)||null===this.currentPart||null===this.draggedParts||(this.mayCopy()?(this.kP(!1),this.Pc(this.copiedParts,!1)):this.mayMove()?(this.Ll(),this.Pc(this.draggedParts,!0)):this.mayDragOut()?(this.kP(!1),this.Pc(this.copiedParts,!1)):this.Ll(),this.SP(t.lastInput.documentPoint))}doMouseUp(){if(!this.isActive)return;let t=this.diagram,e=t.lastInput;if(this.simulatedMouseUp(e.event,e.documentPoint,e.targetDiagram))return;let i=!1,s=this.mayCopy();if(s&&null!==this.copiedParts?(this.Ll(),this.kP(!0),this.Pc(this.copiedParts,!1),null!==this.copiedParts&&(t.v("ChangingSelection",t.selection),t.clearSelection(!0),this.copiedParts.iteratorKeys.each(t=>{t.isSelected=!0}))):(i=!0,this.Ll(),this.mayMove()&&(this.Pc(this.draggedParts,!0),this.SP(t.lastInput.documentPoint))),this.yu=!0,this.JC(t.lastInput.documentPoint),this.isActive){let e=s&&this.copiedParts,n=e?this.copiedParts.toKeySet():this.draggedParts?this.draggedParts.toKeySet():null;this.copiedParts=null,i&&this.mF(),t.invalidateDocumentBounds(),t.wP(this.draggedParts),this.transactionResult=e?"Copy":"Move",t.v(e?"SelectionCopied":"SelectionMoved",n)}this.stopTool(),s&&t.v("ChangedSelection",t.selection)}simulatedMouseMove(t,e,i){if(null===tK.wt)return!1;let s=tK.wt.diagram;i instanceof eh||(i=null);let n=tK.jh;if(i!==n){if(null!==n&&n!==s){n.stopAutoScroll(),tK.wt.isDragOutStarted=!1;let t=n.toolManager.findTool("Dragging");null!==t&&t.doSimulatedDragLeave()}if(tK.jh=i,null!==i&&i!==s){tK.wt.HC();let t=i.toolManager.findTool("Dragging");null!==t&&(t.$C(),t.doSimulatedDragEnter())}this.doUpdateCursor(null)}if(null===i||i===s||!i.allowDrop||i.isReadOnly||!i.allowInsert)return!1;let l=i.toolManager.findTool("Dragging");if(null!==l){let s=e;null!==t&&(void 0!==t.targetTouches&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),s=i.getMouse(t)),i.lastInput.documentPoint=s,i.lastInput.viewPoint=i.transformDocToView(s),i.lastInput.down=!1,i.lastInput.up=!1,l.doSimulatedDragOver()}return!0}simulatedMouseUp(t,e,i){if(null===tK.wt)return!1;let s=tK.jh,n=tK.wt.diagram;if(null===i)return tK.wt.doCancel(),!0;if(i!==s){if(null!==s){let t=s.toolManager.findTool("Dragging");if(null!==s&&s!==n&&null!==t)return s.stopAutoScroll(),tK.wt.isDragOutStarted=!1,t.doSimulatedDragLeave(),!1}tK.jh=i;let t=i.toolManager.findTool("Dragging");null!==t&&(tK.wt.HC(),t.$C(),t.doSimulatedDragEnter())}if(i!==this.diagram){let s=e;null!==t?(void 0!==t.targetTouches&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),s=i.getMouse(t)):null===s&&(s=new ty),i.lastInput.documentPoint=s,i.lastInput.viewPoint=i.transformDocToView(s),i.lastInput.down=!1,i.lastInput.up=!0;let n=i.toolManager.findTool("Dragging");null!==n&&n.doSimulatedDrop();let l=tK.wt;if(null!==l){let t=l.mayCopy();l.transactionResult=t?"Copy":"Move",l.stopTool()}return!0}return!1}mF(){if(null===this.draggedParts)return;let t=this.draggedParts.iterator;for(;t.next();){let e=t.key;if(e instanceof io){let t=e.containingGroup;null!==t&&t.hasPlaceholder()&&!this.draggedParts.has(t)&&t.placeholder.c()}}}mayCopy(){if(!this.isCopyEnabled)return!1;let t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowCopy||!(te.hr?t.lastInput.alt:t.lastInput.control))return!1;let e=t.selection.iterator;for(;e.next();)if(e.value.canCopy())return!0;return!!(null!==this.draggedLink&&this.dragsLink&&this.draggedLink.canCopy())}mayDragOut(){if(!this.isCopyEnabled)return!1;let t=this.diagram;if(!t.allowDragOut||!t.allowCopy||t.allowMove)return!1;let e=t.selection.iterator;for(;e.next();)if(e.value.canCopy())return!0;return!!(null!==this.draggedLink&&this.dragsLink&&this.draggedLink.canCopy())}mayMove(){let t=this.diagram;if(t.isReadOnly||!t.allowMove)return!1;let e=t.selection.iterator;for(;e.next();)if(e.value.canMove())return!0;return!!(null!==this.draggedLink&&this.dragsLink&&this.draggedLink.canMove())}$C(){tK.Bw.has(this)||tK.Bw.add(this)}static cF(){if(tK.Bw.count>0){let t=tK.Bw,e=t.length;for(let i=0;i<e;i++){let e=t.elt(i);e.KC(),e.Ll(),e.yP(),e.diagram.stopAutoScroll()}t.clear()}}computeBorder(t,e,i){return this.yu||null===this.draggedParts||this.draggedParts.has(t)?null:i.a(e)}getDraggingSource(){return tK.wt}mayDragIn(){let t=this.diagram;if(!t.allowDrop||t.isReadOnly||t.isModelReadOnly||!t.allowInsert)return!1;let e=tK.wt;return null!==e&&e.diagram.model.dataFormat===t.model.dataFormat}doSimulatedDragEnter(){if(!this.mayDragIn())return;let t=this.diagram;t.animationManager.stopAnimation(),t.br(),t.animationManager.stopAnimation();let e=tK.wt;null!==e&&(this.diagram.kc=!0,null===t.lastInput.event&&(t.lastInput.event=e.diagram.lastInput.event)),this.doUpdateCursor(null)}doSimulatedDragLeave(){let t=tK.wt;null!==t&&t.doSimulatedDragOut(),this.diagram.kc=!1,this.doCancel()}doSimulatedDragOver(){let t=this.diagram;t.animationManager.ku=!0;let e=tK.wt;if(null!==e&&null!==e.draggedParts){if(!this.mayDragIn())return;this.ZC(e.draggedParts.toKeySet(),!1,t.firstInput),this.Pc(this.copiedParts,!1),this.SP(t.lastInput.documentPoint)}t.animationManager.ku=!1}doSimulatedDrop(){let t=this.diagram,e=tK.wt;if(null!==e){let i=e.diagram;if(e.yu=!0,this.Ll(),null===e.draggedParts||!this.mayDragIn())return;t.animationManager.ku=!0,t.v("ChangingSelection",t.selection),this.startTransaction("Drop"),this.ZC(e.draggedParts.toKeySet(),!0,t.lastInput),this.Pc(this.copiedParts,!1);let s=new tu;null!==this.copiedParts&&(t.clearSelection(!0),this.copiedParts.iteratorKeys.each(t=>{t.isSelected=!0,s.add(t)})),this.JC(t.lastInput.documentPoint),t.invalidateDocumentBounds(),null!==this.copiedParts&&(this.transactionResult="ExternalCopy"),this.copiedParts=null,t.doFocus(),t.kc=!1,t.v("ExternalObjectsDropped",s,i),this.stopTransaction(),t.v("ChangedSelection",t.selection)}t.animationManager.ku=!1}ZC(t,e,i){if(null!==this.copiedParts)return;let s=this.diagram;if(s.isReadOnly||s.isModelReadOnly)return;s.skipsUndoManager=!e,s.partManager.addsToTemporaryLayer=!e,this.startPoint=i.documentPoint;let n=s.copyParts(t,s,!0),l=tw.l();this.fF(t,l);let r=l.x+l.width/2,o=l.y+l.height/2;tw.e(l);let h=this.xm,a=new tp,u=ty.l(),d=t.iterator;for(;d.next();){let t=d.value;if(t instanceof ic&&t.canCopy()){let e=n.get(t);if(null===e)continue;e.points=t.points,e.xr(h.x-r,h.y-o),e.suspendsRouting=!0,a.set(e,this.Xs())}}let c=t.iterator;for(;c.next();){let t=c.value;if(t.Me()&&t.canCopy()){let e=n.get(t);if(null===e)continue;let i=t.location;u.i(h.x-(r-i.x),h.y-(o-i.y)),e.location=u,e.ensureBounds(),a.set(e,this.Xs(u))}}if(ty.e(u),this.copiedParts=a,this.pP(a.toKeySet()),null!==this.draggedLink){let t=this.draggedLink,e=t.routeBounds;t.xr(this.startPoint.x-(e.x+e.width/2),this.startPoint.y-(e.y+e.height/2))}this.doUpdateCursor(null)}aF(){this.isDragOutStarted=!0,this.yu=!1,tK.wt=this,tK.jh=this.diagram,this.doSimulatedDragOut()}doSimulatedDragOut(){let t=this.diagram;t.kc=!1,this.mayCopy()||this.mayMove()?t.currentCursor="":t.currentCursor=this.nodropCursor,this.wu=null}computeMove(t,e,i,s){let n=this.diagram;return null!==n?n.computeMove(t,e,this.dragOptions,s):new ty}static Bw=new th;static wt=null;static jh=null}tz.prototype.doCancel=function(){null!==tK.wt&&tK.wt.doCancel(),tE.prototype.doCancel.call(this)};class tX extends tE{AP;TP;Tl;DP;FP;qh;RP;Wh;vP;OP;IP;EP;BP;UP;QC;VP;Dl;zP;constructor(){super(),this.AP=100,this.TP=!1,this.Tl="pointer",this.DP=new ic({layerName:"Tool"}).add(new e$({isPanelMain:!0,stroke:"blue"}).theme("stroke","tempLink"),new e$({toArrow:"Standard",fill:"blue",stroke:"blue"}).theme("fill","tempLink").theme("stroke","tempLink")).zt(),this.qh=new e$("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:tx.Dk}).theme("stroke","tempPort"),this.FP=new io({selectable:!1,layerName:"Tool"}).add(this.qh).zt(),this.Wh=new e$("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:tx.Dk}).theme("stroke","tempPort"),this.RP=new io({selectable:!1,layerName:"Tool"}).add(this.Wh).zt(),this.vP=null,this.OP=null,this.IP=null,this.EP=null,this.BP=null,this.UP=!0,this.QC=new tp,this.VP=null,this.Dl=null,this.zP=null}doStop(){this.diagram.stopAutoScroll(),this.originalLink=null,this.originalFromNode=null,this.originalFromPort=null,this.originalToNode=null,this.originalToPort=null,this.validPortsCache.clear(),this.targetPort=null}get portGravity(){return this.AP}set portGravity(t){te.s(t,"number",tX,"portGravity"),t>=0&&(this.AP=t)}get isUnconnectedLinkValid(){return this.TP}set isUnconnectedLinkValid(t){te.s(t,"boolean",tX,"isUnconnectedLinkValid"),this.TP=t}get linkingCursor(){return this.Tl}set linkingCursor(t){this.Tl=t}get temporaryLink(){return this.DP}set temporaryLink(t){t.zt(),this.DP=t}get temporaryFromNode(){return this.FP}set temporaryFromNode(t){t.zt(),this.FP=t,t&&(this.qh=t.port)}get temporaryFromPort(){return this.qh}set temporaryFromPort(t){if(null!==this.qh){let e=this.qh.panel;if(null!==e){let i=e.T.indexOf(this.qh);e.removeAt(i),e.insertAt(i,t)}}this.qh=t}get temporaryToNode(){return this.RP}set temporaryToNode(t){t.zt(),this.RP=t,t&&(this.Wh=t.port)}get temporaryToPort(){return this.Wh}set temporaryToPort(t){if(null!==this.Wh){let e=this.Wh.panel;if(null!==e){let i=e.T.indexOf(this.Wh);e.removeAt(i),e.insertAt(i,t)}}this.Wh=t}get originalLink(){return this.vP}set originalLink(t){this.vP=t}get originalFromNode(){return this.OP}set originalFromNode(t){this.OP=t}get originalFromPort(){return this.IP}set originalFromPort(t){this.IP=t}get originalToNode(){return this.EP}set originalToNode(t){this.EP=t}get originalToPort(){return this.BP}set originalToPort(t){this.BP=t}get isForwards(){return this.UP}set isForwards(t){this.UP=t}get validPortsCache(){return this.QC}get targetPort(){return this.VP}set targetPort(t){this.VP=t}copyPortProperties(t,e,i,s,n){if(null===t||null===e||null===i||null===s)return;let l=e.getDocumentScale(),r=tx.l();r.width=e.naturalBounds.width*l,r.height=e.naturalBounds.height*l,s.desiredSize=r,tx.e(r),n?(s.toSpot=e.toSpot,s.toEndSegmentLength=e.toEndSegmentLength):(s.fromSpot=e.fromSpot,s.fromEndSegmentLength=e.fromEndSegmentLength),i.locationSpot=tv.Center;let o=ty.l();i.location=e.getDocumentPoint(tv.Center,o),ty.e(o),s.angle=e.getDocumentAngle(),null!==this.portTargeted&&this.portTargeted(t,e,i,s,n)}setNoTargetPortProperties(t,e,i){null!==e&&(e.desiredSize=tx.Dk,e.fromSpot=tv.None,e.toSpot=tv.None),null!==t&&(t.location=this.diagram.lastInput.documentPoint),null!==this.portTargeted&&this.portTargeted(null,null,t,e,i)}doMouseDown(){this.isActive&&this.doMouseMove()}doMouseMove(){if(this.isActive){let t=this.diagram;if(this.targetPort=this.findTargetPort(this.isForwards),null!==this.targetPort&&this.targetPort.part instanceof io){let t=this.targetPort.part;this.isForwards?this.copyPortProperties(t,this.targetPort,this.temporaryToNode,this.temporaryToPort,!0):this.copyPortProperties(t,this.targetPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else this.isForwards?this.setNoTargetPortProperties(this.temporaryToNode,this.temporaryToPort,!0):this.setNoTargetPortProperties(this.temporaryFromNode,this.temporaryFromPort,!1);(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}findValidLinkablePort(t,e){if(null===t)return null;let i=t.part;if(!(i instanceof io))return null;for(;null!==t;){let s=e?t.toLinkable:t.fromLinkable;if(!0===s&&(null!==t.portId||t instanceof io)&&(e?this.isValidTo(i,t):this.isValidFrom(i,t)))return t;if(!1===s)break;t=t.panel}return null}findTargetPort(t){let e=this.diagram,i=e.lastInput.documentPoint,s=this.portGravity,n=e.findObjectsNear(i,s,e=>this.findValidLinkablePort(e,t),null,!0),l=1/0,r=null,o=n.iterator;for(;o.next();){let e=o.value,s=e.part;if(!(s instanceof io))continue;let n=e.getDocumentPoint(tv.Center,ty.l()),h=i.x-n.x,a=i.y-n.y;ty.e(n);let u=h*h+a*a;if(u<l){let i=this.validPortsCache.get(e);null!==i?i&&(r=e,l=u):t&&this.isValidLink(this.originalFromNode,this.originalFromPort,s,e)||!t&&this.isValidLink(s,e,this.originalToNode,this.originalToPort)?(this.validPortsCache.set(e,!0),r=e,l=u):this.validPortsCache.set(e,!1)}}if(null!==r){let t=r.part;if(t instanceof io&&(null===t.layer||t.layer.allowLink))return r}return null}isValidFrom(t,e){if(null===t||null===e)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(null!==t.layer&&!t.layer.allowLink||!0!==e.fromLinkable))return!1;let i=e.fromMaxLinks;if(i<1/0){if(null!==this.originalLink&&t===this.originalFromNode&&e===this.originalFromPort)return!0;let s=e.portId;if(null===s&&(s=""),t.findLinksOutOf(s).count>=i)return!1}return!0}isValidTo(t,e){if(null===t||null===e)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(null!==t.layer&&!t.layer.allowLink||!0!==e.toLinkable))return!1;let i=e.toMaxLinks;if(i<1/0){if(null!==this.originalLink&&t===this.originalToNode&&e===this.originalToPort)return!0;let s=e.portId;if(null===s&&(s=""),t.findLinksInto(s).count>=i)return!1}return!0}isInSameNode(t,e){if(null===t||null===e)return!1;if(t===e)return!0;let i=t.part,s=e.part;return null!==i&&i===s}isLinked(t,e){if(null===t||null===e)return!1;let i=t.part;if(!(i instanceof io))return!1;let s=t.portId;null===s&&(s="");let n=e.part;if(!(n instanceof io))return!1;let l=e.portId;null===l&&(l="");let r=n.findLinksInto(l);for(;r.next();){let t=r.value;if(t.fromNode===i&&t.fromPortId===s)return!0}return!1}isValidLink(t,e,i,s){let n;return!(!this.isValidFrom(t,e)||!this.isValidTo(i,s)||null!==e&&null!==s&&(!(e.fromLinkableSelfNode&&s.toLinkableSelfNode)&&this.isInSameNode(e,s)||!(e.fromLinkableDuplicates&&s.toLinkableDuplicates)&&this.isLinked(e,s))||null!==this.originalLink&&(null!==t&&this.isLabelDependentOnLink(t,this.originalLink)||null!==i&&this.isLabelDependentOnLink(i,this.originalLink)))&&(null===t||null===i||(null!==t.data||null===i.data)&&(null===t.data||null!==i.data))&&!!this.isValidCycle(t,i,this.originalLink)&&!!((null===t||null===e||null===(n=t.linkValidation)||n(t,e,i,s,this.originalLink))&&(null===i||null===s||null===(n=i.linkValidation)||n(t,e,i,s,this.originalLink)))&&(null===(n=this.linkValidation)||n(t,e,i,s,this.originalLink))}isLabelDependentOnLink(t,e){if(null===t)return!1;let i=t.labeledLink;if(null===i)return!1;if(i===e)return!0;let s=new tu;return s.add(t),this.XP(i,e,s)}XP(t,e,i){if(t===e)return!0;let s=t.fromNode;if(null!==s&&s.labeledLink&&(i.add(s),this.XP(s.labeledLink,e,i)))return!0;let n=t.toNode;return!!(null!==n&&n.labeledLink&&(i.add(n),this.XP(n.labeledLink,e,i)))}isValidCycle(t,e,i){if(void 0===i&&(i=null),null===t||null===e)return this.isUnconnectedLinkValid;let s=this.diagram,n=1;if(s&&(n=s.model.km()?s.isTreePathToChildren?5:6:s.validCycle),1===n)return!0;if(5===n){let s=i||this.temporaryLink;if(null!==s&&!s.isTreeLink)return!0;let n=e.linksConnected;for(;n.next();){let t=n.value;if(t!==i&&t.isTreeLink&&t.toNode===e)return!1}return!this.Pu(t,e,i,!0)}if(6===n){let s=i||this.temporaryLink;if(null!==s&&!s.isTreeLink)return!0;let n=t.linksConnected;for(;n.next();){let e=n.value;if(e!==i&&e.isTreeLink&&e.fromNode===t)return!1}return!this.Pu(t,e,i,!0)}return 2===n?!this.pF(t,e,i):3===n?!this.Pu(t,e,i,!1):4!==n||!this.yF(t,e,i)}Pu(t,e,i,s){if(t===e)return!0;if(null===t||null===e)return!1;let n=t.linksConnected;for(;n.next();){let l=n.value;if(l===i||s&&!l.isTreeLink||l.toNode!==t)continue;let r=l.fromNode;if(r!==t&&null!==r&&this.Pu(r,e,i,s))return!0}return!1}pF(t,e,i){if(t===e)return!0;let s=new tu;return s.add(e),this._C(s,t,e,i)}_C(t,e,i,s){if(e===i)return!0;if(null===e||null===i||t.has(e))return!1;t.add(e);let n=e.linksConnected;for(;n.next();){let l=n.value;if(l===s||l.toNode!==e)continue;let r=l.fromNode;if(r!==e&&null!==r&&this._C(t,r,i,s))return!0}return!1}yF(t,e,i){if(t===e)return!0;let s=new tu;return s.add(e),this.tL(s,t,e,i)}tL(t,e,i,s){if(e===i)return!0;if(null===e||null===i||t.has(e))return!1;t.add(e);let n=e.linksConnected;for(;n.next();){let l=n.value;if(l===s)continue;let r=l.fromNode,o=l.toNode,h=r===e?o:r;if(h!==e&&null!==h&&this.tL(t,h,i,s))return!0}return!1}get linkValidation(){return this.Dl}set linkValidation(t){null!==t&&te.S(t,tX,"linkValidation"),this.Dl=t}get portTargeted(){return this.zP}set portTargeted(t){null!==t&&te.S(t,tX,"portTargeted"),this.zP=t}}var tj=((r=tj||{})[r.Either=1]="Either",r[r.ForwardsOnly=2]="ForwardsOnly",r[r.BackwardsOnly=3]="BackwardsOnly",r);class tG extends tX{YP;KP;P;GP;constructor(t){super(),this.name="Linking",this.YP={},this.KP=null,this.P=1,this.GP=null,t&&Object.assign(this,t)}static Either=1;static ForwardsOnly=2;static BackwardsOnly=3;get archetypeLinkData(){return this.YP}set archetypeLinkData(t){null!==t&&te.lc(t,tG,"archetypeLinkData"),this.YP=t}get archetypeLabelNodeData(){return this.KP}set archetypeLabelNodeData(t){null!==t&&te.lc(t,tG,"archetypeLabelNodeData"),this.KP=t}get direction(){return this.P}set direction(t){this.P=t}get startObject(){return this.GP}set startObject(t){this.GP=t}canStart(){if(!this.isEnabled)return!1;let t=this.diagram;return!!(!t.isReadOnly&&!t.isModelReadOnly&&t.allowLink&&t.model.Uw()&&t.lastInput.left&&(t.currentTool===this||this.isBeyondDragSize()))&&null!==this.findLinkablePort()}findLinkablePort(){let t=this.diagram,e=this.startObject;if(null===e&&(e=t.findObjectAt(t.firstInput.documentPoint,null,null)),null===e)return null;let i=e.part;if(!(i instanceof io))return null;let s=this.direction;if(1===s||2===s){let t=this.findValidLinkablePort(e,!1);if(null!==t)return this.isForwards=!0,t;if(this.startObject===i){let t=i.port;if(this.findValidLinkablePort(t,!1))return this.isForwards=!0,t}}if(1===s||3===s){let t=this.findValidLinkablePort(e,!0);if(null!==t)return this.isForwards=!1,t;if(this.startObject===i){let t=i.port;if(this.findValidLinkablePort(t,!0))return this.isForwards=!1,t}}return null}doActivate(){let t=this.diagram,e=this.findLinkablePort();if(null===e){this.stopTool();return}if(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.isForwards){null!==this.temporaryToNode&&(this.temporaryToNode.location=t.lastInput.documentPoint),this.originalFromPort=e;let i=this.originalFromPort.part;i instanceof io&&(this.originalFromNode=i),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else{null!==this.temporaryFromNode&&(this.temporaryFromNode.location=t.lastInput.documentPoint),this.originalToPort=e;let i=this.originalToPort.part;i instanceof io&&(this.originalToNode=i),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0)}t.add(this.temporaryFromNode),this.temporaryFromNode&&this.temporaryFromNode.ensureBounds(),t.add(this.temporaryToNode),this.temporaryToNode&&this.temporaryToNode.ensureBounds(),null!==this.temporaryLink&&(null!==this.temporaryFromNode&&(this.temporaryLink.fromNode=this.temporaryFromNode),null!==this.temporaryToNode&&(this.temporaryLink.toNode=this.temporaryToNode),this.temporaryLink.isTreeLink=this.isNewTreeLink(),this.temporaryLink.invalidateRoute(),t.add(this.temporaryLink)),this.isActive=!0}doDeactivate(){this.isActive=!1;let t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.startObject=null}doMouseUp(){if(this.isActive){let t=this.diagram;this.transactionResult=null;let e=null,i=null,s=null,n=null,l=null;try{this.targetPort=this.findTargetPort(this.isForwards);let r=this.targetPort;if(null!==r){let t=r.part;t instanceof io&&(this.isForwards?(null!==this.originalFromNode&&(e=this.originalFromNode,i=this.originalFromPort),s=t,n=r):(e=t,i=r,null!==this.originalToNode&&(s=this.originalToNode,n=this.originalToPort)))}else this.isForwards?null!==this.originalFromNode&&this.isUnconnectedLinkValid&&(e=this.originalFromNode,i=this.originalFromPort):null!==this.originalToNode&&this.isUnconnectedLinkValid&&(s=this.originalToNode,n=this.originalToPort);null!==e||null!==s?(l=this.insertLink(e,i,s,n),null!==l?(null===r&&(this.isForwards?l.defaultToPoint=t.lastInput.documentPoint:l.defaultFromPoint=t.lastInput.documentPoint),t.allowSelect&&(t.v("ChangingSelection",t.selection),t.clearSelection(!0),l.isSelected=!0),this.transactionResult=this.name,t.v("LinkDrawn",l)):this.doNoLink(e,i,s,n)):this.isForwards?this.doNoLink(this.originalFromNode,this.originalFromPort,null,null):this.doNoLink(null,null,this.originalToNode,this.originalToPort)}finally{this.stopTool(),l&&t.allowSelect&&t.v("ChangedSelection",t.selection)}}}isNewTreeLink(){let t=this.archetypeLinkData;if(null===t)return!0;if(t instanceof ic)return t.isTreeLink;let e=this.diagram;if(null===e)return!0;let i=e.partManager.getLinkCategoryForData(t),s=e.partManager.findLinkTemplateForCategory(i);return null===s||s.isTreeLink}insertLink(t,e,i,s){return this.diagram.partManager.insertLink(t,e,i,s)}doNoLink(t,e,i,s){}}class tY extends tX{iL;eL;HP;jP;gs;qP;constructor(t){super(),this.name="Relinking",this.fromHandleArchetype=new e$("Diamond",{desiredSize:tx.cu,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:0}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.toHandleArchetype=new e$("Diamond",{desiredSize:tx.cu,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:-1}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.gs=null,this.qP=new tw,t&&Object.assign(this,t)}updateAdornments(t){if(null===t||!(t instanceof ic))return;let e="RelinkFrom",i=null;if(t.isSelected&&!this.diagram.isReadOnly){let s=t.selectionObject;null!==s&&t.canRelinkFrom()&&t.actualBounds.isReal()&&t.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&null===(i=t.findAdornment(e))&&(i=this.makeAdornment(s,!1),t.addAdornment(e,i))}if(null===i&&t.removeAdornment(e),e="RelinkTo",i=null,t.isSelected&&!this.diagram.isReadOnly){let s=t.selectionObject;null!==s&&t.canRelinkTo()&&t.actualBounds.isReal()&&t.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(null===(i=t.findAdornment(e))?(i=this.makeAdornment(s,!0),t.addAdornment(e,i)):i.c())}null===i&&t.removeAdornment(e)}makeAdornment(t,e){let i=e?this.jP:this.HP;return i&&((i=i.copy()).adornedObject=t),i}get fromHandleArchetype(){return this.iL}set fromHandleArchetype(t){this.iL=t,null!==t?this.HP=new il(eq.Link).add(t).zt():this.HP=null}get toHandleArchetype(){return this.eL}set toHandleArchetype(t){this.eL=t,null!==t?this.jP=new il(eq.Link).add(t).zt():this.jP=null}get handle(){return this.gs}set handle(t){null!==t&&(t.part instanceof il||te.o("new handle is not in an Adornment: "+t)),this.gs=t}canStart(){if(!this.isEnabled)return!1;let t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowRelink||!t.model.Uw()||!t.lastInput.left)return!1;let e=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom");return null===e&&(e=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo")),null!==e}doActivate(){let t=this.diagram;if(null===this.originalLink){let e=this.handle;if(null===e&&null===(e=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom"))&&(e=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo")),null===e)return;let i=e.part;if(!(i instanceof il)||!(i.adornedPart instanceof ic))return;this.handle=e,this.isForwards=null===i||"RelinkTo"===i.category,this.originalLink=i.adornedPart}let e=this.originalLink;null!==e&&(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.originalFromPort=e.fromPort,this.originalFromNode=e.fromNode,this.originalToPort=e.toPort,this.originalToNode=e.toNode,this.qP.set(e.actualBounds),e.pointsCount>0&&(null===e.fromNode&&(null!==this.temporaryFromPort&&(this.temporaryFromPort.desiredSize=tx.hc),null!==this.temporaryFromNode&&(this.temporaryFromNode.location=e.getPoint(0))),null===e.toNode&&(null!==this.temporaryToPort&&(this.temporaryToPort.desiredSize=tx.hc),null!==this.temporaryToNode&&(this.temporaryToNode.location=e.getPoint(e.pointsCount-1)))),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0),t.add(this.temporaryFromNode),t.add(this.temporaryToNode),null!==this.temporaryLink&&(null!==this.temporaryFromNode&&(this.temporaryLink.fromNode=this.temporaryFromNode),null!==this.temporaryToNode&&(this.temporaryLink.toNode=this.temporaryToNode),this.copyLinkProperties(e,this.temporaryLink),this.temporaryLink.invalidateRoute(),t.add(this.temporaryLink)),this.isActive=!0)}copyLinkProperties(t,e){if(null===t||null===e)return;e.adjusting=t.adjusting,e.corner=t.corner;let i=t.curve;(11===i||10===i)&&(i=0),e.curve=i,e.curviness=t.curviness,e.isTreeLink=t.isTreeLink,e.points=t.points,e.routing=t.routing,e.smoothness=t.smoothness,e.fromSpot=t.fromSpot,e.fromEndSegmentLength=t.fromEndSegmentLength,e.fromShortLength=t.fromShortLength,e.toSpot=t.toSpot,e.toEndSegmentLength=t.toEndSegmentLength,e.toShortLength=t.toShortLength}doDeactivate(){this.isActive=!1;let t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.handle=null}doMouseUp(){if(this.isActive){let t=this.diagram;this.transactionResult=null;let e=this.originalFromNode,i=this.originalFromPort,s=this.originalToNode,n=this.originalToPort,l=this.originalLink;try{if(this.targetPort=this.findTargetPort(this.isForwards),null!==this.targetPort){let t=this.targetPort.part;t instanceof io&&(this.isForwards?(s=t,n=this.targetPort):(e=t,i=this.targetPort))}else this.isUnconnectedLinkValid?this.isForwards?(s=null,n=null):(e=null,i=null):l=null;null!==l?(this.reconnectLink(l,this.isForwards?s:e,this.isForwards?n:i,this.isForwards),null===this.targetPort&&(this.isForwards?l.defaultToPoint=t.lastInput.documentPoint:l.defaultFromPoint=t.lastInput.documentPoint,l.invalidateRoute()),this.transactionResult=this.name,t.v("LinkRelinked",l,this.isForwards?this.originalToPort:this.originalFromPort)):null!==this.originalLink&&this.doNoRelink(this.originalLink,this.isForwards),null!==this.originalLink&&this.originalLink.invalidateOtherJumpOvers(this.qP)}finally{this.stopTool()}}}reconnectLink(t,e,i,s){let n=null!==i&&null!==i.portId?i.portId:"";return s?(t.toNode=e,t.toPortId=n):(t.fromNode=e,t.fromPortId=n),!0}doNoRelink(t,e){}doDraggingMouseMove(t,e,i,s){null!==t?(this.copyPortProperties(t,e,this.temporaryFromNode,this.temporaryFromPort,!1),this.diagram.add(this.temporaryFromNode)):this.diagram.remove(this.temporaryFromNode),null!==i?(this.copyPortProperties(i,s,this.temporaryToNode,this.temporaryToPort,!0),this.diagram.add(this.temporaryToNode)):this.diagram.remove(this.temporaryToNode)}stopDraggingMouseMove(){this.diagram.remove(this.temporaryFromNode),this.diagram.remove(this.temporaryToNode)}}var tU=((o=tU||{})[o.None=0]="None",o[o.Horizontal=1]="Horizontal",o[o.Vertical=2]="Vertical",o[o.All=3]="All",o);class tq extends tE{kr;WP;JP;gs;Vw;$P;Pm;constructor(t){super(),this.name="LinkReshaping",this.kr=new e$("Rectangle",{desiredSize:tx.fC,fill:"lightblue",stroke:"dodgerblue"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.WP=new e$("Diamond",{desiredSize:tx.cu,fill:"lightblue",stroke:"dodgerblue",cursor:"move"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.JP=3,this.gs=null,this.Vw=null,this.$P=new ty,this.Pm=new th,t&&Object.assign(this,t)}static None=0;static Horizontal=1;static Vertical=2;static All=3;getReshapingBehavior(t){return t?t.Pr:0}setReshapingBehavior(t,e){t.Pr=e}updateAdornments(t){if(null===t||!(t instanceof ic))return;let e=null;if(t.isSelected&&!this.diagram.isReadOnly){let i=t.path;null!==i&&t.canReshape()&&t.actualBounds.isReal()&&t.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()&&(null===(e=t.findAdornment(this.name))||e.ZP!==t.pointsCount||e.QP!==t.resegmentable)&&null!==(e=this.makeAdornment(i))&&(e.ZP=t.pointsCount,e.QP=t.resegmentable,t.addAdornment(this.name,e))}null===e&&t.removeAdornment(this.name)}makeAdornment(t){let e=t.part,i=e.points,s=e.pointsCount,n=e.isOrthogonal,l=null;if(null!==i&&s>1){(l=new il).type=eq.Link;let i=e.firstPickIndex,s=e.lastPickIndex,r=+!!n;if(e.resegmentable&&9!==e.computeCurve())for(let e=i+r;e<s-r;e++){let i=this.makeResegmentHandle(t,e);null!==i&&(i.segmentIndex=e,i.segmentFraction=.5,i.fromMaxLinks=999,l.add(i))}for(let r=i+1;r<s;r++){let o=this.makeHandle(t,r);if(null!==o){if(o.segmentIndex=r,r!==i){if(r===i+1&&n){let t=e.getPoint(i),s=e.getPoint(i+1);tP.f(t.x,s.x)&&tP.f(t.y,s.y)&&(s=e.getPoint(i-1)),tP.f(t.x,s.x)?(this.setReshapingBehavior(o,2),o.cursor="n-resize"):tP.f(t.y,s.y)&&(this.setReshapingBehavior(o,1),o.cursor="w-resize")}else if(r===s-1&&n){let t=e.getPoint(s-1),i=e.getPoint(s);tP.f(t.x,i.x)&&tP.f(t.y,i.y)&&(t=e.getPoint(s+1)),tP.f(t.x,i.x)?(this.setReshapingBehavior(o,2),o.cursor="n-resize"):tP.f(t.y,i.y)&&(this.setReshapingBehavior(o,1),o.cursor="w-resize")}else r===s||(this.setReshapingBehavior(o,3),o.cursor="move")}l.add(o)}}l.adornedObject=t}return l}makeHandle(t,e){let i=this.handleArchetype;return null===i?null:i.copy()._P()}get handleArchetype(){return this.kr}set handleArchetype(t){this.kr=t}makeResegmentHandle(t,e){let i=this.midHandleArchetype;return null===i?null:i.copy()._P()}get midHandleArchetype(){return this.WP}set midHandleArchetype(t){this.WP=t}get handle(){return this.gs}set handle(t){null!==t&&(t.part instanceof il||te.o("new handle is not in an Adornment: "+t)),this.gs=t}get adornedLink(){return this.Vw}canStart(){if(!this.isEnabled)return!1;let t=this.diagram;return!t.isReadOnly&&!!t.allowReshape&&!!t.lastInput.left&&null!==this.findToolHandleAt(t.firstInput.documentPoint,this.name)}doActivate(){let t=this.diagram;if(null===this.handle&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),null===this.handle)return;let e=this.handle.part.adornedPart;if(e instanceof ic){if(this.Vw=e,t.isMouseCaptured=!0,this.startTransaction(this.name),e.resegmentable&&999===this.handle.fromMaxLinks){let i=e.points.copy(),s=this.getResegmentingPoint();if(i.insertAt(this.handle.segmentIndex+1,s),e.isOrthogonal&&i.insertAt(this.handle.segmentIndex+1,s),e.points=i,e.invalidateAdornments(),e.updateAdornments(),this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name),null===this.handle){this.doDeactivate();return}}this.$P=e.getPoint(this.handle.segmentIndex),this.Pm=e.points.copy(),this.isActive=!0}}doDeactivate(){this.stopTransaction(),this.handle=null,this.Vw=null,this.diagram.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){let t=this.diagram,e=super.stopTransaction();return e&&null!==t.undoManager.transactionToUndo&&t.undoManager.transactionToUndo.optimize(),e}doCancel(){let t=this.adornedLink;null!==t&&(t.points=this.Pm),this.stopTool()}getResegmentingPoint(){return this.handle.getDocumentPoint(tv.Center)}doMouseMove(){let t=this.diagram;if(this.isActive){let e=this.computeReshape(t.lastInput.documentPoint);this.reshape(e)}}doMouseUp(){let t=this.diagram;if(this.isActive){let e=this.computeReshape(t.lastInput.documentPoint);this.reshape(e);let i=this.adornedLink;if(null!==i&&i.resegmentable&&null!==this.handle){let t=this.handle.segmentIndex,e=i.getPoint(t-1),s=i.getPoint(t),n=i.getPoint(t+1);if(i.isOrthogonal){if(t>i.firstPickIndex+1&&t<i.lastPickIndex-1){let l=i.getPoint(t-2);if(this.isWithinResegmentingDistance(e,s)&&(this.isInLineOrtho(l,e,s,n,!0)||this.isInLineOrtho(l,e,s,n,!1))){let r=i.points.copy();this.isInLineOrtho(l,e,s,n,!0)?(r.setElt(t-2,new ty(l.x,(n.y+l.y)/2)),r.setElt(t+1,new ty(n.x,(n.y+l.y)/2))):(r.setElt(t-2,new ty((n.x+l.x)/2,l.y)),r.setElt(t+1,new ty((n.x+l.x)/2,n.y))),r.removeAt(t),r.removeAt(t-1),i.points=r,i.invalidateAdornments()}else if(l=i.getPoint(t+2),this.isWithinResegmentingDistance(s,n)&&(this.isInLineOrtho(e,s,n,l,!0)||this.isInLineOrtho(e,s,n,l,!1))){let r=i.points.copy();this.isInLineOrtho(e,s,n,l,!0)?(r.setElt(t-1,new ty(e.x,(e.y+l.y)/2)),r.setElt(t+2,new ty(l.x,(e.y+l.y)/2))):(r.setElt(t-1,new ty((e.x+l.x)/2,e.y)),r.setElt(t+2,new ty((e.x+l.x)/2,l.y))),r.removeAt(t+1),r.removeAt(t),i.points=r,i.invalidateAdornments()}}}else{let l=ty.l();if(tP.bl(e.x,e.y,n.x,n.y,s.x,s.y,l)&&l.distanceSquaredPoint(s)<this.resegmentingDistance*this.resegmentingDistance){let e=i.points.copy();e.removeAt(t),i.points=e,i.invalidateAdornments()}ty.e(l)}}t.invalidateDocumentBounds(),this.transactionResult=this.name,t.v("LinkReshaped",this.adornedLink,this.Pm)}this.stopTool()}isWithinResegmentingDistance(t,e){return Math.abs(t.x-e.x)<this.resegmentingDistance&&Math.abs(t.y-e.y)<this.resegmentingDistance}isInLineOrtho(t,e,i,s,n){return n?Math.abs(t.y-e.y)<this.resegmentingDistance&&Math.abs(e.y-i.y)<this.resegmentingDistance&&Math.abs(i.y-s.y)<this.resegmentingDistance:Math.abs(t.x-e.x)<this.resegmentingDistance&&Math.abs(e.x-i.x)<this.resegmentingDistance&&Math.abs(i.x-s.x)<this.resegmentingDistance}get resegmentingDistance(){return this.JP}set resegmentingDistance(t){te.s(t,"number",tq,"resegmentingDistance"),this.JP=t}reshape(t){let e=this.adornedLink;if(null===e)return;let i=this.handle;if(null===i)return;e.startRoute();let s=i.segmentIndex,n=this.getReshapingBehavior(i);if(e.isOrthogonal){if(s===e.firstPickIndex+1){let i=e.firstPickIndex+1;2===n?(e.setPointAt(i,e.getPoint(i-1).x,t.y),e.setPointAt(i+1,e.getPoint(i+2).x,t.y)):1===n&&(e.setPointAt(i,t.x,e.getPoint(i-1).y),e.setPointAt(i+1,t.x,e.getPoint(i+2).y))}else if(s===e.lastPickIndex-1){let i=e.lastPickIndex-1;2===n?(e.setPointAt(i-1,e.getPoint(i-2).x,t.y),e.setPointAt(i,e.getPoint(i+1).x,t.y)):1===n&&(e.setPointAt(i-1,t.x,e.getPoint(i-2).y),e.setPointAt(i,t.x,e.getPoint(i+1).y))}else{let i=s,n=e.getPoint(i),l=e.getPoint(i-1),r=e.getPoint(i+1);tP.f(l.x,n.x)&&tP.f(n.y,r.y)?(tP.f(l.x,e.getPoint(i-2).x)&&!tP.f(l.y,e.getPoint(i-2).y)?(e.insertPointAt(i,t.x,l.y),s++,i++):e.setPointAt(i-1,t.x,l.y),tP.f(r.y,e.getPoint(i+2).y)&&!tP.f(r.x,e.getPoint(i+2).x)?e.insertPointAt(i+1,r.x,t.y):e.setPointAt(i+1,r.x,t.y)):tP.f(l.y,n.y)&&tP.f(n.x,r.x)?(tP.f(l.y,e.getPoint(i-2).y)&&!tP.f(l.x,e.getPoint(i-2).x)?(e.insertPointAt(i,l.x,t.y),s++,i++):e.setPointAt(i-1,l.x,t.y),tP.f(r.x,e.getPoint(i+2).x)&&!tP.f(r.y,e.getPoint(i+2).y)?e.insertPointAt(i+1,t.x,r.y):e.setPointAt(i+1,t.x,r.y)):tP.f(l.x,n.x)&&tP.f(n.x,r.x)?(tP.f(l.x,e.getPoint(i-2).x)&&!tP.f(l.y,e.getPoint(i-2).y)?(e.insertPointAt(i,t.x,l.y),s++,i++):e.setPointAt(i-1,t.x,l.y),tP.f(r.x,e.getPoint(i+2).x)&&!tP.f(r.y,e.getPoint(i+2).y)?e.insertPointAt(i+1,t.x,r.y):e.setPointAt(i+1,t.x,r.y)):tP.f(l.y,n.y)&&tP.f(n.y,r.y)&&(tP.f(l.y,e.getPoint(i-2).y)&&!tP.f(l.x,e.getPoint(i-2).x)?(e.insertPointAt(i,l.x,t.y),s++,i++):e.setPointAt(i-1,l.x,t.y),tP.f(r.y,e.getPoint(i+2).y)&&!tP.f(r.x,e.getPoint(i+2).x)?e.insertPointAt(i+1,r.x,t.y):e.setPointAt(i+1,r.x,t.y)),e.setPointAt(s,t.x,t.y)}}else{e.setPointAt(s,t.x,t.y);let i=e.fromNode,n=e.fromPort;if(null!==i){let t=i.findVisibleNode();null!==t&&t!==i&&(n=(i=t).port)}if(1===s&&null!==n&&e.computeSpot(!0,n).isNoSpot()){let s=n.getDocumentPoint(tv.Center,ty.l()),l=e.getLinkPointFromPoint(i,n,s,t,!0,ty.l());e.setPointAt(0,l.x,l.y),ty.e(s),ty.e(l)}let l=e.toNode,r=e.toPort;if(null!==l){let t=l.findVisibleNode();null!==t&&t!==l&&(r=(l=t).port)}if(s===e.pointsCount-2&&null!==r&&e.computeSpot(!1,r).isNoSpot()){let i=r.getDocumentPoint(tv.Center,ty.l()),s=e.getLinkPointFromPoint(l,r,i,t,!1,ty.l());e.setPointAt(e.pointsCount-1,s.x,s.y),ty.e(i),ty.e(s)}}e.commitRoute()}computeReshape(t){let e=this.adornedLink;if(null===e)return t;let i=this.handle;if(null===i)return t;let s=i.segmentIndex;switch(this.getReshapingBehavior(i)){case 3:return t;case 2:return new ty(e.getPoint(s).x,t.y);case 1:{let i=e.getPoint(s);return new ty(t.x,i.y)}default:return e.getPoint(s)}}get originalPoint(){return this.$P}get originalPoints(){return this.Pm}}class tH extends tE{Sr;Mr;Do;Sc;tS;ms;kr;gs;Sm;iS;Mc;zw;Xw;Yw;constructor(t){super(),this.name="Resizing",this.Sr=new tx(1,1).u(),this.Mr=new tx(9999,9999).u(),this.Do=new tx(NaN,NaN).u(),this.Sc=!1,this.tS=!0,this.ms=null,this.kr=new e$("Rectangle",{alignmentFocus:tv.Center,desiredSize:tx.fC,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.gs=null,this.Sm=new ty,this.iS=new tx,this.Mc=new ty,this.zw=new tx(0,0),this.Xw=new tx(1/0,1/0),this.Yw=new tx(1,1),t&&Object.assign(this,t)}updateAdornments(t){if(!(null===t||t instanceof ic)){if(t.isSelected&&!this.diagram.isReadOnly){let e=t.resizeObject,i=t.findAdornment(this.name);if(null!==e&&t.canResize()&&t.actualBounds.isReal()&&t.isVisible()&&e.actualBounds.isReal()&&e.isVisibleObject()&&((null===i||i.adornedObject!==e)&&(i=this.makeAdornment(e)),null!==i)){let s=e.getDocumentAngle();t.Fl()&&this.updateResizeHandles(i,s),t.addAdornment(this.name,i);return}}t.removeAdornment(this.name)}}makeAdornment(t){let e=null,i=t.part?.resizeAdornmentTemplate;if(i){if(null===(e=i.copy()))return null}else{(e=new il).type=eq.Spot,e.locationSpot=tv.Center;let i=new iv;i.isPanelMain=!0,e.add(i);let s=this.makeHandle(t,tv.TopLeft);null!==s&&e.add(s),null!==(s=this.makeHandle(t,tv.TopRight))&&e.add(s),null!==(s=this.makeHandle(t,tv.BottomRight))&&e.add(s),null!==(s=this.makeHandle(t,tv.BottomLeft))&&e.add(s),null!==(s=this.makeHandle(t,tv.MiddleTop))&&e.add(s),null!==(s=this.makeHandle(t,tv.MiddleRight))&&e.add(s),null!==(s=this.makeHandle(t,tv.MiddleBottom))&&e.add(s),null!==(s=this.makeHandle(t,tv.MiddleLeft))&&e.add(s)}return e.adornedObject=t,e}makeHandle(t,e){let i=this.handleArchetype;if(null===i)return null;let s=i.copy()._P();return s.alignment=e,s}updateResizeHandles(t,e){if(null!==t){if(!t.alignment.isDefault()&&("pointer"===t.cursor||t.cursor.indexOf("resize")>0))this.wF(t,e);else if(t instanceof eq){let i=t.elements;for(;i.next();){let t=i.value;this.updateResizeHandles(t,e)}}}}wF(t,e){let i=t.alignment;i.isNoSpot()&&(i=tv.Center);let s=e;if(i.x<=0)i.y<=0?s+=225:i.y>=1?s+=135:s+=180;else if(i.x>=1)i.y<=0?s+=315:i.y>=1&&(s+=45);else if(i.y<=0)s+=270;else{if(!(i.y>=1))return;s+=90}s<0?s+=360:s>=360&&(s-=360),s<22.5?t.cursor="e-resize":s<67.5?t.cursor="se-resize":s<112.5?t.cursor="s-resize":s<157.5?t.cursor="sw-resize":s<202.5?t.cursor="w-resize":s<247.5?t.cursor="nw-resize":s<292.5?t.cursor="n-resize":s<337.5?t.cursor="ne-resize":t.cursor="e-resize"}get handleArchetype(){return this.kr}set handleArchetype(t){this.kr=t}get handle(){return this.gs}set handle(t){null!==t&&(t.part instanceof il||te.o("new handle is not in an Adornment: "+t)),this.gs=t}get adornedObject(){return this.ms}set adornedObject(t){null!==t&&t.part instanceof il&&te.o("new handle must not be in an Adornment: "+t),this.ms=t}canStart(){if(!this.isEnabled)return!1;let t=this.diagram;return!t.isReadOnly&&!!t.allowResize&&!!t.lastInput.left&&null!==this.findToolHandleAt(t.firstInput.documentPoint,this.name)}doActivate(){let t=this.diagram;null===this.handle&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),null!==this.handle&&(this.adornedObject=this.handle.part.adornedObject,null!==this.adornedObject&&null!==this.adornedObject.part&&(t.isMouseCaptured=!0,t.animationManager.stopAnimation(),t.xu=!0,this.startTransaction(this.name),this.Sm.set(this.adornedObject.getDocumentPoint(this.handle.alignment.opposite())),this.Mc.set(this.adornedObject.part.location),this.iS.set(this.adornedObject.desiredSize),this.Yw=this.computeCellSize(),this.zw=this.computeMinSize(),this.Xw=this.computeMaxSize(),this.isActive=!0))}doDeactivate(){let t=this.diagram;t.xu=!1,t.Cl=!0,this.stopTransaction(),this.handle=null,this.ms=null,t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){let t=this.diagram,e=super.stopTransaction();return e&&null!==t.undoManager.transactionToUndo&&t.undoManager.transactionToUndo.optimize(),e}doCancel(){null!==this.adornedObject&&null!==this.adornedObject.part&&(this.adornedObject.desiredSize=this.originalDesiredSize,this.adornedObject.part.location=this.originalLocation),this.stopTool()}doMouseMove(){let t=this.diagram;if(!this.isActive||null===this.adornedObject||null===this.handle)return;let e=this.zw,i=this.Xw,s=this.Yw,n=t.lastInput.documentPoint,l=this.adornedObject.getLocalPoint(n,ty.l()),r=this.computeReshape(),o=this.computeResize(l,this.handle.alignment,e,i,s,r);this.resize(o),t.maybeUpdate(),ty.e(l)}doMouseUp(){let t=this.diagram;if(this.isActive&&null!==this.adornedObject&&null!==this.handle){let e=this.zw,i=this.Xw,s=this.Yw,n=this.adornedObject.getLocalPoint(t.lastInput.documentPoint,ty.l()),l=this.computeReshape(),r=this.computeResize(n,this.handle.alignment,e,i,s,l);this.resize(r),ty.e(n),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.v("PartResized",this.adornedObject,this.originalDesiredSize)}this.stopTool()}resize(t){let e=this.diagram,i=this.adornedObject;if(null===i)return;i.desiredSize=t.size;let s=i.part;if(null===s||null===this.handle)return;s.ensureBounds();let n=i.getDocumentPoint(this.handle.alignment.opposite());if(s instanceof ib){let t;let i=new th;i.add(s),this.dragsMembers||s.hasPlaceholder()||((t=new ec).dragsMembers=!1),e.moveParts(i,this.oppositePoint.copy().subtract(n),!0,t)}else s.location=s.location.copy().subtract(n).add(this.oppositePoint);e.maybeUpdate()}computeResize(t,e,i,s,n,l){if(null===this.adornedObject)return tw.Eg;e.isNoSpot()&&(e=tv.Center);let r=this.adornedObject.naturalBounds,o=r.x,h=r.y,a=r.x+r.width,u=r.y+r.height,d=1;if(!l){let t=r.width,e=r.height;t<=0&&(t=1),e<=0&&(e=1),d=e/t}let c=ty.l();tP.Ig(t.x,t.y,o,h,n.width,n.height,c);let g=r.copy();return e.x<=0?e.y<=0?(g.x=Math.max(c.x,a-s.width),g.x=Math.min(g.x,a-i.width),g.width=Math.max(a-g.x,i.width),g.y=Math.max(c.y,u-s.height),g.y=Math.min(g.y,u-i.height),g.height=Math.max(u-g.y,i.height),l||(g.height/g.width>=1?(g.height=Math.max(Math.min(d*g.width,s.height),i.height),g.width=g.height/d):(g.width=Math.max(Math.min(g.height/d,s.width),i.width),g.height=d*g.width),g.x=a-g.width,g.y=u-g.height)):e.y>=1?(g.x=Math.max(c.x,a-s.width),g.x=Math.min(g.x,a-i.width),g.width=Math.max(a-g.x,i.width),g.height=Math.max(Math.min(c.y-h,s.height),i.height),l||(g.height/g.width>=1?(g.height=Math.max(Math.min(d*g.width,s.height),i.height),g.width=g.height/d):(g.width=Math.max(Math.min(g.height/d,s.width),i.width),g.height=d*g.width),g.x=a-g.width)):(g.x=Math.max(c.x,a-s.width),g.x=Math.min(g.x,a-i.width),g.width=a-g.x,l||(g.height=Math.max(Math.min(d*g.width,s.height),i.height),g.width=g.height/d,g.y=h+.5*(u-h-g.height))):e.x>=1?e.y<=0?(g.width=Math.max(Math.min(c.x-o,s.width),i.width),g.y=Math.max(c.y,u-s.height),g.y=Math.min(g.y,u-i.height),g.height=Math.max(u-g.y,i.height),l||(g.height/g.width>=1?(g.height=Math.max(Math.min(d*g.width,s.height),i.height),g.width=g.height/d):(g.width=Math.max(Math.min(g.height/d,s.width),i.width),g.height=d*g.width),g.y=u-g.height)):e.y>=1?(g.width=Math.max(Math.min(c.x-o,s.width),i.width),g.height=Math.max(Math.min(c.y-h,s.height),i.height),l||(g.height/g.width>=1?(g.height=Math.max(Math.min(d*g.width,s.height),i.height),g.width=g.height/d):(g.width=Math.max(Math.min(g.height/d,s.width),i.width),g.height=d*g.width))):(g.width=Math.max(Math.min(c.x-o,s.width),i.width),l||(g.height=Math.max(Math.min(d*g.width,s.height),i.height),g.width=g.height/d,g.y=h+.5*(u-h-g.height))):e.y<=0?(g.y=Math.max(c.y,u-s.height),g.y=Math.min(g.y,u-i.height),g.height=u-g.y,l||(g.width=Math.max(Math.min(g.height/d,s.width),i.width),g.height=d*g.width,g.x=o+.5*(a-o-g.width))):e.y>=1&&(g.height=Math.max(Math.min(c.y-h,s.height),i.height),l||(g.width=Math.max(Math.min(g.height/d,s.width),i.width),g.height=d*g.width,g.x=o+.5*(a-o-g.width))),ty.e(c),g}computeReshape(){let t=0;return this.adornedObject instanceof e$&&(t=this.adornedObject.eS()),!(6===t||this.diagram.lastInput.shift)}computeMinSize(){if(null===this.adornedObject)return tx.hc;let t=this.adornedObject.minSize.copy(),e=this.minSize;return!isNaN(e.width)&&e.width>t.width&&(t.width=e.width),!isNaN(e.height)&&e.height>t.height&&(t.height=e.height),t}computeMaxSize(){if(null===this.adornedObject)return tx.Fk;let t=this.adornedObject.maxSize.copy(),e=this.maxSize;return!isNaN(e.width)&&e.width<t.width&&(t.width=e.width),!isNaN(e.height)&&e.height<t.height&&(t.height=e.height),t}computeCellSize(){let t=new tx(NaN,NaN),e=this.adornedObject?.part;if(e){let i=e.resizeCellSize;!isNaN(i.width)&&i.width>0&&(t.width=i.width),!isNaN(i.height)&&i.height>0&&(t.height=i.height)}let i=this.cellSize;isNaN(t.width)&&!isNaN(i.width)&&i.width>0&&(t.width=i.width),isNaN(t.height)&&!isNaN(i.height)&&i.height>0&&(t.height=i.height);let s=this.diagram;if((isNaN(t.width)||isNaN(t.height))&&s){let e=s.grid;null!==e&&e.visible&&this.isGridSnapEnabled&&(i=e.gridCellSize,isNaN(t.width)&&!isNaN(i.width)&&i.width>0&&(t.width=i.width),isNaN(t.height)&&!isNaN(i.height)&&i.height>0&&(t.height=i.height))}return(isNaN(t.width)||0===t.width||t.width===1/0)&&(t.width=1),(isNaN(t.height)||0===t.height||t.height===1/0)&&(t.height=1),t}get minSize(){return this.Sr}set minSize(t){if(!this.Sr.equals(t)){let e=t.width;isNaN(e)&&(e=0);let i=t.height;isNaN(i)&&(i=0),this.Sr.i(e,i)}}get maxSize(){return this.Mr}set maxSize(t){if(!this.Mr.equals(t)){let e=t.width;isNaN(e)&&(e=1/0);let i=t.height;isNaN(i)&&(i=1/0),this.Mr.i(e,i)}}get cellSize(){return this.Do}set cellSize(t){this.Do.equals(t)||this.Do.a(t)}get isGridSnapEnabled(){return this.Sc}set isGridSnapEnabled(t){te.s(t,"boolean",tH,"isGridSnapEnabled"),this.Sc=t}get dragsMembers(){return this.tS}set dragsMembers(t){te.s(t,"boolean",tH,"dragsMembers"),this.tS=t}get oppositePoint(){return this.Sm}set oppositePoint(t){this.Sm.equals(t)||this.Sm.a(t)}get originalDesiredSize(){return this.iS}get originalLocation(){return this.Mc}}class tW extends tE{sS;nS;ms;kr;Kw;gs;oS;Mm;Mc;rS;lS;constructor(t){super(),this.name="Rotating",this.sS=45,this.nS=2,this.Mc=new ty,this.ms=null,this.handleArchetype=new e$("Ellipse",{desiredSize:tx.cu,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.gs=null,this.oS=0,this.Mm=new ty(NaN,NaN),this.rS=0,this.lS=50,t&&Object.assign(this,t)}updateAdornments(t){if(null!==t){if(t.Rl()){let e=t.rotateObject;if(e===t||e===t.path||e.isPanelMain)return}if(t.isSelected&&!this.diagram.isReadOnly){let e=t.rotateObject;if(null!==e&&t.canRotate()&&t.actualBounds.isReal()&&t.isVisible()&&e.actualBounds.isReal()&&e.isVisibleObject()){let i=t.findAdornment(this.name);if((null===i||i.adornedObject!==e)&&(i=this.makeAdornment(e)),null!==i){i.angle=e.getDocumentAngle(),i.hasPlaceholder()||(i.location=this.computeAdornmentLocation(e)),t.addAdornment(this.name,i);return}}}t.removeAdornment(this.name)}}makeAdornment(t){let e=null,i=t.part?.rotateAdornmentTemplate;return i?e=i.copy():null!==this.Kw&&(e=this.Kw.copy()),null===e?null:(e.adornedObject=t,e)}get handleArchetype(){return this.kr}set handleArchetype(t){this.kr=t,null!==t?this.Kw=new il(eq.Position,{locationSpot:tv.Center}).add(t).zt():this.Kw=null}get handle(){return this.gs}set handle(t){null!==t&&(t.part instanceof il||te.o("new handle is not in an Adornment: "+t)),this.gs=t}get adornedObject(){return this.ms}set adornedObject(t){null!==t&&t.part instanceof il&&te.o("new handle must not be in an Adornment: "+t),this.ms=t}canStart(){if(!this.isEnabled)return!1;let t=this.diagram;return!t.isReadOnly&&!!t.allowRotate&&!!t.lastInput.left&&null!==this.findToolHandleAt(t.firstInput.documentPoint,this.name)}doActivate(){let t=this.diagram;if(null===this.adornedObject){if(null===this.handle&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),null===this.handle)return;this.adornedObject=this.handle.part.adornedObject}null===this.adornedObject||null===this.adornedObject.part||(t.isMouseCaptured=!0,t.delaysLayout=!0,this.startTransaction(this.name),this.oS=this.adornedObject.angle,this.Mm=this.computeRotationPoint(this.adornedObject),this.Mc=this.adornedObject.part.location.copy(),this.isActive=!0)}computeRotationPoint(t){let e=t.part;if(null!==e){let i=e.locationObject;if(e.rotationSpot.isSpot())return t.getDocumentPoint(e.rotationSpot);if(t===e||t===i)return i.getDocumentPoint(e.locationSpot)}return t.getDocumentPoint(tv.Center)}computeAdornmentLocation(t){let e=this.rotationPoint;e.isReal()||(e=this.computeRotationPoint(t));let i=t.getLocalPoint(e),s=this.handleAngle;s<0?s+=360:s>=360&&(s-=360),s=Math.round(45*Math.round(s/45));let n=this.handleDistance;return 0===s?i.x=t.naturalBounds.width+n:45===s?(i.x=t.naturalBounds.width+n,i.y=t.naturalBounds.height+n):90===s?i.y=t.naturalBounds.height+n:135===s?(i.x=-n,i.y=t.naturalBounds.height+n):180===s?i.x=-n:225===s?(i.x=-n,i.y=-n):270===s?i.y=-n:315===s&&(i.x=t.naturalBounds.width+n,i.y=-n),t.getDocumentPoint(i)}doDeactivate(){let t=this.diagram;this.stopTransaction(),this.handle=null,this.ms=null,this.Mm=new ty(NaN,NaN),t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){let t=this.diagram,e=super.stopTransaction();return e&&null!==t.undoManager.transactionToUndo&&t.undoManager.transactionToUndo.optimize(),e}doCancel(){this.diagram.delaysLayout=!1,this.rotate(this.originalAngle),this.stopTool()}doMouseMove(){let t=this.diagram;if(this.isActive){let e=this.computeRotate(t.lastInput.documentPoint);this.rotate(e)}}doMouseUp(){let t=this.diagram;if(this.isActive){t.delaysLayout=!1;let e=this.computeRotate(t.lastInput.documentPoint);this.rotate(e),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.v("PartRotated",this.adornedObject,this.originalAngle)}this.stopTool()}rotate(t){let e=this.adornedObject;if(null===e||null===e.part)return;e.angle=t;let i=e.part;i.ensureBounds();let s=i.locationObject,n=i.rotateObject;(s===n||s.isContainedBy(n))&&(i.location=this.Mc.copy().subtract(this.rotationPoint).rotate(t-this.originalAngle).add(this.rotationPoint)),this.diagram.maybeUpdate()}computeRotate(t){let e=this.rotationPoint.directionPoint(t)-this.handleAngle,i=this.adornedObject?.panel;i&&(e-=i.getDocumentAngle()),e>=360?e-=360:e<0&&(e+=360);let s=Math.min(Math.abs(this.snapAngleMultiple),180),n=Math.min(Math.abs(this.snapAngleEpsilon),s/2);return!this.diagram.lastInput.shift&&s>0&&n>0&&(e%s<n?e=Math.floor(e/s)*s:e%s>s-n&&(e=(Math.floor(e/s)+1)*s)),e>=360?e-=360:e<0&&(e+=360),e}get snapAngleMultiple(){return this.sS}set snapAngleMultiple(t){te.s(t,"number",tW,"snapAngleMultiple"),this.sS=t}get snapAngleEpsilon(){return this.nS}set snapAngleEpsilon(t){te.s(t,"number",tW,"snapAngleEpsilon"),this.nS=t}get originalAngle(){return this.oS}get rotationPoint(){return this.Mm}set rotationPoint(t){this.Mm=t.copy()}get handleAngle(){return this.rS}set handleAngle(t){te.s(t,"number",tW,"handleAngle"),this.rS=t}get handleDistance(){return this.lS}set handleDistance(t){te.s(t,"number",tW,"handleDistance"),this.lS=t}}class t_ extends tE{constructor(t){super(),this.name="ClickSelecting",t&&Object.assign(this,t)}canStart(){return!(!this.isEnabled||this.isBeyondDragSize())}doMouseUp(){this.isActive&&(this.standardMouseSelect(),this.standardMouseClick()||this.diagram.lastInput.isTouchEvent&&this.diagram.toolManager.doToolTip()),this.stopTool()}}class tJ extends tE{Nc;constructor(t){super(),this.name="Action",this.Nc=null,t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;let t=this.diagram,e=t.lastInput,i=t.findObjectAt(e.documentPoint,t=>{for(;null!==t.panel&&!t.isActionable;)t=t.panel;return t});return null!==i&&!!i.isActionable&&(this.Nc=i,t.xc=t.findObjectAt(e.documentPoint,null,null),!0)}doMouseDown(){if(this.isActive){let t=this.diagram.lastInput,e=this.Nc;null!==e&&(t.targetObject=e,null!==e.actionDown&&e.actionDown(t,e))}else this.canStart()&&this.doActivate()}doMouseMove(){if(this.isActive){let t=this.diagram.lastInput,e=this.Nc;null!==e&&(t.targetObject=e,null!==e.actionMove&&e.actionMove(t,e))}}doMouseUp(){if(this.isActive){let t=this.diagram.lastInput,e=this.Nc;if(null===e)return;t.targetObject=e,null!==e.actionUp&&e.actionUp(t,e),this.standardMouseClick(t=>{for(;null!==t.panel&&(!t.isActionable||t!==e);)t=t.panel;return t},t=>t===e)}this.stopTool()}doCancel(){let t=this.diagram.lastInput,e=this.Nc;null!==e&&(t.targetObject=e,null!==e.actionCancel&&e.actionCancel(t,e),this.stopTool())}doStop(){this.Nc=null}}class tZ extends tE{vl;hS;Sc;aS;constructor(t){super(),this.name="ClickCreating",this.vl=null,this.hS=!0,this.Sc=!1,this.aS=new ty(0,0),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled||null===this.archetypeNodeData)return!1;let t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.lastInput.left||this.isBeyondDragSize())return!1;if(this.isDoubleClick){if(1===t.lastInput.clickCount&&(this.aS=t.lastInput.viewPoint.copy()),2!==t.lastInput.clickCount||this.isBeyondDragSize(this.aS))return!1}else if(1!==t.lastInput.clickCount)return!1;return t.currentTool===this||null===t.findPartAt(t.lastInput.documentPoint,!0)}doMouseUp(){let t=this.diagram;this.isActive&&this.insertPart(t.lastInput.documentPoint),this.stopTool()}insertPart(t){let e=this.diagram,i=this.archetypeNodeData;if(null===i)return null;let s=null;try{if(e.v("ChangingSelection",e.selection),this.startTransaction(this.name),i instanceof ii)i.Me()&&(i.zt(),s=i.copy(),null!==s&&e.add(s));else if(null!==i){let t=e.model.copyNodeData(i);te.H(t)&&(e.model.addNodeData(t),s=e.findPartForData(t))}if(null!==s){let i=ty.X(t.x,t.y);this.isGridSnapEnabled&&this.diagram.cS(s,t,i),s.location=i,e.allowSelect&&(e.clearSelection(!0),s.isSelected=!0),ty.e(i)}e.invalidateDocumentBounds(),this.transactionResult=this.name,e.v("PartCreated",s)}finally{this.stopTransaction(),e.v("ChangedSelection",e.selection)}return s}get archetypeNodeData(){return this.vl}set archetypeNodeData(t){null!==t&&te.lc(t,tZ,"archetypeNodeData"),this.vl=t}get isDoubleClick(){return this.hS}set isDoubleClick(t){te.s(t,"boolean",tZ,"isDoubleClick"),this.hS=t}get isGridSnapEnabled(){return this.Sc}set isGridSnapEnabled(t){te.s(t,"boolean",tZ,"isGridSnapEnabled"),this.Sc=t}}class t$ extends tE{Hh;fS;Ol;constructor(t){super(),this.name="DragSelecting",this.Hh=175,this.fS=!1,this.Ol=new ii({layerName:"Tool",selectable:!1}).add(new e$("Rectangle",{name:"SHAPE",fill:null,stroke:"magenta"}).theme("stroke","dragSelect")).zt(),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;let t=this.diagram;if(!t.allowSelect)return!1;let e=t.lastInput;return!(!e.left||t.currentTool!==this&&(!this.isBeyondDragSize()||e.timestamp-t.firstInput.timestamp<this.delay||null!==t.findPartAt(e.documentPoint,!0)))}doActivate(){let t=this.diagram;this.isActive=!0,t.isMouseCaptured=!0,t.skipsUndoManager=!0,this.box&&t.add(this.box),this.doMouseMove()}doDeactivate(){let t=this.diagram;t.stopAutoScroll(),this.box&&t.remove(this.box),t.skipsUndoManager=!1,t.isMouseCaptured=!1,this.isActive=!1}doMouseMove(){let t=this.diagram;if(this.isActive&&null!==this.box){let e=this.computeBoxBounds(),i=this.box.findObject("SHAPE");null===i&&(i=this.box.findMainElement());let s=tx.l().i(e.width,e.height);null!==i&&(i.desiredSize=s),this.box.Cc(e.x,e.y,!1),tx.e(s),(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}doMouseUp(){if(this.isActive){let t=this.diagram;this.box&&t.remove(this.box);try{t.currentCursor="wait",t.v("ChangingSelection",t.selection),this.selectInRect(this.computeBoxBounds()),t.v("ChangedSelection",t.selection)}finally{t.currentCursor=""}}this.stopTool()}computeBoxBounds(){let t=this.diagram;return new tw(t.firstInput.documentPoint,t.lastInput.documentPoint)}selectInRect(t){let e=this.diagram,i=e.lastInput,s=e.findPartsIn(t,this.isPartialInclusion);if(te.hr?i.meta:i.control){if(i.shift){let t=s.iterator;for(;t.next();){let e=t.value;e.isSelected&&(e.isSelected=!1)}}else{let t=s.iterator;for(;t.next();){let e=t.value;e.isSelected=!e.isSelected}}}else if(i.shift){let t=s.iterator;for(;t.next();){let e=t.value;e.isSelected||(e.isSelected=!0)}}else{let t=new th,i=e.selection.iterator;for(;i.next();){let e=i.value;s.has(e)||t.add(e)}let n=t.iterator;for(;n.next();)n.value.isSelected=!1;let l=s.iterator;for(;l.next();){let t=l.value;t.isSelected||(t.isSelected=!0)}}}get delay(){return this.Hh}set delay(t){te.s(t,"number",t$,"delay"),this.Hh=t}get isPartialInclusion(){return this.fS}set isPartialInclusion(t){te.s(t,"boolean",t$,"isPartialInclusion"),this.fS=t}get box(){return this.Ol}set box(t){null!==t&&t.zt(),this.Ol=t}}class tQ extends tE{Gw;sL;To;uS;constructor(t){super(),this.name="Panning",this.Gw=new ty,this.sL=new ty,this.To=!1;let e=this;this.uS=()=>{let t=e.diagram;null!==t&&t.Ni(tt.document,"scroll",e.uS,!1),e.stopTool()},t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;let t=this.diagram;return!(!t.allowHorizontalScroll&&!t.allowVerticalScroll||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize())}doActivate(){let t=this.diagram;this.To?(t.lastInput.bubbles=!0,t.Xt(tt.document,"scroll",this.uS,!1)):(t.currentCursor="move",t.isMouseCaptured=!0,this.Gw.a(t.position)),this.isActive=!0}doDeactivate(){let t=this.diagram;t.currentCursor="",t.isMouseCaptured=!1,this.isActive=!1}doCancel(){let t=this.diagram;t.position=this.Gw,t.isMouseCaptured=!1,this.stopTool()}doMouseMove(){this.nL()}doMouseUp(){this.nL(),this.stopTool()}nL(){let t=this.diagram;if(this.isActive&&t){if(this.To){t.lastInput.bubbles=!0;return}let e=t.position,i=t.firstInput.documentPoint,s=t.lastInput.documentPoint,n=e.x+i.x-s.x,l=e.y+i.y-s.y;t.allowHorizontalScroll||(n=e.x),t.allowVerticalScroll||(l=e.y),t.position=this.sL.i(n,l)}}get bubbles(){return this.To}set bubbles(t){te.s(t,"boolean",tQ,"bubbles"),this.To=t}get originalPosition(){return this.Gw}}class t0{Hw;jw;dS;gS;constructor(t){this.Hw=null,this.jw=null,this.dS=null,this.gS=null,t&&Object.assign(this,t)}get mainElement(){return this.dS}set mainElement(t){this.dS=t}get show(){return this.Hw}set show(t){this.Hw!==t&&(null!==t&&te.S(t,t0,"show"),this.Hw=t)}get hide(){return this.jw}set hide(t){this.jw!==t&&(null!==t&&te.S(t,t0,"hide"),this.jw=t)}get valueFunction(){return this.gS}set valueFunction(t){this.gS=t}}class t1{ai;qw;Lc;constructor(t,e,i){this.ai=t,this.qw=e,this.Lc=i}}class t2 extends tE{mS;Ww;pS;yS;Jw;$w;Nm;constructor(t){super(),this.name="ContextMenu",this.mS=null,this.Ww=null,this.pS=null,this.yS=new ty,this.Jw=null,this.Nm=!1;let e=this;this.$w=()=>e.stopTool(),t&&Object.assign(this,t)}xF(){let t=new t0;t.show=(t,e,i)=>i.showDefaultContextMenu(),t.hide=(t,e)=>e.hideDefaultContextMenu(),t2.Su=t;let e=this;this.$w=()=>e.stopTool();let i=te.fs("div"),s=te.fs("div");i.style.cssText="top: 0px;z-index:10002;position: fixed;display: none;text-align: center;left: 25%;width: 50%;background-color: #F5F5F5;padding: 16px;border: 16px solid #444;border-radius: 10px;margin-top: 10px",s.style.cssText="z-index:10001;position: fixed;display: none;top: 0;left: 0;width: 100%;height: 100%;background-color: black;opacity: 0.8;";let n=te.fs("style");tt.document.getElementsByTagName("head")[0].appendChild(n),n.sheet.insertRule(".goCXul { list-style: none; }",0),n.sheet.insertRule(".goCXli {font:700 1.5em Helvetica, Arial, sans-serif;position: relative;min-width: 60px; }",0),n.sheet.insertRule(".goCXa {color: #444;display: inline-block;padding: 4px;text-decoration: none;margin: 2px;border: 1px solid gray;border-radius: 10px; }",0);let l=this.diagram;null!==l&&(l.Xt(i,"contextmenu",t2.Jh,!1),l.Xt(i,"selectstart",t2.Jh,!1),l.Xt(s,"contextmenu",t2.Jh,!1)),i.className="goCXforeground",s.className="goCXbackground",tt.document.body&&(tt.document.body.appendChild(i),tt.document.body.appendChild(s)),t2.Cm=i,t2.Lm=s,t2.wS=!0}static Su=null;static wS=!1;static Lm=null;static Cm=null;static Jh(t){return t.preventDefault(),!1}canStart(){if(!this.isEnabled)return!1;let t=this.diagram;return!this.isBeyondDragSize()&&!!t.lastInput.right&&!(t.lastInput.clickCount>1)&&!!(t.lastInput.isTouchEvent&&null!==this.defaultTouchContextMenu||null!==this.findObjectWithContextMenu())}doStart(){let t=this.diagram;this.yS.set(t.firstInput.documentPoint)}doStop(){this.hideContextMenu(),this.currentObject=null,this.Nm=!1}findObjectWithContextMenu(t){void 0===t&&(t=null);let e=this.diagram,i=e.lastInput,s=null;if(t instanceof eh||(s=t instanceof eb?t:e.findObjectAt(i.documentPoint,null,t=>!t.layer?.isTemporary)),null!==s){let t=s;for(;null!==t;){if(null!==t.contextMenu)return t;t=t.panel}if(e.lastInput.isTouchEvent&&this.defaultTouchContextMenu)return s.part}else if(null!==e.contextMenu)return e;return null}doActivate(){}doMouseDown(){if(super.doMouseDown(),this.isActive&&this.currentContextMenu instanceof il){let t=this.diagram.toolManager.findTool("Action");null!==t&&t.canStart()&&(t.doActivate(),t.doMouseDown(),t.doDeactivate())}this.diagram.toolManager.mouseDownTools.has(this)&&this.doContextClick()}doMouseUp(){if(this.isActive&&this.currentContextMenu instanceof il){let t=this.diagram.toolManager.findTool("Action");null!==t&&t.canStart()&&(t.doActivate(),t.doCancel(),t.doDeactivate())}this.doContextClick()}doContextClick(){let t=this.diagram;if(this.isActive){let e=this.currentContextMenu;if(null===e)return;let i=null;e instanceof t0||null!==(i=t.findObjectAt(t.lastInput.documentPoint,null,null))&&i.isContainedBy(e)&&this.standardMouseClick(null,null),this.maybeStopTool(i)}else this.canStart()&&(this.openMenu(!0),this.isActive||this.stopTool())}maybeStopTool(t){this.stopTool(),this.canStart()&&(this.diagram.currentTool=this,this.doMouseUp())}openMenu(t,e){if(void 0===e&&(e=null),this.Nm)return;this.Nm=!0,t&&this.standardMouseSelect();let i=this.standardMouseClick();if(this.Nm=!1,!i){this.isActive=!0;let t=t2.Su;if(null===e&&(e=this.findObjectWithContextMenu()),null!==e){let i=e.contextMenu;null!==i?(this.currentObject=e instanceof eb?e:null,this.showContextMenu(i,this.currentObject)):null!==t&&this.showContextMenu(t,this.currentObject)}else null!==t&&this.showContextMenu(t,null);this.currentContextMenu instanceof il&&!this.currentContextMenu.visible&&this.stopTool()}}doMouseMove(){let t=this.diagram.toolManager.findTool("Action");null!==t&&t.doMouseMove(),this.isActive&&this.diagram.toolManager.doMouseMove()}showContextMenu(t,e){let i=this.diagram;if(t!==this.currentContextMenu&&this.hideContextMenu(),t instanceof il){t.layerName="Tool",t.selectable=!1,t.scale=1/i.scale,t.category=this.name,t.hasPlaceholder()&&(t.placeholder.scale=i.scale);let s=t.diagram;null!==s&&s!==i&&s.remove(t),i.add(t),null!==e?t.adornedObject=e:t.data=i.model,t.ensureBounds(),this.positionContextMenu(t,e)}else t instanceof t0&&null!==t.show&&t.show(e,i,this);this.currentContextMenu=t}positionContextMenu(t,e){if(t.hasPlaceholder())return;let i=this.diagram,s=i.lastInput.documentPoint.copy(),n=t.measuredBounds,l=i.viewportBounds;i.lastInput.isTouchEvent&&(s.x-=n.width),s.x+n.width>l.right&&(s.x-=n.width+5/i.scale),s.x<l.x&&(s.x=l.x),s.y+n.height>l.bottom&&(s.y-=n.height+5/i.scale),s.y<l.y&&(s.y=l.y),t.position=s}hideContextMenu(){let t=this.diagram,e=this.currentContextMenu;null!==e&&(e instanceof il?(t.remove(e),null!==this.Ww&&this.Ww.removeAdornment(e.category),e.data=null,e.adornedObject=null):e instanceof t0&&(null!==e.hide?e.hide(t,this):null!==e.mainElement&&(e.mainElement.style.display="none")),this.currentContextMenu=null,this.standardMouseOver())}bF(){let t=this,e=new th;return e.add(new t1("Copy",t=>t.commandHandler.copySelection(),t=>t.commandHandler.canCopySelection())),e.add(new t1("Cut",t=>t.commandHandler.cutSelection(),t=>t.commandHandler.canCutSelection())),e.add(new t1("Delete",t=>t.commandHandler.deleteSelection(),t=>t.commandHandler.canDeleteSelection())),e.add(new t1("Paste",e=>e.commandHandler.pasteSelection(t.mouseDownPoint),e=>e.commandHandler.canPasteSelection(t.mouseDownPoint))),e.add(new t1("Select All",t=>t.commandHandler.selectAll(),t=>t.commandHandler.canSelectAll())),e.add(new t1("Undo",t=>t.commandHandler.undo(),t=>t.commandHandler.canUndo())),e.add(new t1("Redo",t=>t.commandHandler.redo(),t=>t.commandHandler.canRedo())),e.add(new t1("Scroll To Part",t=>t.commandHandler.scrollToPart(),t=>t.commandHandler.canScrollToPart())),e.add(new t1("Zoom To Fit",t=>t.commandHandler.zoomToFit(),t=>t.commandHandler.canZoomToFit())),e.add(new t1("Reset Zoom",t=>t.commandHandler.resetZoom(),t=>t.commandHandler.canResetZoom())),e.add(new t1("Group Selection",t=>t.commandHandler.groupSelection(),t=>t.commandHandler.canGroupSelection())),e.add(new t1("Ungroup Selection",t=>t.commandHandler.ungroupSelection(),t=>t.commandHandler.canUngroupSelection())),e.add(new t1("Edit Text",t=>t.commandHandler.editTextBlock(),t=>t.commandHandler.canEditTextBlock())),e}showDefaultContextMenu(){let t=this.diagram;null===this.Jw&&(this.Jw=this.bF()),t2.Cm.innerHTML="",t2.Lm.addEventListener("pointerdown",this.$w,!1);let e=this,i=te.fs("ul");i.className="goCXul",t2.Cm.appendChild(i),i.innerHTML="";let s=this.Jw.iterator;for(;s.next();){let n=s.value,l=n.qw,r=n.Lc;if(!te.ot(l)||te.ot(r)&&!r(t))continue;let o=te.fs("li");o.className="goCXli";let h=te.fs("a");h.className="goCXa",h.href="#",h.qw=l,h.addEventListener("pointerdown",function(i){return this.qw(t),e.stopTool(),i.preventDefault(),!1},!1),h.textContent=n.ai,o.appendChild(h),i.appendChild(o)}t2.Cm.style.display="block",t2.Lm.style.display="block"}hideDefaultContextMenu(){if(null===this.currentContextMenu||this.currentContextMenu!==t2.Su)return;t2.Cm.style.display="none",t2.Lm.style.display="none";let t=this.diagram;null!==t&&t.Ni(t2.Lm,"pointerdown",this.$w,!1),this.currentContextMenu=null}get currentContextMenu(){return this.mS}set currentContextMenu(t){this.mS=t,this.Ww=t instanceof il?t.adornedPart:null}get defaultTouchContextMenu(){return!1===t2.wS&&null===t2.Su&&eh.isUsingDOM()&&this.xF(),t2.Su}set defaultTouchContextMenu(t){null===t&&(t2.wS=!0),t2.Su=t}get currentObject(){return this.pS}set currentObject(t){this.pS=t}get mouseDownPoint(){return this.yS}}var t3=((h=t3||{})[h.LostFocus=1]="LostFocus",h[h.MouseDown=2]="MouseDown",h[h.Tab=3]="Tab",h[h.Enter=4]="Enter",h),t4=((a=t4||{})[a.SingleClick=1]="SingleClick",a[a.SingleClickSelected=2]="SingleClickSelected",a[a.DoubleClick=3]="DoubleClick",a),t5=((u=t5||{})[u.None=1]="None",u[u.Active=2]="Active",u[u.Editing=3]="Editing",u[u.Validating=4]="Validating",u[u.Invalid=5]="Invalid",u[u.Validated=6]="Validated",u);class t8 extends tE{Ne;xS;bS;Il;jt;kS;PS;SS;Zw;MS;constructor(t){super(),this.name="TextEditing",this.Ne=new e3,this.xS=null,this.bS=2,this.Il=null,this.jt=1,this.kS=1,this.PS=!0,this.SS=null,this.Zw=new t0,this.kF(this.Zw),t&&Object.assign(this,t)}static LostFocus=1;static MouseDown=2;static Tab=3;static Enter=4;static SingleClick=1;static SingleClickSelected=2;static DoubleClick=3;static StateNone=1;static StateActive=2;static StateEditing=3;static StateValidating=4;static StateInvalid=5;static StateValidated=6;kF(t){if(!eh.isUsingDOM())return;let e=te.fs("textarea");this.MS=e;let i=this;e.addEventListener("input",function(t){if(null===i.textBlock)return;let e=i.measureTemporaryTextBlock(this.value),s=this.textScale;this.style.width=20+Math.max(i.textBlock.measuredBounds.width,e.measuredBounds.width)*s+"px",this.rows=Math.max(i.textBlock.lineCount,e.lineCount)},!1),e.addEventListener("keydown",function(t){if(t.isComposing||null===i.textBlock)return;let e=t.key;if("Enter"===e){!1===i.textBlock.isMultiline&&t.preventDefault(),i.acceptText(4);return}if("Tab"===e){i.acceptText(3),t.preventDefault();return}"Escape"===e&&(i.doCancel(),null!==i.diagram&&i.diagram.doFocus())},!1),e.addEventListener("focus",function(t){i.PF(t)},!1),e.addEventListener("blur",function(t){i.SF(t)},!1),t.valueFunction=()=>e.value,t.mainElement=e,t.show=(t,i,s)=>{if(!(t instanceof e3)||!i||!i.div||!(s instanceof t8))return;if(5===s.state){e.style.border="3px solid red",e.focus();return}let n=t.getDocumentPoint(tv.Center),l=i.position,r=i.scale,o=t.getDocumentScale()*r;o<s.minimumEditorScale&&(o=s.minimumEditorScale);let h=t.naturalBounds.width*o+6,a=t.naturalBounds.height*o+2,u=(n.x-l.x)*r,d=(n.y-l.y)*r,c=t.verticalAlignment,g=(t.lineHeight+t.spacingAbove+t.spacingBelow)*t.lineCount*o,f=c.y*a-c.y*g+c.offsetY-(.5*a-.5*g)-g/2;e.value=t.text,i.div.style.font=t.font,e.style.position="absolute",e.style.zIndex="100",e.style.font="inherit",e.style.fontSize=100*o+"%",e.style.lineHeight="normal",e.style.width=h+"px",e.style.left=(u-h/2|0)-1+"px",e.style.top=(d+f|0)-1+"px",e.style.textAlign=t.textAlign,e.style.margin="0",e.style.padding="1px",e.style.border="0",e.style.outline="none",e.style.whiteSpace="pre-wrap",e.style.overflow="hidden",e.rows=t.lineCount,e.textScale=o,e.className="goTXarea",i.div.appendChild(e),e.focus(),s.selectsTextOnActivate&&(e.select(),e.setSelectionRange(0,9999))},t.hide=(t,i)=>{t.div&&t.div.removeChild(e)}}get textBlock(){return this.xS}set textBlock(t){this.xS=t}get currentTextEditor(){return this.SS}set currentTextEditor(t){this.SS=t}get defaultTextEditor(){return this.Zw}set defaultTextEditor(t){this.Zw=t}get starting(){return this.bS}set starting(t){this.bS=t}canStart(){if(!this.isEnabled)return!1;let t=this.diagram;if(null===t||t.isReadOnly||t8.Ac&&t8.Ac!==this&&(t8.Ac.acceptText(2),t8.Ac&&t8.Ac!==this)||!t.lastInput.left||this.isBeyondDragSize())return!1;let e=t.lastInput.documentPoint,i=t.findObjectAt(e);if(null===i||!(i instanceof e3)||!i.editable||null===i.part||!i.part.canEdit())return!1;let s=i.part;return!(null===s||2===this.starting&&!s.isSelected||3===this.starting&&t.lastInput.clickCount<2)}doStart(){t8.Ac=this,null!==this.textBlock&&this.doActivate()}doActivate(){if(this.isActive)return;let t=this.diagram;if(null===t)return;let e=this.textBlock;if(null===e&&(e=t.findObjectAt(t.lastInput.documentPoint)),null===e||!(e instanceof e3)||(this.textBlock=e,null===e.part))return;t.animationManager.stopAnimation(),this.isActive=!0,this.jt=2;let i=this.defaultTextEditor;null!==e.textEditor&&(i=e.textEditor),this.Ne=this.textBlock.copy();let s=new tw(this.textBlock.getDocumentPoint(tv.TopLeft),this.textBlock.getDocumentPoint(tv.BottomRight));t.scrollToRect(s),null!==i&&null!==i.show&&i.show(e,t,this),this.currentTextEditor=i}doCancel(){this.stopTool()}doMouseUp(){this.canStart()&&this.doActivate()}doMouseDown(){this.isActive&&this.acceptText(2)}acceptText(t){switch(t){case 2:6===this.jt?this.currentTextEditor instanceof HTMLElement&&this.currentTextEditor.focus():(2===this.jt||5===this.jt||3===this.jt)&&(this.jt=4,this.oL());break;case 1:case 4:case 3:if(4===t&&null!==this.textBlock&&!0===this.textBlock.isMultiline)return;(2===this.jt||5===this.jt||3===this.jt)&&(this.jt=4,this.oL())}}oL(){let t=this.textBlock,e=this.diagram,i=this.currentTextEditor;if(null!==t&&null!==i){let s=t.text,n="";if(null!==i.valueFunction&&(n=i.valueFunction()),!this.isValidText(t,s,n)){this.jt=5,this.doError(s,n);return}this.startTransaction(this.name),this.jt=6,this.transactionResult=this.name,t.text=n,this.doSuccess(s,n),null!==e&&e.v("TextEdited",t,s),this.stopTransaction(),this.stopTool(),null!==e&&e.doFocus()}}doError(t,e){let i=this.textBlock;if(null===i)return;null!==i.errorFunction&&i.errorFunction(this,t,e);let s=this.currentTextEditor;null!==s&&null!==s.show&&s.show(i,this.diagram,this)}doSuccess(t,e){let i=this.textBlock;null!==i&&null!==i.textEdited&&i.textEdited(i,t,e)}doDeactivate(){let t=this.diagram;if(null!==t){if(this.jt=1,null!==this.currentTextEditor){let e=this.currentTextEditor;null!==e&&null!==e.hide&&e.hide(t,this)}this.textBlock=null,this.isActive=!1}}doStop(){t8.Ac=null}PF(t){if(null===this.currentTextEditor||1===this.state)return;let e=this.MS;2===this.jt&&(this.jt=3),te.ot(e.select)&&this.selectsTextOnActivate&&(e.select(),e.setSelectionRange(0,9999))}SF(t){if(null===this.currentTextEditor||1===this.state)return;let e=this.MS;te.ot(e.focus)&&e.focus(),te.ot(e.select)&&this.selectsTextOnActivate&&(e.select(),e.setSelectionRange(0,9999))}isValidText(t,e,i){let s=this.textValidation;if(null!==s&&!s(t,e,i))return!1;let n=t.textValidation;return!(null!==n&&!n(t,e,i))}get textValidation(){return this.Il}set textValidation(t){null!==t&&te.S(t,t8,"textValidation"),this.Il=t}get minimumEditorScale(){return this.kS}set minimumEditorScale(t){null!==t&&te.s(t,"number",t8,"minimumEditorScale"),this.kS=t}get selectsTextOnActivate(){return this.PS}set selectsTextOnActivate(t){null!==t&&te.s(t,"boolean",t8,"selectsTextOnActivate"),this.PS=t}get state(){return this.jt}set state(t){this.jt!==t&&(this.jt=t)}measureTemporaryTextBlock(t){let e=this.Ne;return e.text=t,null!==this.textBlock&&e.ut(this.textBlock.El,1/0),e}static Ac=null}var t6=((d=t6||{})[d.Default=1]="Default",d[d.AnimateLocations=2]="AnimateLocations",d[d.None=3]="None",d);class t9{L;Ci;Bi;Nr;Jn;Fo;NS;CS;Am;xi;Tc;gn;Tm;$h;Qw;Dm;_w;Dc;ku;Fm;constructor(t){this.L=eh.ym(),this.Ci=!1,this.Am=!1,this.xi=!1,this.Tc=!1,this._w=!0,this.Dc=1,this.ku=!1,this.Bi=!0,this.Nr=!0,this.Fo=600,this.NS=!1,this.CS=!1,this.Jn=new tu,this.gn=new t7,this.Tm=new t7,this.gn.ps=this,this.$h=new tu,this.Qw=new tu,this.Dm=new tu,this.Fm=new tu,t&&Object.assign(this,t)}Ro(t){this.L=t}wE(){return this.L}canStart(t){return!0}Bl(t){return!!(this.Bi&&this.canStart(t))&&(this.Jn.add(t),this.defaultAnimation.isAnimating&&this.stopAnimation(),this.L.Li(),this.xi=!0,!0)}getBundleAnimation(){return this.Tm}LS(){if(!this.Bi||(this.Tm.de.count>0&&this.Tm.start(),!this.xi))return;let t=this.gn,e=this.L,i=this.Jn.has("Model");if(i&&(this.Tc=!0,1===this.Dc?(t.isViewportUnconstrained=!0,t.de.clear(),t.add(e,"position",e.position.copy().offset(0,-200),e.position),t.add(e,"opacity",0,1)):3===this.Dc&&t.de.clear(),2===this.Dc&&e.tx.equals(e.dt)?this._w=!0:this._w=!1,e.v("InitialAnimationStarting",this)),i&&!this.Nr||0===t.de.count){this.Jn.clear(),this.xi=!1,t.de.clear(),t.ix(e),this.Tc=!1,e.C();return}this.Jn.clear(),e.Cr=!1;let s=t.de.get(e);1!==e.autoScale&&null!==s&&(delete s.oi.scale,delete s.ys.scale);let n=this;tt.requestAnimationFrame(()=>{!1===n.xi||t.Ci||(e.getRenderingHint("temporaryPixelRatio")&&e.Ew(),e.AS(),n.xi=!1,t.start(),t.Ci&&(n.Mu(),e.invalidateDocumentBounds(),t.rL(0),e.br(!0),n.Nu(),e.v("AnimationStarting",n)))})}TS(){return this.Jn.has("Trigger")&&1===this.Jn.count}lL(t,e,i,s){this.isTicking||this.TS()||t instanceof ic&&(null!==t.fromNode||null!==t.toNode)||this.gn.add(t,"position",e,i,s)}ex(t){return this.gn.ex(t)}DS(t){return this.gn.DS(t)}MF(t){let e=this.$h,i=this;this.Ci?this.CF(t):(this.Ci=!0,e.add(t),tt.requestAnimationFrame(()=>(function t(){if(i.Dm.count>0&&(e.addAll(i.Dm),i.Dm.clear(),i.Ci=!0),!1===i.Ci||0===e.count)return;i.Qw.addAll(e);let s=i.Qw.iterator;for(;s.next();){let t=s.value;!1!==t.Ci&&(t.NF()?t.hL(!1):t.Fc=!0)}if(i.Qw.clear(),!1===i.Ci){tt.requestAnimationFrame(t);return}i.Mu(),i.L.br(),i.Nu(),tt.requestAnimationFrame(t)})()))}CF(t){this.Dm.add(t)}LF(){let t=this.$h.iterator;for(;t.next();)t.value.Fc=!1}Mu(){if(this.Am)return;let t=this.L;this.NS=t.skipsUndoManager,this.CS=t.ge,t.skipsUndoManager=!0,t.ge=!0,this.Am=!0}Nu(){let t=this.L;t.skipsUndoManager=this.NS,t.ge=this.CS,this.Am=!1}stopAnimation(t){let e=this.gn;if(!0===this.xi&&(this.xi=!1,this.Tc=!1,this.Jn.clear(),e.AF()&&this.L.requestUpdate()),!this.Ci){e.de.clear(),e.ix(this.L);return}if(e.Cu(!0),e.ix(null),!0===t){let t=this.$h.toArray();for(let e=0;e<t.length;e++)t[e].Cu(!0)}}Cu(t){this.$h.delete(t),0===this.$h.count&&(this.Ci=!1,this.L.requestUpdate()),t===this.defaultAnimation&&this.L.v("AnimationFinished",this)}Rc(t,e){!this.xi||(this.Jn.has("Expand Tree")||this.Jn.has("Expand SubGraph"))&&(this.gn.Rc(t,e),this.aL(t))}vc(t,e){!this.xi||(this.Jn.has("Collapse Tree")||this.Jn.has("Collapse SubGraph"))&&(this.gn.vc(t,e),this.gn.FS(e,"position",e.position,e.position),this.aL(t))}cL(t,e){!this.xi||t.equals(e)||this.TS()||(this.L.Kh||(t=e.copy()),this.gn.FS(this.L,"position",t,e))}fL(t,e){this.xi&&(this.TS()||this.gn.add(this.L,"scale",t,e))}RS(t,e){t.Ce&&(t.Lr=e,this.Fm.add(t))}aL(t){let e=t.findLinksConnected();for(;e.next();){let t=e.value;t.Ce&&(t.Lr=t.points.copy(),this.Fm.add(t))}}get isEnabled(){return this.Bi}set isEnabled(t){te.s(t,"boolean",t9,"isEnabled"),this.Bi=t,t&&this.$h.each(t=>{t.isAnimating||t.runCount!==1/0||t.start()})}get duration(){return this.Fo}set duration(t){te.s(t,"number",t9,"duration"),t<1&&te._(t,">= 1",t9,"duration"),this.Fo=t}get isAnimating(){return this.Ci}get isTicking(){return this.Am}get isInitial(){return this.Nr}set isInitial(t){te.s(t,"boolean",t9,"isInitial"),this.Nr=t}get defaultAnimation(){return this.gn}get activeAnimations(){return this.$h}get initialAnimationStyle(){return this.Dc}set initialAnimationStyle(t){this.Dc=t}static sx=new tp;static defineAnimationEffect(t,e){t9.sx.set(t,e)}static vS(t,e,i,s,n){null===t&&(t=[0,0,0,0]),null===e&&(e=[0,0,0,0]);let l=t[0],r=t[1],o=t[2],h=t[3],a=e[0],u=e[1],d=e[2],c=e[3];0===o||100===o?(l=a,r=u):(0===d||100===d)&&(a=l,u=r),Math.abs(a-l)>180&&(a>l?l+=360:a+=360);let g=n(i,l,a-l,s)%360,f=n(i,r,u-r,s);return"hsla("+g+", "+f+"%, "+n(i,o,d-o,s)+"%, "+n(i,h,c-h,s)+")"}static{let t=t9.sx,e=(t,e,i,s,n,l)=>{t.position=new ty(s(n,e.x,i.x-e.x,l),s(n,e.y,i.y-e.y,l))};t.set("position:diagram",e),t.set("position",e),t.set("position:part",(t,e,i,s,n,l)=>{n<l?t.Cc(s(n,e.x,i.x-e.x,l),s(n,e.y,i.y-e.y,l),!1):t.position=new ty(s(n,e.x,i.x-e.x,l),s(n,e.y,i.y-e.y,l))}),t.set("location",(t,e,i,s,n,l)=>{n<l?t.Cc(s(n,e.x,i.x-e.x,l),s(n,e.y,i.y-e.y,l),!0):t.location=new ty(s(n,e.x,i.x-e.x,l),s(n,e.y,i.y-e.y,l))}),t.set("position:placeholder",(t,e,i,s,n,l)=>{n<l?t.Cc(s(n,e.x,i.x-e.x,l),s(n,e.y,i.y-e.y,l),!1):t.position=new ty(s(n,e.x,i.x-e.x,l),s(n,e.y,i.y-e.y,l))}),t.set("position:nodeCollapse",(t,e,i,s,n,l)=>{let r=t.actualBounds,o=i.actualBounds,h=o.x+o.width/2-r.width/2,a=o.y+o.height/2-r.height/2;n<l?t.Cc(s(n,e.x,h-e.x,l),s(n,e.y,a-e.y,l),!1):t.position=new ty(s(n,e.x,h-e.x,l),s(n,e.y,a-e.y,l))}),t.set("desiredSize",(t,e,i,s,n,l)=>{t.desiredSize=new tx(s(n,e.width,i.width-e.width,l),s(n,e.height,i.height-e.height,l))}),t.set("width",(t,e,i,s,n,l)=>{t.width=s(n,e,i-e,l)}),t.set("height",(t,e,i,s,n,l)=>{t.height=s(n,e,i-e,l)}),t.set("fill",(t,e,i,s,n,l)=>{t.fill=t9.vS(e,i,n,l,s)}),t.set("stroke",(t,e,i,s,n,l)=>{t.stroke=t9.vS(e,i,n,l,s)}),t.set("strokeWidth",(t,e,i,s,n,l)=>{t.strokeWidth=s(n,e,i-e,l)}),t.set("strokeDashOffset",(t,e,i,s,n,l)=>{t.strokeDashOffset=s(n,e,i-e,l)}),t.set("background",(t,e,i,s,n,l)=>{t.background=t9.vS(e,i,n,l,s)}),t.set("opacity",(t,e,i,s,n,l)=>{t.opacity=s(n,e,i-e,l)}),t.set("scale",(t,e,i,s,n,l)=>{t.scale=s(n,e,i-e,l)}),t.set("angle",(t,e,i,s,n,l)=>{t.angle=s(n,e,i-e,l)})}static Default=1;static AnimateLocations=2;static None=3}class t7{nx;Rm;Ci;Lu;Fo;ws;uL;Oc;de;ox;oi;$n;Au;Ic;rx;lx;Fc;OS;hx;ps;L;IS;ES;BS;constructor(t){this.L=null,this.ps=null,this.OS=null,this.hx=null,this.IS=!1,this.Ci=!1,this.Fc=!1,this.oi=0,this.$n=0,this.nx=t7.EaseInOutQuad,this.Rm=t7.EaseInOutQuad,this.Au=!1,this.Ic=!1,this.rx=1,this.lx=0,this.Fo=NaN,this.ws=NaN,this.ES=0,this.Lu=null,this.uL=ty.Lo,this.de=new tp,this.ox=new tp,this.Oc=new tu,this.BS=1,t&&Object.assign(this,t)}suspend(){this.Fc=!0}advanceTo(t,e){e&&(this.Fc=!1),this.Au&&t>=this.ws&&(this.Ic=!0,t-=this.ws),this.ES=t,this.hL(!0),this.ps.Mu(),this.L.br(),this.ps.Nu(),this.L.redraw()}ix(t){if(this.ox.clear(),this.Ic=!1,this.lx=0,this.ws=NaN,this.Oc.count>0&&this.Oc.clear(),null!==t){let e=t.links;for(;e.next();)e.value.Lr=null}}AF(){return this.de.count>0}start(){if(0===this.de.count||this.Ci)return this;let t=this.L,e=this.de.iterator;for(;e.next();){let i=e.key;null===t&&(i instanceof eh?t=i:i instanceof eb&&(t=i.diagram))}if(null===t)return this;this.L=t,this.ps=t.animationManager;let i=this.ps;return!1===i.isEnabled||(this.ws=isNaN(this.Fo)?i.duration:this.Fo,this.Rm=this.nx,i.Tc&&1===i.Dc&&this===i.defaultAnimation&&(this.Rm=t7.EaseOutExpo,this.ws=isNaN(this.Fo)?600===i.duration?900:i.duration:this.Fo),this.BS=t.scrollMode,this.isViewportUnconstrained&&(t.Zh=2),i.Mu(),this.Oc.each(e=>{e.data=null,t.add(e)}),i.Nu(),this.Ci=!0,this.oi=+new Date,this.$n=this.oi+this.ws,i.MF(this)),this}addTemporaryPart(t,e){return t.Me()&&(this.Oc.add(t),this.L=e),this}add(t,e,i,s,n){if(null===this.L&&(t instanceof eh?this.L=t:t instanceof eb&&null!==t.diagram&&(this.L=t.diagram)),t instanceof ii){if(!t.isAnimated)return this;"position"===e&&(e="position:part")}return this.FS(t,e,i,s,n),this}FS(t,e,i,s,n){let l,r,o;let h=this.de;if(t instanceof eh&&"position"===e&&(e="position:diagram"),("fill"===e||"stroke"===e||"background"===e)&&(eD.vo(i),eD.US(),i=[eD.Ui.n0,eD.Ui.n1,eD.Ui.n2,eD.Ui.n3],eD.vo(s),eD.US(),s=[eD.Ui.n0,eD.Ui.n1,eD.Ui.n2,eD.Ui.n3]),h.has(t))r=(l=h.get(t)).oi,o=l.ys,void 0===r[e]&&(r[e]=this.Tu(i)),o[e]=this.Tu(s);else{if("position"===e&&i.equalsApprox(s))return;o={},(r={})[e]=this.Tu(i),o[e]=this.Tu(s),l=new et(r,o,n),h.set(t,l)}let a=r[e];a instanceof ty&&!a.isReal()&&a.a(this.uL),n&&0===e.indexOf("position:")&&t instanceof ii?l.ax.location=this.Tu(t.location):n&&(l.ax[e]=this.Tu(i))}Tu(t){return t instanceof ty||t instanceof tx?t.copy():t}TF(t){let e=this.de;e.has(t)&&(e.get(t).cx=!0)}ex(t){if(!this.Ci)return!1;let e=this.de.get(t);return null!==e&&e.cx}DS(t){if(!this.Ci)return!1;let e=this.de.get(t);return null!==e&&!!(e.oi.position||e.oi["position:part"]||e.oi.location)}NF(){if(this.Oc.count>0)return!0;let t=this.de.iterator;for(;t.next();){let e=t.key;if(e instanceof eb&&null!==e.diagram||e instanceof eh)return!0}return!1}hL(t){if(this.Fc&&!t)return;let e=this.ps;if(!1===this.Ci)return;let i=+new Date,s=i>this.$n?this.ws:i-this.oi;t&&((s=this.ES)<this.ws?(this.oi=+new Date-s,this.$n=this.oi+this.ws):s=this.ws),e.Mu(),this.rL(s),this.L.br(!0),e.Nu(),i>this.$n&&(this.Au&&!this.Ic?(this.oi=+new Date,this.$n=this.oi+this.ws,this.Ic=!0):this.Cu(!1))}rL(t){let e=this.ws,i=this.de.iterator,s=this.Ic;for(;i.next();){let n=i.key;if(n instanceof eb&&null===n.diagram)continue;let l=i.value,r=s?l.ys:l.oi,o=s?l.oi:l.ys,h=t9.sx;for(let i in o)"position"===i&&(o["position:placeholder"]||o["position:nodeCollapse"])||null!==h.get(i)&&h.get(i)(n,r[i],o[i],this.Rm,t,e,this)}}stop(){return this.Ci&&this.Cu(!0),this}Cu(t){if(null!==this.hx&&this.hx.DF(this.OS),!this.Ci)return;let e=this.L,i=this.ps;i.Tc=!1,this.Ci=!1,this.Fc=!1,i.Mu();let s=this.de,n=this.Oc.iterator;for(;n.next();)e.remove(n.value);let l=this.Au,r=s.iterator,o=t9.sx;for(;r.next();){let t=r.key,e=r.value,i=l?e.ys:e.oi,s=l?e.oi:e.ys,n=e.ax;for(let l in s)if(null!==o.get(l)){let r=l;e.fx&&("position:nodeCollapse"===r||"position:placeholder"===r)&&(r="position"),o.get(r)(t,i[l],void 0!==n[l]?n[l]:e.fx?i[l]:s[l],this.Rm,this.ws,this.ws,this)}e.fx&&void 0!==n.location&&t instanceof ii&&(t.location=n.location),e.cx&&t instanceof ii&&t.Vi(!1)}this.lx++;let h=!t&&this.rx>this.lx;if(h||this!==i.Tm&&this!==i.defaultAnimation||this.de.clear(),e.ux.clear(),e.xP(!1),e.invalidateDocumentBounds(),e.C(),e.br(!0),i.defaultAnimation===this){let t=i.Fm.iterator;for(;t.next();)t.value.FF();i.Fm.clear()}if(e.br(!0),this.isViewportUnconstrained&&(e.scrollMode=this.BS),i.Nu(),h){this.Ic=!1,this.start();return}this.ix(null),e.dL(),i.Cu(this),this.Lu&&this.Lu(this),e.requestUpdate()}Rc(t,e){let i=e.actualBounds,s=null;if(e instanceof ib&&(s=e.placeholder),null!==s&&s.visible){let e=s.getDocumentPoint(tv.TopLeft),i=s.padding;e.x+=i.left,e.y+=i.top,this.add(t,"position",e,t.position,!1)}else this.add(t,"position",new ty(i.x+i.width/2,i.y+i.height/2),t.position,!1);this.add(t,"scale",.01,t.scale,!1),t instanceof ib&&this.RF(t,e)}RF(t,e){let i=t.memberParts;for(;i.next();){let t=i.value;t instanceof io&&this.Rc(t,e)}}vc(t,e){if(!t.isVisible())return;let i=null;if(e instanceof ib&&(i=e.placeholder),null!==i&&i.visible){let e=i.getDocumentPoint(tv.TopLeft),s=i.padding;e.x+=s.left,e.y+=s.top,this.add(t,"position:placeholder",t.position,e,!0)}else this.add(t,"position:nodeCollapse",t.position,e,!0);this.add(t,"scale",t.scale,.01,!0),this.TF(t),t instanceof ib&&this.vF(t,e)}vF(t,e){let i=t.memberParts;for(;i.next();){let t=i.value;t instanceof io&&this.vc(t,e)}}get duration(){return this.Fo}set duration(t){te.s(t,"number",t7,"duration"),t<1&&te._(t,">= 1",t7,"duration"),this.Fo=t}get reversible(){return this.Au}set reversible(t){this.Au=t}get runCount(){return this.rx}set runCount(t){t>0?this.rx=t:te.o("Animation.runCount value must be a positive integer.")}get finished(){return this.Lu}set finished(t){this.Lu!==t&&(null!==t&&te.S(t,t7,"finished"),this.Lu=t)}get easing(){return this.nx}set easing(t){this.nx=t}get isViewportUnconstrained(){return this.IS}set isViewportUnconstrained(t){this.IS=t}get isAnimating(){return this.Ci}getTemporaryState(t){let e=this.ox.get(t);return null===e&&(e={},this.ox.set(t,e)),e}static EaseLinear=(t,e,i,s)=>i*t/s+e;static EaseInOutQuad=(t,e,i,s)=>(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e;static EaseInQuad=(t,e,i,s)=>i*(t/=s)*t+e;static EaseOutQuad=(t,e,i,s)=>-i*(t/=s)*(t-2)+e;static EaseInExpo=(t,e,i,s)=>0===t?e:i*Math.pow(2,10*(t/s-1))+e;static EaseOutExpo=(t,e,i,s)=>t===s?e+i:i*(-Math.pow(2,-10*t/s)+1)+e}class et{oi;ys;ax;fx;cx;constructor(t,e,i){this.oi=t,this.ys=e,this.ax={},this.fx=i,this.cx=!1}}var ee=((c=ee||{})[c.Default=1]="Default",c[c.Immediate=2]="Immediate",c[c.Bundled=3]="Bundled",c);class ei{Se;fn;Du;Ec;constructor(t,e,i){this.Se=null,this.fn=t,this.Du=i||1,this.Ec=null,void 0!==e&&(this.Ec=e,void 0===i&&(this.Du=2))}copy(){let t=new ei(this.fn);t.Du=this.Du;let e=this.Ec;if(null!==e){let i={};void 0!==e.duration&&(i.duration=e.duration),void 0!==e.finished&&(i.finished=e.finished),void 0!==e.easing&&(i.easing=e.easing),t.Ec=i}return t}get propertyName(){return this.fn}set propertyName(t){this.fn=t}get animationSettings(){return this.Ec}set animationSettings(t){this.Ec=t}OF(t){let e=this.Ec;null!==e&&(e.duration&&(t.duration=e.duration),e.finished&&(t.finished=e.finished),e.easing&&(t.easing=e.easing))}get startCondition(){return this.Du}set startCondition(t){this.Du=t}static Default=1;static Immediate=2;static Bundled=3}class es{L;Nt;_t;Ar;Ul;Vl;zl;Xl;Yl;Kl;Gl;Hl;jl;ql;Wl;Jl;Lc;$l;gx;vm;Fu;Tt;constructor(t){tu.qi(this),this.L=null,this.Tt=new th,this.Nt="",this._t=1,this.Ar=!1,this.Ul=!0,this.Vl=!0,this.zl=!0,this.Xl=!0,this.Yl=!0,this.Kl=!0,this.Gl=!0,this.Hl=!0,this.jl=!0,this.ql=!0,this.Wl=!0,this.Jl=!0,this.Lc=!0,this.$l=!0,this.gx=!0,this.vm=!1,this.Fu=[],t&&Object.assign(this,t)}IF(){let t=this.Tt;for(let e=0;e<t.length;e++)t.r[e].VS(null);t.clear(),this.Fu.length=0}Ro(t){this.L=t}toString(t){void 0===t&&(t=0);let e='Layer "'+this.name+'"';if(t<=0)return e;let i=0,s=0,n=0,l=0,r=0,o=this.Tt.iterator;for(;o.next();){let t=o.value;t instanceof ib?n++:t instanceof io?s++:t instanceof ic?l++:t instanceof il?r++:i++}let h="";if(i>0&&(h+=i+" Parts "),s>0&&(h+=s+" Nodes "),n>0&&(h+=n+" Groups "),l>0&&(h+=l+" Links "),r>0&&(h+=r+" Adornments "),t>1){let t=this.Tt.iterator;for(;t.next();){let e=t.value;h+=`
    `+e.toString();let i=e.data;null!==i&&tu.us(i)&&(h+=" #"+tu.us(i)),e instanceof io?h+=" "+te.toString(i):e instanceof ic&&(h+=" "+te.toString(e.fromNode)+" "+te.toString(e.toNode))}}return e+" "+this.Tt.count+": "+h}findObjectAt(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=null),!1===this.$l)return null;let s=!1;null!==this.diagram&&this.diagram.viewportBounds.containsPoint(t)&&(s=!0);let n=ty.l(),l=this.Tt.r,r=l.length;for(let o=r;o--;){let r=l[o];if(!0===s&&!1===r.Fl()||!r.isVisible())continue;n.a(t),n.Be(r.Ys);let h=r.gL(n,e,i);if(null!==h&&(null!==e&&(h=e(h)),null!==h&&(null===i||i(h))))return ty.e(n),h}return ty.e(n),null}findObjectsAt(t,e,i,s){if(void 0===e&&(e=null),void 0===i&&(i=null),s instanceof th||s instanceof tu||(s=new tu),!1===this.$l)return s;let n=!1;null!==this.diagram&&this.diagram.viewportBounds.containsPoint(t)&&(n=!0);let l=ty.l(),r=this.Tt.r,o=r.length;for(let h=o;h--;){let o=r[h];if(!0===n&&!1===o.Fl()||!o.isVisible())continue;l.a(t),l.Be(o.Ys);let a=o;o.mL(l,e,i,s)&&(null!==e&&(a=e(a)),null!==a&&(null===i||i(a))&&s.add(a))}return ty.e(l),s}findObjectsIn(t,e,i,s,n){if(void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=!1),n instanceof th||n instanceof tu||(n=new tu),!1===this.$l)return n;let l=!1;null!==this.diagram&&this.diagram.viewportBounds.containsRect(t)&&(l=!0);let r=this.Tt.r,o=r.length;for(let h=o;h--;){let o=r[h];if(!0===l&&!1===o.Fl()||!o.isVisible())continue;let a=o;o.Om(t,e,i,s,n)&&(null!==e&&(a=e(a)),null!==a&&(null===i||i(a))&&n.add(a))}return n}LP(t,e,i,s,n,l,r){if(!1===this.$l)return n;let o=this.Tt.r,h=o.length;for(let a=h;a--;){let h=o[a];if(!0===r&&!1===h.Fl()||!l(h)||!h.isVisible())continue;let u=h;h.Om(t,e,i,s,n)&&(null!==e&&(u=e(u)),null!==u&&(null===i||i(u))&&n.add(u))}return n}findObjectsNear(t,e,i,s,n,l){if(void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=!0),!1!==n&&!0!==n&&((n instanceof th||n instanceof tu)&&(l=n),n=!0),l instanceof th||l instanceof tu||(l=new tu),!1===this.$l)return l;let r=!1;null!==this.diagram&&this.diagram.viewportBounds.containsPoint(t)&&(r=!0);let o=ty.l(),h=ty.l(),a=this.Tt.r,u=a.length;for(let d=u;d--;){let u=a[d];if(!0===r&&!1===u.Fl()||!u.isVisible())continue;o.a(t),o.Be(u.Ys),h.i(t.x+e,t.y),h.Be(u.Ys);let c=u;u.pL(o,h,i,s,n,l)&&(null!==i&&(c=i(c)),null!==c&&(null===s||s(c))&&l.add(c))}return ty.e(o),ty.e(h),l}zS(){return this.Tt.r}xs(t,e){if(!this.visible)return;let i=this.Tt.r,s=i.length;if(0===s)return;let n=te.rt(),l=te.rt();for(let t=0;t<s;t++){let s=i[t];if(s.XS=t,s instanceof ic){if(!1===s.Ce)continue}else if(s instanceof il&&null!==s.adornedPart)continue;let r=s.actualBounds;s.isVisible()&&r.intersectsRectPlus(e,10)?(s.xs(!0),n.push(s)):(s.xs(!1),null!==s.adornments&&s.adornments.count>0&&l.push(s))}for(let t=0;t<n.length;t++){let e=n[t];e.YS();let i=e.adornments;for(;i.next();){let t=i.value;t.ut(1/0,1/0),t.Yt(),t.xs(!0)}}for(let t=0;t<l.length;t++)l[t].YS();te.tt(n),te.tt(l)}Ru(t){let e=1;return 1!==this._t&&(e=t.globalAlpha,t.globalAlpha=e*this._t),e}yL(t,e){for(let i=0;i<e;i++)t[i].vu()}zi(t,e,i){if(!this.visible||0===this._t||(void 0===i&&(i=!0),!i&&this.isTemporary))return;let s=this.Tt.r,n=s.length;if(0===n)return;t.Ar&&this.yL(s,n);let l=this.Ru(t),r=this.Fu;r.length=0;let o=e.scale,h=tw.l();for(let i=0;i<n;i++){let n=s[i];this.Im(t,n,e,r,o,h,!0)}tw.e(h),t.Ar&&this.yL(s,n),t.globalAlpha=l}xE(t,e,i){if(!this.visible||0===this._t)return;let s=this.Tt.r,n=s.length;if(0===n)return;let l=this.Ru(t),r=this.Fu;r.length=0;let o=e.scale,h=tw.l();for(let l=0;l<n;l++){let n=s[l];i.has(n)||this.Im(t,n,e,r,o,h,!0)}tw.e(h),t.globalAlpha=l}EF(t,e,i,s){if(!this.visible||0===this._t||!s&&this.isTemporary)return;let n=this.Tt.r,l=n.length;if(0===l)return;let r=this.Ru(t),o=this.Fu;o.length=0;let h=e.scale,a=tw.l();for(let s=0;s<l;s++){let l=n[s];i.has(l)&&this.Im(t,l,e,o,h,a,!1)}tw.e(a),t.globalAlpha=r}BF(t,e,i,s,n){if(!this.visible||0===this.opacity)return;let l=this.diagram.grid.part;if(!s&&this.isTemporary){if(n&&l.layer===this){let e=this.Ru(t);l.zi(t,i),t.globalAlpha=e}}else{let e=this.Ru(t),s=i.scale,r=tw.l(),o=this.Tt.r,h=o.length;for(let e=0;e<h;e++){let h=o[e];(n||h!==l)&&this.Im(t,h,i,null,s,r,!1)}tw.e(r),t.globalAlpha=e}}bE(t,e,i){if(!this.visible||0===this._t)return;let s=this.Ru(t),n=this.Fu;n.length=0;let l=e.scale,r=tw.l(),o=this.Tt.r,h=o.length,a=i.length;for(let s=0;s<h;s++){let h=o[s],u=h.Qh(h.actualBounds);this.UF(u,i,a,l)&&this.Im(t,h,e,n,l,r,!0)}tw.e(r),t.globalAlpha=s}Im(t,e,i,s,n,l,r){if(r&&!e.Fl()||null!==s&&e instanceof ic&&(e.isOrthogonal&&s.push(e),!1===e.Ce)){t.removePartFromView(e);return}let o=!1,h=e.containingGroup;for(;null!==h;)o?null!==h.ri&&l.intersectRect(h.ri):null!==h.ri&&(o=!0,l.a(h.ri)),h=h.containingGroup;let a=e.actualBounds,u=!1;if(o&&e.isVisible()){if(!l.intersectsRect(a)){t.removePartFromView(e);return}u=!l.containsRect(a)}u&&(t.save(),t instanceof eM?t.partClipRect=l.copy():(t.beginPath(),t.rect(l.x,l.y,l.width,l.height),t.clip())),a.width*n>i.Em||a.height*n>i.Em?e.zi(t,i):this.VF(t,e,i),u&&(t.restore(),t.clearContextCache(!0))}VF(t,e,i){if(t instanceof eM){e.zi(t,i);return}let s=e.actualBounds,n=e.naturalBounds;if(0===s.width||0===s.height||isNaN(s.x)||isNaN(s.y)||!e.isVisible())return;let l=e.F;if(null===e.background){e.mn(t,"rgba(0,0,0,0.3)",!0,!1,n,s),t.fillRect(s.x,s.y,s.width,s.height);return}if(t.transform(l.m11,l.m12,l.m21,l.m22,l.dx,l.dy),e.mn(t,e.background,!0,!1,n,s),t.fillRect(0,0,n.width/2,n.height/2),!l.Ik()){let e=1/(l.m11*l.m22-l.m12*l.m21);t.transform(l.m22*e,-l.m12*e,-l.m21*e,l.m11*e,e*(l.m21*l.dy-l.m22*l.dx),e*(l.m12*l.dx-l.m11*l.dy))}}UF(t,e,i,s){let n=2/s,l=4/s;for(let s=0;s<i;s++){let i=e[s];if(0!==i.width&&0!==i.height&&t.intersects(i.x-n,i.y-n,i.width+l,i.height+l))return!0}return!1}t(t,e,i,s,n){let l=this.diagram;null!==l&&l.raiseChangedEvent(2,t,this,e,i,s,n)}_h(t,e,i){let s=this.Tt;if(e.VS(this),t>=s.count)t=s.count;else if(s.elt(t)===e)return -1;s.insertAt(t,e),e.Bm(i);let n=this.diagram;return null!==n&&(i?n.C():n._h(e)),this.mx(t,e),t}se(t,e,i){if(!i&&e.layer!==this&&null!==e.layer)return e.layer.se(t,e,i);let s=this.Tt;if(t<0||t>=s.length){if((t=s.indexOf(e))<0)return -1}else if(s.elt(t)!==e&&(t=s.indexOf(e))<0)return -1;e.Um(i),s.removeAt(t);let n=this.diagram;return null!==n&&(i?n.C():n.se(e)),e.VS(null),t}mx(t,e){t=this.zF(t,e),e instanceof ib&&this.XF(t,e),null!==e.svg&&e.svg.remove()}zF(t,e){let i=e.zOrder;if(isNaN(i))return t;let s=this.Tt,n=s.count;if(n<=1)return t;if(t<0&&(t=s.indexOf(e)),t<0)return -1;let l=t-1,r=NaN;for(;l>=0&&isNaN(r=s.elt(l).zOrder);)l--;let o=t+1,h=NaN;for(;o<n&&isNaN(h=s.elt(o).zOrder);)o++;if(!isNaN(r)&&r>i)for(;;){if(-1===l||r<=i)return++l===t?t:(s.removeAt(t),s.insertAt(l,e),l);for(r=NaN;--l>=0&&isNaN(r=s.elt(l).zOrder););}else if(!isNaN(h)&&h<i)for(;;){if(o===n||h>=i)return--o===t?t:(s.removeAt(t),s.insertAt(o,e),o);for(h=NaN;++o<n&&isNaN(h=s.elt(o).zOrder););}return t}XF(t,e){if(null===e||!isNaN(e.zOrder))return;this.YF(t,e);let i=e.containingGroup;null!==i&&this.mx(-1,i)}YF(t,e){if(0===e.memberParts.count)return;let i=-1,s=this.Tt.r,n=s.length;for(let l=0;l<n;l++){let n=s[l];if(n===e&&(t=l,i>=0)||i<0&&n.containingGroup===e&&(i=l,t>=0))break}if(!(i<0)&&i<t){let s=this.Tt;s.removeAt(t),s.insertAt(i,e)}}get parts(){return this.Tt.iterator}get partsBackwards(){return this.Tt.iteratorBackwards}get diagram(){return this.L}get name(){return this.Nt}set name(t){te.s(t,"string",es,"name");let e=this.Nt;if(e!==t){let i=this.diagram;if(null!==i){""===e&&te.o("Cannot rename default Layer to: "+t);let s=i.layers;for(;s.next();)s.value.name===t&&te.o("Layer.name is already present in this diagram: "+t)}this.Nt=t,this.t("name",e,t);let s=this.Tt.iterator;for(;s.next();)s.value.layerName=this.Nt}}get opacity(){return this._t}set opacity(t){let e=this._t;if(e!==t){te.s(t,"number",es,"opacity"),(t<0||t>1)&&te._(t,"0 <= value <= 1",es,"opacity"),this._t=t;let i=this.diagram;null!==i&&i.C(),this.t("opacity",e,t)}}get isViewportAligned(){return this.vm}set isViewportAligned(t){let e=this.vm;e!==t&&(this.vm=t,this.diagram&&(this.wL(),this.diagram.C()),this.t("isViewportAligned",e,t),t&&(this.isInDocumentBounds=!1))}wL(){if(!this.vm)return;let t=this.diagram,e=this.Tt.r,i=e.length,s=t.Pt,n=t.St;for(let l=0;l<i;l++){let i=e[l],r=i.naturalBounds.width,o=i.naturalBounds.height,h=i.alignment;(h.isDefault()||!h.isSpot())&&(h=tv.BottomRight);let a=i.alignmentFocus;a.isDefault()&&(a=new tv(h.x,h.y));let u=h.x*s+h.offsetX-(a.x*r+a.offsetX),d=h.y*n+h.offsetY-(a.y*o+a.offsetY),c=ty.X(u,d);t.KF(c),i.Cc(c.x,c.y,!0),ty.e(c),i.nt=1/t.scale}}get isTemporary(){return this.Ar}set isTemporary(t){let e=this.Ar;e!==t&&(te.s(t,"boolean",es,"isTemporary"),this.Ar=t,this.t("isTemporary",e,t))}get visible(){return this.Lc}set visible(t){let e=this.Lc;if(e!==t){te.s(t,"boolean",es,"visible"),this.Lc=t;let i=this.Tt.iterator;for(;i.next();)i.value.Vi(t);let s=this.diagram;null!==s&&s.C(),this.t("visible",e,t)}}get pickable(){return this.$l}set pickable(t){let e=this.$l;e!==t&&(te.s(t,"boolean",es,"pickable"),this.$l=t,this.t("pickable",e,t))}get isInDocumentBounds(){return this.gx}set isInDocumentBounds(t){let e=this.gx;e!==t&&(this.gx=t,null!==this.diagram&&this.diagram.invalidateDocumentBounds(),this.t("isInDocumentBounds",e,t))}get allowCopy(){return this.Ul}set allowCopy(t){let e=this.Ul;e!==t&&(te.s(t,"boolean",es,"allowCopy"),this.Ul=t,this.t("allowCopy",e,t))}get allowDelete(){return this.Vl}set allowDelete(t){let e=this.Vl;e!==t&&(te.s(t,"boolean",es,"allowDelete"),this.Vl=t,this.t("allowDelete",e,t))}get allowTextEdit(){return this.zl}set allowTextEdit(t){let e=this.zl;e!==t&&(te.s(t,"boolean",es,"allowTextEdit"),this.zl=t,this.t("allowTextEdit",e,t))}get allowGroup(){return this.Xl}set allowGroup(t){let e=this.Xl;e!==t&&(te.s(t,"boolean",es,"allowGroup"),this.Xl=t,this.t("allowGroup",e,t))}get allowUngroup(){return this.Yl}set allowUngroup(t){let e=this.Yl;e!==t&&(te.s(t,"boolean",es,"allowUngroup"),this.Yl=t,this.t("allowUngroup",e,t))}get allowLink(){return this.Kl}set allowLink(t){let e=this.Kl;e!==t&&(te.s(t,"boolean",es,"allowLink"),this.Kl=t,this.t("allowLink",e,t))}get allowRelink(){return this.Gl}set allowRelink(t){let e=this.Gl;e!==t&&(te.s(t,"boolean",es,"allowRelink"),this.Gl=t,this.t("allowRelink",e,t))}get allowMove(){return this.Hl}set allowMove(t){let e=this.Hl;e!==t&&(te.s(t,"boolean",es,"allowMove"),this.Hl=t,this.t("allowMove",e,t))}get allowReshape(){return this.jl}set allowReshape(t){let e=this.jl;e!==t&&(te.s(t,"boolean",es,"allowReshape"),this.jl=t,this.t("allowReshape",e,t))}get allowResize(){return this.ql}set allowResize(t){let e=this.ql;e!==t&&(te.s(t,"boolean",es,"allowResize"),this.ql=t,this.t("allowResize",e,t))}get allowRotate(){return this.Wl}set allowRotate(t){let e=this.Wl;e!==t&&(te.s(t,"boolean",es,"allowRotate"),this.Wl=t,this.t("allowRotate",e,t))}get allowSelect(){return this.Jl}set allowSelect(t){let e=this.Jl;e!==t&&(te.s(t,"boolean",es,"allowSelect"),this.Jl=t,this.t("allowSelect",e,t))}}var en=((g=en||{})[g.None=1]="None",g[g.Uniform=2]="Uniform",g[g.UniformToFill=3]="UniformToFill",g),el=((f=el||{})[f.All=1]="All",f[f.NotDirected=2]="NotDirected",f[f.NotDirectedFast=3]="NotDirectedFast",f[f.NotUndirected=4]="NotUndirected",f[f.DestinationTree=5]="DestinationTree",f[f.SourceTree=6]="SourceTree",f),er=((m=er||{})[m.Document=1]="Document",m[m.Infinite=2]="Infinite",m),eo=((p=eo||{})[p.TreeParent=1]="TreeParent",p[p.AllParents=2]="AllParents",p[p.AnyParents=3]="AnyParents",p);class eh{ps;Zt;KS;px;Tr;Ou;yx;wx;xx;bx;kx;Px;ta;Zh;Sx;Mx;Nx;Zl;Bc;Dr;Vm;Cx;Lx;Iu;Zn;Fr;ia;Oo;zm;Uc;Xm;Vc;Eu;Rr;Qn;GS;HS;Ax;Tx;jS;Dx;qS;WS;JS;Fx;Ym;vr;Or;Ir;Er;Br;Ur;Rx;Vr;vx;zr;Xr;Yr;Kr;Ox;$S;Io;ZS;Ix;Ex;QS;Mi;_S;tM;iM;Vs;Eo;Bi;Bx;Ul;Vl;Ux;Vx;zl;Xl;Yl;zx;Kl;Gl;Hl;jl;ql;Wl;Jl;Xx;Yx;eM;Bu;Uu;Kx;Gx;Hx;jx;Km;qx;Wx;Jx;ti;sM;$x;nM;Vu;pn;_n;ne;to;xL;Ql;oM;rM;Gm;Zx;zu;Hm;Qx;Gr;_l;ea;lM;hM;jm;_x;tb;ts;Xu;qm;Yu;th;zc;Wm;Hr;sa;aM;Jm;Jt;F;ze;Cr;Xi;bs;cM;ih;jr;Cl;qr;na;Xc;fM;Ku;oa;Gu;Gt;eh;dt;nt;Hu;Pt;St;mt;Yc;Iw;ib;ra;Kc;eb;sb;nb;GF;HF;Yi;Al;Em;$m;uM;dM;bL;Zm;jF;qF;WF;ob;JF;$F;ZF;la;kL;sh;ha;aa;ca;fa;bu;Jh;ii;Ct;Gc;Jk;$k;xc;_t;static rb=null;static PL=new tp;static gM;static mM=null;xu;lb;hb;ab;cb;fb;Qm;pM;_m;t0;i0;tx;yM;wM;Hc;constructor(t,e){if(eh.uw||(eh.Ek(),eh.uw=!0),tu.qi(this),eh.SL(this),this.Jt=!0,this.Ct=null,this.Pt=0,this.St=0,this.mt=null,eh.isUsingDOM()){let t=this,e=()=>{t.Ni(tt.document,"DOMContentLoaded",e,!1),t.setRTL()};null!==tt.document.body?this.setRTL():t.Xt(tt.document,"DOMContentLoaded",e,!1)}this.Yc=null,eh.xM("Model",iA);let i=this;return this._S=t=>i.partManager.doModelDataChanged(t),this.tM=t=>i.partManager.doModelChanged(t),this.eb=null,this.sb=null,this.ML(),this.model=iE.bM(),this.themeManager=new sd,this.Io=!0,this.NL(),this.layout=new ik,this.Io=!1,this.jF=null,this.qF=null,this.WF=null,this.ob=null,this.JF=null,this.$F=null,this.ZF=null,this.la=null,this.kL=null,this.sh=null,this.ha=null,this.aa=null,this.ca=null,this.fa=null,this.bu=()=>{},this.Jh=null,this.Yu=!1,this.Gc=new ea(this),void 0!==t&&("string"==typeof t||tt.Element&&t instanceof Element?this.kM(t):e=t),e&&this.setProperties(e),this.Jt=!1,this.requestUpdate(),this}hF(){return null!==this.mt}get renderer(){return this.zc}set renderer(t){if(this instanceof ef)return;""===t&&(t="default");let e=t.toLowerCase();if(e===this.zc)return;this.zc=e;let i=null;"default"===e||"canvas"===e?(null!==(i=this.th.get("svg"))&&i.Rt.remove(),this.mt&&(this.ii=this.mt.ci),this.ii.clearContextCache(!0)):"svg"===e?(this.th.has("svg")?i=this.th.get("svg"):(i=new eS(this,tt.document),this.addRenderer("svg",i)),null!==this.div&&this.div.appendChild(i.Rt),this.ii=i.ci,this.mt&&(this.mt.ci.setTransform(this.Yi,0,0,this.Yi,0,0),this.mt.ci.clearRect(0,0,this.Pt,this.St))):"debug"===e&&(this.th.has("SVG")||(i=new eS(this,tt.document),this.addRenderer("SVG",i),i.Rt.style.backgroundColor="whitesmoke",null!==this.div&&this.div.after(i.Rt))),this.Jt||this.redraw()}ML(){this.Hc=new th,this.setupRouters(),this.ps=new t9,this.ps.Ro(this),this.Zt=17,this.KS=!1,this.Hu=!1,this.px="default",this.Gt=new th,this.th=new tp,this.zc="default",this.resetRenderingHints(),this.QF(),this._t=1,this.dt=new ty(NaN,NaN).u(),this.tx=new ty(NaN,NaN),this.nt=1,this.Jm=1,this.yx=new ty(NaN,NaN).u(),this.wx=NaN,this.xx=1e-4,this.bx=100,this.F=new tk,this.kx=new ty(NaN,NaN).u(),this.Px=new tw(NaN,NaN,NaN,NaN).u(),this.ta=new tb(0,0,0,0).u(),this.Zh=1,this.Sx=!1,this.Mx=null,this.Nx=null,this.Zl=1,this.Bc=tv.Default,this.Dr=1,this.Vm=tv.Default,this.Cx=tv.None,this.Lx=tv.None,this.ze=!0,this.Iu=!1,this.Zn=new Set,this.Fr=new tu,this.ia=new tu,this.Oo=!1,this.eh=new tp,this.Ku=!0,this.zm=250,this.Uc=-1,this.Xm=new tb(16,16,16,16).u(),this.Cr=!1,this.Vc=!1,this.Eu=!0,this.Wm=new tA,this.Wm.diagram=this,this.Hr=new tA,this.Hr.diagram=this,this.sa=new tA,this.sa.diagram=this,this.Rr=null,this.Qn=null,this.Iw=!1,this._F(),this.qr=new tu,this.Ax=!0,this.Tx=1,this.jS=!1,this.Dx=1,this.Fx="auto",this.Ym="auto",this.vr=null,this.Or=null,this.Ir=null,this.Er=null,this.Br=null,this.Ur=null,this.Rx=null,this.Vr=null,this.vx=!1,this.zr=null,this.Xr=null,this.Yr=null,this.Kr=null,this.Ox=!1,this.ib={},this.ra=[null,null],this.Io=!1,this.ZS=!1,this.Ix=!1,this.Ex=!1,this.QS=!0,this.bs=!1,this.oa=!1,this.iM=!0,this.Vs=-2,this.ih=new tp,this.Gu=new th,this.Eo=!1,this.Bi=!0,this.Bx=!0,this.Ul=!0,this.Vl=!0,this.Ux=!1,this.Vx=!0,this.zl=!0,this.Xl=!0,this.Yl=!0,this.zx=!0,this.Kl=!0,this.Gl=!0,this.Hl=!0,this.jl=!0,this.ql=!0,this.Wl=!0,this.Jl=!0,this.Xx=!0,this.Yx=!0,this.eM=!1,this.Kc=!1,this.Bu=!0,this.Uu=!0,this.Kx=!0,this.Gx=!0,this.Hx=16,this.jx=16,this.Km=!1,this.qx=!1,this.Wx=0,this.Jx=0,this.ti=new tb(5).u(),this.sM=new tu().u(),this.$x=0x3b9ac9ff,this.nM=new tu().u(),this.na=!0,this.Vu=!0,this.Xc=!0,this.pn=!1,this._n=!1,this.jr=!0,this.Cl=!1,this.to=!1,this.xL=new tu,this.fM=new tu,this.Ql=null,this.oM=new tx(8,8),this.rM=999,this.Gm=!1,this.Jk=1,this.$k=0,this.Xi={scale:1,position:new ty,bounds:new tw,canvasSize:new tx,newCanvasSize:new tx,isScroll:!1},this.Xi.canvasSize=this.Xi.canvasSize,this.Xi.newCanvasSize=this.Xi.newCanvasSize,this.Xi.isScroll=!1,this.Zx=new tw(NaN,NaN,NaN,NaN).u(),this.zu=new tx(NaN,NaN).u(),this.Hm=new tw(NaN,NaN,NaN,NaN).u(),this.Qx=!1,this.tR(),this.ts=null,this.Xu=!1,this.xc=null,this.partManager=new iA,this.toolManager=new tz,this.toolManager.initializeStandardTools(),this.defaultTool=this.toolManager,this.currentTool=this.defaultTool,this.hb=null,this.ab=new ec,this.cb=null,this.fb=null,this.lb=!1,this.xu=!1,this.commandHandler=new ep,this.t0=null,this.i0=ty.Ak,this.yM=!1,this.Yi=1,this.Al=null,this.Em=1,this.Qm=0,this.pM=[0,0,0,0,0],this._m=0,this.$m=1,this.uM=0,this.dM=new ty,this.bL=500,this.qm=new ty,this.Zm=!1}static CL=void 0!==tt.document;static isUsingDOM(){return eh.CL}static useDOM(t){eh.CL=!!t&&void 0!==tt.document}static is=new WeakMap;clear(){this.animationManager.stopAnimation(),this.model.clear(),eh.LL(),this.AL(!1),this.Gu.clear(),this.TL(),this.Ql=null,this.invalidateDocumentBounds(),this.ensureBounds(),this.C()}AL(t){this.animationManager.stopAnimation(!0),this.sM=new tu().u(),this.nM=new tu().u();let e=this.skipsUndoManager,i=null!==this.Mi&&void 0!==this.Mi;i&&(this.skipsUndoManager=!0);let s=null;null!==this.ts&&null!==(s=this.ts.part)&&this.remove(s);let n=[],l=this.Gt.length;if(t){for(let t=0;t<l;t++){let e=this.Gt.r[t].parts;for(;e.next();){let t=e.value;t!==s&&null===t.data&&n.push(t)}}for(let t=0;t<n.length;t++){let e=n[t];this.remove(e)}}for(let t=0;t<l;t++)this.Gt.r[t].IF();return this.partManager.clear(),this.Zn.clear(),this.Fr.clear(),this.ia.clear(),this.eh.clear(),this.qr.clear(),this.xc=null,this.Gu.clear(),this.TL(),te.Ck=[],null!==s&&(this.add(s),this.partManager.parts.delete(s)),i&&(this.skipsUndoManager=e),n}static e0=null;static ub="";static LL(){eh.e0=null,eh.ub=""}static kE(){return null}reset(){this.clear(),this.Jt=!0,this.ML(),this.themeManager=new sd,this.nh(),this.Io=!0,this.NL(),this.layout=new ik,this.Io=!1,this.model=iE.bM(),this.model.undoManager=new tB,this.Yu=!1,this.Jt=!1,this.C()}tR(){this.Gr=new tp,this.lM=new io().add(new e3({stroke:"black",font:"10pt sans-serif"}).bind("text","",te.toString).theme("stroke","text").theme("font","normal")),this.Gr.set("",this.lM),this.Gr.set("Comment",new io().add(new e3({stroke:"brown",font:"10pt sans-serif"}).bind("text","",te.toString).theme("stroke","comment").theme("font","normal"))),this.Gr.set("LinkLabel",new io({selectable:!1,avoidable:!1}).add(new e$("Ellipse",{fill:"black",stroke:null,desiredSize:new tx(3,3).it()}).theme("fill","link"))),this.ea=new tp,this.cM=new ib(eq.Vertical,{selectionObjectName:"GROUPPANEL"}).add(new e3({stroke:"black",font:"bold 12pt sans-serif"}).bind("text","",te.toString).theme("stroke","text").theme("font","bold"),new eq(eq.Auto,{name:"GROUPPPANEL"}).add(new e$({fill:"rgba(128,128,128,0.2)",stroke:"black",strokeWidth:1}).theme("fill","group").theme("stroke","outline").theme("strokeWidth","group"),new iv({padding:5}).theme("padding","group"))),this.ea.set("",this.cM),this._l=new tp,this.hM=new ic().add(new e$({isPanelMain:!0,stroke:"black"}).theme("stroke","link"),new e$({toArrow:"Standard",fill:"black",stroke:null,strokeWidth:0}).theme("toArrow").theme("fill","link")),this._l.set("",this.hM),this._l.set("Comment",new ic().add(new e$({isPanelMain:!0,stroke:"brown"}).theme("stroke","comment"))),this.jm=new il(eq.Auto).add(new e$({fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"),new iv({margin:1.5}).theme("margin","selection","numbers",null,t=>t?new tb(t/2):1.5)),this._x=this.jm,this.tb=new il(eq.Link).add(new e$({isPanelMain:!0,fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"))}setRTL(t){let e=void 0===t?this.div:t;null===e&&(e=tt.document.body);let i=te.fs("div");i.dir="rtl",i.style.cssText="font-size: 14px; width: 1px; height: 1px; position: absolute; top: -1000px; overflow: scroll;",i.textContent="A",e.appendChild(i);let s="reverse";i.scrollLeft>0?s="default":(i.scrollLeft=1,0===i.scrollLeft&&(s="negative")),e.removeChild(i),this.px=s}setScrollWidth(t){let e=void 0===t?this.div:t;null===e&&(e=tt.document.body);let i=0;if(eh.isUsingDOM()){let t=eh.mM,s=eh.gM;null===t&&(eh.mM=te.fs("p"),(t=eh.mM).style.width="100%",t.style.height="200px",t.style.boxSizing="content-box",eh.gM=te.fs("div"),(s=eh.gM).style.position="absolute",s.style.visibility="hidden",s.style.width="200px",s.style.height="150px",s.style.boxSizing="content-box",s.appendChild(t)),s.style.overflow="hidden",e.appendChild(s);let n=t.offsetWidth;s.style.overflow="scroll";let l=t.offsetWidth;n===l&&(l=s.clientWidth),e.removeChild(s),0!=(i=n-l)||te.hr||(i=11)}this.Zt=i,this.KS=!0}hi(t){t in en?this.autoScale=t:te.cr(this,t)}toString(t){void 0===t&&(t=0);let e="";this.div&&this.div.id&&(e=this.div.id);let i='Diagram "'+e+'"';if(t<=0)return i;let s=this.Gt.iterator;for(;s.next();)i+=`
  `+s.value.toString(t-1);return i}static SL(t){eh.rb=t}static ym(){return eh.rb}static fromDiv(t){let e=t;if("string"==typeof t&&(e=tt.document.getElementById(t)),e instanceof HTMLDivElement){let t=eh.is.get(e);if(t)return t}return null}get div(){return this.Ct}set div(t){if(this.Ct!==t){let e=this.Ct;if(null!==e){if(eh.is.delete(e),e.goDiagram=void 0,e.go=void 0,e.innerHTML="",null!==this.mt){let t=this.mt.Rt;this.Ni(t,"pointermove",this.ha,!1),this.Ni(t,"pointerdown",this.sh,!1),this.Ni(t,"pointerup",this.aa,!1),this.Ni(t,"pointerout",this.ca,!1),this.Ni(t,"pointercancel",this.fa,!1),this.mt.dispose()}this.Yc&&(this.Yc.disconnect(),this.Yc=null);let t=this.toolManager;null!==t&&(t.mouseDownTools.each(t=>t.cancelWaitAfter()),t.mouseMoveTools.each(t=>t.cancelWaitAfter()),t.mouseUpTools.each(t=>t.cancelWaitAfter())),t.cancelWaitAfter(),this.currentTool.doCancel(),this.mt=null,this.Ni(tt,"resize",this.ob,!1),this.Ni(tt,"wheel",this.la,!0),eh.ym()===this&&eh.SL(null)}else null===this.sh&&(this.to=!1);if(this.Ct=null,null!==t){let e=eh.is.get(t);e&&(e.div=null),this.kM(t),this.bu(),this.themeManager&&this.themeManager.iR()}else this.themeManager&&this.themeManager.eR()}}setupRouters(){this.Hc.push(new sg)}kM(t){let e=this;if(!eh.isUsingDOM())return;null==t&&te.o("Diagram setup requires an argument DIV."),null!==e.Ct&&te.o("Diagram has already completed setup."),"string"==typeof t?e.Ct=tt.document.getElementById(t):t instanceof HTMLDivElement?e.Ct=t:te.o("No DIV or DIV id supplied: "+t),null===e.Ct&&te.o("Invalid DIV id; could not get element with id: "+t);let i=eh.is.get(e.Ct);if(i&&i!==this&&te.o("Invalid div id; div already has a Diagram associated with it."),!e.Yc&&tt.ResizeObserver){let t=tt.ResizeObserver,i=te.Nk(()=>e.requestUpdate(),250,!1);e.Yc=new t(()=>i()),e.Yc.observe(e.Ct)}"static"===tt.getComputedStyle(e.Ct,null).position&&(e.Ct.style.position="relative");let s=5;s--,e.Ct.style["-webkit-tap-highlight-color"]="rgba(255, 255, 255, 0)",e.Ct.innerHTML="",eh.is.set(e.Ct,e),e.Ct.goDiagram=e,e.Ct.go=tt.go;let n=new eN(e);void 0!==n.style&&(n.style.position="absolute",n.style.top="0px",n.style.left="0px","rtl"===tt.getComputedStyle(e.Ct,null).getPropertyValue("direction")&&(e.Hu=!0),n.style.zIndex="2",n.style.userSelect="none",n.style.MozUserSelect="none",n.style.touchAction="none",n.style.letterSpacing="normal !important",n.style.wordSpacing="normal !important",n.style.lang="unknown"),e.mt=n,e.ii=n.ci;let l=e.ii;e.Yi=e.computePixelRatio(),e.viewSize.isReal()||(e.Pt=e.Ct.clientWidth||1,e.St=e.Ct.clientHeight||1),e.DL(e.Pt,e.St),e.Ct.insertBefore(n.Rt,e.Ct.firstChild);let r=new eN(null);if(r.width=1,r.height=1,e.GF=r,e.HF=r.ci,eh.isUsingDOM()){let t=te.fs("div"),i=te.fs("div");t.style.position="absolute",t.style.overflow="auto",t.style.width=e.Pt+"px",t.style.height=e.St+"px",t.style.zIndex="1",i.style.position="absolute",i.style.width="1px",i.style.height="1px",e.Ct.appendChild(t),t.appendChild(i),t.onscroll=eh.sR,t.addEventListener("pointerdown",eh.nR),t.L=e,t.oR=!0,t.rR=!0,e.eb=t,e.sb=i}if(e.bu=te.Nk(()=>{e.Al=null,e.C()},300,!1),e.ob=te.Nk(()=>{e.AS()},250,!1),e.Jh=t=>(t.preventDefault(),!1),e.la=t=>{if(!e.isEnabled)return;let i=e.jc(t,!0);i.bubbles=!0;let s=0,n=0;i.delta=0,void 0!==t.deltaX?(0!==t.deltaX&&(s=t.deltaX>0?1:-1),0!==t.deltaY&&(n=t.deltaY>0?1:-1),i.delta=Math.abs(t.deltaX)>Math.abs(t.deltaY)?-s:-n):void 0!==t.wheelDeltaX?(0!==t.wheelDeltaX&&(s=t.wheelDeltaX>0?-1:1),0!==t.wheelDeltaY&&(n=t.wheelDeltaY>0?-1:1),i.delta=Math.abs(t.wheelDeltaX)>Math.abs(t.wheelDeltaY)?-s:-n):void 0!==t.wheelDelta&&0!==t.wheelDelta&&(i.delta=t.wheelDelta>0?1:-1),e.doMouseWheel(),e.ua(i,t)},e.kL=t=>{if(!e.isEnabled)return;e.Kc=!1,e.jc(t,!0);let i=e.currentTool;i.cancelWaitAfter(),i.standardMouseOver()},e.sh=t=>{if(!e.isEnabled)return;e.Kc=!0;let i=e.ib;void 0===i[t.pointerId]&&(i[t.pointerId]=t);let s=e.ra,n=!1;if(null!==s[0]&&(s[0].pointerId===t.pointerId||s[0].pointerType!==t.pointerType))s[0]=t;else if(null!==s[1]&&s[1].pointerId===t.pointerId)s[1]=t,n=!0;else if(null===s[0])s[0]=t;else if(null===s[1])s[1]=t,n=!0;else{t.preventDefault();return}let l="touch"===t.pointerType||"pen"===t.pointerType;l&&(e.Iw=!1,e.Zm=!0);let r=e.lR(t,t,n),o=e.dM,h=l?25:10;if(t.timeStamp-e.uM<e.bL&&!(Math.abs(o.x-t.screenX)>h||Math.abs(o.y-t.screenY)>h)?e.$m++:e.$m=1,r.clickCount=e.$m,e.uM=t.timeStamp,e.dM.setTo(t.screenX,t.screenY),e.doMouseDown(),1===t.button){t.preventDefault();return}e.ua(r,t)},e.ha=t=>{if(!e.isEnabled)return;e.Kc=!0;let i=e.ra;if(null!==i[0]&&(i[0].pointerId===t.pointerId||i[0].pointerType!==t.pointerType))i[0]=t;else if(null!==i[1]&&i[1].pointerId===t.pointerId){i[1]=t;return}else{if(null!==i[0])return;i[0]=t}if(i[0].pointerId!==t.pointerId)return;let s=e.hR(t,t,null!==i[1]);e.doMouseMove(),e.ua(s,t)},e.aa=t=>{if(!e.isEnabled)return;e.Kc=!0;let i="touch"===t.pointerType||"pen"===t.pointerType,s=e.ib;if(i&&e.Iw){delete s[t.pointerId],t.preventDefault();return}let n=e.ra;if(null!==n[0]&&(n[0].pointerId===t.pointerId||n[0].pointerType!==t.pointerType))n[0]=null;else{if(null===n[1]||n[1].pointerId!==t.pointerId)return;n[1]=null;return}let l=e.PM(t,!1,!0,!1,!0,!1),r=tt.document.elementFromPoint(t.clientX,t.clientY)||null;null!==r&&void 0!==r.shadowRoot&&null!==r.shadowRoot&&(r=r.shadowRoot.elementFromPoint(t.clientX,t.clientY)),null!==r&&r.L instanceof eh&&r.L!==e&&r.L.s0(t,l),null===r&&(r=t.target),e.s0(t,l),l.clickCount=e.$m,l.targetDiagram=e.db(t,r),l.targetObject=null,e.doMouseUp(),e.ua(l,t),i&&(e.Zm=!1)},e.ca=t=>{if(!e.isEnabled)return;e.Kc=!1;let i=e.ib;i[t.pointerId]&&delete i[t.pointerId];let s=e.ra;if(null!==s[0]&&s[0].pointerId===t.pointerId&&(s[0]=null),null!==s[1]&&s[1].pointerId===t.pointerId&&(s[1]=null),"touch"===t.pointerType||"pen"===t.pointerType)return;let n=e.currentTool;n.cancelWaitAfter(),n.standardMouseOver()},e.fa=t=>{let i=e.ra;null!==i[0]&&i[0].pointerId===t.pointerId?(i[0]=null,e.Zm=!1):null!==i[1]&&i[1].pointerId===t.pointerId&&(i[1]=null)},e.nb=l.U[te.Rs("7eba17a4ca3b1a8346")][te.Rs("78a118b7")](l.U,eh.ju,s,s),l.clearContextCache(!0),e.aR(),"svg"===this.zc){let t=this.th.get("svg");this.Ct&&this.Ct.appendChild(t.Rt),this.ii=t.ci}}addEventListener(t,e,i,s){t.addEventListener(e,i,{capture:s,passive:!1})}Xt(t,e,i,s){t.addEventListener(e,i,{capture:s,passive:!1})}removeEventListener(t,e,i,s){t.removeEventListener(e,i,{capture:s})}Ni(t,e,i,s){t.removeEventListener(e,i,{capture:s})}aR(){let t=this.mt.Rt;t instanceof HTMLCanvasElement||(t=this.div),this.Xt(t,"pointerdown",this.sh,!1),this.Xt(t,"pointermove",this.ha,!1),this.Xt(t,"pointerup",this.aa,!1),this.Xt(t,"pointerout",this.ca,!1),this.Xt(t,"pointercancel",this.fa,!1),this.Xt(t,"pointerenter",this.cR,!1),this.Xt(t,"pointerleave",this.fR,!1),this.Xt(t,"wheel",this.la,!1),this.Xt(t,"keydown",this.uR,!1),this.Xt(t,"keyup",this.dR,!1),this.Xt(t,"blur",this.gR,!1),this.Xt(t,"focus",this.mR,!1),this.Xt(t,"selectstart",t=>(t.preventDefault(),!1),!1),this.Xt(t,"contextmenu",t=>(t.preventDefault(),!1),!1),this.Xt(tt,"resize",this.ob,!1)}Ew(){this.Qm>30&&(this.Al=1)}xP(t){null!==this.Al&&(this.Al=null,t&&this.bu(),this.Qm=0,this.pM=[0,0,0,0,0],this._m=0)}computePixelRatio(){return null!==this.Al?this.Al:tt.devicePixelRatio||1}get avgSpf(){return this.Qm}doMouseDown(){this.currentTool.doMouseDown()}doMouseMove(){this.currentTool.doMouseMove()}doMouseUp(){this.currentTool.doMouseUp()}doMouseWheel(){this.currentTool.doMouseWheel()}doKeyDown(){this.currentTool.doKeyDown()}doKeyUp(){this.currentTool.doKeyUp()}doFocus(){this.focus()}focus(){if(this.mt){if(this.scrollsPageOnFocus)this.mt.focus();else{let t=tt.scrollX,e=tt.scrollY;this.mt.focus(),tt.scrollTo(t,e)}}}mR(t){let e=eh.is.get(this);e&&e.v("GainedFocus")}gR(t){let e=eh.is.get(this);e&&e.v("LostFocus")}AS(){if(null===this.mt)return;let t=this.Ct;if(null===t||0===t.clientWidth||0===t.clientHeight)return;this.KS||this.setScrollWidth();let e=this._n?this.Zt:0,i=this.pn?this.Zt:0,s=this.Yi;if(this.Yi=this.computePixelRatio(),this.Yi!==s&&(this.Iu=!0,this.requestUpdate()),t.clientWidth!==this.Pt+e||t.clientHeight!==this.St+i){this.da(),this.ze=!0;let t=this.layout;null!==t&&t.isViewportSized&&1===this.autoScale&&(this.Vc=!0,t.invalidateLayout()),this.bs||this.requestUpdate()}}NL(){let t=0,e=new es;e.name="Grid",e.allowSelect=!1,e.pickable=!1,e.isTemporary=!0,e.isInDocumentBounds=!1,this.Wr(e,t++),(e=new es).name="ViewportBackground",e.isViewportAligned=!0,e.isTemporary=!0,e.isInDocumentBounds=!1,this.Wr(e,t++),(e=new es).name="Background",this.Wr(e,t++),(e=new es).name="",this.Wr(e,t++),(e=new es).name="Foreground",this.Wr(e,t++),(e=new es).name="ViewportForeground",e.isViewportAligned=!0,e.isTemporary=!0,e.isInDocumentBounds=!1,this.Wr(e,t++),(e=new es).name="Adornment",e.isTemporary=!0,e.isInDocumentBounds=!1,this.Wr(e,t++),(e=new es).name="Tool",e.isTemporary=!0,e.isInDocumentBounds=!0,this.Wr(e,t++)}FL(){let t=new eq(eq.Grid,{name:"GRID"}).add(new e$("LineH",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new e$("LineV",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new e$("LineH",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new e$("LineV",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new e$("LineH",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor"),new e$("LineV",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor")),e=new ii({layerName:"Grid",zOrder:0,isInDocumentBounds:!1,isAnimated:!1,pickable:!1,locationObjectName:"GRID"}).add(t);return this.add(e),this.partManager.parts.delete(e),t.visible=!1,t}static sR(){let t=eh.is.get(this.parentElement||this);if(t){if(t.qx){t.qx=!1;return}if(!t.isEnabled){t.RL();return}t.diagramScroll(this)}}static nR(t){if(!this.L.isEnabled){this.L.updateScroll();return}this.L.Wx=t.target.scrollTop,this.L.Jx=t.target.scrollLeft}diagramScroll(t){if(null===this.mt)return;let e=this.eb,i=this.sb;this.Km=!0;let s=this.documentBounds,n=this.viewportBounds,l=this.ta,r=s.x-l.left,o=s.y-l.top,h=s.width+l.left+l.right,a=s.height+l.top+l.bottom,u=s.right+l.right,d=s.bottom+l.bottom,c=n.x,g=n.y,f=n.width,m=n.height,p=n.right,y=n.bottom,x=this.scale,w,b=t.scrollLeft;if(this.Hu)switch(this.px){case"negative":b=b+t.scrollWidth-t.clientWidth;break;case"reverse":b=t.scrollWidth-b-t.clientWidth}let v=b;if(f<h||m<a){w=ty.X(this.position.x,this.position.y),this.allowHorizontalScroll&&this.Jx!==v&&(w.x=v/x+r,this.Jx=v),this.allowVerticalScroll&&this.Wx!==t.scrollTop&&(w.y=t.scrollTop/x+o,this.Wx=t.scrollTop),this.position=w,ty.e(w),this.Km=!1,this.Vu=!1;return}if(w=ty.l(),t.oR&&this.allowHorizontalScroll&&(r<c&&(this.position=w.i(v+r,this.position.y)),u>p)){let t=e.scrollWidth-this.Pt;this.position=w.i(-t+v-this.Pt/x+u,this.position.y)}if(t.rR&&this.allowVerticalScroll&&(o<g&&(this.position=w.i(this.position.x,t.scrollTop+o)),d>y)){let i=e.scrollHeight-this.St;this.position=w.i(this.position.x,-i+t.scrollTop-this.St/x+d)}ty.e(w),this.oh(),this.Km=!1,this.Vu=!1,s=this.documentBounds,n=this.viewportBounds,u=s.right,p=n.right,d=s.bottom,y=n.bottom,r=s.x,c=n.x,o=s.y,g=n.y,f>=h&&r>=c&&u<=p&&(i.style.width="1px"),m>=a&&o>=g&&d<=y&&(i.style.height="1px")}computeBounds(t){return void 0===t&&(t=new tw),this.Li(),this.vL(t)}vL(t){if(this.fixedBounds.isReal())return t.a(this.fixedBounds),t.addMargin(this.ti),t;let e=!0,i=this.Gt.r,s=i.length;for(let n=0;n<s;n++){let s=i[n];if(!s.visible||!s.isInDocumentBounds)continue;let l=s.Tt.r,r=l.length;for(let i=0;i<r;i++){let s=l[i];if(!s.isInDocumentBounds||!s.isVisible())continue;let n=s.actualBounds;n.isReal()&&(e?(e=!1,t.a(n)):t.unionRect(n))}}return e&&t.i(0,0,0,0),t.addMargin(this.ti),t}computePartsBounds(t,e){void 0===e&&(e=!1);let i=null;if(Array.isArray(t))for(let s=0;s<t.length;s++){let n=t[s];!e&&n instanceof ic||(n.ensureBounds(),null===i?i=n.actualBounds.copy():i.unionRect(n.actualBounds))}else{let s=t.iterator;for(;s.next();){let t=s.value;!e&&t instanceof ic||(t.ensureBounds(),null===i?i=t.actualBounds.copy():i.unionRect(t.actualBounds))}}return null===i?new tw(NaN,NaN,0,0):i}Ks(t){if(!t&&!this.to||this.Jt||null===this.mt||!this.documentBounds.isReal())return;if(this.Jt=!0,t){let t=this.initialPosition;if(t.isReal()){this.Jt=!1,this.position=t;return}let e=this.initialDocumentSpot,i=this.initialViewportSpot;e.isNoSpot()&&(e=tv.TopLeft),i.isNoSpot()&&(i=tv.TopLeft);let s=ty.l();s.setRectSpot(this.documentBounds,e);let n=this.viewportBounds,l=tw.X(0,0,n.width,n.height),r=ty.l();r.setRectSpot(l,i),r.i(s.x-r.x,s.y-r.y),this.Jt=!1,this.position=r,tw.e(l),ty.e(r)}let e=this.Zl;t&&1!==this.Dr&&(e=this.Dr);let i=1!==e?this.qu(e):this.scale,s=this.dt.x,n=this.dt.y,l=this.Pt/i,r=this.St/i,o=this.Bc,h=this.Vm;if(t&&!o.isSpot()&&(h.isSpot()||h.isDefault())){let t=this.initialDocumentSpot.isSpot()&&this.initialViewportSpot.isSpot();o=h.isDefault()&&!t?tv.Center:h}this.SM(this.documentBounds,l,r,o,t);let a=this.scale;this.scale=i,this.Jt=!1;let u=this.viewportBounds;u.equalsApproxTo(s,n,l,r)||this.onViewportBoundsChanged(new tw(s,n,l,r),u,a,!1)}qu(t){let e=this.Jm;if(null===this.mt)return e;if(1===t)return this.scale;this.ensureBounds();let i=this.documentBounds;if(!i.isReal())return e;let s=i.width,n=i.height,l=this.Pt+(this._n?this.Zt:0),r=this.St+(this.pn?this.Zt:0),o=l/s,h=r/n,a=this.ta,u=a.left+a.right!==0,d=a.top+a.bottom!==0;(u||d)&&(h===o?(h=(r-this.Zt)/n,o=(l-this.Zt)/s):h>o?h=(r-this.Zt)/n:o=(l-this.Zt)/s);let c=0;return 2===t?c=Math.min(h,o):3===t&&(c=h>o?(r-this.Zt)/n:(l-this.Zt)/s),c>e&&(c=e),c<this.minScale&&(c=this.minScale),c>this.maxScale&&(c=this.maxScale),c}zoomToFit(){let t=this.Zh;this.Zh=1,this.scale=this.qu(2),this.alignDocument(tv.Center,tv.Center),1!==t&&(this.Ks(!1),this.SM(this.documentBounds,this.Pt/this.nt,this.St/this.nt,this.Bc,!1)),this.Zh=t}zoomToRect(t,e){void 0===e&&(e=2);let i=t.width,s=t.height;if(0===i||0===s||isNaN(i)&&isNaN(s))return;let n=1;if(2===e||3===e){if(isNaN(i))n=this.viewportBounds.height*this.scale/s;else if(isNaN(s))n=this.viewportBounds.width*this.scale/i;else{let t=this.Pt,l=this.St;n=3===e?l/s>t/i?(l-(this.pn?this.Zt:0))/s:(t-(this._n?this.Zt:0))/i:Math.min(l/s,t/i)}}this.scale=n,this.position=new ty(t.x,t.y)}get pR(){return this.Jt}set pR(t){this.Jt=t}alignDocument(t,e){this.ensureBounds();let i=this.documentBounds,s=this.viewportBounds;this.position=new ty(i.x+(t.x*i.width+t.offsetX)-(e.x*s.width-e.offsetX),i.y+(t.y*i.height+t.offsetY)-(e.y*s.height-e.offsetY))}focusObject(t){if(t instanceof eb){this.t0=t;let e=ty.l();this.i0=this.transformDocToView(t.getDocumentPoint(tv.TopLeft,e)),ty.e(e)}else this.t0=null,this.i0=ty.Ak}SM(t,e,i,s,n){let l=ty.X(this.dt.x,this.dt.y),r=l.x,o=l.y;if(null!==this.t0){let t=ty.l();r=(t=this.t0.getDocumentPoint(tv.TopLeft,t)).x-this.i0.x/this.scale,o=t.y-this.i0.y/this.scale,s=tv.None,ty.e(t)}if(n||1===this.scrollMode){s.isSpot()&&(e>t.width&&(r=t.x+(s.x*t.width+s.offsetX)-(s.x*e-s.offsetX)),i>t.height&&(o=t.y+(s.y*t.height+s.offsetY)-(s.y*i-s.offsetY)));let n=this.ta,l=e-t.width;if(e<t.width+n.left+n.right){let i=r+e/2;r=(i=Math.max(i=Math.min(i,t.right+Math.max(l,n.right)-e/2),t.left-Math.max(l,n.left)+e/2))-e/2}else r>t.left?r=t.left:r<t.right-e&&(r=t.right-e);let h=i-t.height;if(i<t.height+n.top+n.bottom){let e=o+i/2;o=(e=Math.max(e=Math.min(e,t.bottom+Math.max(h,n.bottom)-i/2),t.top-Math.max(h,n.top)+i/2))-i/2}else o>t.top?o=t.top:o<t.bottom-i&&(o=t.bottom-i)}if(l.x=isFinite(r)?r:-this.ti.left,l.y=isFinite(o)?o:-this.ti.top,null!==this.positionComputation){let t=this.positionComputation(this,l);l.x=t.x,l.y=t.y}this.ps.cL(this.dt,l),this.dt.i(l.x,l.y),this.gb(),this.nh(),this.yR(),ty.e(l)}findPartAt(t,e){if(void 0===e&&(e=!0),e){let e=this.MP(t,t=>t.part,t=>t.canSelect());if(e instanceof ii)return e}else{let e=this.MP(t,t=>t.part);if(e instanceof ii)return e}return null}findObjectAt(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),this.Li();let s=this.Gt.iteratorBackwards;for(;s.next();){let n=s.value;if(!n.visible)continue;let l=n.findObjectAt(t,e,i);if(null!==l)return l}return null}MP(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),this.Li();let s=this.Gt.iteratorBackwards;for(;s.next();){let n=s.value;if(!n.visible||n.isTemporary)continue;let l=n.findObjectAt(t,e,i);if(null!==l)return l}return null}findPartsAt(t,e,i){return void 0===e&&(e=!0),this.wR(t,t=>t.part,e?t=>t instanceof ii&&t.canSelect():null,i)}wR(t,e,i,s){void 0===e&&(e=null),void 0===i&&(i=null),s instanceof th||s instanceof tu||(s=new tu),this.Li();let n=this.Gt.iteratorBackwards;for(;n.next();){let l=n.value;!l.visible||l.isTemporary||l.findObjectsAt(t,e,i,s)}return s}findObjectsAt(t,e,i,s){void 0===e&&(e=null),void 0===i&&(i=null),s instanceof th||s instanceof tu||(s=new tu),this.Li();let n=this.Gt.iteratorBackwards;for(;n.next();){let l=n.value;l.visible&&l.findObjectsAt(t,e,i,s)}return s}findPartsIn(t,e,i,s){return void 0===e&&(e=!1),void 0===i&&(i=!0),this.xR(t,null,t=>t instanceof ii&&(!i||t.canSelect()),e,s)}findObjectsIn(t,e,i,s,n){void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=!1),n instanceof th||n instanceof tu||(n=new tu),this.Li();let l=this.Gt.iteratorBackwards;for(;l.next();){let r=l.value;r.visible&&r.findObjectsIn(t,e,i,s,n)}return n}LP(t,e,i,s,n,l){let r=new tu;this.Li();let o=this.Gt.iteratorBackwards;for(;o.next();){let h=o.value;h.visible&&h.LP(t,e,i,s,r,n,l)}return r}xR(t,e,i,s,n){void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=!1),n instanceof th||n instanceof tu||(n=new tu),this.Li();let l=this.Gt.iteratorBackwards;for(;l.next();){let r=l.value;!r.visible||r.isTemporary||r.findObjectsIn(t,e,i,s,n)}return n}findPartsNear(t,e,i,s,n){return void 0===i&&(i=!0),void 0===s&&(s=!0),this.bR(t,e,null,t=>t instanceof ii&&(!s||t.canSelect()),i,n)}findObjectsNear(t,e,i,s,n,l){void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=!0),!1!==n&&!0!==n&&((n instanceof th||n instanceof tu)&&(l=n),n=!0),l instanceof th||l instanceof tu||(l=new tu),this.Li();let r=this.Gt.iteratorBackwards;for(;r.next();){let o=r.value;o.visible&&o.findObjectsNear(t,e,i,s,n,l)}return l}bR(t,e,i,s,n,l){void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=!0),!1!==n&&!0!==n&&((n instanceof th||n instanceof tu)&&(l=n),n=!0),l instanceof th||l instanceof tu||(l=new tu),this.Li();let r=this.Gt.iteratorBackwards;for(;r.next();){let o=r.value;!o.visible||o.isTemporary||o.findObjectsNear(t,e,i,s,n,l)}return l}acceptEvent(t){return this.jc(t,t instanceof MouseEvent)}jc(t,e){let i=this.Hr;this.Hr=this.sa,this.sa=i,i.diagram=this,i.event=t,e?this.s0(t,i):(i.viewPoint=this.Hr.viewPoint,i.documentPoint=this.Hr.documentPoint);let s=0;return t.ctrlKey&&(s+=1),t.altKey&&(s+=2),t.shiftKey&&(s+=4),t.metaKey&&(s+=8),i.modifiers=s,i.button=t.button,void 0!==t.buttons&&(i.buttons=t.buttons),te.hr&&0===t.button&&t.ctrlKey&&(i.button=2),i.down=!1,i.up=!1,i.clickCount=1,i.delta=0,i.handled=!1,i.bubbles=!1,i.timestamp=t.timeStamp,i.isMultiTouch=!1,i.targetDiagram=this.db(t,t.target),i.targetObject=null,i}db(t,e){if(null===e)return null;let i=eh.is.get(e);if(i)return i;let s=t.path;if(!s&&te.ot(t.composedPath)&&(s=t.composedPath()),s&&s[0]){let t=eh.is.get(s[0]);if(t)return t}return null}lR(t,e,i){let s=this.PM(t,!0,!1,!1,!0,i);return this.s0(e,s),s.targetDiagram=this.db(t,t.target),s.targetObject=null,i||s.clone(this.Wm),s}hR(t,e,i){let s=this.PM(t,!1,!1,!1,!1,i),n=tt.document.elementFromPoint(e.clientX,e.clientY)||null;null!==n&&void 0!==n.shadowRoot&&null!==n.shadowRoot&&(n=n.shadowRoot.elementFromPoint(e.clientX,e.clientY));let l=this,r=t;if(n){let i=this.db(t,n);i&&(r=e,l=i)}return s.targetDiagram=l,this.s0(r,s),s.targetObject=null,s}PM(t,e,i,s,n,l){let r=this.Hr;this.Hr=this.sa,this.sa=r,r.diagram=this,r.clickCount=1,r.delta=0;let o=0;return t.ctrlKey&&(o+=1),t.altKey&&(o+=2),t.shiftKey&&(o+=4),t.metaKey&&(o+=8),r.modifiers=o,r.event=t,r.timestamp=t.timeStamp,r.button=i?this.firstInput.button:t.button,r.buttons=t.buttons,te.hr&&0===t.button&&t.ctrlKey&&(r.button=2),r.down=e,r.up=i,r.handled=s,r.bubbles=n,r.isMultiTouch=l,r}ua(t,e){return!!t.bubbles||(void 0!==e.stopPropagation&&e.stopPropagation(),!1!==e.cancelable&&e.preventDefault(),e.cancelBubble=!0,!1)}uR(t){let e=eh.is.get(this);if(!e||!e.isEnabled)return!1;let i=e.jc(t,!1);return i.key=t.key,i.code=t.code,i.down=!0,e.doKeyDown(),e.ua(i,t)}dR(t){let e=eh.is.get(this);if(!e||!e.isEnabled)return!1;let i=e.jc(t,!1);return i.key=t.key,i.code=t.code,i.up=!0,e.doKeyUp(),e.ua(i,t)}cR(t){let e=eh.is.get(this);if(!e||!e.isEnabled)return!1;let i=e.jc(t,!0);return null!==e.mouseEnter&&e.mouseEnter(i),e.currentTool.standardMouseOver(),e.ua(i,t)}fR(t){let e=eh.is.get(this);if(!e||!e.isEnabled)return!1;let i=e.jc(t,!0);return null!==e.mouseLeave&&e.mouseLeave(i),e.ua(i,t)}getMouse(t){let e=this.mt;if(null===e)return new ty(0,0);let i=e.getBoundingClientRect();return new ty((t.clientX-i.left)*(this.Pt/i.width),(t.clientY-i.top)*(this.St/i.height)).Be(this.F)}s0(t,e){let i=this.mt,s=0,n=0;if(null!==i){let e=i.getBoundingClientRect();s=(t.clientX-e.left)*(this.Pt/e.width),n=(t.clientY-e.top)*(this.St/e.height)}e.viewPoint.i(s,n);let l=ty.X(s,n);this.F._e(l),e.documentPoint.a(l),ty.e(l)}RC(t,e,i){let s;if(null===this.ra[0])return;s=this.ra[e];let n=this.mt;if(null!==n){let t=n.getBoundingClientRect();i.i((s.clientX-t.left)*(this.Pt/t.width),(s.clientY-t.top)*(this.St/t.height))}}invalidateDocumentBounds(){this.na||(this.na=!0,this.requestUpdate(!1))}kR(){this.bs||this.Li(),this.ensureBounds()}redraw(){this.Jt||this.bs||(this.C(),this.maybeUpdate())}isUpdateRequested(){return this.Cr}delayInitialization(t){void 0===t&&(t=null);let e=this.animationManager,i=e.isEnabled;e.stopAnimation(),e.isEnabled=!1,this.br(),this.to=!1,this.tx=new ty(NaN,NaN),e.isEnabled=i,this.bs=!0;let s=this;null!==t&&te.ar(()=>{s.bs=!1,e.Bl("Model"),t(s)},1)}requestUpdate(t){if(void 0===t&&(t=!1),!0===this.Cr||this.Jt||!1===t&&this.bs)return;this.Cr=!0;let e=this;tt.requestAnimationFrame(()=>{e.Cr&&e.maybeUpdate()})}maybeUpdate(){this.Eu&&!this.Cr||(this.Eu&&(this.Eu=!1),this.br())}MM(t,e){!this.Vu||this.Jt||this.animationManager.defaultAnimation.isAnimating||this.RL()||(t&&this.Li(),e&&this.Ks(!1))}br(t){if(this.bs||(this.Cr=!1,null===this.Ct&&!this.zu.isReal()))return;this.bs=!0;let e=this.animationManager,i=this.Gu;if(!e.isAnimating&&0!==i.length){let t=i.r,e=t.length;for(let i=0;i<e;i++){let e=t[i];e.me(!1),e.c()}i.clear()}let s=this.fM;s.count>0&&(s.each(t=>t.NM()),s.clear());let n=!1,l=!1;e.defaultAnimation.isAnimating&&(l=!0,n=this.skipsUndoManager,this.skipsUndoManager=!0),e.xi||this.AS(),t||this.MM(!1,!0);let r=!this.undoManager.isUndoingRedoing&&(this.Cl||0!==this.Hc.count&&0!==this.Fr.size),o=!this.to||this.jr;this.Li(!0);let h=!1;(o||r)&&(this.to?this.CM(!this.Vc,r):(this.startTransaction("Initial Layout"),!1===e.isEnabled&&e.stopAnimation(),this.CM(!1,r)),h=o),this.Vc=!1,this.Cl=!1,this.Li(),null!==this.ts&&(this.ts.visible&&!this.Xu&&(this.rh(),this.Xu=!0),!this.ts.visible&&this.Xu&&(this.Xu=!1)),this.Ix||this.kR(),t||this.MM(!0,!1);let a=!1;if(h){let e=tw.l();e.a(this.viewportBounds),this.to||(this.to=!0,a=!0,this.skipsUndoManager||(this.undoManager.vw=!0),this.undoManager.Ow=!0,this.PR()),this.SR(),this.Li(!1),t||this.MM(!0,!0),tw.e(e)}else if(e.Tc&&e._w){if(1!==this.Dr)this.scale=this.qu(this.Dr);else if(1!==this.Zl)this.scale=this.qu(this.Zl);else{let t=this.initialScale;isFinite(t)&&t>0&&(this.scale=t)}this.Ks(!0)}h&&a&&this.commitTransaction("Initial Layout"),t||this.zi(this.ii),l&&(this.skipsUndoManager=n),this.bs=!1}get Kh(){return this.to}PR(){if(1!==this.Dr)this.scale=this.qu(this.Dr);else if(1!==this.Zl)this.scale=this.qu(this.Zl);else{let t=this.initialScale;isFinite(t)&&t>0&&(this.scale=t)}this.Ks(!0);let t=this.Gt.r;this.xs(t,t.length,this,this.viewportBounds),this.v("InitialLayoutCompleted"),this.tx.a(this.dt),this.rh()}SR(){this.v("LayoutCompleted")}o0(t){this.Zn.add(t)}addInvalidRoute(t){this.Oo?this.ia.add(t):this.Fr.add(t)}Li(t){if(0!==this.Zn.size&&!(!this.bs&&this.animationManager.isTicking)){if(this.bs||(this.Cl=!0),t){this.OL(this.Zn);return}for(let t=0;t<23&&0!==this.Zn.size;t++){let t=new Set(this.Zn);this.Zn.clear(),this.NM(t,this.Zn)}this.nodes.each(t=>{t instanceof ib&&t.IL(!1)})}}OL(t,e){for(let i of t)!i.Me()||i instanceof ib||(i.Jr()?(i.ut(1/0,1/0),i.Yt()):e&&e.add(i));for(let e of t)if(e instanceof ib){if(!e.isVisible())continue;this.mb(e)}}NM(t,e){for(let i of(this.OL(t,e),t))i instanceof ic&&i.isVisible()&&(i.Jr()?(i.ut(1/0,1/0),i.Yt()):e.add(i));for(let i of t)i instanceof il&&i.isVisible()&&(i.Jr()?(i.ut(1/0,1/0),i.Yt()):e.add(i))}r0(t){let e=t instanceof eh,i=e?t.links:t.memberParts,s=this.Zn;if(e)this.Li(!0);else{for(;i.next();){let t=i.value;s.has(t)&&(!t.Me()||t instanceof ib||t.Jr()&&(t.ut(1/0,1/0),t.Yt()))}for(i.reset();i.next();){let t=i.value;if(s.has(t)&&t instanceof ib){if(!t.isVisible())continue;this.mb(t)}}i.reset()}for(;i.next();){let t=i.value;t instanceof ic&&s.has(t)&&t.isVisible()&&t.Jr()&&(t.ut(1/0,1/0),t.Yt())}}mb(t){let e=te.rt(),i=te.rt(),s=t.memberParts;for(;s.next();){let n=s.value;n.isVisible()&&(n instanceof ib?(n.Bo()||n.es()||n.lh())&&this.mb(n):n instanceof ic?n.fromNode===t||n.toNode===t?i.push(n):e.push(n):(n.ut(1/0,1/0),n.Yt()))}let n=e.length;for(let t=0;t<n;t++){let i=e[t];i.ut(1/0,1/0),i.Yt()}te.tt(e),t.ut(1/0,1/0),t.Yt(),n=i.length;for(let t=0;t<n;t++){let e=i[t];e.ut(1/0,1/0),e.Yt()}te.tt(i)}xs(t,e,i,s){if(!(!this.Xc&&!this.animationManager.isAnimating)){for(let n=0;n<e;n++)t[n].xs(i,s);this.Li()}}zi(t){null!==this.Ct&&(null===this.mt&&te.o("No canvas specified"),"svg"===this.zc?this.MR(t):this.NR(t))}NR(t){let e=this.animationManager;if(e.xi||e.isAnimating&&!e.isTicking)return;let i=new Date;if(this.l0(),this.Ct&&"0"===this.Ct.style.opacity)return;let s=t!==this.ii,n=this.Gt.r,l=n.length;if(this.xs(n,l,this,this.viewportBounds),s)t.clearContextCache(!0),this.oh();else if(!this.ze&&!e.isAnimating)return;let r=this.F,o=this.Yi;t.setTransform(o,0,0,o,0,0),t.clearRect(0,0,this.Pt,this.St),1!==this._t&&(t.globalAlpha=this._t),this.LM(t);for(let e=0;e<l;e++)t.setTransform(o,0,0,o,0,0),t.transform(r.m11,r.m12,r.m21,r.m22,r.dx,r.dy),t.commitTransform(),n[e].zi(t,this);let h=!1;this.Gc?this.Gc.ju(this)&&(h=this.nb()):h=!0,h&&(tk.prototype._e=tk.prototype.ww),s?(this.ii.clearContextCache(!0),this.oh()):(this.Xc=!1,this.ze=!1);let a=+new Date-+i,u=this.pM;if(null===this.Al){u[this._m]=a,this._m=(this._m+1)%u.length;let t=0;for(let e=0;e<u.length;e++)t+=u[e];this.Qm=t/u.length}1!==this._t&&(t.globalAlpha=1)}MR(t){if(null===this.Ct)return;let e=this.animationManager;if(e.xi||e.isAnimating&&!e.isTicking)return;this.l0();let i=this.Pt,s=this.St;t.surface.resize(i,s,i,s);let n=this.Gt.r,l=n.length;if(this.xs(n,l,this,this.viewportBounds),!this.ze&&!e.isAnimating)return;let r=this.F;t.lastDrawnPart=null,t.setDiagramPosScale(r.m11,r.m12,r.m21,r.m22,r.dx,r.dy),1!==this._t&&(t.globalAlpha=this._t),this.LM(t);let o=this.Yi;this.mt.ci.setTransform(o,0,0,o,0,0),this.mt.ci.clearRect(0,0,this.Pt,this.St);for(let e=0;e<l;e++)n[e].zi(t,this);let h=!1;this.Gc?this.Gc.ju(this)&&(h=this.nb()):h=!0,h&&(tk.prototype._e=tk.prototype.ww),this.Xc=!1,this.ze=!1}pb(t,e,i,s,n,l,r,o,h){if(null===this.Ct)return;null===this.mt&&te.o("No canvas specified"),void 0===l&&(l=null),void 0===r&&(r=null),void 0===o&&(o=!1),void 0===h&&(h=!1),this.l0(),this.ii.clearContextCache(!0),this.oh(),this.oa=!0;let a=this.nt;this.nt=s;let u=this.Gt.r,d=u.length;try{let a=new tw(n.x,n.y,i.width/s,i.height/s),c=a.copy();c.addMargin(e),this.rh(c),this.Li(),this.xs(u,d,this,a),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,i.width,i.height),null!==r&&""!==r&&(t.fillStyle=r,t.fillBackground(0,0,i.width,i.height));let g=this.Yi;t.scale(g,g);let f=tk.l();f.Ii(),f.Es(e.left,e.top),f.nt(s),(0!==n.x||0!==n.y)&&f.Es(-n.x,-n.y),t.setTransform(f.m11,f.m12,f.m21,f.m22,f.dx,f.dy),t.commitTransform(),t instanceof eM&&t.setDiagramPosScale(f.m11,f.m12,f.m21,f.m22,f.dx,f.dy),tk.e(f),this.LM(t),t.globalAlpha=this._t;let m=this.findLayer("Grid");if(l){let e=new tu,i=l.iterator;for(i.reset();i.next();){let t=i.value;t instanceof ii&&(h||t.layer!==m)&&(t.vu(),e.add(t))}for(let i=0;i<d;i++)u[i].EF(t,this,e,o);e.each(t=>t.vu())}else for(let e=0;e<d;e++){let i=u[e];i===m?h&&i.zi(t,this,!0):i.zi(t,this,o)}this.oa=!1,this.Gc&&this.Gc.ju(this)&&this.nb()}finally{this.nt=a,this.ii.clearContextCache(!0),this.oh(),this.xs(u,d,this,this.viewportBounds),this.rh(),this.ii instanceof eM&&(this.ii.diagramGroup.replaceChildren(),this.redraw())}}getRenderingHint(t){return this.Tr[t]}setRenderingHint(t,e){"minDrawingLength"===t&&(this.Em=e),this.Tr[t]=e,this.redraw()}resetRenderingHints(){this.Tr=new ts,this.Tr.drawShadows=!0,this.Tr.textGreeking=!0,this.Tr.viewportOptimizations=!te.hr,this.Tr.temporaryPixelRatio=!0,this.Tr.pictureRatioOptimization=!0,this.Tr.minDrawingLength=1,this.Em=1}LM(t){let e=this.Tr;if(null===e)return;if(void 0!==e.imageSmoothingEnabled){let i=!!e.imageSmoothingEnabled;t.setImageSmoothingEnabled(i)}let i=e.defaultFont;null!=i&&(t.font=i)}getInputOption(t){return this.Ou[t]}setInputOption(t,e){this.Ou[t]=e}QF(){this.Ou=new ts,this.Ou.extraTouchArea=10,this.Ou.extraTouchThreshold=10,this.Ou.hasGestureZoom=!0}set(t){return Object.assign(this,t),this}attach(t){return this.setProperties(t)}setProperties(t){return eh.h0(this,t),this}static h0(t,e){let i=t instanceof eq,s=t instanceof eh;for(let n in e){""===n&&te.o("Setting properties requires non-empty property names");let l=t,r=n;if(i||s){let e=n.indexOf(".");if(e>0){let s=n.substring(0,e);i?l=t.findObject(s):null==(l=t[s])&&(l=t.toolManager[s]),te.H(l)?r=n.substring(e+1):te.o("Unable to find object named: "+s+" in "+t.toString()+" when trying to set property: "+n)}}if("_"!==r[0]&&!te.fw(l,r)){if(s&&"ModelChanged"===r){t.addModelChangedListener(e[r]);continue}if(s&&"Changed"===r){t.addChangedListener(e[r]);continue}else if(s&&te.fw(t.toolManager,r))l=t.toolManager;else if(s&&t.EL(r)){t.addDiagramListener(r,e[r]);continue}else if(t instanceof iE&&"Changed"===r){t.addChangedListener(e[r]);continue}else te.o('Trying to set undefined property "'+r+'" on object: '+l.toString())}let o=e[n];l[r]=o,"_"===r[0]&&l instanceof eb&&l.addCopyProperty(r)}}dL(){if(0!==this.eh.count&&!(this.undoManager.transactionLevel>1)){for(;this.eh.count>0;){let t=this.eh;this.eh=new tp;let e=t.iterator;for(;e.next();){let t=e.key;t.invalidateOtherJumpOvers(e.value),t.oe()}}this.C()}}C(t){if(void 0===t)this.ze=!0,this.requestUpdate();else{let e=this.viewportBounds;t.isReal()&&e.intersectsRect(t)&&(this.ze=!0,this.requestUpdate())}this.v("InvalidateDraw")}invalidateViewport(t,e){if(!0!==this.ze){if(this.ze=!0,"svg"===this.zc){this.maybeUpdate();return}!0===this.getRenderingHint("temporaryPixelRatio")?(this.Ew(),this.maybeUpdate(),this.xP(!0)):this.maybeUpdate()}}da(){this.Vu=!0}oh(){this.Xc=!0}l0(){!1!==this.Iu&&(this.Iu=!1,this.DL(this.Pt,this.St))}DL(t,e){this.nh();let i=this.Yi;this.mt.resize(t*i,e*i,t,e)&&(this.ze=!0,this.ii.clearContextCache(!0))}RL(){let t=this.mt;if(null===t||this.zu.isReal())return!0;let e=this.Pt,i=this.St,s=this.Ct,n=!1,l=this._n?this.Zt:0,r=this.pn?this.Zt:0,o=s.clientWidth||e+l,h=s.clientHeight||i+r,a=this.viewportBounds,u=a.x,d=a.y,c=a.width,g=a.height;if((o!==e+l||h!==i+r)&&(this._n=!1,this.pn=!1,l=0,r=0,this.Pt=o,this.St=h,this.Iu=!0,n=!0,this.nh()),!this.to||!this.viewportBounds.isReal())return!0;let f=this.eb,m=this.sb;if(this.Vu=!1,!n&&!this._n&&!this.pn&&!this.Bu&&!this.Uu)return!0;let p=this.documentBounds,y=0,x=0,w=0,b=0,v=a.width,k=a.height,P=this.ta;this.contentAlignment.isSpot()?(p.width>v&&(y=P.left,x=P.right),p.height>k&&(w=P.top,b=P.bottom)):(y=P.left,x=P.right,w=P.top,b=P.bottom);let S=p.width+y+x,M=p.height+w+b,N=this.scale,C=S>o/N,L=M>h/N;if(!n&&!this._n&&!this.pn&&!C&&!L)return!0;let T=p.x-y,A=a.x,D=p.right+x,F=a.right+l,O=p.y-w,R=a.y,B=p.bottom+b,E=a.bottom+r,I="1px",V="1px";if(1===this.scrollMode&&(C||L)){if(C&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let t=1;T+1<A&&(t=Math.max((A-T)*N+this.Pt,t)),D>F+1&&(t=Math.max((D-F)*N+this.Pt,t)),v+l+1<S&&(t=Math.max((S-v)*N+this.Pt,t)),I=t.toString()+"px"}if(L&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let t=1;O+1<R&&(t=Math.max((R-O)*N+this.St,t)),B>E+1&&(t=Math.max((B-E)*N+this.St,t)),k+r+1<M&&(t=Math.max((M-k)*N+this.St,t)),V=t.toString()+"px"}}let z="1px"!==I,K="1px"!==V;if(!(z&&K)&&(z||K)){if(C=!(S<v+l),L=!(M<k+r),K&&(F-=this.Zt),z&&(E-=this.Zt),C&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let t=1;T+1<A&&(t=Math.max((A-T)*N+this.Pt,t)),D>F+1&&(t=Math.max((D-F)*N+this.Pt,t)),v+1<S&&(t=Math.max((S-v)*N+this.Pt,t)),I=t.toString()+"px"}z="1px"!==I;let t=this.St;if(z!==this.pn&&(t=z?this.St-this.Zt:this.St+this.Zt),L&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let e=1;O+1<R&&(e=Math.max((R-O)*N+t,e)),B>E+1&&(e=Math.max((B-E)*N+t,e)),k+1<M&&(e=Math.max((M-k)*N+t,e)),V=e.toString()+"px"}K="1px"!==V}if(this.Km&&z===this.pn&&K===this._n)return(e!==this.Pt||i!==this.St)&&this.maybeUpdate(),!1;if(z!==this.pn&&("1px"===I?this.St=this.St+this.Zt:this.St=Math.max(this.St-this.Zt,1),n=!0),this.pn=z,m.style.width=I,K!==this._n&&("1px"===V?this.Pt=this.Pt+this.Zt:this.Pt=Math.max(this.Pt-this.Zt,1),n=!0,this.Hu)){let e=ty.l();K?(t.style.left=this.Zt+"px",this.position=e.i(this.dt.x+this.Zt/this.scale,this.dt.y)):(t.style.left="0px",this.position=e.i(this.dt.x-this.Zt/this.scale,this.dt.y)),ty.e(e)}n&&this.nh(),this._n=K,m.style.height=V,this.qx=!0,n&&(this.Iu=!0);let X=f.scrollLeft;if(this.hasHorizontalScrollbar&&this.allowHorizontalScroll&&(v+1<S?X=(this.position.x-T)*N:T+1<A?X=f.scrollWidth-f.clientWidth:D>F+1&&(X=this.position.x*N)),this.Hu)switch(this.px){case"negative":X=-(f.scrollWidth-X-f.clientWidth);break;case"reverse":X=f.scrollWidth-X-f.clientWidth}if(f.scrollLeft=X,this.hasVerticalScrollbar&&this.allowVerticalScroll&&(k+1<M?f.scrollTop=(this.position.y-O)*N:O+1<R?f.scrollTop=f.scrollHeight-f.clientHeight:B>E+1&&(f.scrollTop=this.position.y*N)),o=this.Pt,h=this.St,f.style.width=o+(this._n?this.Zt:0)+"px",f.style.height=h+(this.pn?this.Zt:0)+"px",e!==o||i!==h||this.animationManager.xi){let t=tw.X(u,d,c,g);return this.onViewportBoundsChanged(t,this.viewportBounds,N,n),tw.e(t),!1}return!0}add(t){let e=t.diagram;if(e===this)return;null!==e&&te.o("Cannot add part "+t.toString()+" to "+this.toString()+". It is already a part of "+e.toString());let i=this.findLayer(t.layerName);if(null===i&&(i=this.findLayer("")),null===i&&te.o('Cannot add a Part when unable find a Layer named "'+t.layerName+'" and there is no default Layer'),t.layer===i)return;let s=i._h(0x5f5e0ff,t,t.diagram===this);s>=0&&this.raiseChangedEvent(3,"parts",i,null,t,null,s),i.isTemporary||this.invalidateDocumentBounds(),t.invalidateLayout(1);let n=t.layerChanged;null!==n&&n(t,null,i)}_h(t){this.partManager._h(t);let e=this;t.$r(t=>e.BL(t)),t.data||t.Uo(),t.hasPlaceholder()&&t.c(),null!==t.data&&t.$r(t=>e.partManager.AM(t,null)),(!0===t.es()||!0===t.lh())&&this.o0(t),t.UL(!0,this),t.VL()?(t.actualBounds.isReal()&&this.C(t.Qh(t.actualBounds)),this.invalidateDocumentBounds()):t.isVisible()&&t.actualBounds.isReal()&&this.C(t.Qh(t.actualBounds)),this.requestUpdate()}se(t){t.clearAdornments(),this.partManager.se(t);let e=this;null!==t.data&&t.$r(t=>e.partManager.TM(t,e)),this.Zn.delete(t),t instanceof ic&&this.Fr.delete(t),t.VL()?(t.actualBounds.isReal()&&this.C(t.Qh(t.actualBounds)),this.invalidateDocumentBounds()):t.isVisible()&&t.actualBounds.isReal()&&this.C(t.Qh(t.actualBounds)),this.requestUpdate()}remove(t){this.DM(t,!0)}DM(t,e){let i=t.layer;if(null===i||i.diagram!==this)return;t.isSelected=!1,t.isHighlighted=!1,t.invalidateLayout(2),e&&t.qc();let s=i.se(-1,t,!1);s>=0&&this.raiseChangedEvent(4,"parts",i,t,null,s,null);let n=t.layerChanged;null!==n&&n(t,i,null)}removeParts(t,e){if(void 0===e&&(e=!1),Array.isArray(t)){let i=t.length;for(let s=0;s<i;s++){let i=t[s];e&&!i.canDelete()||this.remove(i)}}else{let i=new tu;i.addAll(t);let s=i.iterator;for(;s.next();){let t=s.value;e&&!t.canDelete()||this.remove(t)}}}copyParts(t,e,i){void 0===i&&(i=!1);let s=null,n=e||this,l=n.model,r=!1,o=!1;try{l.km()&&(r=l.copiesParentKeyOfNodeData,l.copiesParentKeyOfNodeData=n.commandHandler.copiesParentKey),(l.bm()||l.yb())&&(o=l.copiesGroupKeyOfNodeData,l.copiesGroupKeyOfNodeData=n.commandHandler.copiesGroupKey),s=this.partManager.copyParts(t,e,i)}finally{l.km()&&(l.copiesParentKeyOfNodeData=r),(l.bm()||l.yb())&&(l.copiesGroupKeyOfNodeData=o)}return s}moveParts(t,e,i,s){if(void 0===i&&(i=!1),void 0===s&&(s=this.a0()),null===this.toolManager)return;let n=new tp;if(null!==t){if(Array.isArray(t))for(let e=0;e<t.length;e++)this.Zr(n,t[e],i,s);else{let e=t.iterator;for(;e.next();)this.Zr(n,e.value,i,s)}}else{let t=this.parts;for(;t.next();){let e=t.value;this.Zr(n,e,i,s)}for(t=this.nodes;t.next();){let e=t.value;this.Zr(n,e,i,s)}for(t=this.links;t.next();){let e=t.value;this.Zr(n,e,i,s)}}this.PP(n,e,s,i)}Zr(t,e,i,s,n){if(!t.has(e)&&(void 0===n&&(n=!1),!(i&&!n&&!e.canMove()&&!e.canCopy()))){if(void 0===s&&(s=this.a0()),e instanceof io){if(t.set(e,this.Xs(s,e,e.location)),e instanceof ib&&(e.hasPlaceholder()||s.dragsMembers)){let n=e.memberParts;for(;n.next();){let e=n.value;this.Zr(t,e,i,s,s.groupsAlwaysMove)}}let n=e.linksConnected;for(;n.next();){let e=n.value;if(t.has(e))continue;let l=e.fromNode,r=e.toNode;null!==l&&t.has(l)&&null!==r&&t.has(r)&&this.Zr(t,e,i,s)}if(s.dragsTree){let n=e.findTreeChildrenNodes();for(;n.next();){let e=n.value;this.Zr(t,e,i,s)}}}else if(e instanceof ic){t.set(e,this.Xs(s,e));let n=e.labelNodes;for(;n.next();){let e=n.value;this.Zr(t,e,i,s)}}else e instanceof il||t.set(e,this.Xs(s,e,e.location))}}PP(t,e,i,s){if(null===t||0===t.count)return;let n=ty.l(),l=ty.l();l.a(e),isNaN(l.x)&&(l.x=0),isNaN(l.y)&&(l.y=0);let r=this.lb;r||this.YC(t);let o=te.rt(),h=te.rt(),a=t.iterator,u=ty.l();for(;a.next();){let e=a.key,r=a.value;if(e.Me()){let h=this.zL(e,t);if(null!==h)o.push(new ed(e,r,h));else if(!s||e.canMove()){let t=r.point;n.a(t),this.computeMove(e,n.add(l),i,u),e.location=u,void 0===r.shifted&&(r.shifted=new ty),r.shifted.a(u.subtract(t))}}else a.key instanceof ic&&h.push(new tf(a.key,a.value))}ty.e(u);let d=o.length;for(let t=0;t<d;t++){let e=o[t],i=e.XL.point;n.a(i),void 0===e.wb.shifted&&(e.wb.shifted=new ty),e.Le.location=n.add(e.wb.shifted)}let c=ty.l(),g=ty.l(),f=h.length;for(let e=0;e<f;e++){let s=h[e],r=s.key;if(r instanceof ic){if(r.suspendsRouting){r.Lr=null;let e=r.fromNode,o=r.toNode;if(null!==this.draggedLink&&i.dragsLink){let e=s.value.point;if(null===r.dragComputation){t.set(r,this.Xs(i,r,l));let s=l.x-e.x,n=l.y-e.y;r.xr(s,n)}else{let s=ty.X(0,0),n=r.getPoint(0);n&&n.isReal()&&s.a(n);let o=u=ty.l().a(s).add(l);i.isGridSnapEnabled&&(i.isGridSnapRealtime||this.lastInput.up)&&(o=ty.l(),this.cS(r,u,o,i)),u.a(r.dragComputation(r,u,o)).subtract(s),t.set(r,this.Xs(i,r,u));let h=u.x-e.x,a=u.y-e.y;r.xr(h,a),ty.e(s),ty.e(u),o!==u&&ty.e(o)}}else{if(null!==e){c.a(e.location);let i=t.get(e);null!==i&&c.subtract(i.point)}if(null!==o){g.a(o.location);let e=t.get(o);null!==e&&g.subtract(e.point)}if(null!==e&&null!==o){if(c.equalsApprox(g)){let e=s.value.point;n.a(c),n.subtract(e),t.set(r,this.Xs(i,r,c)),r.xr(n.x,n.y)}else r.suspendsRouting=!1,r.invalidateRoute()}else{let n;let h=s.value.point;n=null!==e?c:null!==o?g:l,t.set(r,this.Xs(i,r,n));let a=n.x-h.x,u=n.y-h.y;r.xr(a,u)}}}else if(null===r.fromNode||null===r.toNode){let e=s.value.point;t.set(r,this.Xs(i,r,l));let n=l.x-e.x,o=l.y-e.y;r.xr(n,o)}}}ty.e(n),ty.e(l),ty.e(c),ty.e(g),te.tt(o),te.tt(h),r||(this.Li(),this.wP(t))}computeMove(t,e,i,s){if(void 0===s&&(s=new ty),s.a(e),null===t)return s;let n=e,l=i.isGridSnapEnabled;l&&(i.isGridSnapRealtime||this.lastInput.up)&&(n=ty.l(),this.cS(t,e,n,i));let r=null!==t.dragComputation?t.dragComputation(t,e,n):n,o=t.minLocation,h=o.x;isNaN(h)&&(h=l?Math.round(1e3*t.location.x)/1e3:t.location.x);let a=o.y;isNaN(a)&&(a=l?Math.round(1e3*t.location.y)/1e3:t.location.y);let u=t.maxLocation,d=u.x;isNaN(d)&&(d=l?Math.round(1e3*t.location.x)/1e3:t.location.x);let c=u.y;return isNaN(c)&&(c=l?Math.round(1e3*t.location.y)/1e3:t.location.y),s.i(Math.max(h,Math.min(r.x,d)),Math.max(a,Math.min(r.y,c))),n!==e&&ty.e(n),s}a0(){let t=this.toolManager.findTool("Dragging");return t instanceof tK?t.dragOptions:this.ab}cS(t,e,i,s){if(void 0===s&&(s=this.a0()),i.a(e),null===t)return i;let n=this.grid,l=s.gridSnapCellSize,r=l.width,o=l.height,h=s.gridSnapOrigin,a=h.x,u=h.y,d=s.gridSnapCellSpot;if(null!==n){let t=n.gridCellSize;isNaN(r)&&(r=t.width),isNaN(o)&&(o=t.height);let e=n.gridOrigin;isNaN(a)&&(a=e.x),isNaN(u)&&(u=e.y)}let c=ty.X(0,0);return c.setSpot(0,0,r,o,d),tP.Ig(e.x,e.y,a+c.x,u+c.y,r,o,i),ty.e(c),i}YC(t){if(null===t)return;this.lb=!0;let e=t.iterator;for(;e.next();){let t=e.key;t instanceof ic&&(t.suspendsRouting=!0)}}wP(t){if(null===t)return;let e=t.iterator;for(;e.next();){let t=e.key;t instanceof ic&&(t.suspendsRouting=!1,t.YL()&&t.invalidateRoute())}this.lb=!1}get draggedLink(){return this.hb}set draggedLink(t){this.hb!==t&&(this.hb=t,null!==t&&(this.cb=t.fromPort,this.fb=t.toPort))}get NP(){return this.cb}set NP(t){this.cb=t}get CP(){return this.fb}set CP(t){this.fb=t}zL(t,e){let i=t.containingGroup;if(null!==i){let t=this.zL(i,e);if(null!==t||null!==(t=e.get(i)))return t}return null}Xs(t,e,i){if(void 0===i)return new eu(ty.Lo);let s=t.isGridSnapEnabled;return t.groupsSnapMembers||null===e.containingGroup||(s=!1),new eu(s?new ty(Math.round(1e3*i.x)/1e3,Math.round(1e3*i.y)/1e3):i.copy())}FM(t,e){if(null!==t.diagram&&t.diagram!==this&&te.o("Cannot share a Layer with another Diagram: "+t+" of "+t.diagram),null===e?null!==t.diagram&&te.o("Cannot add an existing Layer to this Diagram again: "+t):(e.diagram!==this&&te.o("Existing Layer must be in this Diagram: "+e+" not in "+e.diagram),t===e&&te.o("Cannot move a Layer before or after itself: "+t)),t.diagram===this)return;let i=t.name,s=this.Gt,n=s.count;for(let t=0;t<n;t++)s.elt(t).name===i&&te.o("Cannot add Layer with the name '"+i+"'; a Layer with the same name is already present in this Diagram.")}addLayer(t){this.FM(t,null),t.Ro(this);let e=this.Gt,i=e.count-1;if(!t.isTemporary)for(;i>=0&&e.elt(i).isTemporary;)i--;return e.insertAt(i+1,t),null!==this.Mi&&this.raiseChangedEvent(3,"layers",this,null,t,null,i+1),this.C(),this.invalidateDocumentBounds(),this}addLayerBefore(t,e){let i;this.FM(t,e),t.Ro(this);let s=this.Gt,n=s.indexOf(t);n>=0&&(s.delete(t),null!==this.Mi&&this.raiseChangedEvent(4,"layers",this,t,null,n,null));let l=s.count;for(i=0;i<l;i++)if(s.elt(i)===e){s.insertAt(i,t);break}return null!==this.Mi&&this.raiseChangedEvent(3,"layers",this,null,t,null,i),this.C(),n<0&&this.invalidateDocumentBounds(),this}addLayerAfter(t,e){let i;this.FM(t,e),t.Ro(this);let s=this.Gt,n=s.indexOf(t);n>=0&&(s.delete(t),null!==this.Mi&&this.raiseChangedEvent(4,"layers",this,t,null,n,null));let l=s.count;for(i=0;i<l;i++)if(s.elt(i)===e){s.insertAt(i+1,t);break}return null!==this.Mi&&this.raiseChangedEvent(3,"layers",this,null,t,null,i+1),this.C(),n<0&&this.invalidateDocumentBounds(),this}Wr(t,e){t.Ro(this),this.Gt.insertAt(e,t)}KL(t){this.Gt.removeAt(t)}removeLayer(t){if(t.diagram!==this&&te.o("Cannot remove a Layer from another Diagram: "+t+" of "+t.diagram),""===t.name)return;let e=this.Gt,i=e.indexOf(t);if(e.delete(t)){let e=t.Tt.copy().iterator;for(;e.next();){let i=e.value,s=i.layerName;s!==t.name?i.layerName=s:i.layerName=""}null!==this.Mi&&this.raiseChangedEvent(4,"layers",this,t,null,i,null),this.C(),this.invalidateDocumentBounds()}}findLayer(t){let e=this.layers;for(;e.next();){let i=e.value;if(i.name===t)return i}return null}findRouter(t){for(let e of this.Hc)if(e.name===t)return e;return null}addModelChangedListener(t){return te.S(t,eh,"addModelChangedListener:listener"),null===this.Qn&&(this.Qn=new th),this.Qn.add(t),this.model.addChangedListener(t),this}removeModelChangedListener(t){te.S(t,eh,"removeModelChangedListener:listener"),null!==this.Qn&&(this.Qn.delete(t),0===this.Qn.count&&(this.Qn=null)),this.model.removeChangedListener(t)}addChangedListener(t){return te.S(t,eh,"addChangedListener:listener"),null===this.Rr&&(this.Rr=new th),this.Rr.add(t),this}removeChangedListener(t){te.S(t,eh,"removeChangedListener:listener"),null!==this.Rr&&(this.Rr.delete(t),0===this.Rr.count&&(this.Rr=null))}RM(t){if(this.skipsUndoManager||this.model.skipsUndoManager||this.model.undoManager.handleChanged(t),1!==t.change&&(this.isModified=!0),null!==this.Rr){let e=this.Rr,i=e.length;for(let s=0;s<i;s++)e.elt(s)(t)}}raiseChangedEvent(t,e,i,s,n,l,r){void 0===l&&(l=null),void 0===r&&(r=null);let o=new tO;o.diagram=this,o.change=t,o.propertyName=e,o.object=i,o.oldValue=s,o.oldParam=l,o.newValue=n,o.newParam=r,this.RM(o)}raiseChanged(t,e,i,s,n){this.raiseChangedEvent(2,t,this,e,i,s,n)}t(t,e,i,s,n){this.raiseChangedEvent(2,t,this,e,i,s,n)}get animationManager(){return this.ps}get undoManager(){return this.Mi.undoManager}get skipsUndoManager(){return this.Io}set skipsUndoManager(t){te.s(t,"boolean",eh,"skipsUndoManager"),this.Io=t,this.Mi.skipsUndoManager=t}get delaysLayout(){return this.Ex}set delaysLayout(t){this.Ex=t}vC(t,e){if(null===t||t.diagram!==this)return;let i=this.ge;try{this.ge=!0;let i=t.change;if(2===i){let i=t.object,s=t.propertyName,n=t.getValue(e);if(t.diagram.model.et(i,s,n),i instanceof eb){let t=i.part;null!==t&&t.invalidateAdornments()}this.isModified=!0}else if(3===i){let i=t.object,s=t.newParam,n=t.newValue;if(i instanceof eq){if("number"==typeof s&&n instanceof eb){e?i.se(s):i.insertAt(s,n);let t=i.part;null!==t&&t.invalidateAdornments()}else"number"==typeof s&&n instanceof eZ&&(n.isRow?i.GL(s,e?void 0:n):i.HL(s,e?void 0:n))}else if(i instanceof es){let l=!0===t.oldParam;"number"==typeof s&&n instanceof ii&&(e?(l||(n.isSelected=!1,n.isHighlighted=!1,n.invalidateAdornments()),i.se(l?s:-1,n,l)):i._h(s,n,l))}else i instanceof eh?"number"==typeof s&&n instanceof es&&(e?this.KL(s):this.Wr(n,s)):te.o("unknown ChangeType.Insert object: "+t.toString());this.isModified=!0}else if(4===i){let i=t.object,s=t.oldParam,n=t.oldValue;if(i instanceof eq)"number"==typeof s&&n instanceof eb?e?i.insertAt(s,n):i.se(s):"number"==typeof s&&n instanceof eZ&&(n.isRow?i.GL(s,e?n:void 0):i.HL(s,e?n:void 0));else if(i instanceof es){let l=!0===t.newParam;"number"==typeof s&&n instanceof ii&&(e?0>i.Tt.indexOf(n)&&i._h(s,n,l):(l||(n.isSelected=!1,n.isHighlighted=!1,n.invalidateAdornments()),i.se(l?s:-1,n,l)))}else i instanceof eh?"number"==typeof s&&n instanceof es&&(e?this.Wr(n,s):this.KL(s)):te.o("unknown ChangeType.Remove object: "+t.toString());this.isModified=!0}else 1===i||te.o("unknown ChangedEvent: "+t.toString())}finally{this.ge=i}}startTransaction(t){return this.undoManager.startTransaction(t)}commitTransaction(t){return this.undoManager.commitTransaction(t)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(t,e){let i=e;void 0===i&&(i="");let s=this.skipsUndoManager;null===i&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{t(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateAllTargetBindings(t){this.partManager.updateAllTargetBindings(t)}updateAllThemeBindings(){if(this.partManager.updateAllThemeBindings(),null!==this.ts){let t=this.ts.part;null!==t&&t.Uo()}}setDivBackground(t){this.div&&(this.div.style.backgroundColor=t)}updateAllRelationshipsFromData(){this.partManager.updateAllRelationshipsFromData()}gb(){let t=this.F,e=this.nt,i=this.dt;t.Ii(),1!==e&&t.nt(e),(0!==i.x||0!==i.y)&&t.Es(-i.x,-i.y)}jL(t,e){let i=this.animationManager;if(this.Jt||this.bs){this.nt=e,this.nh(),this.C(),this.da(),i.fL(t,this.nt),this.gb();return}if(null===this.mt){this.nt=e,this.gb();return}this.Jt=!0;let s=this.viewportBounds.copy(),n=this.Pt,l=this.St,r=this.zoomPoint.x,o=this.zoomPoint.y,h=this.contentAlignment;isNaN(r)&&(h.isSide()?h.includesSide(tv.LeftSide)?r=0:h.includesSide(tv.RightSide)&&(r=n-1):r=h.isSpot()?h.x*(n-1):n/2),isNaN(o)&&(h.isSide()?h.includesSide(tv.TopSide)?o=0:h.includesSide(tv.BottomSide)&&(o=l-1):o=h.isSpot()?h.y*(l-1):l/2),null===this.scaleComputation||this.animationManager.defaultAnimation.isAnimating||(e=this.scaleComputation(this,e)),e<this.minScale&&(e=this.minScale),e>this.maxScale&&(e=this.maxScale);let a=ty.X(this.dt.x+r/t-r/e,this.dt.y+o/t-o/e);this.position=a,ty.e(a),this.nt=e,this.nh(),this.Jt=!1,this.onViewportBoundsChanged(s,this.viewportBounds,t,!1),this.Ks(!1),i.fL(t,this.nt),this.C()}yR(){let t=this.Gt.r;for(let e=0;e<t.length;e++)t[e].wL()}onViewportBoundsChanged(t,e,i,s){if(t.equals(e))return;void 0===s&&(s=!1),s||this.da(),this.oh();let n=this.layout;null!==n&&n.isViewportSized&&1===this.autoScale&&(t.width!==e.width||t.height!==e.height)&&n.invalidateLayout();let l=this.currentTool;!0===this.Kc&&l instanceof tz&&!this.animationManager.isTicking&&(this.lastInput.documentPoint=this.transformViewToDoc(this.lastInput.viewPoint),l.standardMouseActivity(this)),this.Jt||this.invalidateViewport(t,e),this.rh(),this.Xi.scale=i,this.Xi.position.x=t.x,this.Xi.position.y=t.y,this.Xi.bounds.a(t),this.Xi.canvasSize.width=Math.round(t.width*i),this.Xi.canvasSize.height=Math.round(t.height*i),this.Xi.newCanvasSize.width=this.Pt,this.Xi.newCanvasSize.height=this.St,this.Xi.isScroll=s,this.v("ViewportBoundsChanged",this.Xi,t),this.isVirtualized&&this.links.each(t=>{t.isAvoiding&&t.actualBounds.intersectsRect(e)&&t.invalidateRoute()})}rh(t){let e=this.ts;if(null===e||!e.visible||null===e.part||null===e.layer)return;let i=void 0!==t?t:this.Zx;if(!i.isReal())return;let s=i.width,n=i.height;if(e.scale=1,e.angle=0,e.layer.isViewportAligned)e.width=s*this.scale,e.height=n*this.scale,e.part.alignment=tv.TopLeft;else{null===e.bi&&(e.bi=new eW);let t=e.bi.Wc;if(!t.isReal())return;e.width=s+2*t.width,e.height=n+2*t.height;let l=ty.l();tP.Ig(i.x,i.y,0,0,t.width,t.height,l),l.offset(-t.width,-t.height),e.part.location=l,ty.e(l)}}clearSelection(t){void 0===t&&(t=!1);let e=this.selection;if(0===e.count)return;t||this.v("ChangingSelection",e);let i=e.toArray(),s=i.length;for(let t=0;t<s;t++)i[t].isSelected=!1;e.At(),e.clear(),e.u(),t||this.v("ChangedSelection",e)}select(t){null!==t&&t.diagram===this&&(!t.isSelected||this.selection.count>1)&&(this.v("ChangingSelection",this.selection),this.clearSelection(!0),t.isSelected=!0,this.v("ChangedSelection",this.selection))}selectCollection(t){if(this.v("ChangingSelection",this.selection),this.clearSelection(!0),Array.isArray(t)){let e=t.length;for(let i=0;i<e;i++){let e=t[i];e instanceof ii||te.o("Diagram.selectCollection given something that is not a Part: "+e),e.isSelected=!0}}else{let e=t.iterator;for(;e.next();){let t=e.value;t instanceof ii||te.o("Diagram.selectCollection given something that is not a Part: "+t),t.isSelected=!0}}this.v("ChangedSelection",this.selection)}clearHighlighteds(){let t=this.highlighteds;if(t.count>0){let e=t.toArray(),i=e.length;for(let t=0;t<i;t++)e[t].isHighlighted=!1;t.At(),t.clear(),t.u()}}highlight(t){null!==t&&t.diagram===this&&(!t.isHighlighted||this.highlighteds.count>1)&&(this.clearHighlighteds(),t.isHighlighted=!0)}highlightCollection(t){let e=new tu().addAll(t),i=this.highlighteds.copy().removeAll(e).iterator;for(;i.next();)i.value.isHighlighted=!1;let s=e.iterator;for(;s.next();){let t=s.value;t instanceof ii||te.o("Diagram.highlightCollection given something that is not a Part: "+t),t.isHighlighted=!0}}scroll(t,e,i){void 0===i&&(i=1);let s="up"===e||"down"===e,n=0,l=ty.l();if("pixel"===t)n=i;else if("line"===t)n=i*(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange);else if("page"===t){let t=s?this.viewportBounds.height:this.viewportBounds.width;if(0!=(t*=this.scale)){let e=Math.max(t-(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange),0);n=i*e}}else if("document"===t){let t=this.documentBounds,i=this.viewportBounds;"up"===e?this.position=l.i(i.x,t.y):"left"===e?this.position=l.i(t.x,i.y):"down"===e?this.position=l.i(i.x,t.bottom-i.height):"right"===e&&(this.position=l.i(t.right-i.width,i.y)),ty.e(l);return}else te.o("scrolling unit must be 'pixel', 'line', 'page', or 'document', not: "+t);n/=this.scale;let r=this.position;"up"===e?this.position=l.i(r.x,r.y-n):"down"===e?this.position=l.i(r.x,r.y+n):"left"===e?this.position=l.i(r.x-n,r.y):"right"===e?this.position=l.i(r.x+n,r.y):te.o("scrolling direction must be 'up', 'down', 'left', or 'right', not: "+e),ty.e(l)}scrollToRect(t){let e=this.viewportBounds;if(e.containsRect(t))return;let i=t.center;i.x-=e.width/2,i.y-=e.height/2,this.position=i}centerRect(t){let e=this.viewportBounds,i=t.center;i.x-=e.width/2,i.y-=e.height/2,this.position=i}transformDocToView(t){return t.copy().F(this.F)}transformViewToDoc(t){return t.copy().Be(this.F)}KF(t){return t.Be(this.F)}static None=1;static Uniform=2;static UniformToFill=3;static CycleAll=1;static CycleNotDirected=2;static CycleNotDirectedFast=3;static CycleNotUndirected=4;static CycleDestinationTree=5;static CycleSourceTree=6;static DocumentScroll=1;static InfiniteScroll=2;static TreeParentCollapsed=1;static AllParentsCollapsed=2;static AnyParentsCollapsed=3;get opacity(){return this._t}set opacity(t){let e=this._t;e!==t&&(te.s(t,"number",eh,"opacity"),(t<0||t>1)&&te._(t,"0 <= value <= 1",eh,"opacity"),this._t=t,this.t("opacity",e,t),this.C())}get validCycle(){return this.Dx}set validCycle(t){let e=this.Dx;e!==t&&(this.Dx=t,this.t("validCycle",e,t))}get layers(){return this.Gt.iterator}get isModelReadOnly(){let t=this.Mi;return null!==t&&t.isReadOnly}set isModelReadOnly(t){let e=this.Mi;null!==e&&(e.isReadOnly=t)}get isReadOnly(){return this.Eo}set isReadOnly(t){let e=this.Eo;e!==t&&(te.s(t,"boolean",eh,"isReadOnly"),this.Eo=t,this.t("isReadOnly",e,t))}get isEnabled(){return this.Bi}set isEnabled(t){let e=this.Bi;e!==t&&(te.s(t,"boolean",eh,"isEnabled"),this.Bi=t,this.t("isEnabled",e,t))}get allowClipboard(){return this.Bx}set allowClipboard(t){let e=this.Bx;e!==t&&(te.s(t,"boolean",eh,"allowClipboard"),this.Bx=t,this.t("allowClipboard",e,t))}get allowCopy(){return this.Ul}set allowCopy(t){let e=this.Ul;e!==t&&(te.s(t,"boolean",eh,"allowCopy"),this.Ul=t,this.t("allowCopy",e,t))}get allowDelete(){return this.Vl}set allowDelete(t){let e=this.Vl;e!==t&&(te.s(t,"boolean",eh,"allowDelete"),this.Vl=t,this.t("allowDelete",e,t))}get allowDragOut(){return this.Ux}set allowDragOut(t){let e=this.Ux;e!==t&&(te.s(t,"boolean",eh,"allowDragOut"),this.Ux=t,this.t("allowDragOut",e,t))}get allowDrop(){return this.Vx}set allowDrop(t){let e=this.Vx;e!==t&&(te.s(t,"boolean",eh,"allowDrop"),this.Vx=t,this.t("allowDrop",e,t))}get allowTextEdit(){return this.zl}set allowTextEdit(t){let e=this.zl;e!==t&&(te.s(t,"boolean",eh,"allowTextEdit"),this.zl=t,this.t("allowTextEdit",e,t))}get allowGroup(){return this.Xl}set allowGroup(t){let e=this.Xl;e!==t&&(te.s(t,"boolean",eh,"allowGroup"),this.Xl=t,this.t("allowGroup",e,t))}get allowUngroup(){return this.Yl}set allowUngroup(t){let e=this.Yl;e!==t&&(te.s(t,"boolean",eh,"allowUngroup"),this.Yl=t,this.t("allowUngroup",e,t))}get allowInsert(){return this.zx}set allowInsert(t){let e=this.zx;e!==t&&(te.s(t,"boolean",eh,"allowInsert"),this.zx=t,this.t("allowInsert",e,t))}get allowLink(){return this.Kl}set allowLink(t){let e=this.Kl;e!==t&&(te.s(t,"boolean",eh,"allowLink"),this.Kl=t,this.t("allowLink",e,t))}get allowRelink(){return this.Gl}set allowRelink(t){let e=this.Gl;e!==t&&(te.s(t,"boolean",eh,"allowRelink"),this.Gl=t,this.t("allowRelink",e,t))}get allowMove(){return this.Hl}set allowMove(t){let e=this.Hl;e!==t&&(te.s(t,"boolean",eh,"allowMove"),this.Hl=t,this.t("allowMove",e,t))}get allowReshape(){return this.jl}set allowReshape(t){let e=this.jl;e!==t&&(te.s(t,"boolean",eh,"allowReshape"),this.jl=t,this.t("allowReshape",e,t))}get allowResize(){return this.ql}set allowResize(t){let e=this.ql;e!==t&&(te.s(t,"boolean",eh,"allowResize"),this.ql=t,this.t("allowResize",e,t))}get allowRotate(){return this.Wl}set allowRotate(t){let e=this.Wl;e!==t&&(te.s(t,"boolean",eh,"allowRotate"),this.Wl=t,this.t("allowRotate",e,t))}get allowSelect(){return this.Jl}set allowSelect(t){let e=this.Jl;e!==t&&(te.s(t,"boolean",eh,"allowSelect"),this.Jl=t,this.t("allowSelect",e,t))}get allowUndo(){return this.Xx}set allowUndo(t){let e=this.Xx;e!==t&&(te.s(t,"boolean",eh,"allowUndo"),this.Xx=t,this.t("allowUndo",e,t))}get allowZoom(){return this.Yx}set allowZoom(t){let e=this.Yx;e!==t&&(te.s(t,"boolean",eh,"allowZoom"),this.Yx=t,this.t("allowZoom",e,t))}get hasVerticalScrollbar(){return this.Uu}set hasVerticalScrollbar(t){let e=this.Uu;e!==t&&(te.s(t,"boolean",eh,"hasVerticalScrollbar"),this.Uu=t,this.da(),this.C(),this.t("hasVerticalScrollbar",e,t),this.Ks(!1))}get hasHorizontalScrollbar(){return this.Bu}set hasHorizontalScrollbar(t){let e=this.Bu;e!==t&&(te.s(t,"boolean",eh,"hasHorizontalScrollbar"),this.Bu=t,this.da(),this.C(),this.t("hasHorizontalScrollbar",e,t),this.Ks(!1))}get allowHorizontalScroll(){return this.Kx}set allowHorizontalScroll(t){let e=this.Kx;e!==t&&(te.s(t,"boolean",eh,"allowHorizontalScroll"),this.Kx=t,this.t("allowHorizontalScroll",e,t),this.Ks(!1))}get allowVerticalScroll(){return this.Gx}set allowVerticalScroll(t){let e=this.Gx;e!==t&&(te.s(t,"boolean",eh,"allowVerticalScroll"),this.Gx=t,this.t("allowVerticalScroll",e,t),this.Ks(!1))}get scrollHorizontalLineChange(){return this.Hx}set scrollHorizontalLineChange(t){let e=this.Hx;e!==t&&(te.s(t,"number",eh,"scrollHorizontalLineChange"),t<0&&te._(t,">= 0",eh,"scrollHorizontalLineChange"),this.Hx=t,this.t("scrollHorizontalLineChange",e,t))}get scrollVerticalLineChange(){return this.jx}set scrollVerticalLineChange(t){let e=this.jx;e!==t&&(te.s(t,"number",eh,"scrollVerticalLineChange"),t<0&&te._(t,">= 0",eh,"scrollVerticalLineChange"),this.jx=t,this.t("scrollVerticalLineChange",e,t))}get lastInput(){return this.sa}set lastInput(t){this.sa=t}get previousInput(){return this.Hr}set previousInput(t){this.Hr=t}get firstInput(){return this.Wm}set firstInput(t){this.Wm=t}get currentCursor(){return this.Fx}set currentCursor(t){if(""===t&&(t=this.Ym),this.Fx!==t){te.s(t,"string",eh,"currentCursor");let e=this.mt,i=this.Ct;if(null===e||null===i)return;this.Fx=t;let s=e.style.cursor;e.style.cursor=t,i.style.cursor=t,e.style.cursor===s&&(e.style.cursor="-webkit-"+t,i.style.cursor="-webkit-"+t,e.style.cursor===s&&(e.style.cursor="-moz-"+t,i.style.cursor="-moz-"+t,e.style.cursor===s&&(e.style.cursor=t,i.style.cursor=t)))}}get defaultCursor(){return this.Ym}set defaultCursor(t){""===t&&(t="auto");let e=this.Ym;e!==t&&(te.s(t,"string",eh,"defaultCursor"),this.Ym=t,this.t("defaultCursor",e,t))}get click(){return this.vr}set click(t){let e=this.vr;e!==t&&(null!==t&&te.S(t,eh,"click"),this.vr=t,this.t("click",e,t))}get doubleClick(){return this.Or}set doubleClick(t){let e=this.Or;e!==t&&(null!==t&&te.S(t,eh,"doubleClick"),this.Or=t,this.t("doubleClick",e,t))}get contextClick(){return this.Ir}set contextClick(t){let e=this.Ir;e!==t&&(null!==t&&te.S(t,eh,"contextClick"),this.Ir=t,this.t("contextClick",e,t))}get mouseOver(){return this.Er}set mouseOver(t){let e=this.Er;e!==t&&(null!==t&&te.S(t,eh,"mouseOver"),this.Er=t,this.t("mouseOver",e,t))}get mouseHover(){return this.Br}set mouseHover(t){let e=this.Br;e!==t&&(null!==t&&te.S(t,eh,"mouseHover"),this.Br=t,this.t("mouseHover",e,t))}get mouseHold(){return this.Ur}set mouseHold(t){let e=this.Ur;e!==t&&(null!==t&&te.S(t,eh,"mouseHold"),this.Ur=t,this.t("mouseHold",e,t))}get mouseDragOver(){return this.Rx}set mouseDragOver(t){let e=this.Rx;e!==t&&(null!==t&&te.S(t,eh,"mouseDragOver"),this.Rx=t,this.t("mouseDragOver",e,t))}get mouseDrop(){return this.Vr}set mouseDrop(t){let e=this.Vr;e!==t&&(this.Vr=t,this.t("mouseDrop",e,t))}get handlesDragDropForTopLevelParts(){return this.vx}set handlesDragDropForTopLevelParts(t){let e=this.vx;e!==t&&(te.s(t,"boolean",eh,"handlesDragDropForTopLevelParts"),this.vx=t,this.t("handlesDragDropForTopLevelParts",e,t))}get mouseEnter(){return this.zr}set mouseEnter(t){let e=this.zr;e!==t&&(null!==t&&te.S(t,eh,"mouseEnter"),this.zr=t,this.t("mouseEnter",e,t))}get mouseLeave(){return this.Xr}set mouseLeave(t){let e=this.Xr;e!==t&&(null!==t&&te.S(t,eh,"mouseLeave"),this.Xr=t,this.t("mouseLeave",e,t))}get toolTip(){return this.Yr}set toolTip(t){let e=this.Yr;e!==t&&(this.Yr=t,this.t("toolTip",e,t))}get contextMenu(){return this.Kr}set contextMenu(t){let e=this.Kr;e!==t&&(this.Kr=t,this.t("contextMenu",e,t))}get commandHandler(){return this.$S}set commandHandler(t){this.$S!==t&&(this.$S=t,t.Ro(this))}get toolManager(){return this.qS}set toolManager(t){this.qS!==t&&(this.qS=t,t.diagram=this)}get defaultTool(){return this.WS}set defaultTool(t){let e=this.WS;e!==t&&(this.WS=t,t.diagram=this,this.currentTool===e&&(this.currentTool=t))}get currentTool(){return this.JS}set currentTool(t){let e=this.JS;e&&(e.isActive&&e.doDeactivate(),e.cancelWaitAfter(),e.doStop()),null===t&&(t=this.defaultTool),null!==t&&(this.JS=t,t.diagram=this,t.doStart())}get selection(){return this.sM}get maxSelectionCount(){return this.$x}set maxSelectionCount(t){let e=this.$x;if(e!==t){if(te.s(t,"number",eh,"maxSelectionCount"),t>=0&&!isNaN(t)){if(this.$x=t,this.t("maxSelectionCount",e,t),!this.undoManager.isUndoingRedoing){let e=this.selection.count-t;if(e>0){this.v("ChangingSelection",this.selection);let t=this.selection.toArray();for(let i=0;i<e;i++)t[i].isSelected=!1;this.v("ChangedSelection",this.selection)}}}else te._(t,">= 0",eh,"maxSelectionCount")}}get nodeSelectionAdornmentTemplate(){return this.jm}set nodeSelectionAdornmentTemplate(t){let e=this.jm;e!==t&&(this.jm=t.zt(),this.t("nodeSelectionAdornmentTemplate",e,t))}get groupSelectionAdornmentTemplate(){return this._x}set groupSelectionAdornmentTemplate(t){let e=this._x;e!==t&&(this._x=t.zt(),this.t("groupSelectionAdornmentTemplate",e,t))}get linkSelectionAdornmentTemplate(){return this.tb}set linkSelectionAdornmentTemplate(t){let e=this.tb;e!==t&&(this.tb=t.zt(),this.t("linkSelectionAdornmentTemplate",e,t))}get highlighteds(){return this.nM}get isModified(){let t=this.undoManager;return t.isEnabled?null!==t.currentTransaction||this.Yu&&this.Vs!==t.historyIndex:this.Yu}set isModified(t){if(this.Yu!==t){te.s(t,"boolean",eh,"isModified"),this.Yu=t;let e=this.undoManager;!t&&e.isEnabled&&(this.Vs=e.historyIndex),t||this.qL()}}qL(){let t=this.isModified;this.iM!==t&&(this.iM=t,this.v("Modified"))}get model(){return this.Mi}set model(t){let e=this.Mi;if(e!==t){this.currentTool.doCancel(),e&&e.undoManager!==t.undoManager&&e.undoManager.isInTransaction&&te.o("Do not replace a Diagram.model while a transaction is in progress."),this.animationManager.stopAnimation(!0);let i=this.AL(!0);this.to=!1,this.Eu=!0,this.Vs=-2,this.Cr=!1;let s=this.Jt;this.Jt=!0,this.animationManager.Bl("Model"),e&&(null!==this.Qn&&this.Qn.each(t=>e.removeChangedListener(t)),e.removeChangedListener(this.tM)),this.Mi=t,this.partManager=this.CR(this.Mi.type),this.initializePartManager(this.partManager);for(let t=0;t<i.length;t++)this.add(i[t]);t.addChangedListener(this._S),this.partManager.vM(),t.removeChangedListener(this._S),t.addChangedListener(this.tM),null!==this.Qn&&this.Qn.each(e=>t.addChangedListener(e)),this.Jt=s,this.invalidateDocumentBounds(),this.Jt||this.C(),e&&t.undoManager.copyProperties(e.undoManager)}}get themeManager(){return this.wM}set themeManager(t){let e=this.wM;e!==t&&(e&&e.removeDiagram(this),this.wM=t,null!==t&&t.addDiagram(this))}initializePartManager(t){}static xM(t,e){eh.PL.set(t,e)}static get licenseKey(){return eh.OM.last()}static set licenseKey(t){eh.OM.add(t.replace(/\s/g,""))}static get version(){return eh.LR}static OM=new th;static LR="3.0.19";CR(t){let e=eh.PL.get(t);return null!==e?new e:new iA}get K(){return this.QS}set K(t){this.QS=t}get ux(){return this.xL}AR(t){if(t.model!==this.model)return;let e=t.change,i=t.propertyName;if(1===e&&"S"===i[0]){if("StartingFirstTransaction"===i){let t=this,e=this.toolManager;e.mouseDownTools.each(e=>e.diagram=t),e.mouseMoveTools.each(e=>e.diagram=t),e.mouseUpTools.each(e=>e.diagram=t),this.routers.each(e=>e.diagram=t),this.bs||this.to||(this.Vc=!0,this.Eu&&(this.Cr=!0))}else if("StartingUndo"===i||"StartingRedo"===i){let t=this.animationManager;this.skipsUndoManager||(t.defaultAnimation.isAnimating&&t.stopAnimation(),t.getBundleAnimation().isAnimating&&t.getBundleAnimation().stop()),this.v("ChangingSelection",this.selection)}else if("StartedTransaction"===i){let t=this.animationManager;t.defaultAnimation.isAnimating&&!this.skipsUndoManager&&t.stopAnimation()}return}if(this.K){this.K=!1;try{if(""===t.modelChange&&1===e){("FinishedUndo"===i||"FinishedRedo"===i)&&(this.v("ChangedSelection",this.selection),this.Li());let e=this.animationManager;"RolledBackTransaction"===i&&e.stopAnimation(),this.dL(),this.Vc=!0,this.maybeUpdate(),(0===this.undoManager.transactionLevel||1===this.undoManager.transactionLevel)&&e.LS(),"CommittedTransaction"===i&&this.undoManager.isJustDiscarded&&(this.Vs=Math.min(this.Vs,this.undoManager.historyIndex-1)),("CommittedTransaction"===i||"RolledBackTransaction"===i)&&this.undoManager.Ow&&te.ar(()=>{this.isModified=!1},1);let s=t.isTransactionFinished;if(s&&(this.qL(),this.ux.clear(),this.animationManager.LF()),!this.Ox&&s&&this.lastInput.targetDiagram){this.Ox=!0;let t=this;te.ar(()=>{t.currentTool.standardMouseOver(),t.Ox=!1},10)}}}finally{this.K=!0}}}get ge(){return this.ZS}set ge(t){this.ZS=t}get kc(){return this.Ix}set kc(t){this.Ix=t}BL(t){for(let e of t.T.r)e instanceof e6&&this.IM(e)}IM(t){let e=t.element;if(null===e||!(e instanceof HTMLImageElement)||(e.ss instanceof tu&&e.ss.add(this),t.TR(),!e.c0))return;let i=e.getAttribute("src")||"",s=this.ih.get(i);if(null===s){e6.WL(t,e);let s=[];s.push(t),this.ih.set(i,s)}else{for(let e=0;e<s.length;e++)if(s[e]===t)return;s.push(t)}}DR(t){let e=t.T.r,i=e.length;for(let t=0;t<i;t++)this.EM(e[t])}EM(t){if(!(t instanceof e6))return;let e=t.element;if(null===e||!(e instanceof HTMLImageElement)||!e.c0)return;let i=e.getAttribute("src")||"",s=this.ih.get(i);if(null!==s){for(let n=0;n<s.length;n++)if(s[n]===t){s.splice(n,1),0===s.length&&(this.ih.delete(i),e6.FR(e),e.ss instanceof tu&&e.ss.delete(this),e6.clearCache(i));return}}}TL(){e6.clearCache(),this.ih.clear()}rebuildParts(){this.partManager.rebuildParts()}vc(t,e){this.ps.vc(t,e)}Rc(t,e){this.ps.Rc(t,e)}findPartForKey(t){return this.partManager.findPartForKey(t)}findNodeForKey(t){return this.partManager.findNodeForKey(t)}findLinkForKey(t){return this.partManager.findLinkForKey(t)}findPartForData(t){return this.partManager.findPartForData(t)}findNodeForData(t){return this.partManager.findNodeForData(t)}findLinkForData(t){return this.partManager.findLinkForData(t)}findNodesByExample(...t){return this.partManager.findNodesByExample(...t)}findLinksByExample(...t){return this.partManager.findLinksByExample(...t)}get nodeTemplate(){return this.Gr.get("")}set nodeTemplate(t){let e=this.Gr.get("");e!==t&&(this.Gr.set("",t),this.t("nodeTemplate",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get nodeTemplateMap(){return this.Gr}set nodeTemplateMap(t){let e=this.Gr;e!==t&&(this.Gr=t,this.t("nodeTemplateMap",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplate(){return this.ea.get("")}set groupTemplate(t){let e=this.ea.get("");e!==t&&(this.ea.set("",t),this.t("groupTemplate",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplateMap(){return this.ea}set groupTemplateMap(t){let e=this.ea;e!==t&&(this.ea=t,this.t("groupTemplateMap",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplate(){return this._l.get("")}set linkTemplate(t){let e=this._l.get("");e!==t&&(this._l.set("",t),this.t("linkTemplate",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplateMap(){return this._l}set linkTemplateMap(t){let e=this._l;e!==t&&(this._l=t,this.t("linkTemplateMap",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get isMouseCaptured(){return this.eM}set isMouseCaptured(t){let e=this.mt;if(null===e)return;let i=e.Rt;i instanceof SVGElement||(t?(this.lastInput.bubbles=!1,this.Ni(i,"pointermove",this.ha,!1),this.Ni(i,"pointerdown",this.sh,!1),this.Ni(i,"pointerup",this.aa,!1),this.Ni(i,"pointerout",this.ca,!1),this.Ni(i,"pointercancel",this.fa,!1),this.Xt(tt,"pointermove",this.ha,!0),this.Xt(tt,"pointerdown",this.sh,!0),this.Xt(tt,"pointerup",this.aa,!0),this.Xt(tt,"pointerout",this.ca,!0),this.Xt(tt,"pointercancel",this.fa,!0),this.Ni(i,"wheel",this.la,!1),this.Xt(tt,"wheel",this.la,!0),this.Xt(tt,"selectstart",this.Jh,!1)):(this.Ni(tt,"pointermove",this.ha,!0),this.Ni(tt,"pointerdown",this.sh,!0),this.Ni(tt,"pointerup",this.aa,!0),this.Ni(tt,"pointerout",this.ca,!0),this.Ni(tt,"pointercancel",this.fa,!0),this.Xt(i,"pointermove",this.ha,!1),this.Xt(i,"pointerdown",this.sh,!1),this.Xt(i,"pointerup",this.aa,!1),this.Xt(i,"pointerout",this.ca,!1),this.Xt(i,"pointercancel",this.fa,!1),this.Ni(tt,"wheel",this.la,!0),this.Ni(tt,"selectstart",this.Jh,!1),this.Xt(i,"wheel",this.la,!1)),this.eM=t)}get position(){return this.dt}set position(t){if(this.dt.equals(t))return;let e=ty.l().a(this.dt),i=this.viewportBounds.copy();if(this.dt.a(t),this.animationManager.cL(e,this.dt),this.Jt||null===this.mt&&!this.zu.isReal())this.nh(),this.gb();else{this.Jt=!0;let t=this.scale,e=this.Pt/t,i=this.St/t;this.SM(this.Hm,e,i,this.Bc,!1),this.Jt=!1}if(!this.Jt){let t=this.viewportBounds;this.onViewportBoundsChanged(i,t,this.nt,!1)}ty.e(e)}get initialPosition(){return this.yx}set initialPosition(t){this.yx.equals(t)||(this.yx=t.N())}get initialScale(){return this.wx}set initialScale(t){this.wx!==t&&(te.s(t,"number",eh,"initialScale"),this.wx=t)}get grid(){return null===this.ts&&(this.ts=this.FL()),this.ts}set grid(t){let e=this.ts;if(e!==t){null===e&&(this.ts=this.FL(),e=this.ts),t.type!==eq.Grid&&te.o("Diagram.grid must be a Panel of type Panel.Grid");let i=e.panel;null!==i&&i.remove(e),this.ts=t,t.name="GRID",null!==i&&i.add(t),this.Xu=!1,this.C(),this.t("grid",e,t)}}get viewportBounds(){return this.Zx}nh(){let t=this.Zx,e=this.dt,i=this.nt;t.i(e.x,e.y,Math.max(this.Pt,0)/i,Math.max(this.St,0)/i),this.oh()}get viewSize(){return this.zu}set viewSize(t){let e=this.viewSize;if(!e.equals(t)){t=t.N(),this.zu=t;let i=0,s=0;t.isReal()?(i=t.width,s=t.height):null!==this.Ct&&(i=this.Ct.clientWidth||1,s=this.Ct.clientHeight||1),this.Pt=i,this.St=s,this.nh(),this.invalidateDocumentBounds(),this.t("viewSize",e,t),this.C()}}get fixedBounds(){return this.Px}set fixedBounds(t){let e=this.Px;e.equals(t)||((t.width===-1/0||t.height===1/0||t.height===-1/0)&&te.o("fixedBounds width/height must not be Infinity"),t=t.N(),this.Px=t,this.invalidateDocumentBounds(),this.t("fixedBounds",e,t))}get scrollMargin(){return this.ta}set scrollMargin(t){"number"==typeof t&&(t=new tb(t));let e=this.ta;e.equals(t)||(t=t.N(),this.ta=t,this.t("scrollMargin",e,t),this.bu())}get scrollMode(){return this.Zh}set scrollMode(t){let e=this.Zh;e!==t&&(this.Zh=t,1===t&&this.Ks(!1),this.t("scrollMode",e,t),this.da(),this.C())}get scrollsPageOnFocus(){return this.Sx}set scrollsPageOnFocus(t){let e=this.Sx;e!==t&&(te.s(t,"boolean",eh,"scrollsPageOnFocus"),this.Sx=t,this.t("scrollsPageOnFocus",e,t))}get positionComputation(){return this.Mx}set positionComputation(t){let e=this.Mx;e!==t&&(null!==t&&te.S(t,eh,"positionComputation"),this.Mx=t,this.Ks(!1),this.t("positionComputation",e,t))}get scaleComputation(){return this.Nx}set scaleComputation(t){let e=this.Nx;e!==t&&(null!==t&&te.S(t,eh,"scaleComputation"),this.Nx=t,this.jL(this.scale,this.scale),this.t("scaleComputation",e,t))}get documentBounds(){return this.Hm}JL(t){this.na=!1;let e=this.Hm;e.equals(t)||(e=e.copy(),this.Hm.a(t),this.Ks(!1),this.v("DocumentBoundsChanged",void 0,e),this.da(),this.C())}ensureBounds(){if(this.na){let t=tw.l();this.JL(this.computeBounds(t)),tw.e(t)}}get isVirtualized(){return this.Qx}set isVirtualized(t){let e=this.Qx;e!==t&&(te.s(t,"boolean",eh,"isVirtualized"),this.Qx=t,this.t("isVirtualized",e,t))}get scale(){return this.nt}set scale(t){let e=this.nt;e!==t&&this.jL(e,t)}get defaultScale(){return this.Jm}set defaultScale(t){this.Jm=t}get autoScale(){return this.Zl}set autoScale(t){let e=this.Zl;e!==t&&(this.Zl=t,this.t("autoScale",e,t),1!==t&&this.Ks(!1))}get initialAutoScale(){return this.Dr}set initialAutoScale(t){let e=this.Dr;e!==t&&(this.Dr=t,this.t("initialAutoScale",e,t))}get initialViewportSpot(){return this.Lx}set initialViewportSpot(t){let e=this.Lx;e!==t&&(t.isSpot()||te.o("initialViewportSpot must be a specific Spot: "+t),this.Lx=t,this.t("initialViewportSpot",e,t))}get initialDocumentSpot(){return this.Cx}set initialDocumentSpot(t){let e=this.Cx;e!==t&&(t.isSpot()||te.o("initialViewportSpot must be a specific Spot: "+t),this.Cx=t,this.t("initialDocumentSpot",e,t))}get minScale(){return this.xx}set minScale(t){let e=this.xx;e!==t&&(t>0?(this.xx=t,this.t("minScale",e,t),t>this.scale&&(this.scale=t)):te._(t,"> 0",eh,"minScale"))}get maxScale(){return this.bx}set maxScale(t){let e=this.bx;e!==t&&(t>0?(this.bx=t,this.t("maxScale",e,t),t<this.scale&&(this.scale=t)):te._(t,"> 0",eh,"maxScale"))}get zoomPoint(){return this.kx}set zoomPoint(t){this.kx.equals(t)||(t=t.N(),this.kx=t)}get contentAlignment(){return this.Bc}set contentAlignment(t){let e=this.Bc;e.equals(t)||(t=t.N(),this.Bc=t,this.t("contentAlignment",e,t),this.Ks(!1))}get initialContentAlignment(){return this.Vm}set initialContentAlignment(t){let e=this.Vm;e.equals(t)||(t=t.N(),this.Vm=t,this.t("initialContentAlignment",e,t))}get padding(){return this.ti}set padding(t){"number"==typeof t&&(t=new tb(t));let e=this.ti;e.equals(t)||(t=t.N(),this.ti=t,this.invalidateDocumentBounds(),this.t("padding",e,t))}get partManager(){return this.aM}set partManager(t){let e=this.aM;e!==t&&(null!==t.diagram&&te.o("Cannot share PartManagers between Diagrams: "+t.toString()),e&&e.Ro(null),this.aM=t,t.Ro(this))}get nodes(){return this.partManager.nodes.iterator}get links(){return this.partManager.links.iterator}get parts(){return this.partManager.parts.iterator}findTopLevelNodesAndLinks(){let t=new tu,e=this.nodes;for(;e.next();){let i=e.value;i.isTopLevel&&t.add(i)}let i=this.links;for(;i.next();){let e=i.value;e.isTopLevel&&t.add(e)}return t.iterator}findTopLevelGroups(){return this.qr.iterator}get routers(){return this.Hc}doLinkRouting(t){this.Oo=!0;let e=this.Hc.r;for(let i=0;i<e.length;i++)e[i].canRoute(t)&&e[i].routeLinks(this.Fr,t);this.Oo=!1}get layout(){return this.ne}set layout(t){let e=this.ne;e!==t&&(this.ne=t,t.diagram=this,t.group=null,this.jr=!0,this.t("layout",e,t),this.requestUpdate())}layoutDiagram(t){this.Li(),t&&this.xb(!0),this.bs?this.CM(!1,this.Cl||0!==this.Hc.count&&0!==this.Zn.size):(this.Vc=!0,this.br())}xb(t){let e=this.qr.iterator;for(;e.next();)this.$L(e.value,t);this.layout&&(t?this.layout.isValidLayout=!1:this.layout.invalidateLayout())}$L(t,e){if(null===t)return;let i=t.ga.iterator;for(;i.next();){let t=i.value;this.$L(t,e)}null!==t.layout&&(e?t.layout.isValidLayout=!1:t.layout.invalidateLayout())}CM(t,e){if(this.Ex)return;let i=this.K;this.K=!0;let s="Layout",n=this.undoManager.transactionLevel,l=this.layout,r=this.animationManager;try{0===n&&(this.undoManager.Ml=!0,this.startTransaction(s)),n<=1&&!r.defaultAnimation.isAnimating&&!r.xi&&(t||r.Bl(s)),this.jr=!1;let i=this.qr.iterator;for(;i.next();)this.ZL(i.value,t,n,e);let o=!1;if(l.isValidLayout||(!t||l.isRealtime||null===l.isRealtime||0===n?(l.doLayout(this),this.r0(this),o=!0,l.isValidLayout=!0):this.jr=!0),o||this.r0(this),this.doLinkRouting(this),this.Fr.clear(),0!==this.ia.size){for(let t=0;t<23&&0!==this.ia.size;t++){for(i=this.qr.iterator;i.next();)this.QL(i.value);let t=this.Fr;this.Fr=this.ia,this.ia=t,this.r0(this),this.doLinkRouting(this)}this.Fr.clear(),this.ia.clear()}}finally{let t=this.undoManager.Ml;0===n&&(this.commitTransaction(s),this.undoManager.Ml=!1),t&&(0===n||1===n)&&r.LS(),this.jr&&(this.jr=!l.isValidLayout),this.K=i}}ZL(t,e,i,s){let n=t.ga.iterator;for(;n.next();)this.ZL(n.value,e,i,s);let l=t.layout;null===l||l.isValidLayout?s&&this.doLinkRouting(t):!e||l.isRealtime||0===i?(t.ma=!t.location.isReal(),l.doLayout(t),t.invalidateLayout(32),this.mb(t),this.r0(t),this.doLinkRouting(t),l.isValidLayout=!0):(this.doLinkRouting(t),this.jr=!0)}QL(t){let e=t.ga.iterator;for(;e.next();)this.QL(e.value);this.r0(t),this.doLinkRouting(t)}get isTreePathToChildren(){return this.Ax}set isTreePathToChildren(t){let e=this.Ax;if(e!==t&&(te.s(t,"boolean",eh,"isTreePathToChildren"),this.Ax=t,this.t("isTreePathToChildren",e,t),!this.undoManager.isUndoingRedoing)){let t=this.nodes;for(;t.next();)t.value.f0()}}findTreeRoots(){let t=new th,e=this.nodes;for(;e.next();){let i=e.value;i.isTopLevel&&null===i.findTreeParentLink()&&t.add(i)}return t.iterator}get treeCollapsePolicy(){return this.Tx}set treeCollapsePolicy(t){let e=this.Tx;e!==t&&(1!==t&&2!==t&&3!==t&&te.o("Unknown Diagram.treeCollapsePolicy: "+t),this.Tx=t,this.t("treeCollapsePolicy",e,t))}get isCollapsingExpanding(){return this.jS}set isCollapsingExpanding(t){this.jS=t}_F(){let t=new tp,e=new tp;function i(i){let s=i.toLowerCase(),n=new th;t.set(i,n),t.set(s,n),e.set(i,i),e.set(s,i)}i("InitialAnimationStarting"),i("AnimationStarting"),i("AnimationFinished"),i("BackgroundSingleClicked"),i("BackgroundDoubleClicked"),i("BackgroundContextClicked"),i("ClipboardChanged"),i("ClipboardPasted"),i("DocumentBoundsChanged"),i("ExternalObjectsDropped"),i("GainedFocus"),i("InitialLayoutCompleted"),i("LayoutCompleted"),i("LinkDrawn"),i("LinkRelinked"),i("LinkReshaped"),i("LostFocus"),i("Modified"),i("ObjectSingleClicked"),i("ObjectDoubleClicked"),i("ObjectContextClicked"),i("PartCreated"),i("PartResized"),i("PartRotated"),i("SelectionMoved"),i("SelectionCopied"),i("SelectionDeleting"),i("SelectionDeleted"),i("SelectionGrouped"),i("SelectionUngrouped"),i("ChangingSelection"),i("ChangedSelection"),i("SubGraphCollapsed"),i("SubGraphExpanded"),i("TextEdited"),i("ThemeChanged"),i("TreeCollapsed"),i("TreeExpanded"),i("ViewportBoundsChanged"),i("InvalidateDraw"),this.GS=t,this.HS=e}EL(t){let e=this.HS.get(t);return null!==e?e:this.HS.get(t.toLowerCase())}BM(t){let e=this.GS.get(t);if(null!==e)return e;let i=t.toLowerCase();if(null!==(e=this.GS.get(i)))return e;te.o("Unknown DiagramEvent name: "+t)}addDiagramListener(t,e){te.s(t,"string",eh,"addDiagramListener:name"),te.S(e,eh,"addDiagramListener:listener");let i=this.BM(t);return null!==i&&i.add(e),this}removeDiagramListener(t,e){te.s(t,"string",eh,"removeDiagramListener:name"),te.S(e,eh,"addDiagramListener:listener");let i=this.BM(t);null!==i&&i.delete(e)}raiseDiagramEvent(t,e,i){this.v(t,e,i)}v(t,e,i){let s=this.BM(t),n=new tD;n.diagram=this;let l=this.EL(t);null!==l&&(n.name=l),void 0!==e&&(n.subject=e),void 0!==i&&(n.parameter=i);let r=s.length;if(1===r)s.elt(0)(n);else if(0!==r){let t=s.toArray();for(let e=0;e<r;e++)(0,t[e])(n)}}isUnoccupied(t,e){return this.getPositions(!1,null,e||null).isUnoccupied(t.x,t.y,t.width,t.height)}computeOccupiedArea(t){return this.isVirtualized?this.viewportBounds.copy():this.na?this.vL(t):t.a(this.documentBounds)}getPositions(t,e,i){let s=this.Ql;null===s&&(this.Ql=s=new im(this.avoidanceCellSize));let n=e;if(s.Vo||s.pa!==n||s.UM!==i){if(s.VM=Math.max(s.Jc+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.width)),s.zM=Math.max(s.Jc+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.height)),null!==n&&(n=this._L(n)),null===n){let t=tw.l();this.computeOccupiedArea(t),t.inflate(100,100),s.bb(t);let e=this.nodes;for(;e.next();){let s=e.value,n=s.layer;null===n||!n.visible||n.isTemporary||this.XM(s,i,t)}tw.e(t)}else{if(n.memberParts.count>0){let t=this.computePartsBounds(n.memberParts,!1);t.inflate(20,20),s.bb(t)}let t=tw.l(),e=n.memberParts;for(;e.next();){let s=e.value;s instanceof io&&this.XM(s,i,t)}tw.e(t)}s.pa=n,s.UM=i,s.Vo=!1}else t&&s.tA();return s}get avoidanceCellSize(){return this.oM}set avoidanceCellSize(t){this.Ql=null,this.oM=new tx(Math.max(1,t.width),Math.max(1,t.height))}get avoidanceLimit(){return this.rM}set avoidanceLimit(t){this.rM=Math.max(1,t)}_L(t){return t.canAvoid()?t:null!==t.containingGroup?this._L(t.containingGroup):null}XM(t,e,i){if(t===e||!t.isVisible())return;let s=t.canAvoid();if(s){let e=t.getAvoidableRect(i);this.Ql.RR(e.x,e.y,e.width,e.height)}if(t instanceof ib&&(!s||t.avoidableMembers)){let s=t.memberParts;for(;s.next();){let t=s.value;t instanceof io&&this.XM(t,e,i)}}}YM(t){null!==this.Ql&&!this.Ql.Vo&&(void 0===t||t.canAvoid())&&(this.Ql.Vo=!0)}get autoScrollInterval(){return this.zm}set autoScrollInterval(t){let e=this.zm;e!==t&&(this.zm=t,this.t("autoScrollInterval",e,t))}get autoScrollRegion(){return this.Xm}set autoScrollRegion(t){"number"==typeof t&&(t=new tb(t));let e=this.Xm;e.equals(t)||(t=t.N(),this.Xm=t,this.invalidateDocumentBounds(),this.t("autoScrollRegion",e,t))}doAutoScroll(t){this.qm.a(t),this.computeAutoScrollPosition(this.qm).equalsApprox(this.position)?this.stopAutoScroll():this.iA()}iA(){if(-1!==this.Uc)return;let t=this.zm,e=this;this.Uc=te.ar(()=>{if(-1===e.Uc||(e.stopAutoScroll(),null===e.lastInput.event))return;let t=e.computeAutoScrollPosition(e.qm);if(t.equalsApprox(e.position))return;e.position=t,e.lastInput.documentPoint=e.transformViewToDoc(e.qm),e.doMouseMove(),e.na=!0;let i=tw.l();e.computeBounds(i),i.unionRect(e.documentBounds),e.JL(i),tw.e(i),e.ze=!0,e.maybeUpdate(),e.iA()},t)}stopAutoScroll(){-1!==this.Uc&&(te.Og(this.Uc),this.Uc=-1)}computeAutoScrollPosition(t){let e=this.position,i=this.Xm;if(i.top<=0&&i.left<=0&&i.right<=0&&i.bottom<=0)return e;let s=this.viewportBounds,n=this.scale,l=tw.X(0,0,s.width*n,s.height*n),r=ty.X(0,0);if(t.x>=l.x&&t.x<l.x+i.left&&this.allowHorizontalScroll){let e=Math.max(this.scrollHorizontalLineChange,1);e|=0,r.x-=e,t.x<l.x+i.left/2&&(r.x-=e),t.x<l.x+i.left/4&&(r.x-=4*e)}else if(t.x<=l.x+l.width&&t.x>l.x+l.width-i.right&&this.allowHorizontalScroll){let e=Math.max(this.scrollHorizontalLineChange,1);e|=0,r.x+=e,t.x>l.x+l.width-i.right/2&&(r.x+=e),t.x>l.x+l.width-i.right/4&&(r.x+=4*e)}if(t.y>=l.y&&t.y<l.y+i.top&&this.allowVerticalScroll){let e=Math.max(this.scrollVerticalLineChange,1);e|=0,r.y-=e,t.y<l.y+i.top/2&&(r.y-=e),t.y<l.y+i.top/4&&(r.y-=4*e)}else if(t.y<=l.y+l.height&&t.y>l.y+l.height-i.bottom&&this.allowVerticalScroll){let e=Math.max(this.scrollVerticalLineChange,1);e|=0,r.y+=e,t.y>l.y+l.height-i.bottom/2&&(r.y+=e),t.y>l.y+l.height-i.bottom/4&&(r.y+=4*e)}return r.equalsApprox(ty.Lo)||(e=new ty(e.x+r.x/n,e.y+r.y/n)),tw.e(l),ty.e(r),e}makeSvg(t){this.th.has("SVG")||this.addRenderer("SVG",new eS(this,tt.document));let e=new eS(this,tt.document,!0);void 0===t&&(t={});let i=this;return this.sA(function(t,s){let n=i.eA(t,"SVG",e),l=null!==n?n.svg:null;return te.ot(s)?(s(l),null):l},t)}makeSVG(t){return this.makeSvg(t)}addRenderer(t,e){this.th.set(t,e)}removeRenderer(t){this.th.delete(t)}cacheGroupExternalLinks(t){this.yM=t,t||this.nodes.each(t=>{t instanceof ib&&(t.u0=null)})}sA(t,e){let i=e.callback,s=!0,n=this.ih.iterator;for(;n.next();)if(!n.value[0].yn){s=!1;break}if(!te.ot(i)||s)return t(e,i,this);let l=this,r=e.callbackTimeout||300,o=+new Date;return tt.requestAnimationFrame(()=>(function h(){let a=+new Date;for(s=!0,n.reset();n.next();)if(!n.value[0].yn){s=!1;break}if(s||a-o>r){t(e,i,l);return}tt.requestAnimationFrame(h)})()),null}makeImage(t){return eh.isUsingDOM()?(void 0===t&&(t={}),t.returnType="Image",this.makeImageData(t)):null}makeImageData(t){return void 0===t&&(t={}),this.sA(this.vR,t)}static img="image";vR(t,e,i){let s=i.eA(t,"canvas",null);if(null===s)return null;let n=s.U.canvas,l=null;if(null!==n){let i=t.returnType;switch(i=void 0===i?"string":i.toLowerCase()){case eh.img+"data":l=s.getImageData(0,0,n.width,n.height);break;case eh.img:let r=(t.document||document).createElement("img");r.src=n.toDataURL(t.type,t.details),l=r;break;case"blob":return te.ot(e)||(l="",te.o('Error: Diagram.makeImageData called with "returnType: toBlob", but no required "callback" function property defined.')),te.ot(n.toBlob)?(n.toBlob(e,t.type,t.details),"toBlob"):(e(null),null);default:l=n.toDataURL(t.type,t.details)}}return te.ot(e)?(e(l),null):l}static OR=!1;eA(t,e,i){if(this.animationManager.stopAnimation(),this.maybeUpdate(),null===this.mt)return null;te.H(t)||te.o("properties argument must be an Object.");let s=!1,n=t.size||null,l=t.scale||null;void 0!==t.scale&&isNaN(t.scale)&&(l="NaN");let r=t.maxSize;void 0===t.maxSize&&(s=!0,r="SVG"===e?new tx(1/0,1/0):new tx(2e3,2e3));let o=t.position||null,h=t.parts||null;Array.isArray(h)&&(h=new th(h));let a=void 0===t.padding?1:t.padding,u=t.background||null,d=t.omitTemporary;void 0===d&&(d=!0);let c=t.document||document,g=t.elementFinished||null,f=t.showTemporary;void 0===f&&(f=!d);let m=t.showGrid;void 0===m&&(m=f),null!==n&&isNaN(n.width)&&isNaN(n.height)&&(n=null),"number"==typeof a?a=new tb(a):a instanceof tb||te.o("MakeImage padding must be a Margin or a number."),a.left=Math.max(a.left,0),a.right=Math.max(a.right,0),a.top=Math.max(a.top,0),a.bottom=Math.max(a.bottom,0),this.ii.clearContextCache(!0);let p=new eN(null,c,void 0,!0),y=p.ci;if(!(n||l||h||o))return p.width=this.Pt+Math.ceil(a.left+a.right),p.height=this.St+Math.ceil(a.top+a.bottom),"SVG"===e?null===i?null:(i.resize(p.width,p.height,p.width,p.height),i.ya=c,i.Wu=g,this.pb(i.ci,a,new tx(p.width,p.height),this.nt,this.dt,h,u,f,m),i.ci):(this.Ku=!1,this.pb(y,a,new tx(p.width,p.height),this.nt,this.dt,h,u,f,m),this.Ku=!0,p.ci);let x=this.Jm,w=this.documentBounds.copy();if(w.subtractMargin(this.ti),f){let t=this.Gt.r,e=t.length;for(let i=0;i<e;i++){let e=t[i];if(!e.visible||!e.isTemporary)continue;let s=e.Tt.r,n=s.length;for(let t=0;t<n;t++){let e=s[t];if(!e.isInDocumentBounds||!e.isVisible())continue;let i=e.actualBounds;i.isReal()&&w.unionRect(i)}}}let b=new ty(w.x,w.y);if(null!==h){let t=new tw(0,0,0,0),e=!0,i=h.iterator;for(i.reset();i.next();){let s=i.value;if(!(s instanceof ii))continue;let n=s.layer;if(null!==n&&!n.visible||null!==n&&!f&&n.isTemporary||!s.isVisible())continue;let l=s.actualBounds;l.isReal()&&(e?(e=!1,t.a(l)):t.unionRect(l))}w.width=t.width,w.height=t.height,b.x=t.x,b.y=t.y}null!==o&&o.isReal()&&(b=o,l||(l=x));let v=0,k=0;null!==a&&(v=a.left+a.right,k=a.top+a.bottom);let P=0,S=0;null!==n&&(P=n.width,S=n.height,isFinite(P)&&(P=Math.max(0,P-v)),isFinite(S)&&(S=Math.max(0,S-k)));let M=0,N=0;if(null!==n&&null!==l?("NaN"===l&&(l=x),n.isReal()?(M=P,N=S):isNaN(S)?(M=P,N=w.height*l):(M=w.width*l,N=S)):null!==n?n.isReal()?(l=Math.min(P/w.width,S/w.height),M=P,N=S):isNaN(S)?(l=P/w.width,M=P,N=w.height*l):(l=S/w.height,M=w.width*l,N=S):null!==l?"NaN"===l&&r.isReal()?(l=Math.min((r.width-v)/w.width,(r.height-k)/w.height))>x?(l=x,M=w.width,N=w.height):(M=r.width,N=r.height):(M=w.width*l,N=w.height*l):(l=x,M=w.width,N=w.height),null!==a?(M+=v,N+=k):a=new tb(0),null!==r){let t=r.width,i=r.height;"SVG"!==e&&s&&eh.OR,isNaN(t)&&(t=2e3),isNaN(i)&&(i=2e3),isFinite(t)&&(M=Math.min(M,t)),isFinite(i)&&(N=Math.min(N,i))}return p.width=Math.ceil(M),p.height=Math.ceil(N),"SVG"===e?null===i?null:(i.resize(p.width,p.height,p.width,p.height),i.ya=c,i.Wu=g,this.pb(i.ci,a,new tx(Math.ceil(M),Math.ceil(N)),l,b,h,u,f,m),i.ci):(this.Ku=!1,this.pb(y,a,new tx(Math.ceil(M),Math.ceil(N)),l,b,h,u,f,m),this.Ku=!0,p.ci)}static ju=null;static nA="5da73c80a36555d4038e4972187c3cae51fd22";static uw=!1;static Ek=()=>{if(void 0===eh.nA[5]&&(tk.prototype._e=tk.prototype.ww),!eh.isUsingDOM())return;let t=te.fs("canvas"),e=t.getContext("2d"),i=te.Rs("7ca11abfd022028846");e[i]=te.Rs("398c3597c01238");let s="7ca11abfd7330390",n=[eh.nA,te.uw+"4ae6247590da4bb21c324ba3a84e385776",tk.Ek+"fb236cdfda5de14c134ba1a95a2d4c7cc6f93c1387",tP.za];for(let t=1;t<5;t++)e[te.Rs(s)](te.Rs(n[t-1]),10,15*t+0);e[i]=te.Rs("39f046ebb36e4b");for(let t=1;t<5;t++)e[te.Rs(s)](te.Rs(n[t-1]),10,15*t+0);(4!==n.length||"5"!==n[0][0]||"7"!==n[3][0])&&(tk.prototype._e=tk.prototype.ww),eh.ju=t}}class ea{oA;rA;KM;Ae;constructor(t){if(this.oA=null,this.rA="63ad05bbe23a1786468a4c741b6d2",this.KM="@onz",this.rA===this._tk){this.KM=!0,this.Ae=this.KM;return}this.Ae=null}IR(t,e){let i="f",s=tt[te.Rs("76a715b2f73f148a")][te.Rs("72ba13b5")]||"",n=te.Rs;if(this.Ae=!0,!eh.isUsingDOM())return;let l=eh[n("76a115b6ed251eaf4692")];if(!l){let t=s[n("76ad18b4f73e")];for(let e=s[n("73a612b6fb191d")](n("35e7"))+2;e<t;e++)i+=s[e];let e=i[n("73a612b6fb191d")](n("7da71ca0ad381e90"));this.Ae=!(e>=0&&e<i[n("73a612b6fb191d")](n("35")));return}let r=eh.OM.iterator;for(;r.next();){let t=n(l=r.value).split(n("39e9"));if(t.length<6)return;let o=n(t[1]).split(".");if("7da71ca0"!==t[4])return;let h=n(te[n("6cae19")]).split(".");if(!(o[0]>h[0]||o[0]===h[0]&&o[1]>=h[1]))continue;let a="73a612b6fb191d",u=tt[n("74a900bae4370f8b51")][n("6fbb13a1c2311e8a57")].toLowerCase(),d=u[n(a)](n("3aad1ab6e022098b4dc4")),c=n(t[2]);if(d>-1){let t=u[n(a)](c.toLowerCase()+"/");if(this.Ae=!(t>-1&&t<d),!this.Ae)return}let g=s[n("76ad18b4f73e")];for(let t=s[n(a)](n("35e7"))+2;t<g;t++)i+=s[t];let f=i[n(a)](c);if(f<0&&c!==n("7da71ca0ad381e90")&&(f=i[n(a)](n("76a715b2ef3e149757"))),f<0&&(f=i[n(a)](n("76a715b2ef3e149757"))),f<0&&(f=i[n(a)](n("2bfa41fdb3784bca12"))),f<0&&(f=s[n(a)](n("7baa19a6f76c1988428554"))),this.Ae=!(f>=0&&f<i[n(a)](n("35"))||-1===i[n(a)](n("35"))),!this.Ae||s[n(a)](n("7fb002b6ed25128b4da25b2e"))&&(this.Ae=!(s[n(a)](c)>-1),!this.Ae))return;let m=tt[te.Rs("76a715b2f73f148a")][te.Rs("69ad17a1e03e")],p=m[n(a)](n("7fb002b6ed25128b4da25b2e"));if(p>-1&&(this.Ae=!(m[n(a)](c)>p),!this.Ae))return;if("#"!==c[0])continue;let y=te.fs("div"),x=t[0].replace(/[A-Za-z]/g,"");for(;x.length<4;)x+="9";let w=x;x=x.substring(x.length-4);let b="",v=["Header","Background","Display","Feedback"];if(b+=["gsh","gsf"][parseInt(x.substring(0,1),10)%2],b+=v[parseInt(x.substring(0,1),10)%4],y[n("79a417a0f0181a8946")]=b,tt.document[n("78a712aa")]){tt.document[n("78a712aa")][n("7bb806b6ed32388c4a875b")](y);let t=tt.getComputedStyle(y).getPropertyValue(n("78a704b7e62456904c9b12701b6532a8")),e=tt.getComputedStyle(y).getPropertyValue(n("75b817b0ea2202"));if(tt.document[n("78a712aa")][n("68ad1bbcf533388c4a875b")](y),!t)continue;let i=tt[n("77a902b0eb1b1e804a8a")];if(e==="0."+parseInt(w,10)%100||-1!==t.indexOf(parseInt(c[1]+c[2],16))&&-1!==t.indexOf(parseInt(c[3]+c[4],16))){this.Ae=!1;return}if(i&&i(n("32ae19a1e0331fc94084537c067a67fa59f1386b89d006")).matches){b="."+b;for(let t=0;t<document.styleSheets.length;t++){let e=document.styleSheets[t].rules||document.styleSheets[t].cssRules;for(let t in e)if(b===e[t].selectorText){this.Ae=!1;return}}}}else this.Ae=null,e&&(this.Ae=!1)}}ju(t){return t.ii.setTransform(t.Yi,0,0,t.Yi,0,0),t.ii.commitTransform(),null===this.Ae&&this.IR(t,!0),0<this.Ae&&this!==this.oA}}class eu{GM;HM;constructor(t){this.GM=void 0===t?new ty:t,this.HM=new ty}get point(){return this.GM}set point(t){this.GM=t}get shifted(){return this.HM}set shifted(t){this.HM=t}}class ed{Le;XL;wb;constructor(t,e,i){this.Le=t,this.XL=e,this.wb=i}}class ec{isGridSnapEnabled;isGridSnapRealtime;gridSnapCellSize;gridSnapCellSpot;gridSnapOrigin;dragsLink;dragsTree;groupsSnapMembers;groupsAlwaysMove;dragsMembers;constructor(t){this.Ii(),t&&Object.assign(this,t)}Ii(){this.isGridSnapEnabled=!1,this.isGridSnapRealtime=!0,this.gridSnapCellSize=new tx(NaN,NaN).u(),this.gridSnapCellSpot=tv.TopLeft,this.gridSnapOrigin=new ty(NaN,NaN).u(),this.dragsLink=!1,this.dragsTree=!1,this.groupsSnapMembers=!1,this.groupsAlwaysMove=!0,this.dragsMembers=!0}}class eg extends eh{constructor(t,e){let i;return void 0===t||"string"==typeof t||tt.Element&&t instanceof Element?i=t:te.H(t)&&(e=t),super(i),this.lA(),e&&this.setProperties(e),this}lA(){this.allowDragOut=!0,this.allowMove=!1,this.isReadOnly=!0,this.contentAlignment=tv.TopCenter,this.layout=new iT}setupRouters(){}reset(){super.reset(),this.lA()}}class ef extends eh{kb;Pb;Sb;Mb;d0;$c;Ol;jM;qM;Nb;WM;constructor(t,e){let i;return void 0===t||"string"==typeof t||tt.Element&&t instanceof Element?i=t:te.H(t)&&(e=t),super(i),this.animationManager.isEnabled=!1,this.Jt=!0,this.kb=null,this.Bu=!1,this.Uu=!1,this.Pb=!0,this.Sb=!0,this.Mb=0,this.d0=!1,this.$c=null,this.setRenderingHint("drawShadows",!1),this.Ol=new ii({selectable:!0,selectionAdorned:!1,selectionObjectName:"BOXSHAPE",locationObjectName:"BOXSHAPE",resizeObjectName:"BOXSHAPE",cursor:"move"}).add(new e$({name:"BOXSHAPE",fill:"transparent",stroke:"magenta",strokeWidth:2}).theme("stroke","overviewBox")).zt(),this.allowCopy=!1,this.allowDelete=!1,this.allowDrop=!1,this.allowSelect=!0,this.autoScrollRegion=new tb(0,0,0,0),this.dt.i(0,0),this.toolManager.Qt("Dragging",new em,this.toolManager.mouseMoveTools),this.click=()=>{let t=this.observed;if(null===t)return;let e=t.viewportBounds,i=this.lastInput.documentPoint;t.position=new ty(i.x-e.width/2,i.y-e.height/2)},this.jM=t=>{this.invalidateDocumentBounds(),this.g0()},this.qM=t=>{null!==this.observed&&(this.invalidateDocumentBounds(),this.C())},this.Nb=t=>{this.updateDelay<1?this.C():this.d0||(this.d0=!0,te.ar(()=>this.redraw(),this.updateDelay))},this.WM=t=>{null!==this.observed&&this.g0()},this.autoScale=2,this.Jt=!1,e&&Object.assign(this,e),this}setupRouters(){}computePixelRatio(){return 1}redraw(){this.d0&&this.updateDelay>=1&&(this.d0=!1,this.ER()),super.redraw()}zi(){if(null===this.Ct&&te.o("No div specified"),null===this.mt&&te.o("No canvas specified"),this.mt instanceof eS||(this.box.YS(),!this.ze))return;let t=this.observed;if(null===t||t.animationManager.defaultAnimation.isAnimating||!t.Kh)return;this.l0();let e=this.mt,i=this.ii;if(i.clearContextCache(!0),i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,e.width,e.height),this.updateDelay<1)this.hA();else if(null!==this.$c){i.drawImage(this.$c.Rt,0,0);let t=this.F;i.scale(this.Yi,this.Yi),i.transform(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy),i.commitTransform()}let s=this.Gt.r,n=s.length;for(let t=0;t<n;t++)s[t].zi(i,this);this.Xc=!1,this.ze=!1}ER(){let t=this.mt,e=this.ii;if(null!==t&&null!==e){if(this.l0(),null===this.$c){let e=new eN(null);e.width=t.width,e.height=t.height,this.$c=e}try{this.mt=this.$c,this.ii=this.mt.ci,this.ii.clearContextCache(!0),this.ii.setTransform(1,0,0,1,0,0),this.ii.clearRect(0,0,this.mt.width,this.mt.height),this.hA()}finally{this.mt=t,this.ii=e}}}hA(){let t=this.observed;if(null===t)return;let e=this.drawsTemporaryLayers,i=this.drawsGrid&&e,s=t.grid;if(i&&null!==s&&s.visible&&!(isNaN(s.width)||isNaN(s.height))){let e=tw.l().a(this.viewportBounds).unionRect(t.viewportBounds);t.rh(e),tw.e(e),t.Li()}let n=this.F,l=this.ii;l.scale(this.Yi,this.Yi),l.transform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),l.commitTransform();let r=this.viewportBounds,o=t.Gt.r,h=o.length,a=this.Gt.r;this.xs(a,a.length,this,this.viewportBounds);for(let t=0;t<h;t++)o[t].BF(l,r,this,e,i)}get observed(){return this.kb}set observed(t){let e=this.kb;if(t instanceof ef&&te.o("Overview.observed Diagram may not be an Overview itself: "+t),e!==t){if(null!==e&&this.BR(e),this.kb=t,null!==t&&this.UR(t),this.invalidateDocumentBounds(),null===t){this.$c=null;let t=this.mt,e=this.ii;t&&e&&(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height))}else this.Nb(null),this.g0(),this.C();this.t("observed",e,t)}}get box(){return this.Ol}set box(t){let e=this.Ol;e!==t&&(t.zt(),this.Ol=t,this.remove(e),this.add(this.Ol),this.g0(),this.t("box",e,t))}get drawsTemporaryLayers(){return this.Pb}set drawsTemporaryLayers(t){this.Pb!==t&&(this.Pb=t,this.redraw())}get drawsGrid(){return this.Sb}set drawsGrid(t){this.Sb!==t&&(this.Sb=t,this.redraw())}get updateDelay(){return this.Mb}set updateDelay(t){t<0&&(t=0),this.Mb!==t&&(this.Mb=t)}UR(t){null!==t&&(t.addDiagramListener("ViewportBoundsChanged",this.jM),t.addDiagramListener("DocumentBoundsChanged",this.qM),t.addDiagramListener("InvalidateDraw",this.Nb),t.addDiagramListener("AnimationFinished",this.WM),this.add(this.box))}BR(t){null!==t&&(this.remove(this.box),t.removeDiagramListener("ViewportBoundsChanged",this.jM),t.removeDiagramListener("DocumentBoundsChanged",this.qM),t.removeDiagramListener("InvalidateDraw",this.Nb),t.removeDiagramListener("AnimationFinished",this.WM))}g0(){let t=this.box,e=this.observed;if(null===e)return;this.ze=!0;let i=e.viewportBounds,s=t.selectionObject,n=tx.l();n.i(i.width,i.height),s.desiredSize=n,tx.e(n);let l=2/this.scale;s instanceof e$&&(s.strokeWidth=l),t.location=new ty(i.x-l/2,i.y-l/2),t.isSelected=!0}computeBounds(){let t=this.observed;if(null===t)return tw.Eg;let e=t.documentBounds.copy();return e.unionRect(t.viewportBounds),e}invalidateViewport(t,e){!0!==this.ze&&(this.ze=!0,this.requestUpdate())}onViewportBoundsChanged(t,e,i,s){this.Jt||(this.oh(),this.C(),this.da(),this.invalidateDocumentBounds(),this.g0(),this.Xi.scale=i,this.Xi.position.x=t.x,this.Xi.position.y=t.y,this.Xi.bounds.a(t),this.Xi.isScroll=s,this.v("ViewportBoundsChanged",this.Xi,t))}}class em extends tK{hh;constructor(){super(),this.hh=null}canStart(){if(!this.isEnabled)return!1;let t=this.diagram;if(null===t||!t.allowMove||!t.allowSelect)return!1;let e=t.observed;if(null===e)return!1;let i=t.lastInput;if(!i.left||t.currentTool!==this&&(!this.isBeyondDragSize()||i.isTouchEvent&&i.timestamp-t.firstInput.timestamp<this.delay))return!1;if(null===this.findDraggablePart()){let i=e.viewportBounds;this.hh=new ty(i.width/2,i.height/2);let s=t.firstInput.documentPoint;e.position=new ty(s.x-this.hh.x,s.y-this.hh.y)}return!0}doActivate(){this.hh=null,super.doActivate()}doUpdateCursor(t){let e=this.diagram,i=e.box;null!==i&&i.cursor&&(e.currentCursor=i.cursor)}moveParts(t,e,i){void 0===i&&(i=!1);let s=this.diagram,n=s.observed;if(null===n)return;let l=s.box;if(null===l)return;if(null===this.hh){let t=s.firstInput.documentPoint,e=l.location;this.hh=new ty(t.x-e.x,t.y-e.y)}let r=s.lastInput.documentPoint;n.position=new ty(r.x-this.hh.x,r.y-this.hh.y)}}class ep{L;JM;$M;ZM;QM;_M;t2;i2;e2;ah;s2;Cb;Lb;Ab;Tb;o2;zo;l2;constructor(t){tu.qi(this),this.L=eh.ym(),this.JM=!0,this.$M=!0,this.ZM=!0,this.QM=!1,this._M=!1,this.t2=!1,this.i2=!1,this.e2=null,this.ah=null,this.s2=1.05,this.Cb=NaN,this.Lb=null,this.Ab=NaN,this.Tb=tw.Eg,this.o2=!1,this.zo=null,this.l2=200,t&&Object.assign(this,t)}toString(){return"CommandHandler"}get diagram(){return this.L}Ro(t){this.L=t}doKeyDown(){let t=this.diagram,e=t.lastInput,i=te.hr?e.meta:e.control,s=e.shift,n=e.alt,l=e.commandKey;i&&("Insert"===l||"c"===l)?this.canCopySelection()&&this.copySelection():i&&"x"===l||s&&"Delete"===l?this.canCutSelection()&&this.cutSelection():i&&"v"===l||s&&"Insert"===l?this.canPasteSelection()&&this.pasteSelection():i&&"y"===l||i&&s&&"z"===l||n&&s&&"Backspace"===l?this.canRedo()&&this.redo():i&&"z"===l||n&&"Backspace"===l?this.canUndo()&&this.undo():"Delete"===l||"Backspace"===l?this.canDeleteSelection()&&this.deleteSelection():i&&"a"===l?this.canSelectAll()&&this.selectAll():"Escape"===l?this.canStopCommand()&&this.stopCommand():"ArrowUp"===l?t.allowVerticalScroll&&(i?t.scroll("pixel","up"):t.scroll("line","up")):"ArrowDown"===l?t.allowVerticalScroll&&(i?t.scroll("pixel","down"):t.scroll("line","down")):"ArrowLeft"===l?t.allowHorizontalScroll&&(i?t.scroll("pixel","left"):t.scroll("line","left")):"ArrowRight"===l?t.allowHorizontalScroll&&(i?t.scroll("pixel","right"):t.scroll("line","right")):"PageUp"===l?s&&t.allowHorizontalScroll?t.scroll("page","left"):t.allowVerticalScroll&&t.scroll("page","up"):"PageDown"===l?s&&t.allowHorizontalScroll?t.scroll("page","right"):t.allowVerticalScroll&&t.scroll("page","down"):"Home"===l?i&&t.allowVerticalScroll?t.scroll("document","up"):!i&&t.allowHorizontalScroll&&t.scroll("document","left"):"End"===l?i&&t.allowVerticalScroll?t.scroll("document","down"):!i&&t.allowHorizontalScroll&&t.scroll("document","right"):"Space"===l?this.canScrollToPart()&&this.scrollToPart():"Minus"===l||"NumpadSubtract"===l?this.canDecreaseZoom()&&this.decreaseZoom():"Equal"===l||"NumpadAdd"===l?this.canIncreaseZoom()&&this.increaseZoom():i&&"Digit0"===l?this.canResetZoom()&&this.resetZoom():s&&"z"===l?this.canZoomToFit()&&this.zoomToFit():i&&!s&&"g"===l?this.canGroupSelection()&&this.groupSelection():i&&s&&"g"===l?this.canUngroupSelection()&&this.ungroupSelection():"F2"===l?this.canEditTextBlock()&&this.editTextBlock():"ContextMenu"===l||s&&"F10"===l||i&&s&&"Backslash"===l?this.canShowContextMenu()&&this.showContextMenu():e.bubbles=!0}doKeyUp(){this.diagram.lastInput.bubbles=!0}stopCommand(){let t=this.diagram,e=t.currentTool;e instanceof tz&&t.allowSelect&&t.clearSelection(),null!==e&&e.doCancel()}canStopCommand(){return!0}selectAll(){let t=this.diagram;t.C();try{t.currentCursor="wait",t.v("ChangingSelection",t.selection);let e=t.parts;for(;e.next();){let t=e.value;t.canSelect()&&!t.layer.isTemporary&&(t.isSelected=!0)}let i=t.nodes;for(;i.next();){let t=i.value;t.canSelect()&&!t.layer.isTemporary&&(t.isSelected=!0)}let s=t.links;for(;s.next();){let t=s.value;t.canSelect()&&!t.layer.isTemporary&&(t.isSelected=!0)}}finally{t.v("ChangedSelection",t.selection),t.currentCursor=""}}canSelectAll(){return this.diagram.allowSelect}deleteSelection(){let t=this.diagram;try{t.currentCursor="wait",t.v("ChangingSelection",t.selection),t.startTransaction("Delete"),t.v("SelectionDeleting",t.selection);let e=new tu,i=t.selection.iterator;for(;i.next();){let t=i.value;ii.ch(e,t,!0,this.deletesTree?1/0:0,!!this.deletesConnectedLinks&&null,t=>t.canDelete())}t.removeParts(e,!0),t.v("SelectionDeleted",e)}finally{t.commitTransaction("Delete"),t.v("ChangedSelection",t.selection),t.currentCursor=""}}canDeleteSelection(){let t=this.diagram;return!(t.isReadOnly||t.isModelReadOnly||!t.allowDelete||0===t.selection.count)}copySelection(){let t=this.diagram;{let e=new tu,i=t.selection.iterator;for(;i.next();){let t=i.value;ii.ch(e,t,!0,this.copiesTree?1/0:0,this.copiesConnectedLinks,t=>t.canCopy())}this.copyToClipboard(e)}}canCopySelection(){let t=this.diagram;return!(!t.allowCopy||!t.allowClipboard||0===t.selection.count)}cutSelection(){this.copySelection(),this.deleteSelection()}canCutSelection(){let t=this.diagram;return!(t.isReadOnly||t.isModelReadOnly||!t.allowCopy||!t.allowDelete||!t.allowClipboard||0===t.selection.count)}copyToClipboard(t){let e=this.diagram,i=null;if(null===t)eh.LL();else{let s=null;try{s=e.copyParts(t,null,!0)}finally{i=new th,null!==s&&i.addAll(s.iteratorValues),eh.e0=i,eh.ub=e.model.dataFormat}}e.v("ClipboardChanged",i)}pasteFromClipboard(){let t=new tu,e=eh.e0;if(null===e)return t;let i=this.diagram;if(eh.ub!==i.model.dataFormat)return t;let s=null;try{s=i.copyParts(e,i,!1)}finally{if(null!==s){let e=s.iterator;for(;e.next();){let i=e.value,s=e.key;i.location.isReal()||(s.location.isReal()?i.location=s.location:!i.position.isReal()&&s.position.isReal()&&(i.position=s.position)),t.add(i)}}}return t}pasteSelection(t){void 0===t&&(t=null);let e=this.diagram;try{e.currentCursor="wait",e.v("ChangingSelection",e.selection),e.startTransaction("Paste");let i=this.pasteFromClipboard();i.count>0&&e.clearSelection(!0);let s=i.iterator;for(;s.next();)s.value.isSelected=!0;if(null!==t){let i=e.computePartsBounds(e.selection);if(i.isReal()){let s=this.computeEffectiveCollection(e.selection,e.ab);e.PP(s,new ty(t.x-i.centerX,t.y-i.centerY),e.ab,!1)}}e.v("ClipboardPasted",i)}finally{e.commitTransaction("Paste"),e.v("ChangedSelection",e.selection),e.currentCursor=""}}canPasteSelection(t){let e=this.diagram;return!(e.isReadOnly||e.isModelReadOnly||!e.allowInsert||!e.allowClipboard||null===eh.e0||0===eh.e0.count||eh.ub!==e.model.dataFormat)}undo(){this.diagram.undoManager.undo()}canUndo(){let t=this.diagram;return!t.isReadOnly&&!t.isModelReadOnly&&t.allowUndo&&t.undoManager.canUndo()}redo(){this.diagram.undoManager.redo()}canRedo(){let t=this.diagram;return!t.isReadOnly&&!t.isModelReadOnly&&t.allowUndo&&t.undoManager.canRedo()}decreaseZoom(t){void 0===t&&(t=1/this.zoomFactor);let e=this.diagram;if(1!==e.autoScale)return;let i=e.scale*t;i<e.minScale||i>e.maxScale||(e.scale=i)}canDecreaseZoom(t){void 0===t&&(t=1/this.zoomFactor);let e=this.diagram;if(1!==e.autoScale)return!1;let i=e.scale*t;return!(i<e.minScale)&&!(i>e.maxScale)&&e.allowZoom}increaseZoom(t){void 0===t&&(t=this.zoomFactor);let e=this.diagram;if(1!==e.autoScale)return;let i=e.scale*t;i<e.minScale||i>e.maxScale||(e.scale=i)}canIncreaseZoom(t){void 0===t&&(t=this.zoomFactor);let e=this.diagram;if(1!==e.autoScale)return!1;let i=e.scale*t;return!(i<e.minScale)&&!(i>e.maxScale)&&e.allowZoom}resetZoom(t){void 0===t&&(t=this.defaultScale);let e=this.diagram;t<e.minScale||t>e.maxScale||(e.scale=t)}canResetZoom(t){void 0===t&&(t=this.defaultScale);let e=this.diagram;return!(t<e.minScale)&&!(t>e.maxScale)&&e.allowZoom}zoomToFit(){let t=this.diagram,e=t.animationManager;e.stopAnimation(),t.redraw();let i=t.position,s=t.scale;e.Bl("Zoom To Fit"),this.isZoomToFitRestoreEnabled&&s===this.Ab&&!isNaN(this.Cb)&&null!==this.Lb&&t.documentBounds.equals(this.Tb)?(t.scale=this.Cb,t.position=this.Lb,this.Ab=NaN,this.Tb=tw.Eg):(this.Cb=s,this.Lb=i.copy(),t.zoomToFit(),this.Ab=t.scale,this.Tb=t.documentBounds.copy()),e.LS()}canZoomToFit(){return this.diagram.allowZoom}scrollToPart(t){void 0===t&&(t=null);let e=this.diagram;if(e.ensureBounds(),null===t){try{null!==this.zo&&(this.zo.next()?t=this.zo.value:this.zo=null)}catch{this.zo=null}null===t&&(e.highlighteds.count>0?this.zo=e.highlighteds.iterator:e.selection.count>0&&(this.zo=e.selection.iterator),null!==this.zo&&this.zo.next()&&(t=this.zo.value))}if(null!==t){let i=e.animationManager;i.Bl("Scroll To Part");let s=this.scrollToPartPause;if(s>0){let n=this.Zc(t,[t]);if(1===n.length)e.startTransaction(),e.centerRect(t.actualBounds),e.commitTransaction("Scroll To Part");else{let t=()=>{e.startTransaction();let t=n.pop();for(;n.length>0&&t instanceof io&&t.isTreeExpanded&&(!(t instanceof ib)||t.isSubGraphExpanded);)t=n.pop();n.length>0?(t instanceof ii&&e.scrollToRect(t.actualBounds),t instanceof io&&!t.isTreeExpanded&&(t.isTreeExpanded=!0),t instanceof ib&&!t.isSubGraphExpanded&&(t.isSubGraphExpanded=!0)):(t instanceof ii&&e.centerRect(t.actualBounds),e.removeDiagramListener("LayoutCompleted",l)),e.commitTransaction("Scroll To Part")},l=()=>{te.ar(t,(i.isEnabled?i.duration:0)+s)};e.addDiagramListener("LayoutCompleted",l),t()}}else{let s=e.position.copy();e.centerRect(t.actualBounds),s.equalsApprox(e.position)&&i.stopAnimation()}}}Zc(t,e){if(t.isVisible())return e;if(t instanceof il){let i=t.adornedPart;null!==i&&this.Zc(i,e)}else if(t instanceof ic){let i=t.fromNode;null!==i&&this.Zc(i,e);let s=t.toNode;null!==s&&this.Zc(s,e)}else{if(t instanceof io){let i=t.labeledLink;null!==i&&this.Zc(i,e);let s=t.findTreeParentNode();null!==s&&(s.isTreeExpanded||s.wasTreeExpanded||e.push(s),this.Zc(s,e))}let i=t.containingGroup;null!==i&&(i.isSubGraphExpanded||i.wasSubGraphExpanded||e.push(i),this.Zc(i,e))}return e}canScrollToPart(t){if(void 0===t&&(t=null),null!==t&&!(t instanceof ii))return!1;let e=this.diagram;return(0!==e.selection.count||0!==e.highlighteds.count)&&e.allowHorizontalScroll&&e.allowVerticalScroll}collapseTree(t){void 0===t&&(t=null);let e=this.diagram,i="Collapse Tree";try{e.startTransaction(i),e.animationManager.Bl(i);let s=new th;if(null!==t&&t.isTreeExpanded)t.collapseTree(),s.add(t);else if(null===t){let t=e.selection.iterator;for(;t.next();){let e=t.value;e instanceof io&&e.isTreeExpanded&&(e.collapseTree(),s.add(e))}}e.v("TreeCollapsed",s)}finally{e.commitTransaction(i)}}canCollapseTree(t){void 0===t&&(t=null);let e=this.diagram;if(e.isReadOnly)return!1;if(null!==t){if(!(t instanceof io)||!t.isTreeExpanded)return!1;if(t.findTreeChildrenLinks().count>0)return!0}else{let t=e.selection.iterator;for(;t.next();){let e=t.value;if(e instanceof io){if(!e.isTreeExpanded)continue;if(e.findTreeChildrenLinks().count>0)return!0}}}return!1}expandTree(t){void 0===t&&(t=null);let e=this.diagram,i="Expand Tree";try{e.startTransaction(i),e.animationManager.Bl(i);let s=new th;if(null===t||t.isTreeExpanded){if(null===t){let t=e.selection.iterator;for(;t.next();){let e=t.value;e instanceof io&&(e.isTreeExpanded||(e.expandTree(),s.add(e)))}}}else t.expandTree(),s.add(t);e.v("TreeExpanded",s)}finally{e.commitTransaction(i)}}canExpandTree(t){void 0===t&&(t=null);let e=this.diagram;if(e.isReadOnly)return!1;if(null!==t){if(!(t instanceof io)||t.isTreeExpanded)return!1;if(t.findTreeChildrenLinks().count>0)return!0}else{let t=e.selection.iterator;for(;t.next();){let e=t.value;if(e instanceof io){if(e.isTreeExpanded)continue;if(e.findTreeChildrenLinks().count>0)return!0}}}return!1}groupSelection(){let t=this.diagram,e=t.model;if(!e.Qc())return;let i=this.archetypeGroupData;if(null===i)return;let s=null;try{t.currentCursor="wait",t.v("ChangingSelection",t.selection),t.startTransaction("Group");let n=new th,l=t.selection.iterator;for(;l.next();){let t=l.value;t.Me()&&t.canGroup()&&n.add(t)}let r=new th,o=n.iterator;for(;o.next();){let t=o.value,e=!1,i=n.iterator;for(;i.next();){let s=i.value;if(t.isMemberOf(s)){e=!0;break}}e||r.add(t)}let h=r.first();if(null!==h){let n=h.containingGroup;if(null!==n)for(;null!==n;){let t=!1,e=r.iterator;for(;e.next();)if(!e.value.isMemberOf(n)){t=!0;break}if(t)n=n.containingGroup;else break}if(i instanceof ib)i.zt(),s=i.copy(),null!==s&&t.add(s);else if(e.isGroupForData(i)){let n=e.copyNodeData(i);te.H(n)&&(e.addNodeData(n),s=t.findNodeForData(n))}if(null!==s){null!==n&&this.isValidMember(n,s)&&(s.containingGroup=n);let e=r.iterator;for(;e.next();){let t=e.value;this.isValidMember(s,t)&&(t.containingGroup=s)}t.clearSelection(!0),s.isSelected=!0}}t.v("SelectionGrouped",s)}finally{t.commitTransaction("Group"),t.v("ChangedSelection",t.selection),t.currentCursor=""}}canGroupSelection(){let t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowGroup||!t.model.Qc()||null===this.archetypeGroupData)return!1;let e=t.selection.iterator;for(;e.next();){let t=e.value;if(t.Me()&&t.canGroup())return!0}return!1}h2(t){let e=te.rt();if(Array.isArray(t))t.forEach(t=>{t instanceof ic||t instanceof ii&&e.push(t)});else{let i=t.iterator;for(;i.next();){let t=i.value;t instanceof ic||t instanceof ii&&e.push(t)}}let i=new tu,s=e.length;for(let t=0;t<s;t++){let n=e[t],l=!0;for(let t=0;t<s;t++)if(n.isMemberOf(e[t])){l=!1;break}l&&i.add(n)}return te.tt(e),i}isValidMember(t,e){let i;return null!==e&&t!==e&&!(e instanceof ic)&&!(null!==t&&(t===e||t.isMemberOf(e)||null!==(i=t.memberValidation)&&!i(t,e)||null===t.data&&null!==e.data||null!==t.data&&null===e.data))&&(null===(i=this.memberValidation)||i(t,e))}ungroupSelection(t){void 0===t&&(t=null);let e=this.diagram,i=e.model;if(i.Qc())try{e.currentCursor="wait",e.v("ChangingSelection",e.selection),e.startTransaction("Ungroup");let s=new th;if(null!==t)s.add(t);else{let t=e.selection.iterator;for(;t.next();){let e=t.value;e instanceof ib&&e.canUngroup()&&s.add(e)}}let n=new th;if(s.count>0){e.clearSelection(!0);let t=s.iterator;for(;t.next();){let s=t.value;s.expandSubGraph();let l=s.containingGroup,r=null!==l&&null!==l.data?i.getKeyForNodeData(l.data):void 0;n.addAll(s.memberParts);let o=n.iterator;for(;o.next();){let t=o.value;if(t.isSelected=!0,t instanceof ic)continue;let e=t.data;null!==e?i.setGroupForData(e,r):t.containingGroup=l}e.remove(s)}}e.v("SelectionUngrouped",s,n)}finally{e.commitTransaction("Ungroup"),e.v("ChangedSelection",e.selection),e.currentCursor=""}}canUngroupSelection(t){void 0===t&&(t=null);let e=this.diagram;if(e.isReadOnly||e.isModelReadOnly||!e.allowDelete||!e.allowUngroup||!e.model.Qc())return!1;if(null!==t){if(!(t instanceof ib))return!1;if(t.canUngroup())return!0}else{let t=e.selection.iterator;for(;t.next();){let e=t.value;if(e instanceof ib&&e.canUngroup())return!0}}return!1}addTopLevelParts(t,e){let i=this.h2(t),s=!0,n=i.iterator;for(;n.next();){let t=n.value;null!==t.containingGroup&&(!e||this.isValidMember(null,t)?t.containingGroup=null:s=!1)}return s}collapseSubGraph(t){void 0===t&&(t=null);let e=this.diagram,i="Collapse SubGraph";try{e.startTransaction(i),e.animationManager.Bl(i);let s=new th;if(null!==t&&t.isSubGraphExpanded)t.collapseSubGraph(),s.add(t);else if(null===t){let t=e.selection.iterator;for(;t.next();){let e=t.value;e instanceof ib&&e.isSubGraphExpanded&&(e.collapseSubGraph(),s.add(e))}}e.v("SubGraphCollapsed",s)}finally{e.commitTransaction(i)}}canCollapseSubGraph(t){void 0===t&&(t=null);let e=this.diagram;if(e.isReadOnly)return!1;if(null!==t)return!(!(t instanceof ib)||!t.isSubGraphExpanded);{let t=e.selection.iterator;for(;t.next();){let e=t.value;if(e instanceof ib&&e.isSubGraphExpanded)return!0}}return!1}expandSubGraph(t){void 0===t&&(t=null);let e=this.diagram,i="Expand SubGraph",s=new th;try{if(e.startTransaction(i),e.animationManager.Bl(i),null===t||t.isSubGraphExpanded){if(null===t){let t=e.selection.iterator;for(;t.next();){let e=t.value;e instanceof ib&&(e.isSubGraphExpanded||(e.expandSubGraph(),s.add(e)))}}}else t.expandSubGraph(),s.add(t);e.v("SubGraphExpanded",s)}finally{for(let t of s)this.aA(e,t);t&&this.aA(e,t),e.commitTransaction(i)}}aA(t,e){for(let i of e.memberParts)i instanceof io&&t.Rc(i,e)}canExpandSubGraph(t){void 0===t&&(t=null);let e=this.diagram;if(e.isReadOnly)return!1;if(null!==t)return!(!(t instanceof ib)||t.isSubGraphExpanded);{let t=e.selection.iterator;for(;t.next();){let e=t.value;if(e instanceof ib&&!e.isSubGraphExpanded)return!0}}return!1}editTextBlock(t){void 0===t&&(t=null);let e=this.diagram,i=e.toolManager.findTool("TextEditing");if(null!==i){if(null===t){let i=null,s=e.selection.iterator;for(;s.next();){let t=s.value;if(t.canEdit()){i=t;break}}if(null===i)return;t=i.findInVisualTree(t=>t instanceof e3&&t.editable)}null!==t&&(e.currentTool=null,i.textBlock=t,e.currentTool=i)}}canEditTextBlock(t){void 0===t&&(t=null);let e=this.diagram;if(e.isReadOnly||e.isModelReadOnly||!e.allowTextEdit||null===e.toolManager.findTool("TextEditing"))return!1;if(null!==t){if(!(t instanceof e3))return!1;let e=t.part;if(null!==e&&e.canEdit())return!0}else{let i=e.selection.iterator;for(;i.next();){let e=i.value;if(e.canEdit()&&null!==(t=e.findInVisualTree(t=>t instanceof e3&&t.editable)))return!0}}return!1}showContextMenu(t){let e=this.diagram,i=e.toolManager.findTool("ContextMenu");if(null===i)return;void 0===t&&(t=null),null===t&&(t=e.selection.count>0?e.selection.first():e);let s=i.findObjectWithContextMenu(t);if(null!==s){let t=e.lastInput,n=null;if(s instanceof eb)n=s.getDocumentPoint(tv.Center);else if(!e.viewportBounds.containsPoint(t.documentPoint)){let t=e.viewportBounds;n=new ty(t.x+t.width/2,t.y+t.height/2)}if(null!==n){let t=new tA;t.diagram=e,t.viewPoint=e.transformDocToView(n),t.documentPoint=n,t.button=2,t.up=!0,e.lastInput=t}e.currentTool=i,i.openMenu(!1,s)}}canShowContextMenu(t){let e=this.diagram,i=e.toolManager.findTool("ContextMenu");return!(null===i||(void 0===t&&(t=null),null===t&&(t=e.selection.count>0?e.selection.first():e),null===i.findObjectWithContextMenu(t)))}get copiesClipboardData(){return this.JM}set copiesClipboardData(t){te.s(t,"boolean",ep,"copiesClipboardData"),this.JM=t}get copiesConnectedLinks(){return this.$M}set copiesConnectedLinks(t){te.s(t,"boolean",ep,"copiesConnectedLinks"),this.$M=t}get deletesConnectedLinks(){return this.ZM}set deletesConnectedLinks(t){te.s(t,"boolean",ep,"deletesConnectedLinks"),this.ZM=t}get copiesTree(){return this.QM}set copiesTree(t){te.s(t,"boolean",ep,"copiesTree"),this.QM=t}get deletesTree(){return this._M}set deletesTree(t){te.s(t,"boolean",ep,"deletesTree"),this._M=t}get copiesParentKey(){return this.t2}set copiesParentKey(t){te.s(t,"boolean",ep,"copiesParentKey"),this.t2=t}get copiesGroupKey(){return this.i2}set copiesGroupKey(t){te.s(t,"boolean",ep,"copiesGroupKey"),this.i2=t}get archetypeGroupData(){return this.e2}set archetypeGroupData(t){null!==t&&te.lc(t,ep,"archetypeGroupData"),this.diagram,this.e2=t}get memberValidation(){return this.ah}set memberValidation(t){null!==t&&te.S(t,ep,"memberValidation"),this.ah=t}get defaultScale(){return this.diagram.defaultScale}set defaultScale(t){this.diagram.defaultScale=t}get zoomFactor(){return this.s2}set zoomFactor(t){t>1||te.o("zoomFactor must be larger than 1.0, not: "+t),this.s2=t}get isZoomToFitRestoreEnabled(){return this.o2}set isZoomToFitRestoreEnabled(t){te.s(t,"boolean",ep,"isZoomToFitRestoreEnabled"),this.o2=t}get scrollToPartPause(){return this.l2}set scrollToPartPause(t){this.l2=t}computeEffectiveCollection(t,e){let i=this.diagram,s=i.toolManager.findTool("Dragging"),n=i.currentTool===s;void 0===e&&(e=i.a0());let l=new tp;if(null===t)return l;let r=t.iterator;for(;r.next();){let t=r.value;i.Zr(l,t,n,e)}if(null!==i.draggedLink&&e.dragsLink)return l;for(r=t.iterator;r.next();){let t=r.value;if(t instanceof ic){let e=t.fromNode;if(null===e||l.has(e)){let e=t.toNode;null===e||l.has(e)||l.delete(t)}else l.delete(t)}}return l}}var ey=((y=ey||{})[y.None=0]="None",y[y.Default=1]="Default",y[y.Vertical=4]="Vertical",y[y.Horizontal=5]="Horizontal",y[y.Fill=2]="Fill",y),ex=((x=ex||{})[x.None=0]="None",x[x.Along=21]="Along",x[x.Plus90=22]="Plus90",x[x.Minus90=23]="Minus90",x[x.Opposite=24]="Opposite",x[x.Upright=25]="Upright",x[x.Plus90Upright=26]="Plus90Upright",x[x.Minus90Upright=27]="Minus90Upright",x[x.Upright45=28]="Upright45",x),ew=((w=ew||{})[w.None=0]="None",w[w.Vertical=1]="Vertical",w[w.Horizontal=2]="Horizontal",w[w.Both=3]="Both",w);class eb{n;m0;p0;Qr;b;fh;gt;dt;re;_t;y0;Gs;Dt;ns;_r;uh;ki;wa;nt;Ht;tl;Ai;Ki;Ju;fi;$u;Ut;ri;il;Db;dh;Zu;constructor(){tu.qi(this),this.n=30723,this._t=1,this.y0="",this.Gs=null,this.Dt=null,this.dt=new ty(NaN,NaN).u(),this.ns=tx.mw,this._r=new tk,this.uh=new tk,this.ki=null,this.wa=1,this.nt=1,this.Ht=0,this.tl=tb.Bg,this.re=new tw(NaN,NaN,NaN,NaN).u(),this.Ai=new tw(NaN,NaN,NaN,NaN).u(),this.Ki=new tw(0,0,NaN,NaN).u(),this.Ju=null,this.m0=null,this.gt=null,this.fi=tv.Default,this.$u=tv.Default,this.p0=0,this.Qr=0,this.Ut=null,this.b=null,this.fh=null,this.ri=null,this.Db=null,this.dh=null,this.il=null,this.Zu=null}cloneProtected(t){t.n=(6144|this.n)&-32769,t._t=this._t,t.y0=this.y0,t.Dt=this.Dt,t.dt.a(this.dt),t.ns=this.ns.N(),null!==this.ki?t.ki=this.ki.copy():t.ki=null,t.nt=this.nt,t.Ht=this.Ht,t.tl=this.tl.N(),t.re.a(this.re),t.Ai.a(this.Ai),t.Ki.a(this.Ki),t.m0=this.m0,null!==this.gt&&(t.gt=this.gt.copy()),t.fi=this.fi.N(),t.$u=this.$u.N(),t.p0=this.p0,t.Qr=this.Qr,null!==this.Ut&&(t.Ut=this.Ut.copy()),null!==this.b&&(this.b.gi?t.b=this.b:t.b=this.b.copy()),null!==this.fh&&(t.fh=this.fh.slice()),null!==this.ri&&(t.ri=this.ri.copy())}addCopyProperty(t){let e=this.fh;if(Array.isArray(e)){for(let i=0;i<e.length;i++)if(e[i]===t)return}else e=[],this.fh=e;e.push(t)}Xo(t){t.Ju=null,t.il=null,t.c()}clone(){let t=new this.constructor;if(this.cloneProtected(t),null!==this.fh)for(let e=0;e<this.fh.length;e++){let i=this.fh[e];t[i]=this[i]}return t}copy(){return this.clone()}_P(){let t=this.Ti;if(null!==t)for(let e of(this.Ti=null,t))e.Qu()&&(e.isToData?this.themeData(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter):e.isToObject?this.themeObject(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter,e.sourceName):e.isToModel?this.themeModel(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter):this.theme(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter));return this}hi(t){t in ex?this.segmentOrientation=t:t in ey?this.stretch=t:te.cr(this,t)}toString(){return te.Vn(this.constructor)+"#"+tu.us(this)}static None=0;static Default=1;static Fill=2;static Vertical;static Horizontal;static Uniform=6;static UniformToFill=7;static FlipVertical=1;static FlipHorizontal=2;static FlipBoth=3;gh(){null!==this.b&&(this.b.gi=!0)}qt(){return null===this.b?this.b=new ev:this.b.gi&&(this.b=this.b.copy()),this.b}Xe(){if(null===this.gt){let t=new ix;t.xa=tv.None,t.ba=tv.None,t.ka=10,t.Pa=10,t.Sa=0,t.Ma=0,this.gt=t}return this.gt}raiseChangedEvent(t,e,i,s,n,l,r){let o=this.part;if(null!==o){o._c(t,e,i,s,n,l,r),i===this&&2===t&&this.tf()&&this.Na(o,e);let h=this.diagram;if(null!==this.ks&&null!==h&&h.Kh&&!h.undoManager.isUndoingRedoing&&!h.animationManager.ku){let t=this.ks.get(e);if(null!==t&&h.animationManager.isEnabled&&!h.animationManager.isTicking){null===this.Zu&&(this.Zu=new tp);let i=0===h.undoManager.transactionLevel;if(2===t.startCondition?i=!0:3===t.startCondition&&(i=!1),i){let i=new t7;t.OF(i);let l=this.Zu.get(t);null!==l&&l.stop(),this.Zu.set(t,i),i.hx=this,i.OS=t,i.add(this,e,s,n),i.start()}else h.animationManager.getBundleAnimation().add(this,e,s,n)}}if(this instanceof eq&&i===o&&o.a2()&&null!==o.data){let t=this.T.r,i=t.length;for(let s=0;s<i;s++){let i=t[s];i instanceof eq&&i.$r(t=>{null!==t.data&&t.a2()&&t.updateTargetBindings(e)})}}}}DF(t){this.Zu.delete(t)}Uo(){if(null!==this.diagram&&null===this.findBindingPanel()&&null!==this.Ti){let t=this.diagram.model,e=this.Ti.iterator;for(;e.next();){let i=e.value;if(!i.isToTheme)continue;let s=null,n=i.sourceName;i.isToObject&&(s=this.cA(n));let l=this,r=i.targetId;-1!==r&&null===(l=this.w0(r))||("/"===n?s=l.part:"."===n?s=l:".."===n&&(s=l.panel),i.updateTarget(l,s,void 0,t))}}}Na(t,e){let i=this.findBindingPanel();if(null!==i){let s=t.diagram,n=this.Ti.iterator;for(;n.next();){let t=n.value,l=null;if(t.isToObject){if(null===(l=t.fA(i,this)))continue;t.updateSource(this,l,e,null)}else if(t.isToModel)null===s||s.ge||t.updateSource(this,s.model.modelData,e,i);else if(!t.isToTheme){let n=i.data;if(null===n)continue;null===s||s.ge||t.updateSource(this,n,e,i)}if(l===this){let n=t.targetId,r=i.w0(n);null!==r&&t.updateTarget(r,l,e,s?.model)}}}}w0(t){return this.io===t?this:null}cA(t){return""===t?this:"/"===t?this:"."===t?this:".."===t?this:this.part.findObject(t)}get io(){return null!==this.b?this.b.io:-1}set io(t){this.io!==t&&(null===this.b&&(this.b=new ev),this.b.io=t)}get Ti(){return null!==this.b?this.b.Ti:null}set Ti(t){this.Ti!==t&&(null===this.b&&(this.b=new ev),this.b.Ti=t)}get eo(){return null!==this.b?this.b.eo:null}set eo(t){this.eo!==t&&(null===this.b&&(this.b=new ev),this.b.eo=t)}raiseChanged(t,e,i){this.raiseChangedEvent(2,t,this,e,i)}t(t,e,i){this.raiseChangedEvent(2,t,this,e,i)}so(t,e,i,s){let n=this.re;if(n.i(t,e,i,s),1!==this.nt||0!==this.Ht){null===this.ki&&(this.ki=new tk);let l=this.ki;l.Ii(),this.x0(l,t,e,i,s),l.Ug(n)}}uA(t,e,i){return!1!==this.pickable&&(i.ac(this.F),e?this.intersectsRect(t,i):this.containedInRect(t,i))}dA(t,e,i){if(!1===this.pickable)return!1;let s=this.naturalBounds,n=t.distanceSquaredPoint(e);return i?ty.distanceLineSegmentSquared(t.x,t.y,0,0,0,s.height)<=n||ty.distanceLineSegmentSquared(t.x,t.y,0,s.height,s.width,s.height)<=n||ty.distanceLineSegmentSquared(t.x,t.y,s.width,s.height,s.width,0)<=n||ty.distanceLineSegmentSquared(t.x,t.y,s.width,0,0,0)<=n:t.distanceSquared(0,0)<=n&&t.distanceSquared(0,s.height)<=n&&t.distanceSquared(s.width,0)<=n&&t.distanceSquared(s.width,s.height)<=n}wn(){return!0}containsPoint(t){let e=ty.l();e.a(t),this.F.xt(e);let i=this.actualBounds;if(!i.isReal())return ty.e(e),!1;let s=this.diagram;if(null!==s&&s.Zm){let t=s.getInputOption("extraTouchThreshold"),n=s.getInputOption("extraTouchArea"),l=n/2,r=this.naturalBounds,o=this.getDocumentScale()*s.scale,h=1/o;if(r.width*o<t&&r.height*o<t){let t=tw.contains(i.x-l*h,i.y-l*h,i.width+n*h,i.height+n*h,e.x,e.y);return ty.e(e),t}}let n=!1;return(this instanceof il||this instanceof e$?tw.contains(i.x-5,i.y-5,i.width+10,i.height+10,e.x,e.y):i.containsPoint(e))&&(n=(!this.ri||!!this.ri.containsPoint(e))&&(!!(null!==this.Dt&&this.Ki.containsPoint(t))||this.mh(t))),ty.e(e),n}mh(t){let e=this.naturalBounds;return tw.contains(0,0,e.width,e.height,t.x,t.y)}containsRect(t){if(0===this.angle)return this.actualBounds.containsRect(t);let e=this.naturalBounds,i=tw.X(0,0,e.width,e.height),s=this.F,n=!1,l=ty.X(t.x,t.y);return i.containsPoint(s._e(l))&&(l.i(t.x,t.bottom),i.containsPoint(s._e(l))&&(l.i(t.right,t.bottom),i.containsPoint(s._e(l))&&(l.i(t.right,t.y),i.containsPoint(s._e(l))&&(n=!0)))),ty.e(l),tw.e(i),n}containedInRect(t,e){if(void 0===e)return t.containsRect(this.actualBounds);let i=this.naturalBounds,s=!1,n=ty.X(0,0);return t.containsPoint(e.xt(n))&&(n.i(0,i.height),t.containsPoint(e.xt(n))&&(n.i(i.width,i.height),t.containsPoint(e.xt(n))&&(n.i(i.width,0),t.containsPoint(e.xt(n))&&(s=!0)))),ty.e(n),s}intersectsRect(t,e){if(void 0===e&&(e=this.F,0===this.angle))return t.intersectsRect(this.actualBounds);let i=this.naturalBounds,s=e,n=ty.X(0,0),l=ty.X(0,i.height),r=ty.X(i.width,i.height),o=ty.X(i.width,0),h=!1;if(t.containsPoint(s.xt(n))||t.containsPoint(s.xt(l))||t.containsPoint(s.xt(r))||t.containsPoint(s.xt(o)))h=!0;else{let e=tw.X(0,0,i.width,i.height),a=ty.X(t.x,t.y);e.containsPoint(s._e(a))?h=!0:(a.i(t.x,t.bottom),e.containsPoint(s._e(a))?h=!0:(a.i(t.right,t.bottom),e.containsPoint(s._e(a))?h=!0:(a.i(t.right,t.y),e.containsPoint(s._e(a))&&(h=!0)))),ty.e(a),tw.e(e),h||(tP.kw(t,n,l)||tP.kw(t,l,r)||tP.kw(t,r,o)||tP.kw(t,o,n))&&(h=!0)}return ty.e(n),ty.e(l),ty.e(r),ty.e(o),h}getDocumentPoint(t,e){if(void 0===e&&(e=new ty),!(t instanceof tv))return e.set(t),this.Ys.xt(e),e;{let i=this.naturalBounds;return e.i(t.x*i.width+t.offsetX,t.y*i.height+t.offsetY),this.Ys.xt(e),e}}getDocumentBounds(t){void 0===t&&(t=new tw);let e=this.naturalBounds,i=this.Ys,s=ty.X(0,0).F(i);return t.i(s.x,s.y,0,0),s.i(e.width,0).F(i),t.unionNoCheck(s.x,s.y,0,0),s.i(e.width,e.height).F(i),t.unionNoCheck(s.x,s.y,0,0),s.i(0,e.height).F(i),t.unionNoCheck(s.x,s.y,0,0),ty.e(s),t}getDocumentAngle(){return this.Ys.GD()}getDocumentScale(){if(!1===this.b0())return this.wa;let t=this.nt;return null!==this.panel?t*this.panel.getDocumentScale():t}getLocalPoint(t,e){return void 0===e&&(e=new ty),e.a(t),this.Ys._e(e),e}getNearestIntersectionPoint(t,e,i){return this.ef(t.x,t.y,e.x,e.y,i)}ef(t,e,i,s,n){let l=this.F,r=1/(l.m11*l.m22-l.m12*l.m21),o=l.m22*r,h=-l.m12*r,a=-l.m21*r,u=l.m11*r,d=r*(l.m21*l.dy-l.m22*l.dx),c=r*(l.m12*l.dx-l.m11*l.dy);n.i(0,0);let g=this.naturalBounds,f=tP.kl(0,0,g.width,g.height,t*o+e*a+d,t*h+e*u+c,i*o+s*a+d,i*h+s*u+c,n);return n.F(l),f}ut(t,e,i,s){if(!1===this.Bo())return;let n=this.tl,l=n.right+n.left,r=n.top+n.bottom;t=Math.max(t-l,0),e=Math.max(e-r,0),s=s||0,i=Math.max((i=i||0)-l,0),s=Math.max(s-r,0);let o=this.angle,h=0,a=this.desiredSize,u=this.k0();90===o||270===o?(t=isFinite(a.height)?a.height+u:t,e=isFinite(a.width)?a.width+u:e):(t=isFinite(a.width)?a.width+u:t,e=isFinite(a.height)?a.height+u:e);let d=i||0,c=s||0,g=this instanceof eq;switch(this.Hs(!0)){case 0:d=0,c=0,g&&(t=1/0,e=1/0);break;case 2:isFinite(t)&&t>i&&(d=t),isFinite(e)&&e>s&&(c=e);break;case 5:isFinite(t)&&t>i&&(d=t),c=0,g&&(e=1/0);break;case 4:isFinite(e)&&e>s&&(c=e),d=0,g&&(t=1/0)}let f=this.maxSize,m=this.minSize;d>f.width&&m.width<f.width&&(d=f.width),c>f.height&&m.height<f.height&&(c=f.height),i=Math.max(d,m.width),s=Math.max(c,m.height),f.width<i&&(i=Math.min(m.width,i)),f.height<s&&(s=Math.min(m.height,s)),t=Math.min(f.width,t),e=Math.min(f.height,e),t=Math.max(i,t),e=Math.max(s,e),(90===o||270===o)&&(h=t,t=e,e=h,h=i,i=s,s=h),this.re.At(),this._u(t,e,i,s),this.re.u(),this.re.isReal()||te.o("Non-real measuredBounds has been set. Object "+this+", measuredBounds: "+this.re.toString()),this.me(!1)}_u(t,e,i,s){}js(){return!1}Yt(t,e,i,s,n){this.sf();let l=tw.l();l.a(this.Ai),this.Ai.At(),!1===this.es()?this.Ai.i(t,e,i,s):this.ph(t,e,i,s),this.Ai.u(),void 0===n?this.ri=null:this.ri=n;let r=!1;if(void 0!==n)r=!0;else{let i=this.panel;if(null!==i&&i.el()&&(i=i.panel),null!==i){let s=i.Ki,n=this.measuredBounds,l=e+n.height,o=t+n.width;if(r=!(0<=t+.05&&o<=s.width+.05&&0<=e+.05&&l<=s.height+.05),this instanceof e3){let t=this.naturalBounds;(this.P0>t.height||this.mi>t.width)&&(r=!0)}}}r?this.n|=256:this.n&=-257,this.Ai.isReal()||te.o("Non-real actualBounds has been set. Object "+this+", actualBounds: "+this.Ai.toString()),this.td(l,this.Ai),this.no(!1),tw.e(l)}ph(t,e,i,s){}commonArrange(t,e,i,s){if(this.Ai.i(t,e,i,s),this.desiredSize.isReal())return;let n=this.re,l=this.tl,r=l.right+l.left,o=l.top+l.bottom,h=n.width+r,a=n.height+o;i+=r,s+=o;let u=this.Hs(!0);switch(h===i&&a===s&&(u=0),u){case 0:(h>i||a>s)&&(this.me(!0),this.ut(h>i?i:h,a>s?s:a,0,0));break;case 2:this.me(!0),this.ut(i,s,0,0);break;case 5:this.me(!0),this.ut(i,a,0,0);break;case 4:this.me(!0),this.ut(h,s,0,0)}}td(t,e){let i=this.part;null===i||null===i.diagram||((i.selectionObject===this||i.resizeObject===this||i.rotateObject===this)&&i.c2(!0),this.C(),t.equalsApproxClose(e)||(i.yh(),this.S0(i)))}S0(t){null!==this.portId&&(t.c2(!0),t instanceof io&&t.gA(this))}get shadowVisible(){return null!==this.b?this.b.M0:null}set shadowVisible(t){let e=this.shadowVisible;e!==t&&(this.qt().M0=t,this.Ye(!0),this.C(),this.t("shadowVisible",e,t))}VR(t,e){let i=this.naturalBounds,s=this.uh,n=s.m11,l=s.m21,r=s.dx,o=s.m12,h=s.m22,a=s.dy,u=0,d=0,c=0,g=0;u=0*n+0*l+r,d=c*o+g*h+a;let f=u,m=d,p=0,y=0;u=(c=i.width+e)*n+(g=0)*l+r,d=c*o+g*h+a;let x=Math.min(f,u),w=Math.min(m,d);p=Math.max(f+p,u)-x,y=Math.max(m+y,d)-w,f=x,m=w,u=(c=i.width+e)*n+(g=i.height+e)*l+r,d=c*o+g*h+a,x=Math.min(f,u),w=Math.min(m,d),p=Math.max(f+p,u)-x,y=Math.max(m+y,d)-w,f=x,m=w,u=(c=0)*n+(g=i.height+e)*l+r,d=c*o+g*h+a,x=Math.min(f,u),w=Math.min(m,d),p=Math.max(f+p,u)-x,y=Math.max(m+y,d)-w,f=x,m=w;let b=t.viewportBounds,v=b.x,k=b.y,P=b.width,S=b.height;return f>P+v||v>p+f||m>S+k||k>y+m}zi(t,e){if(this.zR(t,e)||!this.visible)return;let i=this.opacity;if(0===i)return;let s=1;1!==i&&(s=t.globalAlpha,t.globalAlpha=s*i);let n="";""!==this.filter&&(n=t.filter,t.filter=this.filter);let l=this.F,r=this.panel;!0===this.b0()&&this.Fb();let o=this.part,h=!1,a=0;if(o&&e.getRenderingHint("drawShadows")&&(h=o.isShadowed)){let t=o.shadowOffset;a=Math.max(t.y,t.x)*e.scale*e.Yi}let u=this instanceof eq&&this.el(),d=this.Ai;if(u&&(this.mA(h,t,!1,r),this.XR(t,e),this.pA(h,t,!1,r),this.yA(h,t,!1)),u||!u&&(0===d.width||0===d.height||isNaN(d.x)||isNaN(d.y))){1!==i&&(t.globalAlpha=s),""!==this.filter&&(t.filter=n);return}let c=this.js();if(!e.oa&&c&&this.VR(e,a)){1!==i&&(t.globalAlpha=s),""!==this.filter&&(t.filter=n);return}let g=(256&this.n)!=0;if(t.clipInsteadOfFill&&(g=!1),this instanceof e3&&(t.font=this.font),g){let e=r.wn()?r.naturalBounds:r.actualBounds,l=Math.max(d.x,e.x),o=Math.max(d.y,e.y),h=Math.min(d.right,e.right)-l,a=Math.min(d.bottom,e.bottom)-o,u=this.ri;if(null!==u&&(l=u.x,o=u.y,h=u.width,a=u.height),l>d.width+d.x||d.x>e.width+e.x){1!==i&&(t.globalAlpha=s),""!==this.filter&&(t.filter=n);return}t.save(),t.beginPath(),t.rect(l,o,h,a),t.clip()}if(c){if(!o.isVisible()){1!==i&&(t.globalAlpha=s),""!==this.filter&&(t.filter=n);return}if(h){let i=o.shadowOffset;t.shadowsSet(i.x*e.scale*this.scale*e.Yi,i.y*e.scale*this.scale*e.Yi,o.shadowBlur),t.shadowsOn(),t.shadowColor=o.shadowColor}}let f=this.naturalBounds;if(t.transform(l.m11,l.m12,l.m21,l.m22,l.dx,l.dy),this.mA(h,t,c,r),null!==this.Dt&&(t.commitTransform(),this.Rb(t,f,d)),this.pA(h,t,c,r),this.wh(t,e),this.yA(h,t,c),g&&(t.restore(),t.clearContextCache(this instanceof eq)),!l.Ik()){let e=1/(l.m11*l.m22-l.m12*l.m21);t.transform(l.m22*e,-l.m12*e,-l.m21*e,l.m11*e,e*(l.m21*l.dy-l.m22*l.dx),e*(l.m12*l.dx-l.m11*l.dy))}1!==i&&(t.globalAlpha=s),""!==this.filter&&(t.filter=n)}mA(t,e,i,s){t&&!0===this.shadowVisible?e.shadowsOn():t&&!1===this.shadowVisible&&e.shadowsOff(),t&&this.vb(s)&&null===this.shadowVisible&&e.shadowsOff()}pA(t,e,i,s){t&&(null!==this.Dt||this.vb(s))?(this.Ob(!0),null===this.shadowVisible&&e.shadowsOff()):this.Ob(!1)}yA(t,e,i){t&&!0===this.f2()&&e.shadowsOn(),i&&t&&e.shadowsOff()}YR(t,e,i){let s=this.part,n=!1;s&&t.getRenderingHint("drawShadows")&&(n=s.isShadowed),e.clipInsteadOfFill&&(n=!1),this.js()&&n&&e.shadowsOn(),n&&!0===this.shadowVisible?e.shadowsOn():n&&!1===this.shadowVisible&&e.shadowsOff();let l=this.panel;if(n&&this.vb(l)&&null===this.shadowVisible&&e.shadowsOff(),e.sl){let s=t.computePixelRatio(),n=`drop-shadow(${e.shadowOffsetX/s}px ${e.shadowOffsetY/s}px ${e.shadowBlur/s/2}px ${e.shadowColor})`;null!==this.background&&i.Dt.setAttributeNS(null,"filter",n)}return n&&(null!==this.Dt||this.vb(l))?(this.Ob(!0),null===this.shadowVisible&&e.shadowsOff()):this.Ob(!1),n}KR(t,e,i,s){if(i.sl){let s=e.computePixelRatio(),n=`drop-shadow(${i.shadowOffsetX/s}px ${i.shadowOffsetY/s}px ${i.shadowBlur/s/2}px ${i.shadowColor})`;this.u2(t,n)}s&&!0===this.f2()&&i.shadowsOn(),this.js()&&i.shadowsOff()}vb(t){return null!==t&&(t.el()&&(t=t.panel),t.f2()||(t.type===eq.Auto||t.type===eq.Spot)&&t.findMainElement()!==this)}u2(t,e){}Rb(t,e,i){let s=this.k0(),n=e.x,l=e.y,r=e.width+s,o=e.height+s;this.mn(t,this.Dt,!0,!1,e,i),this.Dt instanceof eD&&3===this.Dt.type?(t.beginPath(),t.rect(n-s/2,l-s/2,r,o),t.fillContext(this.Dt,!1,null)):t.fillRect(n-s/2,l-s/2,r,o)}wA(t,e){let i=t.GR(this),s=null!==t.dh?t.dh:t.svg;if(-1!==i){if(0===i){if(s.Dt)s.Dt.after(e);else if(t.type===eq.Table){let t=s.getElementsByClassName("gojs-ts"),i=0!==t.length?t[0]:null;null!==i&&i.after(e)}else s.prepend(e)}else{for(;0!==i&&!t.elt(i-1).isVisibleObject();)i--;if(0===i)s.prepend(e);else{let n=t.elt(i-1).svg;null!==n?n.after(e):s.appendChild(e)}}}}zR(t,e){if(!(t instanceof eM))return!1;if(!this.visible||0===this.opacity)return null!==this.svg&&null!==this.svg.parentNode&&this.svg.remove(),!0;let i=this.Ai;if(this.js()&&(!this.isVisible()||0===i.width||0===i.height||isNaN(i.x)||isNaN(i.y)))return null!==this.svg&&null!==this.svg.parentNode&&this.svg.remove(),!0;let s=this.panel,n=this.ed(t);if(this.nf(t,e,n))return this.xA(this.svg),null!==this.svg.parentElement?this.js()&&(t.lastDrawnPart=this.svg):this.js()?(null!==t.lastDrawnPart?t.lastDrawnPart.after(this.svg):t.diagramGroup.prepend(this.svg),t.lastDrawnPart=this.svg):s&&this.wA(s,this.svg),!0;if(this.Ye(!1),this.js()&&this.isShadowed){let i=this.shadowOffset;t.shadowsSet(i.x*e.scale*this.scale*e.Yi,i.y*e.scale*this.scale*e.Yi,this.shadowBlur),t.shadowsOn(),t.shadowColor=this.shadowColor}this instanceof e3&&(t.font=this.font),t.currentElement=null;let l=this.F,r=this instanceof eq,o=this instanceof eq&&this.el(),h=this.svg;if(!0===this.b0()&&this.Fb(),t.setCurrentTransform(1,0,0,1,0,0),t.outerGroup=!1,n){if(t.outerGroup=!0,r&&o)t.newGroup(1,0,0,1,0,0),this.svg=t.lastCreatedElement;else if(r&&this.isClipping){let e=this.findMainElement(),i=0,s=0;null!==e&&(i=e.actualBounds.x,s=e.actualBounds.y),t.newGroup(l.m11,l.m12,l.m21,l.m22,l.dx+i,l.dy+s),this.svg=t.lastCreatedElement,null!==e&&t.createOrUpdateClipGroup(this,e.actualBounds),t.currentElement=t.lastCreatedElement}else r?(t.newGroup(l.m11,l.m12,l.m21,l.m22,l.dx,l.dy),this.svg=t.lastCreatedElement):t.newGroup(1,0,0,1,0,0)}let a=this.naturalBounds;r||t.setCurrentTransform(l.m11,l.m12,l.m21,l.m22,l.dx,l.dy),null!==this.background&&(r?(o&&t.setCurrentTransform(l.m11,l.m12,l.m21,l.m22,l.dx,l.dy),this.Rb(t,a,i),o&&t.setCurrentTransform(1,0,0,1,0,0)):(t.setCurrentTransform(l.m11,l.m12,l.m21,l.m22,l.dx,l.dy),this.Rb(t,a,i)),t.currentElement.Dt=t.lastCreatedElement,t.currentElement.prepend(t.lastCreatedElement));let u=this.YR(e,t,t.currentElement);this.wh(t,e),r&&t.endGroup(),t.outerGroup&&t.endGroup();let d=t.surface.Wu,c=r?this.svg:t.currentElement;if(null!==h&&c!==h&&h.parentNode===this.panel.svg){let e=this.svg.getAttribute("filter");return null!==e&&c.setAttribute("filter",e),h.replaceWith(c),this.svg=c,null!==c&&this.N0(t,s,i,c),!0}if(this.svg=c,null!==d&&null===c&&t.dummyGroup(),null===c)return!0;this.N0(t,s,i,c),this.KR(c,e,t,u);let g=this.js()?this.opacity*t.globalAlpha:this.opacity;if(1!==g&&c.setAttributeNS(null,"opacity",g.toString()),""!==this.filter&&c.setAttributeNS(null,"filter",this.filter),this.js()){if(null!==h&&c!==h&&h.parentNode===t.diagramGroup){let t=h.getAttribute("filter");null!==t&&c.setAttribute("filter",t),h.replaceWith(c)}else t.lastDrawnPart?t.lastDrawnPart.after(c):t.diagramGroup.prepend(c);t.lastDrawnPart=c}else null!==s&&this.wA(s,c);return null!==d&&d(this,c),this.xA(c),!0}xA(t){let e=t.dataset;this instanceof eb&&(null!==this.portId&&(e.portId=this.portId),this instanceof eq&&(isNaN(this.itemIndex)||(e.itemIndex=this.itemIndex.toString()),this instanceof ii&&(e.className=te.Vn(this),void 0!==this.key&&(e.key=this.key.toString()),null!==this.containingGroup&&(e.group=this.containingGroup.key.toString()),this instanceof ic&&(null!==this.fromNode&&void 0!==this.fromNode.key&&(e.fromKey=this.fromNode.key.toString()),""!==this.fromPortId&&(e.fromPortId=this.fromPortId),null!==this.toNode&&void 0!==this.toNode.key&&(e.toKey=this.toNode.key.toString()),""!==this.toPortId&&(e.toPortId=this.toPortId)))))}N0(t,e,i,s){let n=(256&this.n)!=0;if(t.clipInsteadOfFill&&(n=!1),!n){s.removeAttributeNS(null,"clip-path");return}let l=e.wn()?e.naturalBounds:e.actualBounds,r=Math.max(i.x,l.x),o=Math.max(i.y,l.y),h=Math.min(i.right,l.right)-r,a=Math.min(i.bottom,l.bottom)-o,u=this.ri;null!==u&&(r=u.x,o=u.y,h=u.width,a=u.height);let d=new tw(r,o,Math.max(h,0),Math.max(a,0));this instanceof eq&&this.F.copy().yw().Ug(d),s.setAttributeNS(null,"clip-path",`path('      M ${d.x},${d.y}       L ${d.width+d.x} ${d.y}       L ${d.width+d.x} ${d.height+d.y}       L ${d.x} ${d.height+d.y} z') view-box`)}HR(){if(null===this.svg)return;let t=this.svg.innerHTML.match(/url\(#((CLIP|GRAD).+?)\)/g),e=this.svg.ownerDocument;if(null!==t)for(let i of t){let t=e.getElementById(i.split("#")[1].slice(0,-1));null!==t&&t.remove()}this.svg.remove()}XR(t,e){let i=this.Ai,s=this.Ki,n=this.Dt;null!==n&&t.commitTransform(),null!==n&&(this.mn(t,n,!0,!1,s,i),n instanceof eD&&3===n.type?(t.beginPath(),t.rect(i.x,i.y,i.width,i.height),t.fillContext(n,!1,null)):t.fillRect(i.x,i.y,i.width,i.height)),this.wh(t,e)}wh(t,e){}of(){this.Ye(!0)}nf(t,e,i){let s=this.svg;if(this.jR()){if(this.of(),this.Ye(!1),null===s)return!1;let e=s.getAttribute("clip-path");if(null!==e&&e.includes("url")){let i=t.svg.getElementById(e.split("#")[1].slice(0,-1));null!==i&&i.remove()}return s.getAttribute("filter")&&s.removeAttribute("filter"),!1}if(null===s)return!1;if(!this.visible)return s.remove(),!1;if("g"!==s.nodeName&&i||"g"===s.nodeName&&!i)return!1;let n=this.F,l="matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+n.dx+", "+n.dy+")",r=this instanceof eq,o=!!r&&this.el();if(!(r&&o)){if(this instanceof e6){let e=this.Ib;t.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),null!==e&&t.amendImageTransform(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]),i?s.lastElementChild.setAttributeNS(null,"transform",t.getCurrentTransform()):s.setAttributeNS(null,"transform",t.getCurrentTransform())}else if(i&&!r){if(this instanceof e$){let t=s.getElementsByTagName("path");for(let e=0;e<t.length;e++)t[e].setAttributeNS(null,"transform",l)}else if(this instanceof e3){let t=s.getElementsByTagName("text"),e="string"==typeof this.stroke?this.stroke:null;for(let i=0;i<t.length;i++)t[i].setAttributeNS(null,"transform",l),e&&t[i].setAttributeNS(null,"fill",e)}else(s.lastElementChild||s).setAttributeNS(null,"transform",l)}else if(r&&this.isClipping&&this.dh){let t=this.findMainElement(),e=null!==t?t.actualBounds.x:0,i=null!==t?t.actualBounds.y:0;this.dh.setAttributeNS(null,"transform","matrix(1,0,0,1,"+-e+", "+-i+")"),s.setAttributeNS(null,"transform","matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+(n.dx+e)+", "+(n.dy+i)+")")}else s.setAttributeNS(null,"transform",l)}let h=this.js()?this.opacity*t.globalAlpha:this.opacity;1===h?s.removeAttribute("opacity"):s.setAttributeNS(null,"opacity",h.toString()),t.setCurrentTransform(1,0,0,1,0,0);let a=this.dh?this.dh:this.Db;if(null!==this.background||void 0!==a.Dt){let e=a.Dt;if(null===this.background)t.removeOldGradient(this,a.Dt,"fill"),a.Dt.remove(),a.Dt=void 0;else{if(!o&&(!i||this instanceof eq)||t.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),this.Rb(t,this.naturalBounds,this.actualBounds),a.Dt){t.removeOldGradient(this,a.Dt,"fill");let e=a.Dt.getAttribute("filter");null!==e&&t.lastCreatedElement.setAttribute("filter",e),a.Dt.replaceWith(t.lastCreatedElement)}else a.prepend(t.lastCreatedElement);a.Dt=t.lastCreatedElement}e&&t.removeOldGradient(this,e,"fill")}return this.N0(t,this.panel,this.actualBounds,s),!0}ed(t){if(null!==this.background)return!0;let e=(256&this.n)!=0;return t.clipInsteadOfFill&&(e=!1),!!e}static PE(t,e,i,s,n,l,r){let o=.001,h=l.length;t.moveTo(e,i);let a=s-e,u=n-i;0===a&&(a=.001);let d=u/a,c=Math.sqrt(a*a+u*u),g=0,f=!0;o=l[0%h];let m=0!==r;for(;c>=.1;){if(m){for(o=l[g++%h]-r;o<0;)o+=l[g++%h],f=!f;m=!1}else o=l[g++%h];o>c&&(o=c);let s=Math.sqrt(o*o/(1+d*d));a<0&&(s=-s),e+=s,i+=d*s,f?t.lineTo(e,i):t.moveTo(e,i),c-=o,f=!f}}mn(t,e,i,s,n,l){let r,o=1,h=1;if("string"==typeof e){i?t.fillStyle=e:t.strokeStyle=e;return}if(1===e.type){i?t.fillStyle=e.color:t.strokeStyle=e.color;return}let a=this.k0();o=n.width,h=n.height,s?(o=l.width,h=l.height):i||(o+=a,h+=a);let u=t instanceof eC;if(u&&e.xn&&(4===e.type||e.rf===o&&e.Eb===h))r=e.xn;else{let n=0,d=0,c=0,g=0,f=0,m=0,p=0,y=0;if(s?(p=l.x,y=l.y):i||(p-=a/2,y-=a/2),n=e.start.x*o+e.start.offsetX+p,d=e.start.y*h+e.start.offsetY+y,c=e.end.x*o+e.end.offsetX+p,g=e.end.y*h+e.end.offsetY+y,2===e.type)r=t.createLinearGradient(n,d,c,g);else if(3===e.type)m=isNaN(e.endRadius)?Math.max(o,h)/2:e.endRadius,isNaN(e.startRadius)?(f=0,m=Math.max(o,h)/2):f=e.startRadius,r=t.createRadialGradient(n,d,f,c,g,m);else if(4===e.type)try{r=t.createPattern(e.pattern,"repeat")}catch{r=null}else te.te(e.type,"Brush type");if(4!==e.type){let t=e.colorStops;if(null!==t){let e=t.iterator;for(;e.next();)r.addColorStop(e.key,e.value)}}if(u&&(e.xn=r,null!==r&&(e.rf=o,e.Eb=h),null===r&&4===e.type&&-1!==e.rf)){e.rf=-1;let t=this.diagram;null!==t&&-1===e.rf&&te.ar(()=>{t.redraw()},600)}}i?t.fillStyle=r:t.strokeStyle=r}isContainedBy(t){return t instanceof eq&&this.qR(this,t)}qR(t,e){if(t===e||null===e)return!1;let i=t.panel;for(;null!==i;){if(i===e)return!0;i=i.panel}return!1}isVisibleObject(){if(!this.visible)return!1;let t=this.panel;return null===t||t.isVisibleObject()}isEnabledObject(){let t=this instanceof eq?this:this.panel;for(;null!==t&&t.isEnabled;)t=t.panel;return null===t}get enabledChanged(){return null!==this.b?this.b.C0:null}set enabledChanged(t){let e=this.enabledChanged;e!==t&&(null!==t&&te.S(t,eb,"enabledChanged"),this.qt().C0=t,this.t("enabledChanged",e,t))}Fb(){if(!0===this.Bb()){let t=this._r;if(t.Ii(),!this.Ai.isReal()||!this.re.isReal()){this.sd(!1);return}if(t.Es(this.Ai.x-this.re.x,this.Ai.y-this.re.y),1!==this.scale||0!==this.angle){let e=this.naturalBounds;this.x0(t,e.x,e.y,e.width,e.height)}this.sd(!1),this.Ca(!0)}if(!0===this.b0()){let t=this.panel;if(null===t)this.uh.set(this._r),this.wa=this.scale;else if(null!==t.Ys){let e=this.uh;e.Ii(),t.wn()?e.ac(t.uh):null!==t.panel&&e.ac(t.panel.uh),e.ac(this._r),this.wa=this.scale*t.wa}this.Ca(!1)}}x0(t,e,i,s,n){if(1!==this.nt&&t.nt(this.nt),0===this.Ht)return;let l=ty.l();l.setSpot(e,i,s,n,tv.Center),t.ds(this.Ht,l.x,l.y),ty.e(l)}c(t){if(this.Bo())return;void 0===t&&(t=!1),this.me(!0),this.no(!0);let e=this.panel;null===e||t||e.c()}lf(){this.Bo()||(this.me(!0),this.no(!0))}hf(t){if(this.es())return;let e=this.panel;t||null===e||e.c(),this.no(!0)}sf(){!1===this.Bb()&&(this.sd(!0),this.Ca(!0))}d2(){this.Ca(!0)}C(){let t=this.part;null!==t&&t.C()}Hs(t){let e=this.stretch,i=this.panel;if(null===i)return this.Yo(1===e?0:e,t);if(i.type===eq.Table)return this.L0(i.getRowDefinition(this.row),i.getColumnDefinition(this.column),t);if(i.type===eq.Auto&&i.findMainElement()===this)return this.Yo(2,t);if(1===e){if(i.type===eq.Spot&&i.findMainElement()===this)return this.Yo(2,t);let e=i.defaultStretch;return 1===e?this.Yo(0,t):this.Yo(e,t)}return this.Yo(e,t)}L0(t,e,i){let s=this.stretch;if(1!==s)return this.Yo(s,i);let n=null,l=null;switch(t.stretch){case 1:case 5:break;case 4:case 2:l=!0}switch(e.stretch){case 1:case 4:break;case 5:case 2:n=!0}let r=this.panel.defaultStretch;return null===n&&(n=5===r||2===r),null===l&&(l=4===r||2===r),!0===n&&!0===l?this.Yo(2,i):!0===n?this.Yo(5,i):!0===l?this.Yo(4,i):this.Yo(0,i)}Yo(t,e){if(e)return t;if(0===t)return 0;let i=this.desiredSize;if(i.isReal())return 0;let s=!isNaN(i.width),n=!isNaN(i.height),l=this.angle;if(s){if(90!==l&&270!==l){if(5===t)return 0;if(2===t)return 4}else{if(4===t)return 0;if(2===t)return 5}}if(n){if(90!==l&&270!==l){if(4===t)return 0;if(2===t)return 5}else{if(5===t)return 0;if(2===t)return 4}}return t}get segmentOrientation(){return null!==this.Ut?this.Ut.A0:0}set segmentOrientation(t){let e=this.segmentOrientation;e!==t&&(null===this.Ut&&(this.Ut=new iw),this.Ut.A0=t,this.c(),this.t("segmentOrientation",e,t),0===t&&(this.angle=0))}WR(){this.segmentOrientation=21}get segmentIndex(){return null!==this.Ut?this.Ut.T0:-1/0}set segmentIndex(t){t=Math.round(t);let e=this.segmentIndex;e!==t&&(null===this.Ut&&(this.Ut=new iw),this.Ut.T0=t,this.c(),this.t("segmentIndex",e,t))}get segmentFraction(){return null!==this.Ut?this.Ut.D0:0}set segmentFraction(t){t<0?t=0:t>1&&(t=1);let e=this.segmentFraction;e!==t&&(null===this.Ut&&(this.Ut=new iw),this.Ut.D0=t,this.c(),this.t("segmentFraction",e,t))}get segmentOffset(){return null!==this.Ut?this.Ut.F0:ty.Lo}set segmentOffset(t){let e=this.segmentOffset;e.equals(t)||(t=t.N(),null===this.Ut&&(this.Ut=new iw),this.Ut.F0=t,this.c(),this.t("segmentOffset",e,t))}get stretch(){return null!==this.b?this.b.oo:1}set stretch(t){let e=this.stretch;e!==t&&(this.qt().oo=t,this.c(),this.t("stretch",e,t))}get name(){return null!==this.b?this.b.Nt:""}set name(t){let e=this.name;e!==t&&(this.qt().Nt=t,null!==this.part&&this.part.R0(),this.t("name",e,t))}get opacity(){return this._t}set opacity(t){t<0?t=0:t>1&&(t=1);let e=this.opacity;if(e!==t){this._t=t,this.t("opacity",e,t);let i=this.diagram,s=this.part;null!==i&&null!==s&&i.C(s.Qh(s.actualBounds))}}get filter(){return this.y0}set filter(t){let e=this.filter;if(e!==t){this.y0=t,this.Ye(!0),this.t("filter",e,t);let i=this.diagram,s=this.part;null!==i&&null!==s&&i.C(s.Qh(s.actualBounds))}}get visible(){return(1&this.n)!=0}set visible(t){let e=(1&this.n)!=0;if(e!==t){this.n=1^this.n,this.of(),this.t("visible",e,t);let i=this.panel;null!==i?i.c():this.js()&&this.Vi(t),this.C(),this.bA()}}get pickable(){return(2&this.n)!=0}set pickable(t){let e=(2&this.n)!=0;e!==t&&(this.n=2^this.n,this.t("pickable",e,t))}get fromLinkableDuplicates(){return(4&this.n)!=0}set fromLinkableDuplicates(t){let e=(4&this.n)!=0;e!==t&&(this.n=4^this.n,this.t("fromLinkableDuplicates",e,t))}get fromLinkableSelfNode(){return(8&this.n)!=0}set fromLinkableSelfNode(t){let e=(8&this.n)!=0;e!==t&&(this.n=8^this.n,this.t("fromLinkableSelfNode",e,t))}get toLinkableDuplicates(){return(16&this.n)!=0}set toLinkableDuplicates(t){let e=(16&this.n)!=0;e!==t&&(this.n=16^this.n,this.t("toLinkableDuplicates",e,t))}get toLinkableSelfNode(){return(32&this.n)!=0}set toLinkableSelfNode(t){let e=(32&this.n)!=0;e!==t&&(this.n=32^this.n,this.t("toLinkableSelfNode",e,t))}get isPanelMain(){return(64&this.n)!=0}set isPanelMain(t){let e=(64&this.n)!=0;e!==t&&(this.n=64^this.n,this.c(),this.t("isPanelMain",e,t))}get isActionable(){return(128&this.n)!=0}set isActionable(t){let e=(128&this.n)!=0;e!==t&&(this.n=128^this.n,this.t("isActionable",e,t))}get background(){return this.Dt}set background(t){let e=this.background;e!==t&&(null!==t&&eD.nd(t,"GraphObject.background"),t instanceof eD&&t.u(),this.Dt=t,this.C(),this.t("background",e,t))}f2(){return(512&this.n)!=0}Ob(t){t?this.n|=512:this.n&=-513}tf(){return(1024&this.n)!=0}g2(t){t?this.n|=1024:this.n&=-1025}Bb(){return(2048&this.n)!=0}sd(t){t?this.n|=2048:this.n&=-2049}b0(){return(4096&this.n)!=0}Ca(t){t?this.n|=4096:this.n&=-4097}Bo(){return(8192&this.n)!=0}me(t){t?this.n|=8192:this.n&=-8193}es(){return(16384&this.n)!=0}no(t){t?this.n|=16384:this.n&=-16385}jR(){return(32768&this.n)!=0}Ye(t){t?this.n|=32768:this.n&=-32769}get part(){if(this.js())return this;if(null!==this.il)return this.il;let t=this;for(t=t.panel;t;){if(t instanceof ii)return this.il=t,t;t=t.panel}return null}get svg(){return this.Db}set svg(t){this.Db=t}vu(){this.svg=null}get panel(){return this.Gs}La(t){this.Gs=t,null!==this.svg&&this.svg.remove()}get layer(){let t=this.part;return null!==t?t.layer:null}get diagram(){let t=this.part;return null!==t?t.diagram:null}get position(){return this.dt}set position(t){let e=t.x,i=t.y,s=this.position,n=s.x,l=s.y;(n===e||isNaN(n)&&isNaN(e))&&(l===i||isNaN(l)&&isNaN(i))?this.p2():(t=t.copy(),this.m2(t,n,l)&&this.t("position",new ty(n,l),t.copy()))}p2(){}m2(t,e,i){return this.dt=t,this.hf(),!0}Cc(t,e,i){this.dt.x===t&&this.dt.y===e||(this.dt.i(t,e),this.sf())}get actualBounds(){return this.Ai}get scale(){return this.nt}set scale(t){let e=this.scale;e!==t&&(t<=0&&te.o("GraphObject.scale for "+this+" must be greater than zero, not: "+t),this.nt=t,this.c(),this.t("scale",e,t))}get angle(){return this.Ht}set angle(t){let e=this.angle;if(e!==t){if((t%=360)<0&&(t+=360),e===t)return;this.Ht=t,this.bA(),this.c(),this.t("angle",e,t)}}get desiredSize(){return this.ns}set desiredSize(t){let e=t.width,i=t.height,s=this.desiredSize,n=s.width,l=s.height;if((n!==e&&(!isNaN(n)||!isNaN(e))||l!==i&&(!isNaN(l)||!isNaN(i)))&&(t=t.N(),this.ns=t,this.c(),this instanceof e$&&this.oe(),this.t("desiredSize",s,t),this.tf())){let t=this.part;null!==t&&(this.Na(t,"width"),this.Na(t,"height"))}}get width(){return this.ns.width}set width(t){let e=this.ns.width;if(e!==t&&(!isNaN(e)||!isNaN(t))){let e=this.ns,i=new tx(t,this.ns.height).u();if(this.ns=i,this.c(),this instanceof e$&&this.oe(),this.t("desiredSize",e,i),this.tf()){let t=this.part;null!==t&&this.Na(t,"width")}}}get height(){return this.ns.height}set height(t){let e=this.ns.height;if(e!==t&&(!isNaN(e)||!isNaN(t))){let e=this.ns,i=new tx(this.ns.width,t).u();if(this.ns=i,this.c(),this instanceof e$&&this.oe(),this.t("desiredSize",e,i),this.tf()){let t=this.part;null!==t&&this.Na(t,"height")}}}get minSize(){return null!==this.b?this.b.Sr:tx.hc}set minSize(t){let e=this.minSize;e.equals(t)||(isNaN((t=t.copy()).width)&&(t.width=0),isNaN(t.height)&&(t.height=0),t.u(),this.qt().Sr=t,this.c(),this.t("minSize",e,t))}get maxSize(){return null!==this.b?this.b.Mr:tx.Fk}set maxSize(t){let e=this.maxSize;e.equals(t)||(isNaN((t=t.copy()).width)&&(t.width=1/0),isNaN(t.height)&&(t.height=1/0),t.u(),this.qt().Mr=t,this.c(),this.t("maxSize",e,t))}get measuredBounds(){return this.re}get naturalBounds(){return this.Ki}k0(){return 0}get margin(){return this.tl}set margin(t){"number"==typeof t&&(t=new tb(t));let e=this.tl;e.equals(t)||(t=t.N(),this.tl=t,this.c(),this.t("margin",e,t))}get F(){return!0===this.Bb()&&this.Fb(),this._r}get Ys(){return!0===this.b0()&&this.Fb(),this.uh}trigger(t,e,i){let s=null;return(s="string"==typeof t?new ei(t,e,i):t).Se=this,null===this.ks&&(this.ks=new tp),this.ks.set(s.propertyName,s),this}get ks(){return null!==this.b?this.b.ks:null}set ks(t){this.ks!==t&&(this.qt().ks=t)}get Pr(){return null!==this.b?this.b.Pr:0}set Pr(t){this.Pr!==t&&(this.qt().Pr=t)}get alignment(){return this.fi}set alignment(t){let e=this.alignment;e.equals(t)||(t.isNoSpot()&&!t.isDefault()&&te.o("GraphObject.alignment for "+this+" must be a real Spot or Spot.Default, not: "+t),t=t.N(),this.fi=t,this.hf(),this.t("alignment",e,t))}get column(){return this.Qr}set column(t){t=Math.round(t);let e=this.column;e!==t&&(t<0&&te._(t,">= 0",eb,"column"),this.Qr=t,this.c(),this.t("column",e,t),null!==this.svg&&this.svg.remove())}get columnSpan(){return null!==this.b?this.b.v0:1}set columnSpan(t){t=Math.round(t);let e=this.columnSpan;e!==t&&(t<1&&te._(t,">= 1",eb,"columnSpan"),this.qt().v0=t,this.c(),this.t("columnSpan",e,t))}get row(){return this.p0}set row(t){t=Math.round(t);let e=this.row;e!==t&&(t<0&&te._(t,">= 0",eb,"row"),this.p0=t,this.c(),this.t("row",e,t),null!==this.svg&&this.svg.remove())}get rowSpan(){return null!==this.b?this.b.O0:1}set rowSpan(t){t=Math.round(t);let e=this.rowSpan;e!==t&&(t<1&&te._(t,">= 1",eb,"rowSpan"),this.qt().O0=t,this.c(),this.t("rowSpan",e,t))}get spanAllocation(){return null!==this.b?this.b.I0:null}set spanAllocation(t){let e=this.spanAllocation;e!==t&&(null!==t&&te.S(t,eb,"spanAllocation"),this.qt().I0=t,this.c(),this.t("spanAllocation",e,t))}get alignmentFocus(){return this.$u}set alignmentFocus(t){let e=this.alignmentFocus;e.equals(t)||(t=t.N(),this.$u=t,this.c(),this.t("alignmentFocus",e,t))}get portId(){return this.m0}set portId(t){let e=this.portId;if(e!==t){let i=this.part;null===i||i instanceof io||te.o("Cannot set portID on a Link: "+t),null!==e&&null!==i&&i.w2(this),this.m0=t,null!==t&&null!==i&&(i.bn=!0,i.kA(this)),this.t("portId",e,t)}}Aa(){let t=this.part;if(t instanceof io&&(null!==this.portId||this===t.port)){let e=t.diagram;null===e||e.undoManager.isUndoingRedoing||t.gA(this)}}bA(){let t=this.diagram;null===t||t.undoManager.isUndoingRedoing||(this instanceof eq?this instanceof io?this.invalidateConnectedLinks():this.walkVisualTreeFrom(this,t=>{t.Aa()}):this.Aa())}get toSpot(){return null!==this.gt?this.gt.ba:tv.None}set toSpot(t){let e=this.toSpot;e.equals(t)||(t=t.N(),this.Xe().ba=t,this.t("toSpot",e,t),this.Aa())}get toEndSegmentLength(){return null!==this.gt?this.gt.Pa:10}set toEndSegmentLength(t){let e=this.toEndSegmentLength;e!==t&&(t<0&&te._(t,">= 0",eb,"toEndSegmentLength"),this.Xe().Pa=t,this.t("toEndSegmentLength",e,t),this.Aa())}get toShortLength(){return null!==this.gt?this.gt.Ma:0}set toShortLength(t){let e=this.toShortLength;e!==t&&(this.Xe().Ma=t,this.t("toShortLength",e,t),this.Aa())}get toLinkable(){return null!==this.gt?this.gt.E0:null}set toLinkable(t){let e=this.toLinkable;e!==t&&(this.Xe().E0=t,this.t("toLinkable",e,t))}get toMaxLinks(){return null!==this.gt?this.gt.B0:1/0}set toMaxLinks(t){let e=this.toMaxLinks;e!==t&&(t<0&&te._(t,">= 0",eb,"toMaxLinks"),this.Xe().B0=t,this.t("toMaxLinks",e,t))}get fromSpot(){return null!==this.gt?this.gt.xa:tv.None}set fromSpot(t){let e=this.fromSpot;e.equals(t)||(t=t.N(),this.Xe().xa=t,this.t("fromSpot",e,t),this.Aa())}get fromEndSegmentLength(){return null!==this.gt?this.gt.ka:10}set fromEndSegmentLength(t){let e=this.fromEndSegmentLength;e!==t&&(t<0&&te._(t,">= 0",eb,"fromEndSegmentLength"),this.Xe().ka=t,this.t("fromEndSegmentLength",e,t),this.Aa())}get fromShortLength(){return null!==this.gt?this.gt.Sa:0}set fromShortLength(t){let e=this.fromShortLength;e!==t&&(this.Xe().Sa=t,this.t("fromShortLength",e,t),this.Aa())}get fromLinkable(){return null!==this.gt?this.gt.U0:null}set fromLinkable(t){let e=this.fromLinkable;e!==t&&(this.Xe().U0=t,this.t("fromLinkable",e,t))}get fromMaxLinks(){return null!==this.gt?this.gt.V0:1/0}set fromMaxLinks(t){let e=this.fromMaxLinks;e!==t&&(t<0&&te._(t,">= 0",eb,"fromMaxLinks"),this.Xe().V0=t,this.t("fromMaxLinks",e,t))}get cursor(){return null!==this.b?this.b.Tl:""}set cursor(t){let e=this.cursor;e!==t&&(te.s(t,"string",eb,"cursor"),this.qt().Tl=t,this.t("cursor",e,t))}get click(){return null!==this.b?this.b.vr:null}set click(t){let e=this.click;e!==t&&(null!==t&&te.S(t,eb,"click"),this.qt().vr=t,this.t("click",e,t))}get doubleClick(){return null!==this.b?this.b.Or:null}set doubleClick(t){let e=this.doubleClick;e!==t&&(null!==t&&te.S(t,eb,"doubleClick"),this.qt().Or=t,this.t("doubleClick",e,t))}get contextClick(){return null!==this.b?this.b.Ir:null}set contextClick(t){let e=this.contextClick;e!==t&&(null!==t&&te.S(t,eb,"contextClick"),this.qt().Ir=t,this.t("contextClick",e,t))}get mouseEnter(){return null!==this.b?this.b.zr:null}set mouseEnter(t){let e=this.mouseEnter;e!==t&&(null!==t&&te.S(t,eb,"mouseEnter"),this.qt().zr=t,this.t("mouseEnter",e,t))}get mouseLeave(){return null!==this.b?this.b.Xr:null}set mouseLeave(t){let e=this.mouseLeave;e!==t&&(null!==t&&te.S(t,eb,"mouseLeave"),this.qt().Xr=t,this.t("mouseLeave",e,t))}get mouseOver(){return null!==this.b?this.b.Er:null}set mouseOver(t){let e=this.mouseOver;e!==t&&(null!==t&&te.S(t,eb,"mouseOver"),this.qt().Er=t,this.t("mouseOver",e,t))}get mouseHover(){return null!==this.b?this.b.Br:null}set mouseHover(t){let e=this.mouseHover;e!==t&&(null!==t&&te.S(t,eb,"mouseHover"),this.qt().Br=t,this.t("mouseHover",e,t))}get mouseHold(){return null!==this.b?this.b.Ur:null}set mouseHold(t){let e=this.mouseHold;e!==t&&(null!==t&&te.S(t,eb,"mouseHold"),this.qt().Ur=t,this.t("mouseHold",e,t))}get mouseDragEnter(){return null!==this.b?this.b.z0:null}set mouseDragEnter(t){let e=this.mouseDragEnter;e!==t&&(null!==t&&te.S(t,eb,"mouseDragEnter"),this.qt().z0=t,this.t("mouseDragEnter",e,t))}get mouseDragLeave(){return null!==this.b?this.b.X0:null}set mouseDragLeave(t){let e=this.mouseDragLeave;e!==t&&(null!==t&&te.S(t,eb,"mouseDragLeave"),this.qt().X0=t,this.t("mouseDragLeave",e,t))}get mouseDrop(){return null!==this.b?this.b.Vr:null}set mouseDrop(t){let e=this.mouseDrop;e!==t&&(null!==t&&te.S(t,eb,"mouseDrop"),this.qt().Vr=t,this.t("mouseDrop",e,t))}get actionDown(){return null!==this.b?this.b.Y0:null}set actionDown(t){let e=this.actionDown;e!==t&&(null!==t&&te.S(t,eb,"actionDown"),this.qt().Y0=t,this.t("actionDown",e,t))}get actionMove(){return null!==this.b?this.b.K0:null}set actionMove(t){let e=this.actionMove;e!==t&&(null!==t&&te.S(t,eb,"actionMove"),this.qt().K0=t,this.t("actionMove",e,t))}get actionUp(){return null!==this.b?this.b.G0:null}set actionUp(t){let e=this.actionUp;e!==t&&(null!==t&&te.S(t,eb,"actionUp"),this.qt().G0=t,this.t("actionUp",e,t))}get actionCancel(){return null!==this.b?this.b.H0:null}set actionCancel(t){let e=this.actionCancel;e!==t&&(null!==t&&te.S(t,eb,"actionCancel"),this.qt().H0=t,this.t("actionCancel",e,t))}get toolTip(){return null!==this.b?this.b.Yr:null}set toolTip(t){let e=this.toolTip;e!==t&&(this.qt().Yr=t,this.t("toolTip",e,t))}get contextMenu(){return null!==this.b?this.b.Kr:null}set contextMenu(t){let e=this.contextMenu;e!==t&&(this.qt().Kr=t,this.t("contextMenu",e,t))}findBindingPanel(){let t=this instanceof eq?this:this.panel;for(;null!==t;){if(t.b2())return t;t=t.panel}return null}bind(t,e,i,s){return this.af(t,e,i,s),this}bindTwoWay(t,e,i,s){return this.af(t,e,i,s).makeTwoWay(),this}bindModel(t,e,i,s){return this.af(t,e,i,s).ofModel(),this}bindObject(t,e,i,s,n){return this.af(t,e,i,s).ofObject(n),this}theme(t,e,i,s,n){return this.xh(t,e,i,s,n),this}themeData(t,e,i,s,n){return this.xh(t,e,i,s,n).ofData(),this}themeObject(t,e,i,s,n,l){return this.xh(t,e,i,s,n).ofObject(l),this}themeModel(t,e,i,s,n){return this.xh(t,e,i,s,n).ofModel(),this}af(t,e,i,s){let n=null;return n="string"==typeof t?new iR(t,e,i,s):t,this.j0(n),n}xh(t,e,i,s,n){let l=null;return l="string"==typeof t?new iB(t,e,i,s,n):t,this.j0(l),l}j0(t){t.Se=this;let e=this.findBindingPanel();null!==e&&e.PA()&&te.o("Cannot add a Binding to a template that has already been copied: "+t),null===this.Ti&&(this.Ti=new th),this.Ti.add(t)}set(t){return Object.assign(this,t),this}attach(t){return eb.k2(this,t),this}apply(t){return t(this),this}setProperties(t){return eh.h0(this,t),this}static make(t,...e){let i=arguments,s=null,n=null;if(te.ot(t))n=t;else if("string"==typeof t){let e=eb.Ub.get(t);te.ot(e)?(s=e(i=Array.prototype.slice.call(i)),te.H(s)||te.o('GraphObject.make invoked object builder "'+t+'", but it did not return an Object')):n=tt.go[t]}null===s&&(null!=n&&n.constructor||te.o("GraphObject.make requires a class function or GoJS class name or name of an object builder, not: "+t),s=new n);let l=1;if(s instanceof eh&&i.length>1){let t=s,e=i[1];("string"==typeof e||e instanceof HTMLDivElement)&&(t.kM(e),l++)}for(let t=l;t<i.length;t++){let e=i[t];void 0===e?te.o("Undefined value at argument "+t+" for object being constructed by GraphObject.make: "+s):eb.k2(s,e)}return s}static k2(t,e){if("number"==typeof e)eb.JR(t,e);else if("string"==typeof e)eb.$R(t,e);else if(e instanceof eb)t instanceof eq||te.o("A GraphObject can only be added to a Panel, not to: "+t),t.add(e);else if(e instanceof eZ){let i;e.isRow&&te.ot(t.getRowDefinition)?i=t.getRowDefinition(e.index):!e.isRow&&te.ot(t.getColumnDefinition)&&(i=t.getColumnDefinition(e.index)),i instanceof eZ?i.Vb(e):te.o("A RowColumnDefinition can only be added to an object that implements getRowDefinition/getColumnDefinition, not to: "+t)}else if(e instanceof eF)t.type=e;else if(e instanceof iR)t instanceof eb||t instanceof eZ?t.bind(e):te.o("A Binding can only be applied to a GraphObject or RowColumnDefinition, not to: "+t);else if(e instanceof ei)t instanceof eb?t.trigger(e):te.o("An AnimationTrigger can only be applied to a GraphObject, not to: "+t);else if(e instanceof tC)t instanceof tN&&4===t.type?t.figures.add(e):te.o("A PathFigure can only be added to a Path Geometry, not to: "+t);else if(e instanceof tT)t instanceof tC?t.segments.add(e):te.o("A PathSegment can only be added to a PathFigure, not to: "+t);else if(e instanceof ik)t instanceof eh||t instanceof ib?t.layout=e:te.o("A Layout can only be assigned to a Diagram or a Group, not to: "+t);else if(Array.isArray(e))for(let i=0;i<e.length;i++){let s=e[i];eb.k2(t,s)}else te.H(e)?eb.ZR(t,e):te.o('Unknown initializer "'+e+'" for object being constructed by GraphObject.make: '+t)}static $R(t,e){if(t instanceof e3)t.text=e;else if(t instanceof e$)t.figure=e;else if(t instanceof e6)t.source=e;else if(t instanceof eq){let i=eF.os.get(e);null!==i&&(t.type=i)}else if(t instanceof eD){let i=te.Xh(eL,e);null!==i?t.type=i:te.o("Unknown Brush type as an argument to GraphObject.make: "+e)}else if(t instanceof tN){let i=te.Xh(tS,e);null!==i&&(t.type=i)}else if(t instanceof tT){let i=te.Xh(tL,e);null!==i&&(t.type=i)}}static JR(t,e){te.ot(t.hi)?t.hi(e):te.cr(t,e)}static ZR(t,e){if(t instanceof eD){let i=new ts;for(let s in e){let n=parseFloat(s);isNaN(n)?i[s]=e[s]:t.addColorStop(n,e[s])}eh.h0(t,i)}else if(t instanceof eZ){if(void 0!==e.row){let i=e.row;(null==i||i===1/0||isNaN(i)||i<0)&&te.o("Must specify non-negative integer row for RowColumnDefinition "+e+", not: "+i),t.isRow=!0,t.index=i}else if(void 0!==e.column){let i=e.column;(null==i||i===1/0||isNaN(i)||i<0)&&te.o("Must specify non-negative integer column for RowColumnDefinition "+e+", not: "+i),t.isRow=!1,t.index=i}let i=new ts;for(let t in e)"row"===t||"column"===t||(i[t]=e[t]);eh.h0(t,i)}else eh.h0(t,e)}static build(t,e,...i){let s=eb.Ub.get(t);if(te.ot(s)){let n=s([t].concat(i));if(n instanceof eb)return e&&n.setProperties(e),n}te.o('GraphObject.build invoked object builder "'+t+'", but it did not return an Object')}static defineBuilder(t,e){te.s(t,"string",eb,"defineBuilder:name"),te.S(e,eb,"defineBuilder:func"),t.toLowerCase(),eb.Ub.set(t,e)}static isBuilderDefined(t){return eb.Ub.has(t)}static takeBuilderArgument(t,e,i){void 0===i&&(i=null);let s=t[1];return(te.ot(i)?i(s):"string"==typeof s)?(t.splice(1,1),s):(void 0===e&&te.o("no "+(te.ot(i)?"satisfactory":"string")+" argument for GraphObject builder "+t[0]),e)}static Ub=new tp;static{eb.Vertical=4,eb.Horizontal=5,eb.defineBuilder("Button",t=>{let e=new eq(eq.Auto,{isActionable:!0,enabledChanged:(t,e)=>{if(t instanceof eq){let i=t.findObject("ButtonBorder");if(null!==i){if(void 0===t._buttonFillNormal&&(t._buttonFillNormal=i.fill),e){let e=null;null!==t.layer&&null!==t.diagram&&t.isVisibleObject()&&(e=t.layer.findObjectAt(t.diagram.lastInput.documentPoint)),e===t||null!==e&&e.isContainedBy(t)?i.fill=t._buttonFillOver:i.fill=t._buttonFillNormal}else i.fill=t._buttonFillDisabled}}},cursor:"pointer"}).attach({_buttonFillNormal:void 0,_buttonStrokeNormal:void 0,_buttonFillOver:"#d4d4d4",_buttonStrokeOver:"#737373",_buttonFillDisabled:"#a3a3a3"}).add(new e$("RoundedRectangle",{name:"ButtonBorder",spot1:new tv(0,0,2.76142374915397,2.761423749153969),spot2:new tv(1,1,-2.76142374915397,-2.761423749153969),parameter1:2,fill:"#f5f5f5",stroke:"#737373"}));return e.mouseEnter=(t,e,i)=>{if(!e.isEnabledObject()||!(e instanceof eq))return;let s=e.findObject("ButtonBorder");s instanceof e$&&(void 0===e._buttonFillNormal&&(e._buttonFillNormal=s.fill),s.fill=e._buttonFillOver,void 0===e._buttonStrokeNormal&&(e._buttonStrokeNormal=s.stroke),s.stroke=e._buttonStrokeOver)},e.mouseLeave=(t,e,i)=>{if(!e.isEnabledObject()||!(e instanceof eq))return;let s=e.findObject("ButtonBorder");s instanceof e$&&(void 0!==e._buttonFillNormal&&(s.fill=e._buttonFillNormal),void 0!==e._buttonStrokeNormal&&(s.stroke=e._buttonStrokeNormal))},e}),eb.defineBuilder("TreeExpanderButton",t=>{let e=eb.build("Button");return e.attach({_treeExpandedFigure:"MinusLine",_treeCollapsedFigure:"PlusLine",visible:!1}),e.add(new e$("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:tx.cu}).bindObject("figure","isTreeExpanded",(t,e)=>{let i=e.panel;return t?i._treeExpandedFigure:i._treeCollapsedFigure})),e.bindObject("visible","isTreeLeaf",t=>!t),e.click=(t,e)=>{let i=e.part;if(i instanceof il&&(i=i.adornedPart),!(i instanceof io))return;let s=i.diagram;if(null===s)return;let n=s.commandHandler;if(i.isTreeExpanded){if(!n.canCollapseTree(i))return}else if(!n.canExpandTree(i))return;t.handled=!0,i.isTreeExpanded?n.collapseTree(i):n.expandTree(i)},e}),eb.defineBuilder("SubGraphExpanderButton",t=>{let e=eb.build("Button");return e.attach({_subGraphExpandedFigure:"MinusLine",_subGraphCollapsedFigure:"PlusLine"}),e.add(new e$("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:tx.cu}).bindObject("figure","isSubGraphExpanded",(t,e)=>{let i=e.panel;return t?i._subGraphExpandedFigure:i._subGraphCollapsedFigure})),e.click=(t,e)=>{let i=e.part;if(i instanceof il&&(i=i.adornedPart),!(i instanceof ib))return;let s=i.diagram;if(null===s)return;let n=s.commandHandler;if(i.isSubGraphExpanded){if(!n.canCollapseSubGraph(i))return}else if(!n.canExpandSubGraph(i))return;t.handled=!0,i.isSubGraphExpanded?n.collapseSubGraph(i):n.expandSubGraph(i)},e}),eb.defineBuilder("ToolTip",t=>new il(eq.Auto,{isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new ty(0,2)}).add(new e$("RoundedRectangle",{name:"Border",parameter1:1,fill:"#f5f5f5",strokeWidth:0,spot1:new tv(0,0,4,6),spot2:new tv(1,1,-4,-4)}))),eb.defineBuilder("ContextMenu",t=>new il(eq.Vertical,{background:"#f5f5f5",isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new ty(0,2)}).bindObject("background","",t=>null!==t.adornedPart&&t.hasPlaceholder()?null:"#f5f5f5")),eb.defineBuilder("ContextMenuButton",t=>{let e=eb.build("Button");e.stretch=5;let i=e.findObject("ButtonBorder");return i instanceof e$&&(i.figure="Rectangle",i.strokeWidth=0,i.spot1=new tv(0,0,4,6),i.spot2=new tv(1,1,-4,-4)),e}),eb.defineBuilder("PanelExpanderButton",t=>{let e=eb.takeBuilderArgument(t,"COLLAPSIBLE"),i=eb.build("Button");i.attach({_buttonExpandedFigure:"M0 0 M0 6 L4 2 8 6 M8 8",_buttonCollapsedFigure:"M0 0 M0 2 L4 6 8 2 M8 8","ButtonBorder.fill":"rgba(0, 0, 0, 0)",_buttonFillNormal:"rgba(0, 0, 0, 0)","ButtonBorder.stroke":null,_buttonStrokeNormal:null,_buttonFillOver:"rgba(0, 0, 0, .2)",_buttonStrokeOver:null}),i.add(new e$({name:"ButtonIcon",strokeWidth:2}).bindObject("geometryString","visible",t=>t?i._buttonExpandedFigure:i._buttonCollapsedFigure,void 0,e));let s=i.findObject("ButtonBorder");return s instanceof e$&&(s.stroke=null,s.fill="rgba(0, 0, 0, 0)"),i.click=(t,i)=>{if(!(i instanceof eq))return;let s=i.diagram;if(null===s||s.isReadOnly)return;let n=i.findBindingPanel();if(null===n&&(n=i.part),null!==n){let i=n.findObject(e);null!==i&&(t.handled=!0,s.startTransaction("Collapse/Expand Panel"),i.visible=!i.visible,s.commitTransaction("Collapse/Expand Panel"))}},i}),eb.defineBuilder("CheckBoxButton",t=>{let e=eb.takeBuilderArgument(t),i=eb.build("Button",{desiredSize:new tx(14,14)});i.attach({"ButtonBorder.spot1":new tv(0,0,1,1),"ButtonBorder.spot2":new tv(1,1,-1,-1)});let s=new e$({name:"ButtonIcon",geometryString:"M0 0 M0 8.85 L4.9 13.75 16.2 2.45 M16.2 16.2",strokeWidth:2,stretch:2,geometryStretch:6,visible:!1});return""!==e&&s.bindTwoWay("visible",e),i.add(s),i.click=(t,i)=>{if(!(i instanceof eq))return;let s=t.diagram;if(null===s||s.isReadOnly||""!==e&&s.model.isReadOnly)return;t.handled=!0;let n=i.findObject("ButtonIcon");s.startTransaction("checkbox"),null!==n&&(n.visible=!n.visible),te.ot(i._doClick)&&i._doClick(t,i),s.commitTransaction("checkbox")},i}),eb.defineBuilder("CheckBox",t=>{let e=eb.takeBuilderArgument(t),i=eb.build("CheckBoxButton",{name:"Button",isActionable:!1,margin:new tb(0,1,0,0)},e),s=new eq("Horizontal",{isActionable:!0,cursor:i.cursor,margin:new tb(1),mouseEnter:i.mouseEnter,mouseLeave:i.mouseLeave,click:i.click}).attach({_buttonFillNormal:i._buttonFillNormal,_buttonStrokeNormal:i._buttonStrokeNormal,_buttonFillOver:i._buttonFillOver,_buttonStrokeOver:i._buttonStrokeOver,_buttonFillDisabled:i._buttonFillDisabled,_buttonClick:i.click});return s.add(i),i.mouseEnter=null,i.mouseLeave=null,i.click=null,s})}}class ev{gi;Nt;io;Ti;eo;qs;Tl;vr;Or;Ir;zr;Xr;Er;Br;Ur;z0;X0;Vr;Y0;K0;G0;H0;Yr;Kr;C0;I0;ks;Sr;Mr;oo;O0;v0;Pr;M0;q0;W0;constructor(){this.gi=!1,this.Nt="",this.io=-1,this.Ti=null,this.eo=null,this.qs=null,this.Tl="",this.vr=null,this.Or=null,this.Ir=null,this.zr=null,this.Xr=null,this.Er=null,this.Br=null,this.Ur=null,this.z0=null,this.X0=null,this.Vr=null,this.Y0=null,this.K0=null,this.G0=null,this.H0=null,this.Yr=null,this.Kr=null,this.C0=null,this.I0=null,this.ks=null,this.Sr=tx.hc,this.Mr=tx.Fk,this.oo=1,this.O0=1,this.v0=1,this.Pr=0,this.M0=null,this.q0=null,this.W0="category"}copy(){let t=new ev;return t.Nt=this.Nt,t.io=this.io,t.Ti=this.Ti,t.qs=this.qs,t.Tl=this.Tl,t.vr=this.vr,t.Or=this.Or,t.Ir=this.Ir,t.zr=this.zr,t.Xr=this.Xr,t.Er=this.Er,t.Br=this.Br,t.Ur=this.Ur,t.z0=this.z0,t.X0=this.X0,t.Vr=this.Vr,t.Y0=this.Y0,t.K0=this.K0,t.G0=this.G0,t.H0=this.H0,t.Yr=this.Yr,t.Kr=this.Kr,t.C0=this.C0,t.I0=this.I0,t.ks=this.ks,t.Sr=this.Sr.N(),t.Mr=this.Mr.N(),t.oo=this.oo,t.O0=this.O0,t.v0=this.v0,t.Pr=this.Pr,t.M0=this.M0,t.q0=this.q0,t.W0=this.W0,t}}class ek{m;constructor(){this.m=[1,0,0,1,0,0]}copy(){let t=new ek;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t}translate(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e}scale(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e}rotate(t,e,i){if(t>=360?t-=360:t<0&&(t+=360),0===t)return;this.translate(e,i);let s=0,n=0;if(90===t)s=0,n=1;else if(180===t)s=-1,n=0;else if(270===t)s=0,n=-1;else{let e=t*Math.PI/180;s=Math.cos(e),n=Math.sin(e)}let l=this.m[0]*s+this.m[2]*n,r=this.m[1]*s+this.m[3]*n,o=-(this.m[0]*n)+this.m[2]*s,h=-(this.m[1]*n)+this.m[3]*s;this.m[0]=l,this.m[1]=r,this.m[2]=o,this.m[3]=h,this.translate(-e,-i)}}class eP{type;x1;y1;r1;x2;y2;r2;colors;pattern;constructor(t){this.type=t,this.x1=0,this.y1=0,this.r1=0,this.x2=0,this.y2=0,this.r2=0,this.colors=[],this.pattern=null}addColorStop(t,e){this.colors.push({offset:t,color:e})}}class eS{Rt;ci;ya;Wu;P2;constructor(t,e,i){let s=void 0===e?tt.document:e;this.ya=s,this.P2="http://www.w3.org/2000/svg";let n="http://www.w3.org/2000/xmlns/";void 0!==s&&(this.Rt=this.makeElement("svg",{width:"1px",height:"1px",viewBox:"0 0 1 1"}),this.style.display="block",this.style.letterSpacing="normal",this.style.wordSpacing="normal",i||(this.style.position="absolute"),this.Rt.setAttributeNS(n,"xmlns",this.P2),this.Rt.setAttributeNS(n,"xmlns:xlink","http://www.w3.org/1999/xlink")),this.Wu=null,this.ci=new eM(this,i)}resize(t,e,i,s){return(this.width!==t||this.height!==e)&&(this.width=t,this.height=e,this.style.width=i+"px",this.style.height=s+"px",this.Rt.setAttributeNS(null,"width",i+"px"),this.Rt.setAttributeNS(null,"height",s+"px"),this.Rt.setAttributeNS(null,"viewBox","0 0 "+i+" "+s),this.ci.S2.firstElementChild.setAttributeNS(null,"width",i+"px"),this.ci.S2.firstElementChild.setAttributeNS(null,"height",s+"px"),!0)}makeElement(t,e,i){let s=this.ya.createElementNS(this.P2,t);if(te.H(e))for(let t in e)s.setAttributeNS("href"===t?"http://www.w3.org/1999/xlink":"",t,e[t]);return void 0!==i&&(s.textContent=i),s}getBoundingClientRect(){return this.Rt.getBoundingClientRect()}focus(){this.Rt.focus()}get width(){return this.Rt.width.baseVal.value}set width(t){this.Rt.setAttribute("width",t+"px")}get height(){return this.Rt.height.baseVal.value}set height(t){this.Rt.setAttribute("height",t+"px")}dispose(){this.ya=null}get style(){return this.Rt.style}}class eM{cf;ff;kn;Di;Ke;fillStyle;font;globalAlpha;lineCap;lineDashOffset;lineJoin;lineWidth;miterLimit;shadowBlur;shadowColor;shadowOffsetX;shadowOffsetY;strokeStyle;textAlign;imageSmoothingEnabled;clipInsteadOfFill;lastCreatedElement;uf;df;surface;svg;S2;SA;zb;Ko;bh;Ta;currentElement;clipPathGroup;diagramGroup;lastDrawnPart;currentPath;outerGroup;pathAttributes;sl;Ar;filter;partClipRect;constructor(t,e){this.surface=t,this.svg=t.Rt,this.uf=[],this.df=[],this.fillStyle="#000000",this.font="10px sans-serif",this.globalAlpha=1,this.lineCap="butt",this.lineDashOffset=0,this.lineJoin="miter",this.lineWidth=1,this.miterLimit=10,this.shadowBlur=0,this.shadowColor="rgba(0, 0, 0, 0)",this.shadowOffsetX=0,this.shadowOffsetY=0,this.sl=!1,this.strokeStyle="#000000",this.textAlign="start",this.clipInsteadOfFill=!1,this.cf=0,this.ff=0,this.kn=0,this.lastCreatedElement=null,this.currentElement=null,this.Di=[],this.pathAttributes={},this.zb=!1,this.Ko=null,this.bh=0,this.Ke=new ek,this.clipPathGroup=this.newGroup2(),this.diagramGroup=this.newGroup2("gojs-diagram"),this.lastDrawnPart=null,this.currentPath=null;let i=tu.dw++,s=this.makeElement("clipPath",{id:"mainClip"+i}),n={x:0,y:0,width:t.width,height:t.height};s.appendChild(this.makeElement("rect",n)),this.S2=s,this.svg.appendChild(this.clipPathGroup),this.clipPathGroup.appendChild(this.diagramGroup),this.svg.appendChild(s),this.clipPathGroup.setAttributeNS(null,"clip-path","url(#mainClip"+i+")"),this.SA={},this.Ar=!!e,this.filter="",this.partClipRect=null}setDiagramPosScale(t,e,i,s,n,l){void 0===this.diagramGroup?this.newGroup(t,e,i,s,n,l):this.diagramGroup.setAttribute("transform","matrix("+t+", "+e+", "+i+", "+s+", "+n+", "+l+")")}resetInnerSVG(){null!==this.diagramGroup&&(this.diagramGroup.innerHTML="")}arc(t,e,i,s,n,l,r,o){let h=2*Math.PI,a=i*Math.cos(s),u=i*Math.sin(s),d=t+a,c=e+u,g=+!l,f=l?s-n:n-s;(Math.abs(r-d)>1e-6||Math.abs(o-c)>1e-6)&&this.Di.push(["L",d,+c]),f<0&&(f=f%h+h),f>h-1e-6?(this.Di.push(["A",i,i,0,1,g,t-a,e-u]),this.Di.push(["A",i,i,0,1,g,d,c])):f>1e-6&&this.Di.push(["A",i,i,0,+(f>=Math.PI),g,t+i*Math.cos(n),e+i*Math.sin(n)])}beginPath(){this.Di=[],this.pathAttributes={stroke:"none",fill:"none"}}endPath(t){this.QR(this.Di,this.Ke,t||0)}bezierCurveTo(t,e,i,s,n,l){this.Di.push(["C",t,e,i,s,n,l])}clearRect(t,e,i,s){}clip(){this.pathAttributes.clipPath=!0}closePath(){this.Di.push(["z"])}createLinearGradient(t,e,i,s){let n=new eP("linear");return n.x1=t,n.y1=e,n.x2=i,n.y2=s,n}createPattern(t,e){let i="";t instanceof HTMLCanvasElement&&(i=t.toDataURL()),t instanceof HTMLImageElement&&(i=t.getAttribute("src"));let s=this.SA;if(s[i])return"url(#"+s[i]+")";let n="PATTERN"+tu.dw++,l={width:t.width,height:t.height,id:n,patternUnits:"userSpaceOnUse"},r={x:0,y:0,width:t.width,height:t.height,href:i},o=this.makeElement("pattern",l);return o.appendChild(this.makeElement(eh.img,r)),this.svg.appendChild(o),s[i]=n,"url(#"+n+")"}createRadialGradient(t,e,i,s,n,l){let r=new eP("radial");return r.x1=t,r.y1=e,r.r1=i,r.x2=s,r.y2=n,r.r2=l,r}amendImageTransform(t,e,i,s,n,l,r,o){let h=r/i,a=o/s;(0!==n||0!==l)&&this.Ke.translate(n,l),(1!==h||1!==a)&&this.Ke.scale(h,a),(0!==t||0!==e)&&this.Ke.translate(-t,-e)}drawImage(t,e,i,s,n,l,r,o,h){let a="";t instanceof HTMLCanvasElement&&(a=t.toDataURL()),t instanceof HTMLImageElement&&(a=t.getAttribute("src"));let u=t instanceof HTMLImageElement?t.naturalWidth:t.width,d=t instanceof HTMLImageElement?t.naturalHeight:t.height;void 0===s&&(l=e,r=i,o=s=u,h=n=d),s=s||0,n=n||0,l=l||0,r=r||0,o=o||0,h=h||0,this.amendImageTransform(e,i,s,n,l,r,o,h);let c={x:0,y:0,width:u||s,height:d||n,href:a};tP.Y(s,o)&&tP.Y(n,h)?-1===a.toLowerCase().indexOf(".svg")&&-1===a.toLowerCase().indexOf("data:image/svg")&&(c.preserveAspectRatio="xMidYMid slice"):c.preserveAspectRatio="none",(0!==e||0!==i||s!==u||n!==d)&&(s+=e,n+=i,c["clip-path"]=`path('M ${e},${i} L ${s} ${i} L ${s} ${n} L ${e} ${n} z')`),this.processCommon(eh.img,c,this.Ke),this.od(eh.img,c)}fill(t,e){t&&(this.pathAttributes["fill-rule"]="evenodd"),this.setFill(this.pathAttributes)}fillContext(t,e,i){this.clipInsteadOfFill?this.clip():this.fill(e,i)}createOrUpdateClipGroup(t,e){let i=this.newGroup(1,0,0,1,-e.x,-e.y);i.setAttributeNS(null,"class","spotClip"),t.dh=i}fillRect(t,e,i,s){this.addRect("fill",[t,e,i,s],this.Ke)}fillBackground(t,e,i,s){let n={x:t,y:e,width:i,height:s};this.processCommon("fill",n,this.Ke),this.setFill(n),this.svg.prepend(this.makeElement("rect",n))}fillText(t,e,i){this.addText("fill",[t,e,i],this.Ke)}lineTo(t,e){this.Di.push(["L",t,e])}moveTo(t,e){this.Di.push(["M",t,e])}quadraticCurveTo(t,e,i,s){this.Di.push(["Q",t,e,i,s])}rect(t,e,i,s){this.Di.push(["M",t,e],["L",t+i,e],["L",t+i,e+s],["L",t,e+s],["z"])}restore(){this.Ke=this.uf.pop(),this.Di=this.uf.pop();let t=this.uf.pop();this.fillStyle=t.fillStyle,this.font=t.font,this.globalAlpha=t.globalAlpha,this.lineCap=t.lineCap,this.lineDashOffset=t.lineDashOffset,this.lineJoin=t.lineJoin,this.lineWidth=t.lineWidth,this.miterLimit=t.miterLimit,this.shadowBlur=t.shadowBlur,this.shadowColor=t.shadowColor,this.shadowOffsetX=t.shadowOffsetX,this.shadowOffsetY=t.shadowOffsetY,this.strokeStyle=t.strokeStyle,this.textAlign=t.textAlign,this.partClipRect=t.partClipRect}save(){let t={fillStyle:this.fillStyle,font:this.font,globalAlpha:this.globalAlpha,lineCap:this.lineCap,lineDashOffset:this.lineDashOffset,lineJoin:this.lineJoin,lineWidth:this.lineWidth,miterLimit:this.miterLimit,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,strokeStyle:this.strokeStyle,textAlign:this.textAlign,partClipRect:this.partClipRect};this.uf.push(t);let e=[];for(let t=0;t<this.Di.length;t++)e.push(this.Di[t]);this.uf.push(e),this.uf.push(this.Ke.copy())}setTransform(t,e,i,s,n,l){1===t&&0===e&&0===i&&1===s&&0===n&&0===l||this.newGroup(t,e,i,s,n,l)}setCurrentTransform(t,e,i,s,n,l){this.Ke.m=[t,e,i,s,n,l]}getCurrentTransform(){let t=this.Ke.m;return"matrix("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}scale(t,e){this.Ke.scale(t,e)}translate(t,e){this.Ke.translate(t,e)}transform(t,e,i,s,n,l){}commitTransform(){}stroke(){this.setStroke(this.pathAttributes)}strokeContext(){this.clipInsteadOfFill||this.stroke()}strokeRect(t,e,i,s){this.addRect("stroke",[t,e,i,s],this.Ke)}makeElement(t,e,i){return this.surface.makeElement(t,e,i)}od(t,e,i){let s=this.makeElement(t,e,i);return null!==this.currentElement?this.currentElement.appendChild(s):this.currentElement=s,this.lastCreatedElement=s,s}processCommon(t,e,i){if("fill"===t?this.setFill(e):"stroke"===t&&this.setStroke(e),null!==i){let t=i.m;e.transform="matrix("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}}setFill(t){if(this.fillStyle instanceof eP){t.fill=this.addGradient(this.fillStyle,!0);return}if(/^rgba\(/.test(this.fillStyle)){let e=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);t.fill="rgb("+e[1]+","+e[2]+","+e[3]+")",t["fill-opacity"]=e[4]}else t.fill=this.fillStyle}setFillOrStrokeInPlace(t,e){let i=e?"fill":"stroke";if(this.fillStyle instanceof eP){t.setAttributeNS(null,"fill",this.addGradient(this.fillStyle,!0));return}if(/^rgba\(/.test(this.fillStyle)){let e=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);t.setAttributeNS(null,i,"rgb("+e[1]+","+e[2]+","+e[3]+")"),t.setAttributeNS(null,i+"-opacity",e[4])}else t.setAttributeNS(null,i,this.fillStyle)}setStroke(t){if(this.strokeStyle instanceof eP)t.stroke=this.addGradient(this.strokeStyle,!1);else if(/^rgba\(/.test(this.strokeStyle)){let e=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.strokeStyle);t.stroke="rgb("+e[1]+","+e[2]+","+e[3]+")",t["stroke-opacity"]=e[4]}else t.stroke=this.strokeStyle;t["stroke-width"]=this.lineWidth,t["stroke-linecap"]=this.lineCap,t["stroke-linejoin"]=this.lineJoin,t["stroke-miterlimit"]=this.miterLimit,this.zb&&(t["stroke-dasharray"]=this.Ko.toString(),t["stroke-dashoffset"]=this.bh)}addGradient(t,e){let i,s="",n=null!==this.currentPath?this.currentPath.getAttribute(e?"fill":"stroke"):null;if(null!==n&&-1!==n.indexOf("GRAD")){s=n.split("#")[1].slice(0,-1);let t=this.svg.getElementById(s);null!==t&&t.remove()}else s="GRAD"+tu.dw++;if("linear"===t.type){let e={x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,id:s,gradientUnits:"userSpaceOnUse"};i=this.makeElement("linearGradient",e)}else if("radial"===t.type){let e={x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,r1:t.r1,r2:t.r2,id:s};i=this.makeElement("radialGradient",e)}else te.o("invalid gradient");let l=t.colors,r=l.length,o=[];for(let t=0;t<r;t++){let e=l[t],i=e.color,s={offset:e.offset,"stop-color":i};if(/^rgba\(/.test(i)){let t=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(i);s["stop-color"]="rgb("+t[1]+","+t[2]+","+t[3]+")",s["stop-opacity"]=t[4]}o.push(s)}o.sort((t,e)=>t.offset>e.offset?1:-1);for(let t=0;t<r;t++)i.appendChild(this.makeElement("stop",o[t]));return this.svg.appendChild(i),"url(#"+s+")"}addRect(t,e,i){let s={x:e[0],y:e[1],width:e[2],height:e[3]};this.processCommon(t,s,i),this.od("rect",s)}addText(t,e,i){let s=this.textAlign;"left"===s?s="start":"right"===s?s="end":"center"===s&&(s="middle");let n={x:e[1],y:e[2],style:"font: "+this.font,"text-anchor":s};this.processCommon(t,n,i),this.od("text",n,e[0])}QR(t,e,i){let s=this._R(t),n=this.pathAttributes;if(n.clipPath){this.df.length>1&&this.df[this.df.length-2].setAttributeNS(null,"clip-path",'path("'+s+'") view-box');return}if(n.d=s,this.processCommon("",n,e),null!==this.currentPath){let t=this.currentPath;if("g"!==t.nodeName)for(let e in n)"transform"!==e&&t.setAttributeNS(null,e,n[e]);else{let e=t.getElementsByTagName("path");for(let t in n)"transform"!==t&&e[i].setAttributeNS(null,t,n[t])}}else this.od("path",n)}_R(t){let e=[];for(let i=0;i<t.length;i++){let s=t[i].slice(),n=[s.shift()];if("A"===n[0])n.push(s.shift()+","+s.shift(),s.shift(),s.shift()+","+s.shift(),s.shift()+","+s.shift());else for(;s.length;)n.push(s.shift()+","+s.shift());e.push(n.join(" "))}return e.join(" ")}newGroup(t,e,i,s,n,l){let r=new ek;r.m=[t,e,i,s,n,l];let o={};this.processCommon("g",o,r);let h=this.od("g",o);return this.df.push(h),h}newGroup2(t){let e={};t&&(e.class=t);let i=this.od("g",e);return this.df.push(i),i}endGroup(){return this.df.pop()}dummyGroup(){return this.newGroup2(),this.endGroup()}shadowsSet(t,e,i){this.cf=t,this.ff=e,this.kn=i}shadowsOff(){this.sl=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.sl=!0,this.shadowOffsetX=this.cf,this.shadowOffsetY=this.ff,this.shadowBlur=this.kn}enableDash(t,e){this.zb=!0,this.Ko=t,this.bh=e}disableDash(){this.zb=!1}clearContextCache(t){}setImageSmoothingEnabled(t){}rotate(t){this.Ke.rotate(57.2958*t,0,0)}getImageData(t,e,i,s){return null}measureText(t){return null}removeOldGradient(t,e,i){let s=e.getAttribute(i);if(null===s)return;let n=s.split("#");if(1===n.length)return;let l=this.svg.getElementById(n[1].slice(0,-1));if(null!==l){let t=RegExp(l.id,"g");1===this.svg.innerHTML.match(t).length&&l.remove()}}removePartFromView(t){null!==t.svg&&t.svg.parentNode===this.diagramGroup&&t.svg.remove()}}class eN{Rt;ci;ya;Wu;constructor(t,e,i,s){let n=void 0===e?tt.document:e;this.ya=n,this.Wu=null;let l=n.createElement("canvas");l.tabIndex=0,this.Rt=l,this.ci=new eC(l,i,s),eh.is.set(l,t)}resize(t,e,i,s){return(this.width!==t||this.height!==e)&&(this.width=t,this.height=e,this.style.width=i+"px",this.style.height=s+"px",!0)}toDataURL(t,e){return this.Rt.toDataURL(t,e)}getBoundingClientRect(){return this.Rt.getBoundingClientRect()}focus(){this.Rt.focus()}get width(){return this.Rt.width}set width(t){this.Rt.width=t}get height(){return this.Rt.height}set height(t){this.Rt.height=t}dispose(){eh.is.delete(this.Rt),this.ya=null}get style(){return this.Rt.style}}class eC{U;Xb;Yb;Kb;clipInsteadOfFill;cf;ff;kn;Ta;sl;Ar;constructor(t,e,i){this.U=t.getContext?t.getContext("2d",e):null,null===this.U&&te.o("Browser does not support HTML Canvas Element"),this.Xb="",this.Yb="",this.Kb="",this.clipInsteadOfFill=!1,this.cf=0,this.ff=0,this.kn=0,this.sl=!1,this.Ta=new tk,this.Ar=!!i}createOrUpdateClipGroup(t,e){}setImageSmoothingEnabled(t){this.U.imageSmoothingEnabled=t}get fillStyle(){return this.U.fillStyle}set fillStyle(t){this.Kb!==t&&(this.U.fillStyle=t,this.Kb=t)}get font(){return this.U.font}set font(t){this.Xb!==t&&(this.U.font=t,this.Xb=t)}get globalAlpha(){return this.U.globalAlpha}set globalAlpha(t){this.U.globalAlpha=t}get lineCap(){return this.U.lineCap}set lineCap(t){this.U.lineCap=t}get lineDashOffset(){return this.U.lineDashOffset}set lineDashOffset(t){this.U.lineDashOffset=t}get lineJoin(){return this.U.lineJoin}set lineJoin(t){this.U.lineJoin=t}get lineWidth(){return this.U.lineWidth}set lineWidth(t){this.U.lineWidth=t}get miterLimit(){return this.U.miterLimit}set miterLimit(t){this.U.miterLimit=t}get shadowBlur(){return this.U.shadowBlur}set shadowBlur(t){this.U.shadowBlur=t}get shadowColor(){return this.U.shadowColor}set shadowColor(t){this.U.shadowColor=t}get shadowOffsetX(){return this.U.shadowOffsetX}set shadowOffsetX(t){this.U.shadowOffsetX=t}get shadowOffsetY(){return this.U.shadowOffsetY}set shadowOffsetY(t){this.U.shadowOffsetY=t}get strokeStyle(){return this.U.strokeStyle}set strokeStyle(t){this.Yb!==t&&(this.U.strokeStyle=t,this.Yb=t)}get textAlign(){return this.U.textAlign}set textAlign(t){this.U.textAlign=t}get imageSmoothingEnabled(){return this.U.imageSmoothingEnabled}set imageSmoothingEnabled(t){this.U.imageSmoothingEnabled=t}get filter(){return this.U.filter}set filter(t){""===t?this.U.filter="none":this.U.filter=t}arc(t,e,i,s,n,l,r,o){this.U.arc(t,e,i,s,n,l)}beginPath(){this.U.beginPath()}endPath(){}bezierCurveTo(t,e,i,s,n,l){this.U.bezierCurveTo(t,e,i,s,n,l)}clearRect(t,e,i,s){this.commitTransform(),this.U.clearRect(t,e,i,s)}clip(t){t?this.U.clip(t):this.U.clip()}closePath(){this.U.closePath()}createLinearGradient(t,e,i,s){return this.U.createLinearGradient(t,e,i,s)}createPattern(t,e){return this.U.createPattern(t,e)}createRadialGradient(t,e,i,s,n,l){return this.U.createRadialGradient(t,e,i,s,n,l)}drawImage(t,e,i,s,n,l,r,o,h){void 0===s?this.U.drawImage(t,e,i):this.U.drawImage(t,e,i,s,n,l,r,o,h)}fill(t,e){e?this.U.fill(e,t?"evenodd":"nonzero"):this.U.fill(t?"evenodd":"nonzero")}fillRect(t,e,i,s){this.U.fillRect(t,e,i,s)}fillBackground(t,e,i,s){this.U.fillRect(t,e,i,s)}fillText(t,e,i){this.U.fillText(t,e,i)}getImageData(t,e,i,s){return this.U.getImageData(t,e,i,s)}lineTo(t,e){this.U.lineTo(t,e)}measureText(t){return this.U.measureText(t)}moveTo(t,e){this.U.moveTo(t,e)}quadraticCurveTo(t,e,i,s){this.U.quadraticCurveTo(t,e,i,s)}rect(t,e,i,s){this.U.rect(t,e,i,s)}restore(){this.U.restore()}save(){this.commitTransform(),this.U.save()}rotate(t){this.Ta.ds(57.2958*t,0,0)}setTransform(t,e,i,s,n,l){this.Ta.setTo(t,e,i,s,n,l)}scale(t,e){this.Ta.nt(t,e)}translate(t,e){this.Ta.Es(t,e)}stroke(t){t?this.U.stroke(t):this.U.stroke()}transform(t,e,i,s,n,l){if(1===t&&0===e&&0===i&&1===s&&0===n&&0===l)return;let r=this.Ta,o=r.m11*t+r.m21*e,h=r.m12*t+r.m22*e,a=r.m11*i+r.m21*s,u=r.m12*i+r.m22*s;r.dx=r.m11*n+r.m21*l+r.dx,r.dy=r.m12*n+r.m22*l+r.dy,r.m11=o,r.m12=h,r.m21=a,r.m22=u}commitTransform(){let t=this.Ta;this.U.setTransform(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy)}fillContext(t,e,i){this.radialFill(t,e,i)||this.fillOrClip(e,i)}radialFill(t,e,i){if(!(t instanceof eD)||3!==t.type)return!1;let s=t.rf,n=t.Eb;return n>s?(this.scale(s/n,1),this.translate((n-s)/2,0)):s>n&&(this.scale(1,n/s),this.translate(0,(s-n)/2)),this.fillOrClip(e,i),n>s?(this.translate(-(n-s)/2,0),this.scale(1/(s/n),1)):s>n&&(this.translate(0,-(s-n)/2),this.scale(1,1/(n/s))),!0}strokeContext(){this.clipInsteadOfFill||this.stroke()}fillOrClip(t,e){this.clipInsteadOfFill?this.clip(e):this.fill(t,e)}shadowsSet(t,e,i){this.cf=t,this.ff=e,this.kn=i}shadowsOff(){this.sl=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.sl=!0,this.shadowOffsetX=this.cf,this.shadowOffsetY=this.ff,this.shadowBlur=this.kn}enableDash(t,e){let i=this.U;void 0!==i.setLineDash&&(i.setLineDash(t),i.lineDashOffset=e)}disableDash(){let t=this.U;void 0!==t.setLineDash&&(t.setLineDash(eC.EmptyArray),t.lineDashOffset=0)}clearContextCache(t){t&&(this.Xb=""),this.Yb="",this.Kb=""}removePartFromView(t){}static EmptyArray=Object.freeze([])}var eL=((b=eL||{})[b.Solid=1]="Solid",b[b.Linear=2]="Linear",b[b.Radial=3]="Radial",b[b.Pattern=4]="Pattern",b),eT=((v=eT||{})[v.Lab=1]="Lab",v[v.HSL=2]="HSL",v[v.Oklch=3]="Oklch",v);class eA{n0;n1;n2;n3;constructor(){this.n0=0,this.n1=0,this.n2=0,this.n3=0}}class eD{h;$;Da;oi;ys;J0;$0;Go;Z0;xn;rf;Eb;constructor(t,e){if(tu.qi(this),this.h=!1,void 0===t)this.$=1,this.Da="black";else if("string"==typeof t){let e=te.Xh(eL,t);null!==e?(this.$=e,this.Da="black"):(this.$=1,this.Da=t)}else this.$=t,this.Da="black";let i=this.$;if(2===i?(this.oi=tv.TopCenter,this.ys=tv.BottomCenter):3===i?(this.oi=tv.Center,this.ys=tv.Center):(this.oi=tv.None,this.ys=tv.None),this.J0=0,this.$0=NaN,this.Go=null,this.Z0=null,this.xn=null,this.rf=0,this.Eb=0,e){let t={};for(let i in e)isFinite(parseFloat(i))?this.addColorStop(parseFloat(i),e[i]):t[i]=e[i];Object.assign(this,t)}}copy(){let t=new eD;return t.$=this.$,t.Da=this.Da,t.oi=this.oi.N(),t.ys=this.ys.N(),t.J0=this.J0,t.$0=this.$0,null!==this.Go&&(t.Go=this.Go.copy()),t.Z0=this.Z0,t}u(){return this.h=!0,null!==this.Go&&this.Go.u(),this}hi(t){t in eL?this.type=t:te.cr(this,t)}toString(){let t="Brush(";if(1===this.type)t+=this.color;else if(2===this.type?t+="Linear ":3===this.type?t+="Radial ":4===this.type?t+="Pattern ":t+="(unknown) ",t+=this.start+" "+this.end,null!==this.colorStops){let e=this.colorStops.iterator;for(;e.next();)t+=" "+e.key+":"+e.value}return t+")"}addColorStop(t,e){return this.h&&te.D(this),("number"!=typeof t||!isFinite(t)||t>1||t<0)&&te._(t,"0 <= loc <= 1",eD,"addColorStop:loc"),te.s(e,"string",eD,"addColorStop:color"),null===this.Go&&(this.Go=new tp),this.Go.set(t,e),1===this.$&&(this.type=2),this.xn=null,this}get type(){return this.$}set type(t){this.h&&te.D(this,t),this.$=t,this.start.isNoSpot()&&(2===t?this.start=tv.TopCenter:3===t&&(this.start=tv.Center)),this.end.isNoSpot()&&(2===t?this.end=tv.BottomCenter:3===t&&(this.end=tv.Center)),this.xn=null}get color(){return this.Da}set color(t){this.h&&te.D(this,t),this.Da=t,this.xn=null}get start(){return this.oi}set start(t){this.h&&te.D(this,t),this.oi=t.N(),this.xn=null}get end(){return this.ys}set end(t){this.h&&te.D(this,t),this.ys=t.N(),this.xn=null}get startRadius(){return this.J0}set startRadius(t){this.h&&te.D(this,t),t<0&&te._(t,">= zero",eD,"startRadius"),this.J0=t,this.xn=null}get endRadius(){return this.$0}set endRadius(t){this.h&&te.D(this,t),t<0&&te._(t,">= zero",eD,"endRadius"),this.$0=t,this.xn=null}get colorStops(){return this.Go}set colorStops(t){this.h&&te.D(this,t),this.Go=t,this.xn=null}get pattern(){return this.Z0}set pattern(t){this.h&&te.D(this,t),this.Z0=t,this.xn=null}static randomColor(t,e){void 0===t&&(t=128),void 0===e&&(e=Math.max(t,255));let i=Math.abs(e-t),s=Math.floor(t+Math.random()*i).toString(16),n=Math.floor(t+Math.random()*i).toString(16),l=Math.floor(t+Math.random()*i).toString(16);return s.length<2&&(s="0"+s),n.length<2&&(n="0"+n),l.length<2&&(l="0"+l),"#"+s+n+l}static isValidColor(t){return!tt.CSS||tt.CSS.supports("color",t)}static lighten(t){return eD.lightenBy(t)}lightenBy(t,e){this.h&&te.D(this);let i=void 0===t||"number"!=typeof t?.2:t,s=void 0===e?3:e;if(1===this.type)eD.vo(this.color),this.color=eD.rd(i,s);else if((2===this.type||3===this.type)&&null!==this.colorStops){let t=this.colorStops.iterator;for(;t.next();)eD.vo(t.value),this.addColorStop(t.key,eD.rd(i,s))}return this}static lightenBy(t,e,i){return eD.vo(t),eD.rd(void 0===e||"number"!=typeof e?.2:e,void 0===i?3:i)}static darken(t){return eD.darkenBy(t)}darkenBy(t,e){this.h&&te.D(this);let i=void 0===t||"number"!=typeof t?.2:t,s=void 0===e?3:e;if(1===this.type)eD.vo(this.color),this.color=eD.rd(-i,s);else if((2===this.type||3===this.type)&&null!==this.colorStops){let t=this.colorStops.iterator;for(;t.next();)eD.vo(t.value),this.addColorStop(t.key,eD.rd(-i,s))}return this}static darkenBy(t,e,i){return eD.vo(t),eD.rd(-(void 0===e||"number"!=typeof e?.2:e),void 0===i?3:i)}static mix(t,e,i){eD.vo(t);let s=eD.G.n0,n=eD.G.n1,l=eD.G.n2,r=eD.G.n3;eD.vo(e),void 0===i&&(i=.5);let o=Math.round((eD.G.n0-s)*i+s),h=Math.round((eD.G.n1-n)*i+n),a=Math.round((eD.G.n2-l)*i+l),u=Math.round((eD.G.n3-r)*i+r);return`rgba(${o}, ${h}, ${a}, ${u})`}isDark(){if(1===this.type)return eD.isDark(this.color);if((2===this.type||3===this.type)&&null!==this.colorStops){let t=this.colorStops;if(3===this.type)return eD.isDark(t.first().value);if(null!==t.get(.5))return eD.isDark(t.get(.5));if(2===t.count){let e=t.toArray();return eD.isDark(eD.mix(e[0].value,e[1].value))}let e=t.iterator,i=-1,s=-1,n=1,l=1;for(;e.next();){let t=e.key,r=Math.abs(.5-e.key);n>l&&r<n?(i=t,n=r):l>=n&&r<l&&(s=t,l=r)}if(i>s){let t=i;i=s,s=t,t=n,n=l,l=t}let r=s-i;return eD.isDark(eD.mix(t.get(i),t.get(s),1-l/r))}return!1}static isDark(t){return!!t&&(t instanceof eD?t.isDark():(eD.vo(t),(299*eD.G.n0+587*eD.G.n1+114*eD.G.n2)/1e3<128))}static rd(t,e){switch(e){case 1:return eD.tv(),eD.ro.n0=Math.min(100,Math.max(0,eD.ro.n0+100*t)),eD.iv(),"rgba("+eD.G.n0+", "+eD.G.n1+", "+eD.G.n2+", "+eD.G.n3+")";case 2:return eD.US(),eD.Ui.n2=Math.min(100,Math.max(0,eD.Ui.n2+100*t)),"hsla("+eD.Ui.n0+", "+eD.Ui.n1+"%, "+eD.Ui.n2+"%, "+eD.Ui.n3+")";case 3:return eD.ev(),eD.lo.n0=Math.min(100,Math.max(0,eD.lo.n0+100*t)),eD.sv(),"rgba("+eD.G.n0+", "+eD.G.n1+", "+eD.G.n2+", "+eD.G.n3+")";default:te.o("Unknown color space: "+e)}}static vo(t){let e=eD.nl;if(null===e)return;e.clearRect(0,0,1,1),e.fillStyle="#000000";let i=e.fillStyle;if(e.fillStyle=t,e.fillStyle!==i){e.fillRect(0,0,1,1);let t=e.getImageData(0,0,1,1).data;eD.G.n0=t[0],eD.G.n1=t[1],eD.G.n2=t[2],eD.G.n3=t[3]/255}else e.fillStyle="#FFFFFF",e.fillStyle,e.fillStyle=t,e.fillStyle,eD.G.n0=0,eD.G.n1=0,eD.G.n2=0,eD.G.n3=1}static US(){let t,e;let i=eD.G.n0/255,s=eD.G.n1/255,n=eD.G.n2/255,l=Math.max(i,s,n),r=Math.min(i,s,n),o=l-r,h=(l+r)/2;if(0===o)t=e=0;else{switch(l){case i:t=(s-n)/o%6;break;case s:t=(n-i)/o+2;break;case n:t=(i-s)/o+4}(t*=60)<0&&(t+=360),e=o/(1-Math.abs(2*h-1))}eD.Ui.n0=Math.round(t),eD.Ui.n1=Math.round(100*e),eD.Ui.n2=Math.round(100*h),eD.Ui.n3=eD.G.n3}static SE(){let t,e,i;let s=eD.Ui.n0,n=eD.Ui.n1/100,l=eD.Ui.n2/100,r=(1-Math.abs(2*l-1))*n,o=s/60,h=r*(1-Math.abs(o%2-1));o>=0&&o<1?(t=r,e=h,i=0):o>=1&&o<2?(t=h,e=r,i=0):o>=2&&o<3?(t=0,e=r,i=h):o>=3&&o<4?(t=0,e=h,i=r):o>=4&&o<5?(t=h,e=0,i=r):o>=5&&o<6&&(t=r,e=0,i=h);let a=l-.5*r;t+=a,e+=a,i+=a,eD.G.n0=Math.round(255*t),eD.G.n1=Math.round(255*e),eD.G.n2=Math.round(255*i),eD.G.n3=eD.Ui.n3}static tv(){eD.MA(),eD.nv()}static iv(){eD.ov(),eD.NA()}static M2(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}static N2(t){return t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055}static MA(){let t=eD.M2(eD.G.n0),e=eD.M2(eD.G.n1),i=eD.M2(eD.G.n2);eD.vt.n0=.4124564*t+.3575761*e+.1804375*i,eD.vt.n1=.2126729*t+.7151522*e+.072175*i,eD.vt.n2=.0193339*t+.119192*e+.9503041*i,eD.vt.n3=eD.G.n3}static NA(){let t=3.2404542*eD.vt.n0+-1.5371385*eD.vt.n1+-.4985314*eD.vt.n2,e=-.969266*eD.vt.n0+1.8760108*eD.vt.n1+.041556*eD.vt.n2,i=.0556434*eD.vt.n0+-.2040259*eD.vt.n1+1.0572252*eD.vt.n2;eD.G.n0=255*eD.N2(t),eD.G.n1=255*eD.N2(e),eD.G.n2=255*eD.N2(i),eD.G.n3=eD.vt.n3,eD.G.n0=Math.round(eD.G.n0),eD.G.n0>255?eD.G.n0=255:eD.G.n0<0&&(eD.G.n0=0),eD.G.n1=Math.round(eD.G.n1),eD.G.n1>255?eD.G.n1=255:eD.G.n1<0&&(eD.G.n1=0),eD.G.n2=Math.round(eD.G.n2),eD.G.n2>255?eD.G.n2=255:eD.G.n2<0&&(eD.G.n2=0)}static C2=216/24389;static Gb=24389/27;static ld=[95.047,100,108.883];static L2(t){return t>eD.C2?Math.pow(t,1/3):(eD.Gb*t+16)/116}static nv(){let t=eD.L2(100*eD.vt.n0/eD.ld[0]),e=eD.L2(100*eD.vt.n1/eD.ld[1]),i=eD.L2(100*eD.vt.n2/eD.ld[2]);eD.ro.n0=116*e-16,eD.ro.n1=500*(t-e),eD.ro.n2=200*(e-i),eD.ro.n3=eD.vt.n3}static CA(t){let e=t*t*t;return e>eD.C2?e:(116*t-16)/eD.Gb}static ov(){let t=(eD.ro.n0+16)/116,e=eD.ro.n1/500+t,i=t-eD.ro.n2/200;eD.vt.n0=eD.ld[0]/100*eD.CA(e),eD.vt.n1=eD.ld[1]/100*(eD.ro.n0>eD.Gb*eD.C2?Math.pow(t,3):eD.ro.n0/eD.Gb),eD.vt.n2=eD.ld[2]/100*eD.CA(i),eD.vt.n3=eD.ro.n3}static rv(){let t=.8190224*eD.vt.n0+.3619062*eD.vt.n1+-.1288737*eD.vt.n2,e=.03298366*eD.vt.n0+.9292868*eD.vt.n1+.03614466*eD.vt.n2,i=.04817719*eD.vt.n0+.2642395*eD.vt.n1+.6335478*eD.vt.n2;t=Math.cbrt(t),e=Math.cbrt(e),i=Math.cbrt(i),eD.ui.n0=.2104542*t+.7936177*e+-.004072046*i,eD.ui.n1=1.977998*t+-2.428592*e+.4505937*i,eD.ui.n2=.02590403*t+.7827717*e+-.8086757*i,eD.ui.n3=eD.vt.n3,eD.ui.n0*=100}static lv(){eD.ui.n0/=100;let t=.9999999*eD.ui.n0+.3963377*eD.ui.n1+.2158037*eD.ui.n2,e=1.000000009*eD.ui.n0+-.1055613*eD.ui.n1+-.06385417*eD.ui.n2,i=1.00000005*eD.ui.n0+-.08948418*eD.ui.n1+-1.291485*eD.ui.n2;t=t**3,e=e**3,i=i**3,eD.vt.n0=1.2268798*t+-.5578149*e+.281391*i,eD.vt.n1=-.04057576*t+1.112286*e+-.07171106*i,eD.vt.n2=-.07637294*t+-.4214933*e+1.586924*i,eD.vt.n3=eD.ui.n3}static hv(){let t=180*Math.atan2(eD.ui.n2,eD.ui.n1)/Math.PI;eD.lo.n0=eD.ui.n0,eD.lo.n1=Math.sqrt(eD.ui.n1**2+eD.ui.n2**2),eD.lo.n2=t>=0?t:t+360,eD.lo.n3=eD.ui.n3}static av(){eD.ui.n0=eD.lo.n0,eD.ui.n1=eD.lo.n1*Math.cos(eD.lo.n2*Math.PI/180),eD.ui.n2=eD.lo.n1*Math.sin(eD.lo.n2*Math.PI/180),eD.ui.n3=eD.lo.n3}static ev(){eD.MA(),eD.rv(),eD.hv()}static sv(){eD.av(),eD.lv(),eD.NA()}static nd(t,e){"string"==typeof t||t instanceof eD||te.o("Value for "+e+" must be a color string or a Brush, not "+t)}static Solid=1;static Linear=2;static Radial=3;static Pattern=4;static Lab=1;static HSL=2;static nl=eh.isUsingDOM()?new eN(null,void 0,{willReadFrequently:!0}).ci:null;static G=new eA;static Ui=new eA;static vt=new eA;static ro=new eA;static ui=new eA;static lo=new eA}class eF{Nt="Base";static os=new tp;static Pn(t,e){e.name=t,eF.os.set(t,e)}get name(){return this.Nt}set name(t){this.Nt=t}constructor(){}get classType(){return eq}measure(t,e,i,s,n,l,r){}measureElement(t,e,i,s,n){t.ut(e,i,s,n)}arrange(t,e,i){}arrangeElement(t,e,i,s,n,l){t.Yt(e,i,s,n,l)}remeasureObject(t){t.lf()}zi(t,e,i){}}class eO extends eF{constructor(){super()}measure(t,e,i,s,n,l,r){let o=s.length,h=t.Ho();for(let t=0;t<o;t++){let o=s[t];if(!o.visible&&o!==h)continue;let a=o.margin,u=a.right+a.left,d=a.top+a.bottom;o.ut(e,i,l,r);let c=o.measuredBounds,g=Math.max(c.width+u,0),f=Math.max(c.height+d,0),m=o.position.x,p=o.position.y;if(isFinite(m)||(m=0),isFinite(p)||(p=0),o instanceof e$&&o.isGeometryPositioned){let t=o.strokeWidth/2;m-=t,p-=t}n.unionNoCheck(m,p,g,f)}}arrange(t,e,i){let s=e.length,n=t.padding,l=i.x-n.left,r=i.y-n.top;for(let t=0;t<s;t++){let i=e[t],s=i.measuredBounds,n=i.margin,o=i.position.x,h=i.position.y,a=isNaN(o)?-l:o-l,u=isNaN(h)?-r:h-r;if(i instanceof e$&&i.isGeometryPositioned){let t=i.strokeWidth/2;a-=t,u-=t}i.visible&&i.Yt(a+n.left,u+n.top,s.width,s.height)}}}eF.Pn("Position",new eO);class eR extends eF{constructor(){super()}measure(t,e,i,s,n,l,r){let o=s.length,h=te.rt(),a=t.Ho();for(let t=0;t<o;t++){let e=s[t];if(!e.visible&&e!==a)continue;let l=e.Hs(!1);if(0!==l&&5!==l){h.push(e);continue}e.ut(1/0,i,0,r);let o=e.margin,u=e.measuredBounds,d=Math.max(u.width+o.right+o.left,0),c=Math.max(u.height+o.top+o.bottom,0);n.zn(n.width+d,Math.max(n.height,c))}let u=h.length;t.desiredSize.height?i=Math.min(t.desiredSize.height,t.maxSize.height):0!==n.height&&(i=Math.min(n.height,t.maxSize.height));for(let t=0;t<u;t++){let e=h[t];if(!e.visible&&e!==a)continue;let s=e.margin,l=s.right+s.left,o=s.top+s.bottom;e.ut(1/0,i,0,r);let u=e.measuredBounds,d=Math.max(u.width+l,0),c=Math.max(u.height+o,0);n.width+=d,n.height=Math.max(n.height,c)}te.tt(h)}arrange(t,e,i){let s=e.length,n=t.padding,l=n.top,r=t.isOpposite,o=r?i.width:n.left;for(let h=0;h<s;h++){let s=e[h];if(!s.visible)continue;let a=s.measuredBounds,u=s.margin,d=u.top+u.bottom,c=l+n.bottom,g=a.height,f=s.Hs(!1);(isNaN(s.desiredSize.height)&&2===f||4===f)&&(g=Math.max(i.height-d-c,0));let m=g+d+c,p=s.alignment;p.isDefault()&&(p=t.defaultAlignment),p.isSpot()||(p=tv.Center),r&&(o-=a.width+u.left+u.right),s.Yt(o+p.offsetX+u.left,l+p.offsetY+u.top+(i.height*p.y-m*p.y),a.width,g),r||(o+=a.width+u.left+u.right)}}}eF.Pn("Horizontal",new eR);class eB extends eF{constructor(){super()}measure(t,e,i,s,n,l,r){let o=s.length,h=te.rt(),a=t.Ho();for(let t=0;t<o;t++){let i=s[t];if(!i.visible&&i!==a)continue;let r=i.Hs(!1);if(0!==r&&4!==r){h.push(i);continue}i.ut(e,1/0,l,0);let o=i.margin,u=i.measuredBounds,d=Math.max(u.width+o.right+o.left,0),c=Math.max(u.height+o.top+o.bottom,0);n.zn(Math.max(n.width,d),n.height+c)}let u=h.length;t.desiredSize.width?e=Math.min(t.desiredSize.width,t.maxSize.width):0!==n.width&&(e=Math.min(n.width,t.maxSize.width));for(let t=0;t<u;t++){let i=h[t];if(!i.visible&&i!==a)continue;let s=i.margin,r=s.right+s.left,o=s.top+s.bottom;i.ut(e,1/0,l,0);let u=i.measuredBounds,d=Math.max(u.width+r,0),c=Math.max(u.height+o,0);n.width=Math.max(n.width,d),n.height+=c}te.tt(h)}arrange(t,e,i){let s=e.length,n=t.padding,l=n.left,r=t.isOpposite,o=r?i.height:n.top;for(let h=0;h<s;h++){let s=e[h];if(!s.visible)continue;let a=s.measuredBounds,u=s.margin,d=u.left+u.right,c=l+n.right,g=a.width,f=s.Hs(!1);(isNaN(s.desiredSize.width)&&2===f||5===f)&&(g=Math.max(i.width-d-c,0));let m=g+d+c,p=s.alignment;p.isDefault()&&(p=t.defaultAlignment),p.isSpot()||(p=tv.Center),r&&(o-=a.height+u.bottom+u.top),s.Yt(l+p.offsetX+u.left+(i.width*p.x-m*p.x),o+p.offsetY+u.top,g,a.height),r||(o+=a.height+u.bottom+u.top)}}}eF.Pn("Vertical",new eB);class eE extends eF{constructor(){super()}static LA=!1;measure(t,e,i,s,n,l,r){let o;let h=s.length;if(0===h)return;let a=t.findMainElement(),u=a.margin,d=0,c=0,g=u.right+u.left,f=u.top+u.bottom;a.ut(e,i,l,r);let m=a.measuredBounds,p=m.width,y=m.height,x=Math.max(p+g,0),w=Math.max(y+f,0),b=t.isClipping;b&&0!==a.k0()&&!eE.LA&&(eE.LA=!0,te.li("Main Shape for Spot Panel with isClipping = true must have a zero strokeWidth: "+t.toString()));let v=tw.X(-u.left,-u.top,x,w),k=tw.X(0,0,p,y);this.A2(a,k,!0),p=k.width,y=k.height;let P=!0,S=t.Ho();for(let l=0;l<h;l++){let r=s[l],h=e,g=i;if(r===a||!r.visible&&r!==S)continue;let f=(u=r.margin).left,b=u.top;switch(d=u.right+u.left,c=u.top+u.bottom,o=r.Hs(!1)){case 2:h=p,g=y,d=0,c=0,f=0,b=0;break;case 5:h=p,d=0,f=0;break;case 4:g=y,c=0,b=0}r.ut(h,g,0,0),x=Math.max((m=r.measuredBounds).width+d,0),w=Math.max(m.height+c,0);let v=r.alignment;v.isDefault()&&(v=t.defaultAlignment),v.isSpot()||(v=tv.Center);let M=r.alignmentFocus;M.isDefault()&&(M=tv.Center);let N=null;r instanceof eq&&""!==r.ho&&(N=r.findObject(r.ho))===r&&(N=null);let C=k.x-f,L=k.y-b;if(null!==N){r.Yt(0,0,m.width,m.height);let t=N.actualBounds,e=ty.X(t.x+(M.x*t.width-M.offsetX),t.y+(M.y*t.height-M.offsetY));for(N=N.panel;N!==r;)N.F.xt(e),N=N.panel;C+=v.x*p+v.offsetX-e.x,L+=v.y*y+v.offsetY-e.y,ty.e(e)}else C+=v.x*p+v.offsetX-(M.x*m.width+M.offsetX),L+=v.y*y+v.offsetY-(M.y*m.height+M.offsetY);P?(P=!1,n.i(C,L,x,w)):n.unionNoCheck(C,L,x,w)}switch(P?n.a(v):b?n.intersect(k.x,k.y,k.width,k.height):n.unionNoCheck(v.x,v.y,v.width,v.height),tw.e(v),tw.e(k),1===(o=a.stretch)&&(o=a.Hs(!1)),o){case 0:return;case 2:if(!isFinite(e)&&!isFinite(i))return;break;case 5:if(!isFinite(e))return;break;case 4:if(!isFinite(i))return}p=(m=a.measuredBounds).width,y=m.height,x=Math.max(p+g,0),w=Math.max(y+f,0),u=a.margin,k=tw.X(-u.left,-u.top,x,w),this.A2(a,k,!0),p=k.width,y=k.height;for(let e=0;e<h;e++){let i=s[e];if(i===a||!i.visible&&i!==S)continue;d=(u=i.margin).right+u.left,c=u.top+u.bottom,x=Math.max((m=i.measuredBounds).width+d,0),w=Math.max(m.height+c,0);let l=i.alignment;l.isDefault()&&(l=t.defaultAlignment),l.isSpot()||(l=tv.Center);let r=i.alignmentFocus;r.isDefault()&&(r=tv.Center),P?(P=!1,n.i(l.x*p+l.offsetX-(r.x*m.width+r.offsetX)-u.left,l.y*y+l.offsetY-(r.y*m.height+r.offsetY)-u.top,x,w)):n.unionNoCheck(l.x*p+l.offsetX-(r.x*m.width+r.offsetX)-u.left,l.y*y+l.offsetY-(r.y*m.height+r.offsetY)-u.top,x,w)}P?n.a(v):b?n.intersect(k.x,k.y,k.width,k.height):n.unionNoCheck(v.x,v.y,v.width,v.height),tw.e(k)}arrange(t,e,i){let s=e.length;if(0===s)return;let n=t.findMainElement(),l=n.measuredBounds,r=l.width,o=l.height,h=t.padding,a=h.left,u=h.top,d=a-i.x,c=u-i.y;n.Yt(d,c,r,o);let g=tw.X(0,0,r,o);this.A2(n,g,!1);for(let l=0;l<s;l++){let s=e[l];if(s===n)continue;let r=s.measuredBounds,o=r.width,h=r.height,f=s.alignment;f.isDefault()&&(f=t.defaultAlignment),f.isSpot()||(f=tv.Center);let m=s.alignmentFocus;m.isDefault()&&(m=tv.Center);let p=null;if(s instanceof eq&&""!==s.ho&&(p=s.findObject(s.ho))===s&&(p=null),null!==p){let t=p.actualBounds,e=ty.X(t.x+(m.x*t.width-m.offsetX),t.y+(m.y*t.height-m.offsetY));for(p=p.panel;p!==s;)p.F.xt(e),p=p.panel;d=f.x*g.width+f.offsetX-e.x,c=f.y*g.height+f.offsetY-e.y,ty.e(e)}else d=f.x*g.width+f.offsetX-(m.x*o+m.offsetX),c=f.y*g.height+f.offsetY-(m.y*h+m.offsetY);d+=g.x-i.x,c+=g.y-i.y,s.visible&&s.Yt(a+d,u+c,o,h)}tw.e(g)}A2(t,e,i){let s=null;if(t instanceof eq&&""!==t.ho&&(s=t.findObject(t.ho))===t&&(s=null),null!==s)for(i&&t.Yt(0,0,e.width,e.height),e.a(s.actualBounds),s=s.panel;s!==t;)s.F.Ug(e),s=s.panel}}eF.Pn("Spot",new eE);class eI extends eF{constructor(){super()}measure(t,e,i,s,n,l,r){let o=s.length;if(0===o)return;let h=t.findMainElement(),a=h.margin,u=e,d=i,c=a.right+a.left,g=a.top+a.bottom;h.ut(e,i,l,r);let f=h.measuredBounds,m=0,p=null;h instanceof e$&&(m=(p=h).strokeWidth*p.scale);let y=Math.max(f.width+c,0),x=Math.max(f.height+g,0),w=t.T2(h),b=w.x*y+w.offsetX,v=w.y*x+w.offsetY,k=t.D2(h),P=k.x*y+k.offsetX,S=k.y*x+k.offsetY;isFinite(e)&&(u=Math.max(Math.abs(b-P)-m,0)),isFinite(i)&&(d=Math.max(Math.abs(v-S)-m,0));let M=0,N=0;l>0&&(M=Math.max(Math.abs(w.x*l+w.offsetX-(k.x*l+k.offsetX))-m,0)),r>0&&(N=Math.max(Math.abs(w.y*r+w.offsetY-(k.y*r+k.offsetY))-m,0));let C=tx.l();C.i(0,0);let L=t.Ho();for(let t=0;t<o;t++){let e=s[t];if(e===h||!e.visible&&e!==L)continue;let i=(a=e.margin).right+a.left,n=a.top+a.bottom;e.ut(u,d,M,N),y=Math.max((f=e.measuredBounds).width+i,0),x=Math.max(f.height+n,0),C.i(Math.max(y,C.width),Math.max(x,C.height))}if(1===o){f=h.measuredBounds,n.width=y,n.height=x,tx.e(C);return}w=t.T2(h);let T=0,A=0;(k=t.D2(h)).x!==w.x&&k.y!==w.y&&(T=C.width/Math.abs(k.x-w.x),A=C.height/Math.abs(k.y-w.y)),tx.e(C),m=0,null!==p&&(m=p.strokeWidth*p.scale,6===p.eS()&&(T=A=Math.max(T,A))),T+=Math.abs(w.offsetX)+Math.abs(k.offsetX)+m,A+=Math.abs(w.offsetY)+Math.abs(k.offsetY)+m;let D=h.stretch;switch(1===D&&(D=h.Hs(!1)),D){case 0:l=0,r=0;break;case 2:isFinite(e)&&(T=e),isFinite(i)&&(A=i);break;case 5:isFinite(e)&&(T=e),r=0;break;case 4:l=0,isFinite(i)&&(A=i)}h.lf(),h.ut(T,A,l,r),n.width=h.measuredBounds.width+c,n.height=h.measuredBounds.height+g}arrange(t,e,i){let s=e.length;if(0===s)return;let n=t.findMainElement(),l=n.measuredBounds,r=tw.l();r.i(0,0,1,1);let o=n.margin,h=o.left,a=o.top,u=t.padding,d=u.left,c=u.top,g=h,f=a,m=l.width,p=l.height;n.Yt(d+g,c+f,m,p);let y=t.T2(n),x=t.D2(n),w=0+y.x*l.width+y.offsetX,b=0+y.y*l.height+y.offsetY,v=0+x.x*l.width+x.offsetX,k=0+x.y*l.height+x.offsetY;r.x=w,r.y=b,r.unionNoCheck(v,k,0,0),r.x+=h+d,r.y+=a+c;for(let i=0;i<s;i++){let s=e[i];if(s===n)continue;let l=s.measuredBounds;o=s.margin;let h=Math.max(l.width+o.right+o.left,0),a=Math.max(l.height+o.top+o.bottom,0),u=s.alignment;u.isDefault()&&(u=t.defaultAlignment),u.isSpot()||(u=tv.Center),g=r.width*u.x+u.offsetX-h*u.x+o.left+r.x,f=r.height*u.y+u.offsetY-a*u.y+o.top+r.y,m=r.width,p=r.height,s.visible&&(tw.contains(r.x,r.y,r.width,r.height,g,f,l.width,l.height)?s.Yt(g,f,l.width,l.height):s.Yt(g,f,l.width,l.height,new tw(r.x,r.y,r.width,r.height)))}tw.e(r)}}eF.Pn("Auto",new eI);class eV extends eF{constructor(){super(),this.name="Table"}measure(t,e,i,s,n,l,r){let o=s.length,h=te.rt(),a=te.rt();for(let t=0;t<o;t++){let e=s[t],i=e instanceof eq?e:null;if(null!==i&&i.el()&&e.visible){a.push(i);let t=i.T.r,s=t.length;for(let n=0;n<s;n++){let s=t[n];i.type===eq.TableRow?s.row=e.row:i.type===eq.TableColumn&&(s.column=e.column),h.push(s)}}else h.push(e)}0===(o=h.length)&&(t.getRowDefinition(0),t.getColumnDefinition(0));let u=[];for(let t=0;t<o;t++){let e=h[t];e.visible&&(e.me(!0),e.no(!0),u[e.row]||(u[e.row]=[]),u[e.row][e.column]||(u[e.row][e.column]=[]),u[e.row][e.column].push(e))}te.tt(h);let d=te.rt(),c=te.rt(),g=te.rt(),f={count:0},m={count:0},p=e,y=i,x=t.Ge,w=t.He,b=null;o=x.length;for(let t=0;t<o;t++)void 0!==(b=x[t])&&(b.actual=0,b.Fi=0);o=w.length;for(let t=0;t<o;t++)void 0!==(b=w[t])&&(b.actual=0,b.Fi=0);let v=u.length,k=0;for(let t=0;t<v;t++)u[t]&&(k=Math.max(k,u[t].length));let P=Math.min(t.topIndex,v-1),S=Math.min(t.leftIndex,k-1),M=0,N;v=u.length;let C=t.Ho();for(let e=0;e<v;e++){if(!u[e])continue;k=u[e].length;let i=t.getRowDefinition(e);i.actual=0,i.Fi=0;for(let s=0;s<k;s++){if(!u[e][s])continue;let n=t.getColumnDefinition(s);void 0===d[s]&&(n.actual=0,n.Fi=0,d[s]=!0);let l=u[e][s],r=l.length;for(let o=0;o<r;o++){let r=l[o];if(!r.visible&&r!==C)continue;let h=r.rowSpan>1,a=r.columnSpan>1;(h||a)&&!(e<P)&&!(s<S)&&c.push(r);let u=r.margin,d=u.right+u.left,x=u.top+u.bottom;N=r.L0(i,n,!1);let w=r.desiredSize,v=!isNaN(w.width),k=!isNaN(w.height);if(0===N||v&&k||e<P||s<S||(!a&&void 0===f[s]&&(2===N||5===N)&&(f[s]=-1,f.count++),!h&&void 0===m[e]&&(2===N||4===N)&&(m[e]=-1,m.count++),h||a||g.push(r)),r.ut(1/0,1/0,0,0),e<P||s<S)continue;let L=r.measuredBounds,T=Math.max(L.width+d,0),A=Math.max(L.height+x,0);if(1===r.rowSpan&&(0===N||5===N)){let i=(b=t.getRowDefinition(e)).computeEffectiveSpacing(),s=0===b.st;(M=Math.max(A-b.actual,0))+(s?i:0)>y&&(M=Math.max(y-i,0)),b.Fi=b.Fi+M,b.actual=b.st+M,y=Math.max(y-(M+(s?i:0)),0)}if(1===r.columnSpan&&(0===N||4===N)){let e=(b=t.getColumnDefinition(s)).computeEffectiveSpacing(),i=0===b.st;(M=Math.max(T-b.actual,0))+(i?e:0)>p&&(M=Math.max(p-e,0)),b.Fi=b.Fi+M,b.actual=b.st+M,p=Math.max(p-(M+(i?e:0)),0)}(h||a)&&r.lf()}}}te.tt(d);let L=0,T=0;o=t.columnCount;for(let t=0;t<o;t++){let e=w[t];void 0!==e&&(L+=isNaN(e.pe)?e.Fi:e.pe,0!==e.Fi&&(L+=e.computeEffectiveSpacing()))}o=t.rowCount;for(let t=0;t<o;t++){let e=x[t];void 0!==e&&(T+=isNaN(e.pe)?e.Fi:e.pe,0!==e.Fi&&(T+=e.computeEffectiveSpacing()))}p=Math.max(e-L,0);let A=y=Math.max(i-T,0),D=p;o=g.length;for(let e=0;e<o;e++){let i=g[e],s=t.getRowDefinition(i.row),n=t.getColumnDefinition(i.column),l=i.measuredBounds,r=i.margin,o=r.right+r.left,h=r.top+r.bottom;0===n.Fi&&void 0!==f[i.column]?f[i.column]=Math.max(l.width+o,f[i.column]):f[i.column]=null,0===s.Fi&&void 0!==m[i.row]?m[i.row]=Math.max(l.height+h,m[i.row]):m[i.row]=null}let F=0,O=0,R;for(R in m)"count"!==R&&(F+=m[R]);for(R in f)"count"!==R&&(O+=f[R]);let B=tx.l();for(let e=0;e<o;e++){let i=g[e];if(!i.visible&&i!==C)continue;let s=t.getRowDefinition(i.row),n=t.getColumnDefinition(i.column),l=0;l=isFinite(n.width)?n.width:Math.max(0,(l=isFinite(p)&&null!==f[i.column]?0===O?n.actual+p:f[i.column]/O*D:null!==f[i.column]?p:n.actual||p)-n.computeEffectiveSpacing());let r=0;switch(r=isFinite(s.height)?s.height:Math.max(0,(r=isFinite(y)&&null!==m[i.row]?0===F?s.actual+y:m[i.row]/F*A:null!==m[i.row]?y:s.actual||y)-s.computeEffectiveSpacing()),B.i(Math.max(n.minimum,Math.min(l,n.maximum)),Math.max(s.minimum,Math.min(r,s.maximum))),N=i.L0(s,n,!1)){case 5:B.height=Math.max(B.height,s.actual+y);break;case 4:B.width=Math.max(B.width,n.actual+p)}let o=i.margin,h=o.right+o.left,a=o.top+o.bottom;i.lf();let u=n.minimum,d=s.minimum,c=i.measuredBounds;0===c.width&&null!==f[i.column]&&(u=Math.max(u,f[i.column])),0===c.height&&null!==m[i.row]&&(d=Math.max(u,m[i.row])),i.ut(B.width,B.height,u,d);let x=i.measuredBounds,w=Math.max(x.width+h,0),b=Math.max(x.height+a,0);isFinite(p)&&(w=Math.min(w,B.width)),isFinite(y)&&(b=Math.min(b,B.height));let v=0;v=s.actual,s.actual=Math.max(s.actual,b),s.Fi=Math.max(s.Fi,b),y=Math.max(y-(M=s.actual-v),0),null===m[i.row]&&(A=Math.max(A-M,0)),v=n.actual,n.actual=Math.max(n.actual,w),n.Fi=Math.max(n.Fi,w),p=Math.max(p-(M=n.actual-v),0),null===f[i.column]&&(D=Math.max(D-M,0))}te.tt(g);let E=tx.l(),I=te.rt(),V=te.rt();if(0!==(o=c.length))for(let e=0;e<v;e++){if(!u[e])continue;k=u[e].length;let i=t.getRowDefinition(e);I[e]=i.actual;for(let i=0;i<k;i++){if(!u[e][i])continue;let s=t.getColumnDefinition(i);V[i]=s.actual}}for(let s=0;s<o;s++){let n=c[s];if(!n.visible&&n!==C)continue;let l=t.getRowDefinition(n.row),r=t.getColumnDefinition(n.column);switch(B.i(Math.max(r.minimum,Math.min(e,r.maximum)),Math.max(l.minimum,Math.min(i,l.maximum))),N=n.L0(l,r,!1)){case 2:0!==V[r.index]&&(B.width=Math.min(B.width,V[r.index])),0!==I[l.index]&&(B.height=Math.min(B.height,I[l.index]));break;case 5:0!==V[r.index]&&(B.width=Math.min(B.width,V[r.index]));break;case 4:0!==I[l.index]&&(B.height=Math.min(B.height,I[l.index]))}isFinite(r.width)&&(B.width=r.width),isFinite(l.height)&&(B.height=l.height),E.i(0,0);let o=r.minimum,h=l.minimum;for(let e=1;e<n.rowSpan&&!(n.row+e>=t.rowCount);e++)b=t.getRowDefinition(n.row+e),M=0,M=2===N||4===N?Math.max(b.minimum,0===I[n.row+e]?b.maximum:Math.min(I[n.row+e],b.maximum)):Math.max(b.minimum,isNaN(b.pe)?b.maximum:Math.min(b.pe,b.maximum)),E.height+=M,h+=b.minimum;for(let e=1;e<n.columnSpan&&!(n.column+e>=t.columnCount);e++)b=t.getColumnDefinition(n.column+e),M=0,M=2===N||5===N?Math.max(b.minimum,0===V[n.column+e]?b.maximum:Math.min(V[n.column+e],b.maximum)):Math.max(b.minimum,isNaN(b.pe)?b.maximum:Math.min(b.pe,b.maximum)),E.width+=M,o+=b.minimum;B.width+=E.width,B.height+=E.height;let a=n.margin,u=a.right+a.left,d=a.top+a.bottom;n.ut(B.width,B.height,o,h);let g=n.measuredBounds,f=Math.max(g.width+u,0),m=Math.max(g.height+d,0),p=0;for(let e=0;e<n.rowSpan&&!(n.row+e>=t.rowCount);e++)p+=(b=t.getRowDefinition(n.row+e)).total||0;if(p<m){let e=m-p,i=m-p;if(null!==n.spanAllocation){let s=n.spanAllocation;for(let l=0;l<n.rowSpan&&!(e<=0||n.row+l>=t.rowCount);l++){let r=(b=t.getRowDefinition(n.row+l)).st||0,o=s(n,b,i);b.actual=Math.min(b.maximum,r+o),b.st!==r&&(e-=b.st-r)}}for(;e>0;){let i=b.st||0;if(isNaN(b.height)&&b.maximum>i&&(b.actual=Math.min(b.maximum,i+e),b.st!==i&&(e-=b.st-i)),0===b.index)break;b=t.getRowDefinition(b.index-1)}}let y=0;for(let e=0;e<n.columnSpan&&!(n.column+e>=t.columnCount);e++)y+=(b=t.getColumnDefinition(n.column+e)).total||0;if(y<f){let e=f-y,i=f-y;if(null!==n.spanAllocation){let s=n.spanAllocation;for(let l=0;l<n.columnSpan&&!(e<=0||n.column+l>=t.columnCount);l++){let r=(b=t.getColumnDefinition(n.column+l)).st||0,o=s(n,b,i);b.actual=Math.min(b.maximum,r+o),b.st!==r&&(e-=b.st-r)}}for(;e>0;){let i=b.st||0;if(isNaN(b.width)&&b.maximum>i&&(b.actual=Math.min(b.maximum,i+e),b.st!==i&&(e-=b.st-i)),0===b.index)break;b=t.getColumnDefinition(b.index-1)}}}te.tt(c),tx.e(E),tx.e(B),void 0!==I&&te.tt(I),void 0!==V&&te.tt(V);let z=0,K=0,X=t.desiredSize,j=t.maxSize;N=t.Hs(!0),L=0,T=0;let G=0,Y=0;o=t.columnCount;for(let e=0;e<o;e++)if(void 0!==w[e]){if(isFinite((b=t.getColumnDefinition(e)).width)){G+=b.width,G+=b.computeEffectiveSpacing();continue}if(2===b.Hb()){G+=b.st,G+=b.computeEffectiveSpacing();continue}0!==b.st&&(L+=b.st,L+=b.computeEffectiveSpacing())}z=Math.max((z=Math.max(z=isFinite(X.width)?Math.min(X.width,j.width):0!==N&&isFinite(e)?e:L,isFinite(e)?Math.min(l,e):l))-G,0);let U=0===L?1:Math.max(z/L,1);for(let e=0;e<o;e++)void 0!==w[e]&&(isFinite((b=t.getColumnDefinition(e)).width)||2===b.Hb()||(b.actual=b.st*U),b.position=n.width,0!==b.st&&(n.width+=b.st,n.width+=b.computeEffectiveSpacing()));o=t.rowCount;for(let e=0;e<o;e++)if(void 0!==x[e]){if(isFinite((b=t.getRowDefinition(e)).height)){Y+=b.height,Y+=b.computeEffectiveSpacing();continue}if(2===b.Hb()){Y+=b.st,Y+=b.computeEffectiveSpacing();continue}0!==b.st&&(T+=b.st,T+=b.computeEffectiveSpacing())}K=Math.max((K=Math.max(K=isFinite(X.height)?Math.min(X.height,j.height):0!==N&&isFinite(i)?i:T,isFinite(i)?Math.min(r,i):r))-Y,0);let q=0===T?1:Math.max(K/T,1);for(let e=0;e<o;e++)void 0!==x[e]&&(isFinite((b=t.getRowDefinition(e)).height)||2===b.Hb()||(b.actual=b.st*q),b.position=n.height,0!==b.st&&(n.height+=b.st,n.height+=b.computeEffectiveSpacing()));o=a.length;for(let e=0;e<o;e++){let i=a[e],s=0,l=0;i.type===eq.TableRow?(s=n.width,l=(b=t.getRowDefinition(i.row)).actual):(s=(b=t.getColumnDefinition(i.column)).actual,l=n.height),i.measuredBounds.i(0,0,s,l),i.me(!1)}te.tt(a),t.kh=u}arrange(t,e,i){let s=e.length,n=t.padding,l=n.left,r=n.top,o=t.kh;if(null===o)return;let h=0,a=0,u=o.length,d=0;for(let t=0;t<u;t++)o[t]&&(d=Math.max(d,o[t].length));let c=t.Ge,g=t.He,f=0,m=0,p=Math.min(t.topIndex,u-1);if(c.length>0){for(;p!==u&&(void 0===c[p]||0===c[p].st);)p++;f=-c[p=Math.max(Math.min(p,u-1),0)].position}let y=Math.min(t.leftIndex,d-1);if(g.length>0){for(;y!==d&&(void 0===g[y]||0===g[y].st);)y++;m=-g[y=Math.max(Math.min(y,d-1),0)].position}let x=0,w=0;for(;x!==u&&void 0===c[x];)x++;for(;w!==u&&void 0===g[w];)w++;let b=t.part,v=t.getRowDefinition(x),k=t.getColumnDefinition(w);for(let i=0;i<e.length;i++){let s=e[i];if(!(s instanceof eq&&s.visible&&s.el()))continue;s.type===eq.TableRow?(v=t.getRowDefinition(s.row),k=t.getColumnDefinition(w)):(v=t.getRowDefinition(x),k=t.getColumnDefinition(s.column)),a=v.position+f+r,0!==v.st&&(a+=v.computeEffectiveSpacingTop(Math.max(x,p))),h=k.position+m+l,0!==k.st&&(h+=k.computeEffectiveSpacingTop(Math.max(w,y)));let n=s.measuredBounds;s.sf(),s.actualBounds.At();let o=s.actualBounds,u=tw.X(o.x,o.y,o.width,o.height);if(o.x=s.type===eq.TableRow?l:h,o.y=s.type===eq.TableColumn?r:a,o.width=n.width,o.height=n.height,s.actualBounds.u(),s.no(!1),u.equalsApproxClose(o)){tw.e(u);continue}null!==b&&(b.yh(),s.S0(b)),tw.e(u)}let P=tx.l();for(let e=0;e<u;e++){if(!o[e])continue;d=o[e].length;let s=t.getRowDefinition(e);a=s.position+f+r,0!==s.st&&(a+=s.computeEffectiveSpacingTop(Math.max(x,p)));for(let n=0;n<d;n++){if(!o[e][n])continue;let r=t.getColumnDefinition(n);h=r.position+m+l,0!==r.st&&(h+=r.computeEffectiveSpacingTop(Math.max(w,y)));let u=o[e][n],d=u.length;for(let l=0;l<d;l++){let o=u[l],d=o.measuredBounds;P.i(0,0);for(let i=1;i<o.rowSpan&&!(e+i>=t.rowCount);i++){let s=t.getRowDefinition(e+i);0!==s.st&&(P.height+=s.total)}for(let e=1;e<o.columnSpan&&!(n+e>=t.columnCount);e++){let i=t.getColumnDefinition(n+e);0!==i.st&&(P.width+=i.total)}let c=r.st+P.width,g=s.st+P.height,f=h,m=a,p=h,y=a,x=c,w=g;h+c>i.width&&(x=Math.max(i.width-h,0)),a+g>i.height&&(w=Math.max(i.height-a,0));let b=o.alignment,v=0,k=0,S=0,M=0;if(b.isDefault()){(b=t.defaultAlignment).isSpot()||(b=tv.Center),v=b.x,k=b.y,S=b.offsetX,M=b.offsetY;let e=r.alignment,i=s.alignment;e.isSpot()&&(v=e.x,S=e.offsetX),i.isSpot()&&(k=i.y,M=i.offsetY)}else v=b.x,k=b.y,S=b.offsetX,M=b.offsetY;(isNaN(v)||isNaN(k))&&(v=.5,k=.5,S=0,M=0);let N=d.width,C=d.height,L=o.margin,T=L.left+L.right,A=L.top+L.bottom,D=o.L0(s,r,!1);isNaN(o.desiredSize.width)&&(2===D||5===D)&&(N=Math.max(c-T,0)),isNaN(o.desiredSize.height)&&(2===D||4===D)&&(C=Math.max(g-A,0));let F=o.maxSize,O=o.minSize;N=Math.min(F.width,N),C=Math.min(F.height,C),N=Math.max(O.width,N);let R=(C=Math.max(O.height,C))+A;f+=c*v-(N+T)*v+S+L.left,m+=g*k-R*k+M+L.top,o.visible&&(tw.contains(p,y,x,w,f,m,d.width,d.height)?o.Yt(f,m,N,C):o.Yt(f,m,N,C,new tw(p,y,x,w)))}}}tx.e(P);for(let t=0;t<s;t++){let i=e[t],s=i instanceof eq?i:null;if(null!==s&&s.el()){let t=i.actualBounds;i.naturalBounds.At(),i.naturalBounds.i(0,0,t.width,t.height),i.naturalBounds.u()}}}}eF.Pn("Table",new eV);class ez extends eF{constructor(){super()}measure(t,e,i,s,n,l,r){}arrange(t,e,i){}}eF.Pn("TableRow",new ez);class eK extends eF{constructor(){super()}measure(t,e,i,s,n,l,r){}arrange(t,e,i){}}eF.Pn("TableColumn",new eK);class eX extends eF{constructor(){super()}measure(t,e,i,s,n,l,r){1!==s.length&&te.o("Viewbox Panel must contain exactly one GraphObject.");let o=s[0];o.nt=1,o.lf(),o.ut(1/0,1/0,l,r);let h=o.measuredBounds,a=o.margin,u=a.right+a.left,d=a.top+a.bottom;if(isFinite(e)||isFinite(i)){let s=o.scale,n=h.width,a=h.height,c=Math.max(e-u,0),g=Math.max(i-d,0),f=1;6===t.viewboxStretch?0!==n&&0!==a&&(f=Math.min(c/n,g/a)):0!==n&&0!==a&&(f=Math.max(c/n,g/a)),0===f&&(f=1e-4),o.nt*=f,s!==o.scale&&(o.me(!0),o.ut(1/0,1/0,l,r))}h=o.measuredBounds,n.width=isFinite(e)?e:Math.max(h.width+u,0),n.height=isFinite(i)?i:Math.max(h.height+d,0)}arrange(t,e,i){let s=e[0],n=s.measuredBounds,l=s.margin,r=l.right+l.left,o=l.top+l.bottom,h=Math.max(n.width+r,0),a=Math.max(n.height+o,0),u=s.alignment;u.isDefault()&&(u=t.defaultAlignment),u.isSpot()||(u=tv.Center),s.Yt(i.width*u.x-h*u.x+u.offsetX,i.height*u.y-a*u.y+u.offsetY,n.width,n.height)}}eF.Pn("Viewbox",new eX);class ej extends eF{constructor(){super()}measure(t,e,i,s,n,l,r){null===t.bi&&(t.bi=new eW),this.cv(t),this.fv(t)}arrange(t,e,i){}zi(t,e,i){let s=t.naturalBounds,n=s.width,l=s.height;e.save(),e.beginPath(),e.rect(0,0,n,l),e.clip(),e.endPath(),this.uv(t,e,i),e.restore(),e.clearContextCache(!1)}uv(t,e,i){let s=t.getDocumentScale()*i.scale;s<=0&&(s=1);let n=t.gridCellSize,l=n.width,r=n.height,o=t.naturalBounds,h=t.actualBounds,a=o.width,u=o.height,d=Math.ceil(a/l),c=Math.ceil(u/r),g=t.gridOrigin,f=g.x,m=g.y,p=t.bi.Q0,y=t.T.r,x=y.length;for(let i=0;i<x;i++){let n=y[i];if(!n.visible)continue;let g=n.interval||1,x=Math.abs(g);if(l*x*s<2)continue;let w=n.segmentIndex;(!isFinite(w)||isNaN(w))&&(w=0),w<0&&(w=x-Math.min(-w,x)),w=Math.round(w%x);let b=n.opacity,v=1;if(1!==b){if(0===b)continue;v=e.globalAlpha,e.globalAlpha=v*b}let k=p[i],P=!1,S=n.strokeDashArray;if(null!==S&&(P=!0,e.enableDash(S,n.strokeDashOffset)),null!==n.stroke&&n.strokeWidth>0&&("LineV"===n.figure||"LineH"===n.figure)){if(e.lineWidth=n.strokeWidth,t.mn(e,n.stroke,!1,!1,o,h),e.beginPath(),"LineV"===n.figure){let t=Math.floor((f-l)/l);for(let i=t;i<=t+d;i++){let t=i*l+f;0<=t&&t<=a&&this.jb(i,g,w,k)&&(e.moveTo(t,0),e.lineTo(t,u))}}else if("LineH"===n.figure){let t=Math.floor((m-r)/r);for(let i=t;i<=t+c;i++){let t=i*r+m;0<=t&&t<=u&&this.jb(i,g,w,k)&&(e.moveTo(0,t),e.lineTo(a,t))}}e.stroke(),e.endPath()}else if(null!==n.fill){if(t.mn(e,n.fill,!0,!1,o,h),"BarV"===n.figure){let t=n.width;isNaN(t)&&(t=l);let i=Math.floor((f-l)/l);for(let s=i;s<=i+d;s++){let i=s*l+f;0<=i+t&&i<=a&&this.jb(s,g,w,k)&&e.fillRect(i,0,t,u)}}else if("BarH"===n.figure){let t=n.height;isNaN(t)&&(t=r);let i=Math.floor((m-r)/r);for(let s=i;s<=i+c;s++){let i=s*r+m;0<=i+t&&i<=u&&this.jb(s,g,w,k)&&e.fillRect(0,i,a,t)}}}P&&e.disableDash(),1!==b&&(e.globalAlpha=v)}}jb(t,e,i,s){if(e<0)return t%e===i;if(t%e!==i)return!1;let n=s.length;for(let e=0;e<n;e++)if(t%s[e]===i)return!1;return!0}fv(t){let e=[],i=t.T.r,s=i.length;for(let t=0;t<s;t++){let n=i[t],l=[];if(e.push(l),!n.visible)continue;let r=n.interval;if(r<0)continue;let o=n.figure,h=this.F2(o);for(let e=0;e<s;e++){if(e===t)continue;let s=i[e];if(!s.visible)continue;let n=s.figure;if(this.F2(n)!==h)continue;let o=s.interval;o>r&&l.push(o)}}t.bi.Q0=e}F2(t){return"LineV"===t||"BarV"===t}cv(t){let e=1,i=1,s=t.T.r,n=s.length;for(let t=0;t<n;t++){let n=s[t],l=Math.abs(n.interval);l<2||(this.F2(n.figure)?i=i*l/tP.MC(i,l):e=e*l/tP.MC(e,l))}let l=t.gridCellSize,r=t.bi;r.Wc.isReal()?r.Wc.i(i*l.width,e*l.height):r.Wc=new tx(i*l.width,e*l.height)}}eF.Pn("Grid",new ej);class eG extends eF{constructor(){super()}measure(t,e,i,s,n,l,r){let o=s.length;if(!(t instanceof il||t instanceof ic))return;let h=null,a=null;if(t instanceof ic&&(h=t),t instanceof il&&(h=(a=t).adornedPart,null===t.gf&&(t.gf=[])),!(h instanceof ic))return;let u=h;if(0===o){t.naturalBounds.zn(0,0),t.measuredBounds.i(0,0,0,0);return}let d=t instanceof il?null:h.path,c=h.routeBounds,g=t.jo;g.i(0,0,c.width,c.height);let f=u.points,m=h.pointsCount;null!==a?a.hd(!1):null!==h&&h.hd(!1);let p=c.width,y=c.height,x=t.gf;if(x.length=0,null!==d){this.measureLinkPath(t,p,y,d);let e=d.measuredBounds;g.unionRect(e),x.push(e)}let w=tk.l(),b=ty.l(),v=ty.l();for(let e=0;e<o;e++){let i=s[e];if(i===d)continue;let n=i.measuredBounds;if(i.isPanelMain&&i instanceof e$){this.measureLinkPath(t,p,y,i),n=i.measuredBounds,g.unionRect(n),x.push(n);continue}if(m<2){i.ut(1/0,1/0,0,0),n=i.measuredBounds,g.unionRect(n),x.push(n);continue}let l=i.segmentIndex,r=i.segmentFraction,o=i.alignmentFocus;o.isNoSpot()&&(o=tv.Center);let h=i.segmentOrientation,a=i.segmentOffset,k=0,P=0,S=0,M=0;if(isNaN(l)){let t=u.at,e=te.rt();t.getPointAndAngleAlongPath(r,e);let s=ty.X(e[0],e[1]);M=e[2],0!==h&&(S=u.computeAngle(i,h,M),i.Ht=S,i.me(!0),i.no(!0)),k=s.x,P=s.y,ty.e(s),te.tt(e)}else if(l<-m||l>=m){let t=ty.l();u.AA(t),M=u.midAngle,0!==h&&(S=u.computeAngle(i,h,M),i.Ht=S,i.me(!0),i.no(!0)),k=t.x-c.x,P=t.y-c.y,ty.e(t)}else{let t,e,s=0;if(l>=0?(t=f.elt(l),e=l<m-1?f.elt(l+1):t):(s=m+l,t=f.elt(s),e=s>0?f.elt(s-1):t),M=0,t.equalsApprox(e)){let i,n;l>=0?(i=l>0?f.elt(l-1):t,n=l<m-2?f.elt(l+2):e):(i=s<m-1?f.elt(s+1):t,n=s>1?f.elt(s-2):e);let r=i.distanceSquaredPoint(t),o=e.distanceSquaredPoint(n);M=r>o+10?l>=0?i.directionPoint(t):t.directionPoint(i):o>r+10?l>=0?e.directionPoint(n):n.directionPoint(e):l>=0?i.directionPoint(n):n.directionPoint(i)}else M=l>=0?t.directionPoint(e):e.directionPoint(t);0!==h&&(S=u.computeAngle(i,h,M),i.Ht=S,i.me(!0),i.no(!0)),k=t.x+(e.x-t.x)*r-c.x,P=t.y+(e.y-t.y)*r-c.y}i.ut(1/0,1/0,0,0),n=i.measuredBounds;let N=i.naturalBounds,C=0;i instanceof e$&&(C=i.strokeWidth);let L=N.width+C,T=N.height+C;w.Ii(),w.Es(-n.x,-n.y),w.nt(i.scale,i.scale),w.ds(0===h?i.angle:M,L/2,T/2),(22===h||26===h)&&w.ds(90,L/2,T/2),(23===h||27===h)&&w.ds(-90,L/2,T/2),28===h&&(M>45&&M<135||M>225&&M<315)&&w.ds(-M,L/2,T/2);let A=new tw(0,0,L,T);b.setRectSpot(A,o),w.xt(b);let D=-b.x+C/2*i.scale,F=-b.y+C/2*i.scale;v.a(a);let O=isNaN(a.x),R=isNaN(a.y);if(O||R){let t=L/2+3,e=T/2+3,i=M>=45&&M<=135,s=M>=225&&M<=315;0===h&&(i||s)?(v.x=R?t:a.y,v.y=O?e:a.x,i?l>=0||isNaN(l)&&r<.5||O&&(v.y=-e):s&&((l>=0||isNaN(l)&&r<.5)&&O&&(v.y=-e),R&&(v.x=-t))):(O&&(l>=0||isNaN(l)&&r<.5?v.x=t:v.x=-t),R&&(v.y=-e),v.rotate(M))}else v.rotate(M);k+=v.x,P+=v.y,A.i(k+D,P+F,n.width,n.height),x.push(A),g.unionRect(A)}if(null!==h){let t=h.labelNodes;for(;t.next();)t.value.ut(1/0,1/0)}t.jo=g,t.position.i(c.x+g.x,c.y+g.y),n.zn(g.width||0,g.height||0),tk.e(w),ty.e(b),ty.e(v)}arrange(t,e,i){let s=e.length;if(!(t instanceof il||t instanceof ic))return;let n=t,l=null;t instanceof il&&(n=(l=t).adornedPart);let r=t instanceof il?null:n.path,o=t.gf;if(0!==o.length){let i=0;if(null!==r&&i<o.length){let e=o[i];i++,r.Yt(e.x-t.jo.x,e.y-t.jo.y,e.width,e.height)}for(let n=0;n<s;n++){let s=e[n];if(s!==r&&i<o.length){let e=o[i];i++,s.Yt(e.x-t.jo.x,e.y-t.jo.y,e.width,e.height)}}}let h=n.points,a=h.count;if(a>=2&&t instanceof ic){let e=t.labelNodes;for(;e.next();){let i=e.value;t.dv(i,a,h)}}null!==l?l.hd(!1):n.hd(!1);let u=t.TA(ty.l());t.location.i(t.position.x+u.x,t.position.y+u.y),ty.e(u)}measureLinkPath(t,e,i,s){if(!1===s.Bo())return;let n=s.strokeWidth;if(0===n&&t instanceof il&&t.type===eq.Link&&t.adornedObject instanceof e$&&(n=t.adornedObject.strokeWidth),n*=s.nt,t instanceof ic&&null!==t.at){let e=t.geometry.bounds;s.so(e.x-n/2,e.y-n/2,e.width+n,e.height+n)}else if(t instanceof il&&null!==t.adornedPart.at){let e=t.adornedPart.at.bounds;s.so(e.x-n/2,e.y-n/2,e.width+n,e.height+n)}else s.so(-(n/2),-(n/2),e+n,i+n);s.gv(),s.me(!1)}}eF.Pn("Link",new eG);class eY extends eF{constructor(){super()}measure(t,e,i,s,n,l,r){let o=t.findMainElement();t.je=[];let h=o.margin,a=h.right+h.left,u=h.top+h.bottom;o.ut(e,i,l,r);let d=o.measuredBounds,c=d.width,g=d.height,f=Math.max(c+a,0),m=Math.max(g+u,0),p=new tw(-h.left,-h.top,f,m);t.je.push(p),n.a(p),this.determineGraduatedMarks(t,o);let y=t.Ps;if(null===y)return;let x=s.length;for(let e=0;e<x;e++){let i=s[e],l=y[e];i.visible&&i!==o&&0!==l.length&&(i instanceof e$?this.measureGraduatedTicks(t,i,l,n):i instanceof e3&&this.measureGraduatedLabels(t,i,l,n),i.me(!1))}}arrange(t,e,i){if(null===t.je)return;let s=t.findMainElement(),n=t.Ps;if(null===n)return;let l=t.je,r=0,o=l[0];r++,null!==s&&s.Yt(o.x-i.x,o.y-i.y,o.width,o.height);let h=e.length;for(let t=0;t<h;t++){let h=e[t],a=n[t];h.visible&&h!==s&&0!==a.length&&(o=l[r],r++,h.Yt(o.x-i.x,o.y-i.y,o.width,o.height))}t.je=null}measureGraduatedTicks(t,e,i,s){let n=e.alignmentFocus;n.isNoSpot()&&(n=tv.TopCenter);let l=e.angle;e.Ht=0,e.ut(1/0,1/0,0,0),e.Ht=l;let r=e.measuredBounds,o=r.width,h=r.height,a=tw.X(0,0,o,h),u=ty.l();u.setRectSpot(a,n),tw.e(a);let d=-u.x,c=-u.y,g=new tw,f=i.length;for(let t=0;t<f;t++){let s=i[t],n=s.pt.x,l=s.pt.y,r=s.angle;for(let i=0;i<4;i++){switch(i){case 0:u.i(d,c);break;case 1:u.i(d+o,c);break;case 2:u.i(d,c+h);break;case 3:u.i(d+o,c+h)}u.rotate(r+e.angle),u.offset(n,l),0===t&&0===i?g.i(u.x,u.y,0,0):g.unionPoint(u),u.offset(-n,-l),u.rotate(-r-e.angle)}}ty.e(u),null!==t.je&&t.je.push(g),s.unionNoCheck(g.x,g.y,g.width,g.height)}measureGraduatedLabels(t,e,i,s){null===t.Ne&&(t.Ne=new e3);let n=t.Ne;this.DA(e,n);let l=e.alignmentFocus;l.isNoSpot()&&(l=tv.TopCenter);let r=e.segmentOrientation,o=e.segmentOffset,h=new tw,a=0,u=0,d=0,c=0,g=0,f=i.length;for(let t=0;t<f;t++){let s=i[t];a=s.pt.x,u=s.pt.y,d=s.angle,c=e.angle,g=e.angle,0!==r&&(g=21===r||25===r?d+e.angle:d,c=ic.computeAngle(r,g)),n.Ht=c,n.text=s.text||"",n.ut(1/0,1/0,0,0);let f=n.measuredBounds,m=n.naturalBounds,p=m.width,y=m.height,x=tk.l();x.Ii(),x.Es(-f.x,-f.y),x.nt(n.scale,n.scale),x.ds(g,p/2,y/2),(22===r||26===r)&&x.ds(90,p/2,y/2),(23===r||27===r)&&x.ds(-90,p/2,y/2),28===r&&(d>45&&d<135||d>225&&d<315)&&x.ds(-d,p/2,y/2);let w=tw.X(0,0,p,y),b=ty.l();b.setRectSpot(w,l),x.xt(b);let v=-b.x,k=-b.y,P=ty.l();P.a(o),isNaN(P.x)&&(P.x=p/2+3),isNaN(P.y)&&(P.y=-(y/2+3)),P.rotate(d);let S=new tw(a+=P.x+v,u+=P.y+k,f.width,f.height),M=new tw(f.x,f.y,f.width,f.height),N=new tw(m.x,m.y,m.width,m.height);s.labelAngle=c,s.lineCount=n.lineCount,s.lines=n.getMetrics(),s.actualBounds=S,s.measuredBounds=M,s.naturalBounds=N,0===t?h.a(S):h.unionRect(S),ty.e(P),ty.e(b),tw.e(w),tk.e(x)}null!==t.je&&t.je.push(h),s.unionNoCheck(h.x,h.y,h.width,h.height)}determineGraduatedMarks(t,e){let i;let s=e.geometry,n=e.strokeWidth,l=s.flattenedSegments,r=s.flattenedLengths,o=s.flattenedTotalLength,h=l.length,a=0,u=0,d=te.rt();for(let t=0;t<h;t++){let e=l[t],i=[];a=0,u=0;let s=e.length;for(let t=0;t<s;t+=2){let s=e[t],n=e[t+1];if(0===t){a=s,u=n;continue}let l=180*Math.atan2(n-u,s-a)/Math.PI;l<0&&(l+=360),i.push(l),a=s,u=n}d.push(i)}let c=this.mv(t),g=t.T.r,f=g.length,m=0,p=0,y=o;t.Ps=[];for(let h=0;h<f;h++){let a=g[h];if(i=[],!a.visible||a===e){t.Ps.push(i);continue}let u=Math.abs(a.interval),f=t.graduatedTickUnit;if(f*u*o/t.graduatedRange<2&&null===a.graduatedSkip){t.Ps.push(i);continue}let x=r[0][0],w=0,b=0;p=o*a.graduatedStart-1e-4,y=o*a.graduatedEnd+1e-4;let v=f*u,k=t.graduatedTickBase;if(k<t.graduatedMin){let e=(t.graduatedMin-k)/v;k+=(e=e%1==0?e:Math.floor(e+1))*v}else if(k>t.graduatedMin+v){let e=Math.floor((k-t.graduatedMin)/v);k-=e*v}let P=c[h],S=k,M=1e-6*t.graduatedMax;for(let h=1;k<=t.graduatedMax+M;h++){if(this.pv(t,k-t.graduatedTickBase,P)&&(k>t.graduatedMax&&(k=t.graduatedMax),(null===a.graduatedSkip||a instanceof e3&&!a.graduatedSkip(k,a)||a instanceof e$&&!a.graduatedSkip(k,a))&&((m=(k-t.graduatedMin)*o/t.graduatedRange)>o&&(m=o),p<=m&&m<=y))){let t=d[w][b],o=r[w][b];for(;w<r.length;){for(;m>x&&b<r[w].length-1;)b++,t=d[w][b],x+=o=r[w][b];if(m<=x)break;b=0,t=d[++w][b],x+=o=r[w][b]}let h=l[w],u=h[2*b],c=h[2*b+1],g=h[2*b+2],f=h[2*b+3],p=(m-(x-o))/o,y=new ty(u+(g-u)*p+n/2-s.bounds.x,c+(f-c)*p+n/2-s.bounds.y);if(y.scale(e.scale,e.scale),t=this.yv(t,p,h,d[w],b),a instanceof e3){let e="";""!==(e=null!==a.graduatedFunction?null!=(e=a.graduatedFunction(k,a))?e.toString():"":(+k.toFixed(2)).toString())&&i.push({pt:y,angle:t,text:e})}else i.push({pt:y,angle:t})}k=S+h*v}t.Ps.push(i)}te.tt(d)}yv(t,e,i,s,n){if(e<.5005&&e>.4995)return t;let l=t;if(e<.5?n>0?l=s[n-1]:tP.Y(i[0],i[i.length-2])&&tP.Y(i[1],i[i.length-1])&&(l=s[s.length-1]):e>.5&&(n+1<s.length?l=s[n+1]:tP.Y(i[0],i[i.length-2])&&tP.Y(i[1],i[i.length-1])&&(l=s[0])),t!==l){let i=Math.abs(t-l);if(i>180&&(t<l?t+=360:l+=360,i=Math.abs(t-l)),e<5e-4||e>.9995)return(t+l)/2%360;if(i<10){let i=1-Math.abs(.5-e);return(t*i+l*(1-i))%360}}return t}mv(t){if(null===t.rs){let e=[],i=t.T.r,s=i.length;for(let t=0;t<s;t++){let n=i[t],l=[];if(e.push(l),!n.visible)continue;let r=n.interval;if(!(r<0))for(let e=0;e<s;e++){if(e===t)continue;let s=i[e];if(!s.visible||n.constructor!==s.constructor)continue;let o=s.interval;o>r&&l.push(o)}}t.rs=e}return t.rs}pv(t,e,i){let s=i.length;for(let n=0;n<s;n++){let s=e%(i[n]*t.graduatedTickUnit),l=1e-6*t.graduatedTickUnit;if(s<l&&s>-l)return!1}return!0}zi(t,e,i){let s=i.oa;i.oa=!0;let n=t.naturalBounds,l=n.width,r=n.height,o=e instanceof eM;e.save(),e.beginPath(),e.rect(-1,-1,l+1,r+1),e.clip(),e.endPath();let h=t.findMainElement();h.zi(e,i);let a=t.getDocumentScale()*i.scale;a<=0&&(a=1);let u=h.actualBounds,d=t.T.r,c=t.Ps,g=d.length;for(let s=0;s<g;s++){let n=d[s],l=c[s],r=l.length;if(!(!n.visible||n===h||0===l.length)){if(n instanceof e$){if(t.graduatedTickUnit*n.interval*h.geometry.flattenedTotalLength/t.graduatedRange*a<2&&null===n.graduatedSkip)continue;let s=n.measuredBounds,d=n.strokeWidth*n.scale,c=n.alignmentFocus;c.isNoSpot()&&(c=tv.TopCenter);for(let h=0;h<r;h++){let r=l[h].pt,a=l[h].angle;this.wv(n,r,u,a,s,d,c),n.zi(e,i),o&&(t.svg.appendChild(n.svg),n.svg=null),n._r.Ii()}}else if(n instanceof e3){null===t.Ne&&(t.Ne=new e3);let s=t.Ne;this.DA(n,s),s.R2=!0;for(let h=0;h<r;h++){let r=l[h];if(r.actualBounds&&r.measuredBounds&&r.naturalBounds){s.xv(r);let l=r.actualBounds;s.Yt(l.x,l.y,l.width,l.height),this.bv(s,u,l,r.measuredBounds,r.naturalBounds),s.il=n.part,s.Gs=n.panel,s.zi(e,i),s.Gs=null,s.il=null,o&&(t.svg.appendChild(s.svg),s.svg=null)}}}}}i.oa=s,e.restore(),e.clearContextCache(!0)}wv(t,e,i,s,n,l,r){let o=t._r;o.Ii(),o.Es(e.x+i.x,e.y+i.y),o.ds(s+t.angle,0,0),o.Es(-n.width*r.x+r.offsetX+l/2,-n.height*r.y+r.offsetY+l/2),o.nt(t.scale,t.scale),t.sd(!1),t.uh.set(t._r),t.wa=t.scale,t.Ca(!1)}bv(t,e,i,s,n){let l=t._r;l.Ii(),l.Es(i.x+e.x,i.y+e.y),l.Es(-s.x,-s.y),t.x0(l,n.x,n.y,n.width,n.height),t.sd(!1),t.uh.set(t._r),t.wa=t.scale,t.Ca(!1)}DA(t,e){e.kv(t)}}eF.Pn("Graduated",new eY);var eU=((k=eU||{})[k.Uniform=6]="Uniform",k[k.UniformToFill=7]="UniformToFill",k);class eq extends eb{$;T;ti;ad;qn;ol;ho;jo;v2;O;cd;lt;bi;ei;fd;Ph;Ws;constructor(t,e){if(super(),this.$=null,void 0===t)this.$=eq.Position;else if("string"==typeof t){let e=eF.os.get(t);null!==e&&(this.$=e)}else t instanceof eF?this.$=t:t&&(this.$=eq.Position,e=t);null===this.$&&te.o("Panel type not specified or PanelLayout not loaded: "+t),this.n|=4194304|1048576*(this.$===eq.Grid),this.T=new th,this.ti=tb.Bg,this.ad=tv.Default,this.qn=1,this.ol=null,this.ho="",this.jo=new tw(NaN,NaN,NaN,NaN),this.v2=null,this.O=null,this.cd=6,this.bi=null,this.lt=null,this.ei=null,this.fd=NaN,this.Ph=null,this.Ws=null,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.$=this.$,t.ti=this.ti.N(),t.ad=this.ad.N(),t.qn=this.qn,t.ho=this.ho,t.jo.a(this.jo),null!==this.O&&(t.O=this.O.copy(t)),t.cd=this.cd,null!==this.lt&&(t.lt=this.lt.copy()),null!==this.bi&&(t.bi=this.bi.copy()),t.ei=this.ei,t.fd=this.fd,t.Ph=this.Ph}Xo(t){super.Xo(t),t.T=this.T;let e=t.T.r,i=e.length;for(let s=0;s<i;s++)e[s].Gs=t;t.ol=null}copy(){let t=super.copy();if(null===t)return null;{let e=this.T.r,i=e.length;for(let s=0;s<i;s++){let i=e[s].copy();t.Pv(i)}return t}}toString(){return"Panel("+this.type.name+")#"+tu.us(this)}get type(){return this.$}set type(t){let e=this.$;e!==t&&(this.$=t,this.mf=this.$===eq.Grid,this.c(),this.t("type",e,t))}get elements(){return this.T.iterator}get naturalBounds(){return this.Ki}get padding(){return this.ti}set padding(t){"number"==typeof t?(t<0&&te._(t,">= 0",eq,"padding"),t=new tb(t)):(t.left<0&&te._(t.left,">= 0",eq,"padding:value.left"),t.right<0&&te._(t.right,">= 0",eq,"padding:value.right"),t.top<0&&te._(t.top,">= 0",eq,"padding:value.top"),t.bottom<0&&te._(t.bottom,">= 0",eq,"padding:value.bottom"));let e=this.ti;e.equals(t)||(t=t.N(),this.ti=t,this.c(),this.t("padding",e,t))}get defaultAlignment(){return this.ad}set defaultAlignment(t){let e=this.ad;e.equals(t)||(t=t.N(),this.ad=t,this.c(),this.t("defaultAlignment",e,t))}get defaultStretch(){return this.qn}set defaultStretch(t){let e=this.qn;e!==t&&(this.qn=t,this.c(),this.t("defaultStretch",e,t))}get defaultSeparatorPadding(){return null!==this.O?this.O._0:tb.Bg}set defaultSeparatorPadding(t){"number"==typeof t&&(t=new tb(t));let e=this.defaultSeparatorPadding;e.equals(t)||(t=t.N(),null===this.O&&(this.O=new e_),this.O._0=t,this.c(),this.t("defaultSeparatorPadding",e,t))}get defaultRowSeparatorStroke(){return null!==this.O?this.O.tp:null}set defaultRowSeparatorStroke(t){let e=this.defaultRowSeparatorStroke;e!==t&&(null===t||"string"==typeof t||t instanceof eD)&&(t instanceof eD&&t.u(),null===this.O&&(this.O=new e_),this.O.tp=t,this.C(),this.t("defaultRowSeparatorStroke",e,t))}get defaultRowSeparatorStrokeWidth(){return null!==this.O?this.O.ip:1}set defaultRowSeparatorStrokeWidth(t){let e=this.defaultRowSeparatorStrokeWidth;e!==t&&isFinite(t)&&t>=0&&(null===this.O&&(this.O=new e_),this.O.ip=t,this.c(),this.t("defaultRowSeparatorStrokeWidth",e,t))}get defaultRowSeparatorDashArray(){return null!==this.O?this.O.ep:null}set defaultRowSeparatorDashArray(t){let e=this.defaultRowSeparatorDashArray;if(e!==t){if(null===t||Array.isArray(t)||te.te(t,"Array",eq,"defaultRowSeparatorDashArray:value"),null!==t){let i=t.length,s=0;for(let e=0;e<i;e++){let i=t[e];"number"==typeof i&&i>=0&&isFinite(i)||te.o("defaultRowSeparatorDashArray value "+i+" at index "+e+" must be a positive number or zero."),s+=i}if(0===s){if(null===e)return;t=null}}null===this.O&&(this.O=new e_),this.O.ep=t,this.C(),this.t("defaultRowSeparatorDashArray",e,t)}}get defaultColumnSeparatorStroke(){return null!==this.O?this.O.sp:null}set defaultColumnSeparatorStroke(t){let e=this.defaultColumnSeparatorStroke;e!==t&&(null===t||"string"==typeof t||t instanceof eD)&&(t instanceof eD&&t.u(),null===this.O&&(this.O=new e_),this.O.sp=t,this.C(),this.t("defaultColumnSeparatorStroke",e,t))}get defaultColumnSeparatorStrokeWidth(){return null!==this.O?this.O.np:1}set defaultColumnSeparatorStrokeWidth(t){let e=this.defaultColumnSeparatorStrokeWidth;e!==t&&isFinite(t)&&t>=0&&(null===this.O&&(this.O=new e_),this.O.np=t,this.c(),this.t("defaultColumnSeparatorStrokeWidth",e,t))}get defaultColumnSeparatorDashArray(){return null!==this.O?this.O.op:null}set defaultColumnSeparatorDashArray(t){let e=this.defaultColumnSeparatorDashArray;if(e!==t){if(null===t||Array.isArray(t)||te.te(t,"Array",eq,"defaultColumnSeparatorDashArray:value"),null!==t){let i=t.length,s=0;for(let e=0;e<i;e++){let i=t[e];"number"==typeof i&&i>=0&&isFinite(i)||te.o("defaultColumnSeparatorDashArray value "+i+" at index "+e+" must be a positive number or zero."),s+=i}if(0===s){if(null===e)return;t=null}}null===this.O&&(this.O=new e_),this.O.op=t,this.C(),this.t("defaultColumnSeparatorDashArray",e,t)}}get kh(){return null!==this.O?this.O.kh:null}set kh(t){null===this.O&&(this.O=new e_),this.O.kh=t}get viewboxStretch(){return this.cd}set viewboxStretch(t){let e=this.cd;e!==t&&(this.cd=t,this.c(),this.t("viewboxStretch",e,t))}get gridCellSize(){return null!==this.bi?this.bi.ud:tx.uC}set gridCellSize(t){null===this.bi&&(this.bi=new eW);let e=this.bi.ud;if(!e.equals(t)){t.isReal()&&0!==t.width&&0!==t.height||te.o("Invalid Panel.gridCellSize: "+t),this.bi.ud=t.N();let i=this.diagram;null!==i&&this===i.grid&&i.rh(),this.C(),this.t("gridCellSize",e,t)}}get gridOrigin(){return null!==this.bi?this.bi.dd:ty.Lo}set gridOrigin(t){null===this.bi&&(this.bi=new eW);let e=this.bi.dd;if(!e.equals(t)){t.isReal()||te.o("Invalid Panel.gridOrigin: "+t),this.bi.dd=t.N();let i=this.diagram;null!==i&&this===i.grid&&i.rh(),this.C(),this.t("gridOrigin",e,t)}}get graduatedMin(){return null!==this.lt?this.lt.rp:0}set graduatedMin(t){let e=this.graduatedMin;if(e!==t&&(null===this.lt&&(this.lt=new eH),this.lt.rp=t,this.c(),this.t("graduatedMin",e,t),this.tf())){let t=this.part;null!==t&&this.Na(t,"graduatedRange")}}get graduatedMax(){return null!==this.lt?this.lt.lp:100}set graduatedMax(t){let e=this.graduatedMax;if(e!==t&&(null===this.lt&&(this.lt=new eH),this.lt.lp=t,this.c(),this.t("graduatedMax",e,t),this.tf())){let t=this.part;null!==t&&this.Na(t,"graduatedRange")}}get graduatedRange(){return this.graduatedMax-this.graduatedMin}get graduatedTickUnit(){return null!==this.lt?this.lt.hp:10}set graduatedTickUnit(t){let e=this.graduatedTickUnit;e!==t&&t>0&&(null===this.lt&&(this.lt=new eH),this.lt.hp=t,this.c(),this.t("graduatedTickUnit",e,t))}get graduatedTickBase(){return null!==this.lt?this.lt.ap:0}set graduatedTickBase(t){let e=this.graduatedTickBase;e!==t&&(null===this.lt&&(this.lt=new eH),this.lt.ap=t,this.c(),this.t("graduatedTickBase",e,t))}get Ps(){return null!==this.lt?this.lt.Ps:null}set Ps(t){null!==this.lt?this.lt.Ps=t:null!==t&&(this.lt=new eH,this.lt.Ps=t)}get je(){return null!==this.lt?this.lt.je:null}set je(t){null!==this.lt?this.lt.je=t:null!==t&&(this.lt=new eH,this.lt.je=t)}get rs(){return null!==this.lt?this.lt.rs:null}set rs(t){null!==this.lt?this.lt.rs=t:null!==t&&(this.lt=new eH,this.lt.rs=t)}get Ne(){return null!==this.lt?this.lt.Ne:null}set Ne(t){null!==this.lt?this.lt.Ne=t:null!==t&&(this.lt=new eH,this.lt.Ne=t)}S0(t){super.S0(t);let e=this.T.r,i=e.length;for(let s=0;s<i;s++)e[s].S0(t)}wh(t,e){if(this.$===eq.Grid||this.$===eq.Graduated){t.commitTransform(),this.$.zi(this,t,e);return}if(this.$===eq.Table){if(t.commitTransform(),t instanceof eM){let i=t.currentElement;t.currentElement=t.newGroup2("gojs-ts"),this.O2(t,e),t.endGroup(),t.currentElement=i}else this.O2(t,e)}let i=this.isClipping&&this.$===eq.Spot;i&&t.save();let s=this.findMainElement(),n=this.T.r,l=n.length;for(let r=0;r<l;r++){let l=n[r];i&&l===s&&(t.clipInsteadOfFill=!0),l.zi(t,e),i&&l===s&&(t.clipInsteadOfFill=!1)}i&&(t.restore(),t.clearContextCache(!0))}O2(t,e){t.lineCap="butt";let i=this.rowCount>0?this.Ge:null,s=this.columnCount>0?this.He:null;null!==i&&this.qb(t,e,!0,i,!0),null!==s&&this.qb(t,e,!1,s,!0),null!==i&&this.FA(t,!0,i),null!==s&&this.FA(t,!1,s),null!==i&&this.qb(t,e,!0,i,!1),null!==s&&this.qb(t,e,!1,s,!1)}FA(t,e,i){let s=i.length,n=this.actualBounds,l=this.naturalBounds,r=!0;for(let o=0;o<s;o++){let s=i[o];if(void 0===s||0===s.actual)continue;if(r){r=!1;continue}if(e){if(s.position>l.height)continue}else if(s.position>l.width)continue;let h=s.separatorStrokeWidth;isNaN(h)&&(h=e?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let a=s.separatorStroke;if(null===a&&(a=e?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),0===h||null===a)continue;this.mn(t,a,!1,!1,l,n);let u=!1,d=s.separatorDashArray;null===d&&(d=e?this.defaultRowSeparatorDashArray:this.defaultColumnSeparatorDashArray),null!==d&&(u=!0,t.enableDash(d,0)),t.beginPath();let c=s.position+h;e?c>l.height&&(h-=c-l.height):c>l.width&&(h-=c-l.width);let g=s.position+h/2;t.lineWidth=h;let f=this.ti;if(e){g+=f.top;let e=f.left,i=l.width-f.right;t.moveTo(e,g),t.lineTo(i,g)}else{g+=f.left;let e=f.top,i=l.height-f.bottom;t.moveTo(g,e),t.lineTo(g,i)}t.stroke(),t.endPath(),u&&t.disableDash()}}qb(t,e,i,s,n){let l=s.length,r=this.actualBounds,o=this.naturalBounds,h=this.RA(!0),a=this.RA(!1);for(let e=0;e<l;e++){let l=s[e];if(void 0===l||null===l.background||l.coversSeparators===n||0===l.actual)continue;let u=i?r.height:r.width;if(l.position>u)continue;let d=l.computeEffectiveSpacing(),c=l.separatorStrokeWidth;isNaN(c)&&(c=i?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let g=l.separatorStroke;null===g&&(g=i?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),(null===g||l.index===(i?h:a))&&(c=0),d-=c;let f=l.position+c,m=d+l.actual;if(f+m>u&&(m=u-f),m<=0)continue;let p=this.ti;this.mn(t,l.background,!0,!1,o,r),i?t.fillRect(p.left,f+p.top,r.width-(p.left+p.right),m):t.fillRect(f+p.left,p.top,m,r.height-(p.top+p.bottom))}}RA(t){let e=t?this.rowCount:this.columnCount;for(let i=0;i<e;i++){let e=t?this.Ge[i]:this.He[i];if(void 0!==e)return e.index}return 0}of(){let t=this.T.r,e=t.length;for(let i=0;i<e;i++)t[i].of();this.Ye(!0)}nf(t,e,i){let s=this.svg;if(null===s)return!1;if(this.type===eq.Table){let i=s.getElementsByClassName("gojs-ts"),n=0!==i.length?i[0]:null;null!==n&&(n.innerHTML=""),t.currentElement=n,this.O2(t,e),t.currentElement=null}else{if(this.$===eq.Grid||this.$===eq.Graduated)return s.innerHTML="",s.remove(),!1;if(this.$===eq.Spot&&this.isClipping)return s.innerHTML="",s.remove(),this.dh=null,this.of(),!1}if(!super.nf(t,e,i))return!1;let n=this.T.r,l=n.length;for(let i=0;i<l;i++)n[i].zi(t,e);return!0}ed(t){return!0}N0(t,e,i,s){if(!this.isClipping){if(this.js()&&null!==t.partClipRect){let e=t.partClipRect,n=this.T.r,l=0,r=0;for(let t=0;t<n.length;t++){if(!n[t].isVisibleObject())continue;let e=n[t].actualBounds;l=0===t?e.x:Math.min(e.x,l),r=0===t?e.y:Math.min(e.y,r)}s.setAttributeNS(null,"clip-path",`path('M ${e.x-i.x-l},${e.y-i.y-r} l ${e.width} 0 l 0 ${e.height} l -${e.width} 0 z')`);return}super.N0(t,e,i,s)}}ef(t,e,i,s,n){let l=this.wn(),r=this.F,o=1/(r.m11*r.m22-r.m12*r.m21),h=r.m22*o,a=-r.m12*o,u=-r.m21*o,d=r.m11*o,c=o*(r.m21*r.dy-r.m22*r.dx),g=o*(r.m12*r.dx-r.m11*r.dy);if(null!==this.background){let l=t*h+e*u+c,o=t*a+e*d+g,f=i*h+s*u+c,m=i*a+s*d+g;n.i(0,0);let p=this.naturalBounds,y=tP.kl(0,0,p.width,p.height,l,o,f,m,n);return n.F(r),y}{l||(h=1,a=0,u=0,d=1,c=0,g=0);let o=t*h+e*u+c,f=t*a+e*d+g,m=i*h+s*u+c,p=i*a+s*d+g;n.i(m,p);let y=(m-o)**2+(p-f)**2,x=!1,w=this.T.r,b=w.length,v=ty.l(),k=null,P=1/0,S=null,M=this.isClipping&&this.$===eq.Spot;M&&(S=ty.l(),(x=(k=this.findMainElement()).ef(o,f,m,p,S))&&(P=(o-S.x)**2+(f-S.y)**2));for(let t=0;t<b;t++){let e=w[t];if(!e.visible||e===k||!e.ef(o,f,m,p,v))continue;x=!0;let i=(o-v.x)**2+(f-v.y)**2;i<y&&(y=i,n.set(v))}return M&&(P>y&&n.set(S),ty.e(S)),ty.e(v),l&&n.F(r),x}}vu(){let t=this.T.r,e=t.length;for(let i=0;i<e;i++)t[i].vu();super.vu()}c(t){if(this.Bo())return;super.c(t);let e=null;(this.$===eq.Auto||this.$===eq.Link)&&(e=this.findMainElement());let i=this.T.r,s=i.length;for(let t=0;t<s;t++){let s=i[t];if((s===e||s.isPanelMain)&&s.c(!0),s.desiredSize.isReal())continue;let n=s.Hs(!1);(s instanceof iv||s instanceof eq||s instanceof e3||0!==n)&&s.c(!0)}}lf(){if(this.Bo())return;this.me(!0),this.no(!0);let t=this.T.r,e=t.length;for(let i=0;i<e;i++)t[i].lf()}sf(){if(!1===this.Bb()){this.sd(!0),this.Ca(!0);let t=this.T.r,e=t.length;for(let i=0;i<e;i++)t[i].d2()}}d2(){this.Ca(!0);let t=this.T.r,e=t.length;for(let i=0;i<e;i++)t[i].d2()}_u(t,e,i,s){let n=this.jo;n.i(0,0,0,0);let l=this.desiredSize,r=this.minSize;void 0===i&&(i=r.width,s=r.height),i=Math.max(i,r.width),s=Math.max(s,r.height);let o=this.maxSize;isNaN(l.width)||(t=Math.min(l.width,o.width)),isNaN(l.height)||(e=Math.min(l.height,o.height)),t=Math.max(i,t),e=Math.max(s,e);let h=this.ti;t=Math.max(t-h.left-h.right,0),e=Math.max(e-h.top-h.bottom,0);let a=this.T.r;this.$.measure(this,t,e,a,n,i,s);let u=n.width+h.left+h.right,d=n.height+h.top+h.bottom;isFinite(l.width)&&(u=l.width),isFinite(l.height)&&(d=l.height),u=Math.min(o.width,u),d=Math.min(o.height,d),u=Math.max(r.width,u),d=Math.max(r.height,d),u=Math.max(i,u),d=Math.max(s,d),n.zn(u,d),this.naturalBounds.zn(u,d),this.so(0,0,u,d)}findMainElement(){if(null===this.ol){let t=this.T.r,e=t.length;if(0===e)return null;for(let i=0;i<e;i++){let e=t[i];if(!0===e.isPanelMain)return this.ol=e,e}this.ol=t[0]}return this.ol}Ho(){return null!==this.part?this.part.locationObject:null}get panelLayoutState(){return this.v2}set panelLayoutState(t){this.v2=t}ph(t,e,i,s){let n=this.T.r;if(this.actualBounds.i(t,e,i,s),!this.desiredSize.isReal()){let t=this.Hs(!0),e=this.measuredBounds,n=e.width,l=e.height,r=this.tl,o=r.left+r.right,h=r.top+r.bottom;switch(n===i&&l===s&&(t=0),t){case 0:(n>i||l>s)&&(this.c(),this.ut(n>i?i:n,l>s?s:l,0,0));break;case 2:this.c(!0),this.ut(i+o,s+h,0,0);break;case 5:this.c(!0),this.ut(i+o,l+h,0,0);break;case 4:this.c(!0),this.ut(n+o,s+h,0,0)}}this.$.arrange(this,n,this.jo)}mh(t){let e=this.naturalBounds,i=this.Ho();if(tw.contains(0,0,e.width,e.height,t.x,t.y)){let e=this.T.r,s=e.length,n=ty.X(0,0);for(let l=s;l--;){let s=e[l];if(!(!s.visible&&s!==i)&&(n.set(t).Be(s.F),s.containsPoint(n)))return ty.e(n),!0}return ty.e(n),null!==this.Dt}return!1}w0(t){if(this.io===t)return this;let e=this.T.r,i=e.length;for(let s=0;s<i;s++){let i=e[s].w0(t);if(null!==i)return i}return null}walkVisualTreeFrom(t,e){if(e(this,t),t instanceof eq){let i=t.T.r,s=i.length;for(let t=0;t<s;t++)this.walkVisualTreeFrom(i[t],e)}}$r(t){this.vA(this,t)}vA(t,e){e(t);let i=t.T.r,s=i.length;for(let t=0;t<s;t++){let s=i[t];s instanceof eq&&this.vA(s,e)}}Sv(t){this.OA(this,t)}OA(t,e){if(e(t),t instanceof eq){let i=t.T.r,s=i.length;for(let t=0;t<s;t++)this.OA(i[t],e)}}findInVisualTree(t){return this.IA(this,t)}IA(t,e){if(e(t))return t;if(t instanceof eq){let i=t.T.r,s=i.length;for(let t=0;t<s;t++){let s=this.IA(i[t],e);if(null!==s)return s}}return null}findObject(t){if(this.name===t)return this;let e=this.T.r,i=e.length;this.Mv()&&(i=this.cp());for(let s=0;s<i;s++){let i=e[s];if(i instanceof eq){let e=i.findObject(t);if(null!==e)return e}if(i.name===t)return i}return null}EA(){let t=this.T.r,e=t.length,i=0;for(let s=0;s<e;s++){let e=t[s];e instanceof eq?i=Math.max(i,e.EA()):e instanceof e$&&(i=Math.max(i,e.Nv()))}return i}wn(){return this.type!==eq.TableRow&&this.type!==eq.TableColumn}el(){return this.type===eq.TableRow||this.type===eq.TableColumn}gL(t,e,i){if(!1===this.pickable||(void 0===e&&(e=null),void 0===i&&(i=null),this.es()))return null;let s=this.naturalBounds,n=1/this.getDocumentScale(),l=this.wn(),r=l?t:ty.X(t.x,t.y).Be(this.F),o=this.diagram,h=10,a=5;if(null!==o&&(a=(h=o.getInputOption("extraTouchArea"))/2),tw.contains(-(a*n),-(a*n),s.width+h*n,s.height+h*n,r.x,r.y)){if(!this.mf){let s=this.T.r,n=s.length,o=ty.l(),h=this.isClipping&&this.$===eq.Spot,a=h?this.findMainElement():null;if(h&&(a.wn()?o.set(t).Be(a.F):o.set(t),!a.containsPoint(o)))return ty.e(o),l||ty.e(r),null;let u=this.Ho();for(let d=n;d--;){let n=s[d];if(!n.visible&&n!==u||(n.wn()?o.set(t).Be(n.F):o.set(t),h&&n===a))continue;let c=null;if(n instanceof eq?c=n.gL(o,e,i):!0===n.pickable&&n.containsPoint(o)&&(c=n),null!==c&&(null!==e&&(c=e(c)),null!==c&&(null===i||i(c))))return ty.e(o),l||ty.e(r),c}ty.e(o)}if(null===this.background)return l||ty.e(r),null;let n=tw.contains(0,0,s.width,s.height,r.x,r.y)?this:null;return l||ty.e(r),n}return l||ty.e(r),null}mL(t,e,i,s){if(!1===this.pickable)return!1;void 0===e&&(e=null),void 0===i&&(i=null);let n=this.naturalBounds,l=this.wn(),r=l?t:ty.X(t.x,t.y).Be(this.F),o=this.el(),h=tw.contains(0,0,n.width,n.height,r.x,r.y);if(o||h){if(!this.mf){let n=this.T.r,l=n.length,r=ty.l(),o=this.Ho();for(let h=l;h--;){let l=n[h];if(!l.visible&&l!==o)continue;l.wn()?r.set(t).Be(l.F):r.set(t);let a=l,u=l instanceof eq?l:null;if(null!==u?u.mL(r,e,i,s):a.containsPoint(r)){if(!1===a.pickable)continue;null!==e&&(a=e(a)),null!==a&&(null===i||i(a))&&s.add(a)}}ty.e(r)}return l||ty.e(r),h&&null!==this.background}return l||ty.e(r),!1}Om(t,e,i,s,n,l){if(!1===this.pickable)return!1;void 0===e&&(e=null),void 0===i&&(i=null);let r=l;if(void 0===l&&(r=tk.l()).Ii(),r.ac(this.F),this.containedInRect(t,r))return this.I2(e,i,n),void 0===l&&tk.e(r),!0;if(this.intersectsRect(t,r)){if(!this.mf){let l=this.Ho(),o=this.T.r,h=o.length;for(let a=h;a--;){let h=o[a];if(!h.visible&&h!==l)continue;let u=h.actualBounds,d=this.naturalBounds;if(u.x>d.width||u.y>d.height||u.x+u.width<0||u.y+u.height<0)continue;let c=h,g=h instanceof eq?h:null,f=tk.l();f.set(r),(null!==g?g.Om(t,e,i,s,n,f):c.uA(t,s,f))&&(null!==e&&(c=e(c)),null!==c&&(null===i||i(c))&&n.add(c)),tk.e(f)}}return void 0===l&&tk.e(r),s}return void 0===l&&tk.e(r),!1}I2(t,e,i){let s=this.T.r,n=s.length;for(let l=n;l--;){let n=s[l];if(!n.visible)continue;let r=n.actualBounds,o=this.naturalBounds;if(r.x>o.width||r.y>o.height||r.x+r.width<0||r.y+r.height<0)continue;n instanceof eq&&n.I2(t,e,i);let h=n;null!==t&&(h=t(h)),null!==h&&(null===e||e(h))&&i.add(h)}}pL(t,e,i,s,n,l){if(!1===this.pickable)return!1;void 0===i&&(i=null),void 0===s&&(s=null);let r=this.naturalBounds,o=this.wn(),h=o?t:ty.X(t.x,t.y).Be(this.F),a=o?e:ty.X(e.x,e.y).Be(this.F),u=h.distanceSquaredPoint(a),d=h.x>0&&h.x<r.width&&h.y>0&&h.y<r.height||ty.distanceLineSegmentSquared(h.x,h.y,0,0,0,r.height)<=u||ty.distanceLineSegmentSquared(h.x,h.y,0,r.height,r.width,r.height)<=u||ty.distanceLineSegmentSquared(h.x,h.y,r.width,r.height,r.width,0)<=u||ty.distanceLineSegmentSquared(h.x,h.y,r.width,0,0,0)<=u,c=h.distanceSquared(0,0)<=u&&h.distanceSquared(0,r.height)<=u&&h.distanceSquared(r.width,0)<=u&&h.distanceSquared(r.width,r.height)<=u;if(o||(ty.e(h),ty.e(a)),d){if(!this.mf){let r=ty.l(),h=ty.l(),a=this.Ho(),u=this.T.r,d=u.length;for(let c=d;c--;){let d=u[c];if(!d.visible&&d!==a)continue;let g=d.actualBounds,f=this.naturalBounds;if(o&&(g.x>f.width||g.y>f.height||g.x+g.width<0||g.y+g.height<0))continue;if(d.wn()){let i=d.F;r.set(t).Be(i),h.set(e).Be(i)}else r.set(t),h.set(e);let m=d,p=d instanceof eq?d:null;(null!==p?p.pL(r,h,i,s,n,l):m.dA(r,h,n))&&(null!==i&&(m=i(m)),null!==m&&(null===s||s(m))&&l.add(m))}ty.e(r),ty.e(h)}return n?d:c}return!1}T2(t){let e=null;if(t instanceof e$){(e=t.spot1)===tv.Default&&(e=null);let i=t.geometry;null!==i&&null===e&&(e=i.spot1)}return null===e&&(e=tv.TopLeft),e}D2(t){let e=null;if(t instanceof e$){(e=t.spot2)===tv.Default&&(e=null);let i=t.geometry;null!==i&&null===e&&(e=i.spot2)}return null===e&&(e=tv.BottomRight),e}add(...t){for(let e=0;e<t.length;e++)this.insertAt(this.T.count,t[e]);return this}elt(t){return this.T.elt(t)}insertAt(t,e){e instanceof ii&&te.o("Cannot add a Part to a Panel: "+e+"; use a Panel instead"),(this===e||this.isContainedBy(e))&&(this===e&&te.o("Cannot make a Panel contain itself: "+this.toString()),te.o("Cannot make a Panel indirectly contain itself: "+this.toString()+" already contains "+e.toString()));let i=e.panel;if(null!==i&&i!==this&&te.o("Cannot add a GraphObject that already belongs to another Panel to this Panel: "+e.toString()+", already contained by "+i.toString()+", cannot be shared by this Panel: "+this.toString()),this.$!==eq.Grid||e instanceof e$||te.o("Can only add Shapes to a Grid Panel, not: "+e),this.$!==eq.Graduated||e instanceof e$||e instanceof e3||te.o("Can only add Shapes or TextBlocks to a Graduated Panel, not: "+e),e.La(this),e.il=null,null!==this.itemArray){let t=e.data;te.H(t)&&(null===this.Ws&&(this.Ws=new tp),this.Ws.set(t,e))}let s=this.T,n=-1;if(i===this){let l=-1,r=this.T.r,o=r.length;for(let t=0;t<o;t++)if(r[t]===e){l=t;break}if(-1!==l){if(l===t||l+1>=s.count&&t>=s.count)return;s.removeAt(l),n=l}else te.o("element "+e.toString()+" has panel "+i.toString()+" but is not contained by it.")}(t<0||t>s.count)&&(t=s.count),s.insertAt(t,e),(0===t||e.isPanelMain)&&(this.ol=null),this.Bo()||this.c(),e.c(!1),null!==e.portId?this.bn=!0:e instanceof eq&&!0===e.bn&&(this.bn=!0),this.rs=null,this.isEnabledObject()||this.Wb(e,!1);let l=this.part;if(null!==l){l.R0(),l.pf(),this.bn&&l instanceof io&&(l.bn=!0),l.bn&&l instanceof io&&(l.le=null);let i=this.diagram;if(null!==i&&i.undoManager.isUndoingRedoing)return;-1!==n&&l.raiseChangedEvent(4,"elements",this,e,null,n,null),l.raiseChangedEvent(3,"elements",this,null,e,null,t)}}get bn(){return(8388608&this.n)!=0}set bn(t){(8388608&this.n)!=0!==t&&(this.n=8388608^this.n)}a2(){return(0x1000000&this.n)!=0}E2(t){t?this.n|=0x1000000:this.n&=-0x1000001}Pv(t){t.La(this),t.il=null;let e=this.T,i=e.count;e.insertAt(i,t);let s=this.part;if(null!==s){s.R0(),null!==t.portId&&s instanceof io&&(s.bn=!0);let e=this.diagram;if(null!==e&&e.undoManager.isUndoingRedoing)return;s.raiseChangedEvent(3,"elements",this,null,t,null,i)}}GR(t){let e=this.T.r,i=e.length,s=-1;for(let n=0;n<i;n++)if(e[n]===t){s=n;break}return s}remove(t){let e=this.T.r,i=e.length,s=-1;for(let n=0;n<i;n++)if(e[n]===t){s=n;break}-1!==s&&this.se(s,!0)}removeAt(t){t>=0&&this.se(t,!0)}se(t,e){let i=this.T,s=i.elt(t);if(s.il=null,s.La(null),null!==this.Ws){let t=s.data;te.H(t)&&this.Ws.delete(t)}i.removeAt(t),this.me(!1),this.c(),this.ol===s&&(this.ol=null),this.rs=null;let n=this.part;if(null!==n){n.R0(),n.pf(),n.invalidateAdornments(),n instanceof io&&(s instanceof eq?s.walkVisualTreeFrom(s,(t,i)=>n.w2(i,e)):n.w2(s,e));let i=this.diagram;if(null!==i&&i.undoManager.isUndoingRedoing)return;n.raiseChangedEvent(4,"elements",this,s,null,t,null)}}get Ge(){return null===this.O&&(this.O=new e_),this.O.Ge}get rowCount(){return null===this.O?0:this.Ge.length}getRowDefinition(t){t<0&&te._(t,">= 0",eq,"getRowDefinition:idx"),t=Math.round(t);let e=this.Ge;if(void 0===e[t]){let i=new eZ;i.La(this),i.isRow=!0,i.index=t,e[t]=i,this.raiseChangedEvent(3,"rowdefs",this,null,i,null,t)}return e[t]}removeRowDefinition(t){if(t<0&&te._(t,">= 0",eq,"removeRowDefinition:idx"),0===this.rowCount)return;t=Math.round(t);let e=this.Ge,i=e[t];if(i){e[t]=void 0;let s=e.length-1;for(;s>=0&&void 0===e[s--];)e.length--;this.raiseChangedEvent(4,"rowdefs",this,i,null,t,null),this.c()}}GL(t,e){let i=this.Ge;if(!(t<0)){if(i[t]=e instanceof eZ?e:void 0,!e){let t=i.length-1;for(;t>=0&&void 0===i[t--];)i.length--}this.c()}}get He(){return null===this.O&&(this.O=new e_),this.O.He}get columnCount(){return null===this.O?0:this.He.length}getColumnDefinition(t){t<0&&te._(t,">= 0",eq,"getColumnDefinition:idx"),t=Math.round(t);let e=this.He;if(void 0===e[t]){let i=new eZ;i.La(this),i.isRow=!1,i.index=t,e[t]=i,this.raiseChangedEvent(3,"coldefs",this,null,i,null,t)}return e[t]}removeColumnDefinition(t){if(t<0&&te._(t,">= 0",eq,"removeColumnDefinition:idx"),0===this.columnCount)return;t=Math.round(t);let e=this.He,i=e[t];if(i){e[t]=void 0;let s=e.length-1;for(;s>=0&&void 0===e[s--];)e.length--;this.raiseChangedEvent(4,"coldefs",this,i,null,t,null),this.c()}}HL(t,e){let i=this.He;if(!(t<0)){if(i[t]=e instanceof eZ?e:void 0,!e){let t=i.length-1;for(;t>=0&&void 0===i[t--];)i.length--}this.c()}}addRowColumnDefinition(t){let e=null;return t.isRow?e=this.getRowDefinition(t.index):t.isRow||(e=this.getColumnDefinition(t.index)),e&&e.Vb(t),this}addRowDefinition(t,e){let i=this.getRowDefinition(t);return i&&i.Vb(new eZ(e)),this}addColumnDefinition(t,e){let i=this.getColumnDefinition(t);return i&&i.Vb(new eZ(e)),this}get rowSizing(){return null!==this.O?this.O.fp:3}set rowSizing(t){let e=this.rowSizing;e!==t&&(null===this.O&&(this.O=new e_),this.O.fp=t,this.c(),this.t("rowSizing",e,t))}get columnSizing(){return null!==this.O?this.O.dp:3}set columnSizing(t){let e=this.columnSizing;e!==t&&(null===this.O&&(this.O=new e_),this.O.dp=t,this.c(),this.t("columnSizing",e,t))}get topIndex(){return null!==this.O?this.O.gp:0}set topIndex(t){let e=this.topIndex;e!==t&&((!isFinite(t)||t<0)&&te.o("Panel.topIndex must be greater than zero and a real number, not: "+t),null===this.O&&(this.O=new e_),this.O.gp=t,this.c(),this.t("topIndex",e,t))}get leftIndex(){return null!==this.O?this.O.mp:0}set leftIndex(t){let e=this.leftIndex;e!==t&&((!isFinite(t)||t<0)&&te.o("Panel.leftIndex must be greater than zero and a real number, not: "+t),null===this.O&&(this.O=new e_),this.O.mp=t,this.c(),this.t("leftIndex",e,t))}findRowForLocalY(t){if(t<0||this.type!==eq.Table||0===this.rowCount)return -1;let e=0,i=this.Ge,s=i.length,n=this.topIndex;for(;n<s;n++){let s=i[n];if(void 0!==s&&t<(e+=s.total))break}return n}findColumnForLocalX(t){if(t<0||this.type!==eq.Table||0===this.columnCount)return -1;let e=0,i=this.He,s=i.length,n=this.leftIndex;for(;n<s;n++){let s=i[n];if(void 0!==s&&t<(e+=s.total))break}return n}graduatedPointForValue(t,e){if(void 0===e&&(e=new ty(NaN,NaN)),this.type!==eq.Graduated)return e.i(NaN,NaN),e;t=Math.min(Math.max(t,this.graduatedMin),this.graduatedMax);let i=this.findMainElement();return i.geometry.getPointAlongPath((t-this.graduatedMin)/this.graduatedRange,e),i.F.xt(e)}graduatedValueForPoint(t){if(this.type!==eq.Graduated)return NaN;let e=this.findMainElement();return e.F._e(t),e.geometry.getFractionForPoint(t)*this.graduatedRange+this.graduatedMin}get data(){return this.ei}set data(t){let e=this.ei;if(e!==t){let i=this instanceof ii&&!(this instanceof il);i&&te.s(t,"object",eq,"data"),this.zt(),this.ei=t;let s=this.diagram;if(null!==s){if(i)s.partManager.Cv(this,e,t);else{let i=this.panel;null!==i&&null!==i.Ws&&(null!==e&&i.Ws.delete(e),null!==t&&i.Ws.set(t,this))}}if(this.t("data",e,t),null!==s&&s.undoManager.isUndoingRedoing)return;null!==t&&this.updateTargetBindings()}}get itemIndex(){return this.fd}set itemIndex(t){let e=this.fd;e!==t&&(this.fd=t,this.t("itemIndex",e,t))}get qs(){return null!==this.b?this.b.qs:null}set qs(t){this.Ti!==t&&(null===this.b&&(this.b=new ev),this.b.qs=t)}b2(){return null!==this.qs}PA(){let t=this.qs;return null!==t&&t.h}freezeBindings(){return this.zt()}zt(){let t=this.qs;if(null===t)null!==this.data&&te.o("Template cannot have .data be non-null: "+this),this.qs=t=new th;else if(t.h)return this;let e=new th;this.E2(!1),this.walkVisualTreeFrom(this,(i,s)=>{s.gh();let n=s.Ti;if(null!==n){s.g2(!1);let l=n.iterator;for(;l.next();){let n=l.value;2===n.mode&&s.g2(!0);let r=n.sourceName;if(n.isToObject){"/"===r&&i.E2(!0);let t=n.fA(i,s);null!==t&&(e.add(t),null===t.eo&&(t.eo=new th),t.eo.add(n))}t.add(n)}}if(s instanceof eq&&s.type===eq.Table){if(s.rowCount>0){let e=s.Ge,i=e.length;for(let s=0;s<i;s++){let i=e[s];if(void 0!==i&&null!==i.Ss){let e=i.Ss.iterator;for(;e.next();){let s=e.value;s.Se=i,s.gd=2,s.yf=i.index,t.add(s)}}}}if(s.columnCount>0){let e=s.He,i=e.length;for(let s=0;s<i;s++){let i=e[s];if(void 0!==i&&null!==i.Ss){let e=i.Ss.iterator;for(;e.next();){let s=e.value;s.Se=i,s.gd=1,s.yf=i.index,t.add(s)}}}}}});let i=e.iterator;for(;i.next();){let t=i.value;if(null!==t.eo){t.g2(!0);let e=t.eo.iterator;for(;e.next();){let i=e.value;null===t.Ti&&(t.Ti=new th),t.Ti.add(i)}}t.eo=null}let s=t.iterator;for(;s.next();){let t=s.value,e=t.Se;if(null!==e){t.Se=null;let i=t.targetProperty,s=i.indexOf(".");if(s>0&&e instanceof eq){let n=i.substring(0,s),l=i.substring(s+1),r=e.findObject(n);null!==r?(e=r,t.targetProperty=l):(te.li('Warning: unable to find GraphObject named "'+n+'" for Binding: '+t.toString()),e=null)}if(e instanceof eZ){let i=tu.us(e.panel);t.targetId=void 0===i?-1:i,e.panel.io=t.targetId}else if(e instanceof eb){let i=tu.us(e);t.targetId=void 0===i?-1:i,e.io=t.targetId}else te.o("Unknown type of binding target: "+e);t.check(e)}}return t.u(),this instanceof ii&&this.Me()&&this.ensureBounds(),this}static ME=!1;copyTemplate(t){void 0===t&&(t=!1);let e=this.copy();return e.Sv(t=>{t instanceof eq&&(t.qs=null,t.ei=null);let e=t.Ti;null!==e&&(t.Ti=null,e.each(e=>t.bind(e.copy())));let i=t.ks;null!==i&&(t.ks=null,i.each(e=>t.trigger(e.value.copy())))}),t&&e.zt(),e}updateTargetBindings(t){let e=this.qs;if(null===e)return;void 0===t&&(t="");let i=this.diagram?.model,s=e.iterator;for(;s.next();){let e=s.value,n=this.BA(e,t);if(null===n)continue;let{data:l,elt:r}=n;e.isToTheme&&null===this.diagram||void 0!==r&&e.updateTarget(r,l,void 0,i)}}Uo(){if(null!==this.diagram){if(this.b2()){let t=this.diagram.model,e=this.qs.iterator;for(;e.next();){let i=e.value;if(!i.isToTheme)continue;let s=this.BA(i);if(null===s)continue;let{data:n,elt:l}=s;void 0!==l&&i.updateTarget(l,n,void 0,t)}}else{let t=this.T.r,e=t.length;for(let i=0;i<e;i++)t[i].Uo()}}}BA(t,e=""){let i=t.sourceProperty;if(""!==e&&""!==i&&i!==e)return null;let s=t.targetProperty;if(null===t.converter&&""===s)return null;let n=this.data,l=t.sourceName;if(t.isToObject){if(null===(n=this.cA(l)))return null}else if(t.isToModel){let t=this.diagram;if(null===t)return null;n=t.model.modelData}let r=this,o=t.targetId;if(-1!==o){if(null===(r=this.w0(o)))return null}else null!==t.Se&&(r=t.Se);"/"===l?n=r.part:"."===l?n=r:".."===l&&(n=r.panel);let h=t.gd;if(0!==h){if(!(r instanceof eq))return null;1===h?r=r.getColumnDefinition(t.yf):2===h&&(r=r.getRowDefinition(t.yf))}return{data:n,elt:r}}get itemArray(){return this.Ph}set itemArray(t){let e=this.Ph;if(e!==t||null!==t&&this.Lv(t)){let i=this.diagram;if(e!==t&&(null!==i&&null!==e&&i.partManager.TM(this,i),this.Ph=t,null!==i&&null!==t&&i.partManager.AM(this,i)),this.t("itemArray",e,t),null!==i&&i.undoManager.isUndoingRedoing)return;this.UA(e,t)}}findItemPanelForData(t){return null==t||null===this.Ws?null:(te.lc(t,eq,"findItemPanelForData"),this.Ws.get(t))}Lv(t){let e=this.T.r,i=e.length,s=t.length,n=0,l=null;for(;n<i&&(!((l=e[n])instanceof eq)||null===l.data);)l=e[++n];if(i-n!==s)return!0;if(null===l)return s>0;let r=0;for(;n<i&&r<s;){if(!((l=e[n])instanceof eq)||l.data!==t[r])return!0;n++,r++}return!1}cp(){if(this.type===eq.Spot||this.type===eq.Auto)return Math.min(this.T.length,1);if(this.type===eq.Link){let t=this.T,e=t.length,i=0;for(;i<e;i++){let e=t.elt(i);if(!(e instanceof e$)||!e.isPanelMain)break}return i}if(this.type===eq.Table&&this.T.length>0){let t=this.T.elt(0);if(t.isPanelMain&&t instanceof eq&&t.el())return 1}return 0}rebuildItemElements(){let t=this.cp();for(;this.T.length>t;)this.se(this.T.length-1,!1);this.UA(null,this.itemArray)}UA(t,e){let i=this.cp();if(null===e||0===e.length){for(;this.T.length>i;)this.se(this.T.length-1,!1);return}if(this.T.length<=i){let t=e.length;for(let i=0;i<t;i++)this.Jb(e[i],i,!0)}else{let t=i;for(let i=0;i<e.length;i++,t++){let s=e[i],n=t<this.T.length?this.T.elt(t):null;if(n instanceof eq){if(n.data!==s){let e=this.B2(n.data,i),l=this.B2(s,i),r=l!==e;if(!r){let t=this.U2(n.data,i,e);r=this.U2(s,i,l)!==t}r?(this.se(t,!1),this.Jb(s,i,!1)):n.data=s}}else this.Jb(s,i,!1)}for(;t<this.T.length;)this.se(t,!1);this.ol=null,this.V2(i,0),this.Bo()||this.c(),this.rs=null,this.isEnabledObject()||this.Wb(this,!1);let s=this.part;null!==s&&(s.R0(),s.pf(),this.bn&&s instanceof io&&(s.bn=!0),s.bn&&s instanceof io&&(s.le=null))}}Jb(t,e,i){if(null==t||e<0)return null;let s=this.B2(t,e),n=this.U2(t,e,s);if(null!==n){n.zt();let s=n.copy();if(s.a2()){let t=this.findBindingPanel();null!==t&&t.E2(!0)}te.H(t)&&(null===this.Ws&&(this.Ws=new tp),this.Ws.set(t,s));let l=e+this.cp();return this.insertAt(l,s),i&&(s.ei=t,this.V2(l,e),s.ei=null),s.data=t,s}return null}Av(t){if(t<0)return;let e=t+this.cp();this.se(e,!0),this.V2(e,t)}V2(t,e){let i=this.T,s=t,n=e;for(;s<i.length;){let t=i.elt(s);t instanceof eq&&t.Tv(s,n),s++,n++}}Tv(t,e){this.type===eq.TableRow?this.row=t:this.type===eq.TableColumn&&(this.column=t),this.itemIndex=e}Mv(){return null!==this.Ph||null!==this.itemTemplateMap}get itemTemplate(){return null===this.itemTemplateMap?null:this.itemTemplateMap.get("")}set itemTemplate(t){if(null===this.itemTemplateMap){if(null===t)return;this.itemTemplateMap=new tp}let e=this.itemTemplateMap.get("");if(e!==t){(t instanceof ii||t.isPanelMain)&&te.o("Panel.itemTemplate must not be a Part or be Panel.isPanelMain: "+t),this.itemTemplateMap.set("",t),this.t("itemTemplate",e,t);let i=this.diagram;if(null!==i&&i.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemTemplateMap(){return null!==this.b?this.b.q0:null}set itemTemplateMap(t){let e=this.itemTemplateMap;if(e!==t){let i=t.iterator;for(;i.next();)i.value;this.qt().q0=t,this.t("itemTemplateMap",e,t);let s=this.diagram;if(null!==s&&s.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemCategoryProperty(){return null!==this.b?this.b.W0:"category"}set itemCategoryProperty(t){let e=this.itemCategoryProperty;e!==t&&("string"==typeof t||te.ot(t)||te.te(t,"string or function",eq,"itemCategoryProperty"),this.qt().W0=t,this.t("itemCategoryProperty",e,t))}B2(t,e){if(null===t)return"";let i=this.itemCategoryProperty,s="";if(te.ot(i))s=i(t);else{if(!("string"==typeof i&&te.H(t))||""===i)return"";let e=this.diagram,n=null!==e?e.model:null;s=n?n.bt(t,i):iE.bt(t,i)}return void 0===s?"":"string"==typeof s?s:void te.o("Panel.getCategoryForItemData found a non-string category for "+t+": "+s)}static VA=!1;static zA=null;U2(t,e,i){let s=this.itemTemplateMap,n=null;return null!==s&&(n=s.get(i)),null===n&&(null!==s&&(n=s.get("")),null===n&&(eq.VA||(eq.VA=!0,te.li('No item template Panel found for category "'+i+'" on '+this),te.li("  Using default item template."),eq.zA=new eq().add(new e3().bind("text","",te.toString).theme("stroke","text"))),n=eq.zA)),n}get mf(){return(1048576&this.n)!=0}set mf(t){let e=(1048576&this.n)!=0;e!==t&&(te.s(t,"boolean",eq,"isAtomic"),this.n=1048576^this.n,this.t("isAtomic",e,t))}get isClipping(){return(2097152&this.n)!=0}set isClipping(t){let e=(2097152&this.n)!=0;e!==t&&(this.of(),this.n=2097152^this.n,this instanceof ib&&(this.ri=null),this.c(),this.t("isClipping",e,t))}get isOpposite(){return(0x2000000&this.n)!=0}set isOpposite(t){let e=(0x2000000&this.n)!=0;e!==t&&(this.n=0x2000000^this.n,this.c(),this.t("isOpposite",e,t))}get isEnabled(){return(4194304&this.n)!=0}set isEnabled(t){let e=(4194304&this.n)!=0;if(e!==t){let i=null===this.panel||this.panel.isEnabledObject();this.n=4194304^this.n,this.t("isEnabled",e,t);let s=this.diagram;if(null!==s&&s.undoManager.isUndoingRedoing)return;i&&this.Wb(this,t)}}Wb(t,e){let i=t.enabledChanged;if(null!==i&&i(t,e),t instanceof eq){let i=t.T.r,s=i.length;for(let t=0;t<s;t++){let s=i[t];e&&s instanceof eq&&!s.isEnabled||this.Wb(s,e)}}}get alignmentFocusName(){return this.ho}set alignmentFocusName(t){let e=this.ho;e!==t&&(this.ho=t,this.c(),this.t("alignmentFocusName",e,t))}static definePanelLayout(t,e){eF.Pn(t,e)}static isBuilderDefined(t){return eF.os.has(t)}static Position=eF.os.get("Position");static Horizontal=eF.os.get("Horizontal");static Vertical=eF.os.get("Vertical");static Spot=eF.os.get("Spot");static Auto=eF.os.get("Auto");static Table=eF.os.get("Table");static Viewbox=eF.os.get("Viewbox");static TableRow=eF.os.get("TableRow");static TableColumn=eF.os.get("TableColumn");static Link=eF.os.get("Link");static Grid=eF.os.get("Grid");static Graduated=eF.os.get("Graduated")}eq.definePanelLayout=eq.definePanelLayout;class eH{rp;lp;hp;ap;Ps;je;rs;Ne;constructor(){this.rp=0,this.lp=100,this.hp=10,this.ap=0,this.Ps=null,this.je=null,this.rs=null,this.Ne=null}copy(){let t=new eH;return t.rp=this.rp,t.lp=this.lp,t.hp=this.hp,t.ap=this.ap,t.Ps=this.Ps,t.je=this.je,t.rs=this.rs,t.Ne=this.Ne,t}}class eW{ud;dd;Wc;Q0;constructor(){this.ud=tx.uC,this.dd=ty.Lo,this.Wc=tx.mw,this.Q0=[]}copy(){let t=new eW;return t.ud=this.ud.copy(),t.dd=this.dd.copy(),t.Wc=this.Wc.copy(),t.Q0=this.Q0,t}}class e_{Ge;He;fp;dp;gp;mp;_0;ip;tp;ep;np;sp;op;kh;constructor(){this.Ge=[],this.He=[],this.fp=3,this.dp=3,this.gp=0,this.mp=0,this._0=tb.Bg,this.ip=1,this.tp=null,this.ep=null,this.np=1,this.sp=null,this.op=null,this.kh=null}copy(t){let e=new e_,i=this.Ge,s=i.length,n=e.Ge;for(let e=0;e<s;e++){if(void 0===i[e])continue;let s=i[e].copy();s.La(t),n[e]=s}let l=this.He,r=l.length,o=e.He;for(let e=0;e<r;e++){if(void 0===l[e])continue;let i=l[e].copy();i.La(t),o[e]=i}return e.fp=this.fp,e.dp=this.dp,e.gp=this.gp,e.mp=this.mp,e._0=this._0.N(),e.ip=this.ip,e.tp=this.tp,e.ep=this.ep,e.np=this.np,e.sp=this.sp,e.op=this.op,e.kh=this.kh,e}}var eJ=((P=eJ||{})[P.Default=1]="Default",P[P.None=2]="None",P[P.ProportionalExtra=3]="ProportionalExtra",P);class eZ{Gs;pp;Ft;Fa;Ra;fi;dt;md;oo;rl;pd;yd;va;Dt;wd;Ss;st;Fi;pe;constructor(t){tu.qi(this),this.Gs=null,this.pp=!0,this.Ft=0,this.pe=NaN,this.Fa=0,this.Ra=1/0,this.fi=tv.Default,this.st=0,this.Fi=0,this.dt=0,this.Ss=null,this.md=1,this.oo=1,this.rl=null,this.pd=null,this.yd=NaN,this.va=null,this.Dt=null,this.wd=!1,t&&(Object.assign(this,t),void 0!==t.column?(this.isRow=!1,this.index=t.column):void 0!==t.row&&(this.isRow=!0,this.index=t.row))}copy(){let t=new eZ;return t.pp=this.pp,t.Ft=this.Ft,t.pe=this.pe,t.Fa=this.Fa,t.Ra=this.Ra,t.fi=this.fi,t.st=this.st,t.Fi=this.Fi,t.dt=this.dt,t.oo=this.oo,t.md=this.md,null===this.rl?t.rl=null:t.rl=this.rl.N(),t.pd=this.pd,t.yd=this.yd,t.va=null,null!==this.va&&(t.separatorDashArray=this.va.slice()),t.Dt=this.Dt,t.wd=this.wd,t.Ss=this.Ss,t}Vb(t){t.isRow?void 0!==t.height&&(this.height=t.height):void 0!==t.width&&(this.width=t.width),void 0!==t.minimum&&(this.minimum=t.minimum),void 0!==t.maximum&&(this.maximum=t.maximum),void 0!==t.alignment&&(this.alignment=t.alignment),void 0!==t.stretch&&(this.stretch=t.stretch),void 0!==t.sizing&&(this.sizing=t.sizing),void 0!==t.separatorPadding&&(this.separatorPadding=t.separatorPadding),void 0!==t.separatorStroke&&(this.separatorStroke=t.separatorStroke),void 0!==t.separatorStrokeWidth&&(this.separatorStrokeWidth=t.separatorStrokeWidth),void 0!==t.separatorDashArray&&(this.va=t.separatorDashArray),void 0!==t.background&&(this.background=t.background),void 0!==t.coversSeparators&&(this.coversSeparators=t.coversSeparators),void 0!==t.Ss&&(this.Ss=t.Ss)}hi(t){t in eJ?this.sizing=t:te.cr(this,t)}toString(){return"RowColumnDefinition "+(this.isRow?"(Row ":"(Column ")+this.index+") #"+tu.us(this)}static Default=1;static None=2;static ProportionalExtra=3;La(t){this.Gs=t}computeEffectiveSpacingTop(t){let e=0,i=this.Gs;if(this.index!==t){let t=this.separatorStroke;null===t&&null!==i&&(t=this.isRow?i.defaultRowSeparatorStroke:i.defaultColumnSeparatorStroke),null!==t&&isNaN(e=this.separatorStrokeWidth)&&(e=null!==i?this.isRow?i.defaultRowSeparatorStrokeWidth:i.defaultColumnSeparatorStrokeWidth:0)}let s=this.rl;if(null===s){if(null===i)return e;s=i.defaultSeparatorPadding}return e+(this.isRow?s.top:s.left)}computeEffectiveSpacing(){let t=0,e=this.Gs,i=0,s=this.isRow;if(null!==e&&e.type===eq.Table){let t=s?e.Ge.length:e.He.length;for(let n=0;n<t;n++){let t=s?e.Ge[n]:e.He[n];if(void 0!==t&&0!==t.st){i=t.index;break}}}if(this.index!==i){let i=this.separatorStroke;null===i&&null!==e&&(i=s?e.defaultRowSeparatorStroke:e.defaultColumnSeparatorStroke),null!==i&&isNaN(t=this.separatorStrokeWidth)&&(t=null!==e?s?e.defaultRowSeparatorStrokeWidth:e.defaultColumnSeparatorStrokeWidth:0)}let n=this.rl;if(null===n){if(null===e)return t;n=e.defaultSeparatorPadding}return t+(this.isRow?n.top+n.bottom:n.left+n.right)}t(t,e,i,s,n){let l=this.Gs;if(null!==l&&(l.raiseChangedEvent(2,t,this,e,i,s,n),null!==this.Ss)){let e=l.diagram;if(null!==e&&!e.ge){let e=l.findBindingPanel();if(null!==e){let i=e.data;if(null!==i){let s=this.Ss.iterator;for(;s.next();)s.value.updateSource(this,i,t,e)}}}}}get panel(){return this.Gs}get isRow(){return this.pp}set isRow(t){this.pp=t}get index(){return this.Ft}set index(t){this.Ft=t}get height(){return this.pe}set height(t){let e=this.pe;e!==t&&(t<0&&te._(t,">= 0",eZ,"height"),this.pe=t,this.actual=this.st,null!==this.panel&&this.panel.c(),this.t("height",e,t))}get width(){return this.pe}set width(t){let e=this.pe;e!==t&&(t<0&&te._(t,">= 0",eZ,"width"),this.pe=t,this.actual=this.st,null!==this.panel&&this.panel.c(),this.t("width",e,t))}get minimum(){return this.Fa}set minimum(t){let e=this.Fa;e!==t&&((t<0||!isFinite(t))&&te._(t,">= 0",eZ,"minimum"),this.Fa=t,this.actual=this.st,null!==this.panel&&this.panel.c(),this.t("minimum",e,t))}get maximum(){return this.Ra}set maximum(t){let e=this.Ra;e!==t&&(t<0&&te._(t,">= 0",eZ,"maximum"),this.Ra=t,this.actual=this.st,null!==this.panel&&this.panel.c(),this.t("maximum",e,t))}get alignment(){return this.fi}set alignment(t){let e=this.fi;e.equals(t)||(this.fi=t.N(),null!==this.panel&&this.panel.c(),this.t("alignment",e,t))}get stretch(){return this.oo}set stretch(t){let e=this.oo;e!==t&&(this.oo=t,null!==this.panel&&this.panel.c(),this.t("stretch",e,t))}get separatorPadding(){return this.rl}set separatorPadding(t){"number"==typeof t&&(t=new tb(t));let e=this.rl;null!==t&&null!==e&&e.equals(t)||(null!==t&&(t=t.N()),this.rl=t,null!==this.panel&&this.panel.c(),this.t("separatorPadding",e,t))}get separatorStroke(){return this.pd}set separatorStroke(t){let e=this.pd;e!==t&&(null!==t&&eD.nd(t,"RowColumnDefinition.separatorStroke"),t instanceof eD&&t.u(),this.pd=t,null!==this.panel&&this.panel.c(),this.t("separatorStroke",e,t))}get separatorStrokeWidth(){return this.yd}set separatorStrokeWidth(t){let e=this.yd;e!==t&&(this.yd=t,null!==this.panel&&this.panel.c(),this.t("separatorStrokeWidth",e,t))}get separatorDashArray(){return this.va}set separatorDashArray(t){let e=this.va;if(e!==t){if(null===t||Array.isArray(t)||te.te(t,"Array",eZ,"separatorDashArray:value"),null!==t){let i=t.length,s=0;for(let e=0;e<i;e++){let i=t[e];"number"==typeof i&&i>=0&&isFinite(i)||te.o("separatorDashArray value "+i+" at index "+e+" must be a positive number or zero."),s+=i}if(0===s){if(null===e)return;t=null}}this.va=t,null!==this.panel&&this.panel.C(),this.t("separatorDashArray",e,t)}}get background(){return this.Dt}set background(t){let e=this.Dt;e!==t&&(null!==t&&eD.nd(t,"RowColumnDefinition.background"),t instanceof eD&&t.u(),this.Dt=t,null!==this.panel&&this.panel.C(),this.t("background",e,t))}get coversSeparators(){return this.wd}set coversSeparators(t){let e=this.wd;e!==t&&(te.s(t,"boolean",eZ,"coversSeparators"),this.wd=t,null!==this.panel&&this.panel.C(),this.t("coversSeparators",e,t))}get sizing(){return this.md}set sizing(t){let e=this.md;e!==t&&(this.md=t,null!==this.panel&&this.panel.c(),this.t("sizing",e,t))}Hb(){if(1===this.sizing){let t=this.Gs;return this.isRow?t.rowSizing:t.columnSizing}return this.sizing}get actual(){return this.st}set actual(t){isNaN(this.pe)?this.st=Math.max(Math.min(this.Ra,t),this.Fa):this.st=Math.max(Math.min(this.Ra,this.pe),this.Fa)}get measured(){return this.Fi}set measured(t){this.Fi=t}get total(){return this.st+this.computeEffectiveSpacing()}get position(){return this.dt}set position(t){this.dt=t}bind(t,e,i,s){return this.af(t,e,i,s),this}bindTwoWay(t,e,i,s){let n=this.af(t,e,i,s);return void 0===s&&n.makeTwoWay(),this}theme(t,e,i,s,n){return this.xh(t,e,i,s,n),this}themeData(t,e,i,s,n){return this.xh(t,e,i,s,n).ofData(),this}themeObject(t,e,i,s,n,l){return this.xh(t,e,i,s,n).ofObject(l),this}themeModel(t,e,i,s,n){return this.xh(t,e,i,s,n).ofModel(),this}af(t,e,i,s){let n;return n="string"==typeof t?new iR(t,e,i,s):t,this.j0(n),n}xh(t,e,i,s,n){let l;return l="string"==typeof t?new iB(t,e,i,s,n):t,this.j0(l),l}j0(t){t.Se=this;let e=this.panel;if(null!==e){let i=e.findBindingPanel();null!==i&&i.PA()&&te.o("Cannot add a Binding to a RowColumnDefinition that is already frozen: "+t+" on "+e)}null===this.Ss&&(this.Ss=new th),this.Ss.add(t)}}class e$ extends eb{at;Ms;xd;Oa;Wi;qo;Ko;Wt;bd;kd;W;constructor(t,e){super(),this.at=null,this.Ms=null,this.xd="None",this.Oa="black",this.Wi="black",this.qo=1,this.Ko=null,this.Wt=null,this.bd=NaN,this.kd=NaN,this.W=null,"string"==typeof t?this.figure=t:t&&Object.assign(this,t),e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.at=this.at,t.Ms=this.Ms,t.xd=this.xd,t.Oa=this.Oa,t.Wi=this.Wi,t.qo=this.qo,null!==this.Ko&&(t.Ko=this.Ko.slice()),null!==this.Wt&&(this.Wt.gi?t.Wt=this.Wt:t.Wt=this.Wt.copy()),t.bd=this.bd,t.kd=this.kd,null!==this.W&&(t.W=this.W.copy())}Ia(){return null===this.Wt?this.Wt=new eQ:this.Wt.gi&&(this.Wt=this.Wt.copy()),this.Wt}gh(){super.gh(),null!==this.Wt&&(this.Wt.gi=!0)}hi(t){t in tM?this.geometryStretch=t:super.hi(t)}toString(){return"Shape("+("None"!==this.figure?this.figure:"None"!==this.toArrow?this.toArrow:this.fromArrow)+")#"+tu.us(this)}Dv(t,e){let i=this.pathPattern;i.ut(1/0,1/0);let s=i.measuredBounds;i.Yt(0,0,s.width,s.height);let n=this.geometry;t.save(),t.beginPath();let l=te.rt();if(1===n.type)l.push(n.startX),l.push(n.startY),l.push(n.endX),l.push(n.endY),this.Pd(t,e,l,i);else if(4===n.type){let s=n.figures.iterator;for(;s.next();){let n=s.value;l.length=0,l.push(n.startX),l.push(n.startY);let r=n.startX,o=n.startY,h=r,a=o,u=n.segments.r,d=u.length;for(let s=0;s<d;s++){let d=u[s];switch(d.type){case 1:this.Pd(t,e,l,i),l.length=0,l.push(d.endX),l.push(d.endY),r=d.endX,o=d.endY,h=r,a=o;break;case 2:l.push(d.endX),l.push(d.endY),r=d.endX,o=d.endY;break;case 3:tP.Yn(r,o,d.point1X,d.point1Y,d.point2X,d.point2Y,d.endX,d.endY,.5,l),r=d.endX,o=d.endY;break;case 4:tP.Vg(r,o,d.point1X,d.point1Y,d.endX,d.endY,.5,l),r=d.endX,o=d.endY;break;case 5:{let t=d.Ao(n),e=t.length;if(0===e){l.push(d.centerX),l.push(d.centerY),r=d.centerX,o=d.centerY;break}for(let i=0;i<e;i++){let e=t[i];tP.Yn(r,o,e[2],e[3],e[4],e[5],e[6],e[7],.5,l),r=e[6],o=e[7]}break}case 6:{let t=d.Yh(n,r,o),e=t.length;if(0===e){l.push(d.endX),l.push(d.endY),r=d.endX,o=d.endY;break}for(let i=0;i<e;i++){let e=t[i];tP.Yn(r,o,e[2],e[3],e[4],e[5],e[6],e[7],.5,l),r=e[6],o=e[7]}break}default:te.o("Segment not of valid type: "+d.type)}d.isClosed&&(l.push(h),l.push(a),this.Pd(t,e,l,i))}this.Pd(t,e,l,i)}}else if(2===n.type)l.push(n.startX),l.push(n.startY),l.push(n.endX),l.push(n.startY),l.push(n.endX),l.push(n.endY),l.push(n.startX),l.push(n.endY),l.push(n.startX),l.push(n.startY),this.Pd(t,e,l,i);else if(3===n.type){let s=new tC;s.startX=n.endX,s.startY=(n.startY+n.endY)/2;let r=new tT(5);r.startAngle=0,r.sweepAngle=360,r.centerX=(n.startX+n.endX)/2,r.centerY=(n.startY+n.endY)/2,r.radiusX=Math.abs(n.startX-n.endX)/2,r.radiusY=Math.abs(n.startY-n.endY)/2,s.add(r);let o=r.Ao(s),h=o.length;if(0===h)l.push(r.centerX),l.push(r.centerY);else{let t=s.startX,e=s.startY;for(let i=0;i<h;i++){let s=o[i];tP.Yn(t,e,s[2],s[3],s[4],s[5],s[6],s[7],.5,l),t=s[6],e=s[7]}}this.Pd(t,e,l,i)}te.tt(l),t.restore(),t.clearContextCache(!1)}Fv(t){let e=t.measuredBounds.width;return t instanceof e$&&(e-=t.strokeWidth),e<1&&(e=1),e}Pd(t,e,i,s){let n=i.length;if(n<4)return;let l=s.measuredBounds,r=Math.max(1,l.width),o=l.height,h=i[0],a=i[1],u=0,d=0,c=0,g=0,f=0,m=0,p=0,y=0,x=te.rt();for(let t=2;t<n;t+=2)u=i[t],d=i[t+1],0==(c=u-h)&&(c=.001),f=(g=d-a)/c,m=Math.atan2(g,c),p=Math.sqrt(c*c+g*g),x.push([c,m,f,p]),y+=p,h=u,a=d;h=i[0],a=i[1];let w=this.Fv(s),b=w,v=r/2,k=0!==v,P=0,S=x[0];c=S[0],m=S[1],f=S[2],p=S[3];let M=0;for(;y>=.1;){if(0===M&&(k?(b=w-v,y-=v,k=!1):b=w,0===b&&(b=1)),b>y){b=y,te.tt(x);return}b>p?(M=b-p,b=p):M=0;let i=Math.sqrt(b*b/(1+f*f));if(c<0&&(i=-i),h+=i,a+=f*i,t.translate(h,a),t.rotate(m),t.translate(-(r/2),-(o/2)),0===M&&s.wh(t,e),t.translate(r/2,o/2),t.rotate(-m),t.translate(-h,-a),y-=b,p-=b,0!==M){if(++P===x.length){te.tt(x);return}c=(S=x[P])[0],m=S[1],f=S[2],p=S[3],b=M}}te.tt(x)}wh(t,e){let i=t instanceof eM,s=this.Wi,n=this.Oa;if(null===s&&null===n)return;let l=this.at;if(null===l)return;t.commitTransform();let r=this.actualBounds,o=this.naturalBounds;null!==n&&this.mn(t,n,!0,!1,o,r);let h=this.part,a=this.qo;null!==s&&0===a&&null!==h&&(this.isPanelMain||h.findMainElement()===this)&&(a=h.Rv()),0===a&&(s=null),null!==s&&0!==a&&(this.mn(t,s,!1,!1,o,r),t.lineWidth=a,t.lineJoin=this.strokeJoin,t.lineCap=this.strokeCap,t.miterLimit=this.strokeMiterLimit);let u=!1;h&&e.getRenderingHint("drawShadows")&&(u=h.isShadowed),!1===t.sl&&(u=!1);let d=!0;null!==s&&(null===n||"transparent"===n)&&(d=!1);let c=!1,g=this.strokeDashArray;if(null!==g&&(c=!0,t.enableDash(g,this.strokeDashOffset)),1===l.type)t.beginPath(),t.moveTo(l.startX,l.startY),t.lineTo(l.endX,l.endY),null!==s&&t.strokeContext(),t.endPath();else if(2===l.type){let e=l.startX,i=l.startY,r=l.endX,o=l.endY,h=Math.min(e,r),a=Math.min(i,o),c=Math.abs(r-e),g=Math.abs(o-i);t.beginPath(),t.rect(h,a,c,g),null!==n&&t.fillContext(n,!1,null),null!==s&&(d&&u&&t.shadowsOff(),t.strokeContext(),d&&u&&t.shadowsOn()),t.endPath()}else if(3===l.type){let e=l.startX,i=l.startY,r=l.endX,o=l.endY,h=Math.abs(r-e)/2,a=Math.abs(o-i)/2,c=Math.min(e,r)+h,g=Math.min(i,o)+a;t.beginPath(),t.moveTo(c,g-a),t.bezierCurveTo(c+tP.Xn*h,g-a,c+h,g-tP.Xn*a,c+h,g),t.bezierCurveTo(c+h,g+tP.Xn*a,c+tP.Xn*h,g+a,c,g+a),t.bezierCurveTo(c-tP.Xn*h,g+a,c-h,g+tP.Xn*a,c-h,g),t.bezierCurveTo(c-h,g-tP.Xn*a,c-tP.Xn*h,g-a,c,g-a),t.closePath(),null!==n&&t.fillContext(n,!1,null),null!==s&&(d&&u&&t.shadowsOff(),t.strokeContext(),d&&u&&t.shadowsOn()),t.endPath()}else if(4===l.type){let e=l.figures,r=e.length;for(let l=0;l<r;l++){let r=e.r[l];i?this.buildPath(t,r):null===r.Ve&&(r.Ve=new Path2D,this.buildPath(r.Ve,r));let o=r.isFilled;u?r.isShadowed?(!0===o&&"transparent"!==n&&null!==n&&t.fillContext(n,r.isEvenOdd,r.Ve),null!==s&&(o&&d&&t.shadowsOff(),t.stroke(r.Ve),o&&d&&t.shadowsOn())):(t.shadowsOff(),o&&"transparent"!==n&&null!==n&&t.fillContext(n,r.isEvenOdd,r.Ve),null!==s&&t.stroke(r.Ve),t.shadowsOn()):(o&&null!==n&&t.fillContext(n,r.isEvenOdd,r.Ve),null!==s&&t.stroke(r.Ve)),t.endPath(l)}}c&&t.disableDash(),null!==this.pathPattern&&this.Dv(t,e)}buildPath(t,e){t instanceof Path2D||t.beginPath(),t.moveTo(e.startX,e.startY);let i=e.segments.r,s=i.length,n=null;for(let l=0;l<s;l++){let s=i[l];switch(s.type){case 1:t.moveTo(s.endX,s.endY);break;case 2:t.lineTo(s.endX,s.endY);break;case 3:t.bezierCurveTo(s.point1X,s.point1Y,s.point2X,s.point2Y,s.endX,s.endY);break;case 4:t.quadraticCurveTo(s.point1X,s.point1Y,s.endX,s.endY);break;case 5:if(s.radiusX===s.radiusY){let i=null!==n?n.endX:e.startX,l=null!==n?n.endY:e.startY,r=Math.PI/180;t.arc(s.point1X,s.point1Y,s.radiusX,s.startAngle*r,(s.startAngle+s.sweepAngle)*r,s.sweepAngle<0,i,l)}else{let i=s.Ao(e),n=i.length;if(0===n){t.lineTo(s.centerX,s.centerY);break}for(let e=0;e<n;e++){let s=i[e];0===e&&t.lineTo(s[0],s[1]),t.bezierCurveTo(s[2],s[3],s[4],s[5],s[6],s[7])}}break;case 6:{let i=0,l=0,r;if(null!==n&&5===n.type){let o=(r=n.Ao(e)).length;if(0===o){t.lineTo(s.endX,s.endY);break}let h=r[o-1]||null;null!==h&&(i=h[6],l=h[7])}else i=null!==n?n.endX:e.startX,l=null!==n?n.endY:e.startY;let o=(r=s.Yh(e,i,l)).length;if(0===o){t.lineTo(s.endX,s.endY);break}for(let e=0;e<o;e++){let i=r[e];t.bezierCurveTo(i[2],i[3],i[4],i[5],i[6],i[7])}}}s.isClosed&&t.closePath(),n=s}}nf(t,e,i){if(!super.nf(t,e,i)||null===this.Wi&&null===this.Oa||null===this.at||null!==this.pathPattern)return!1;let s=this.svg.getElementsByTagName("path");return this.geometry.figures.length===s.length&&(t.currentPath=this.svg,this.wh(t,e),t.currentPath=null,!0)}ed(t){return null!==this.geometry&&this.geometry.figures.length>1||null!==this.pathPattern||super.ed(t)}u2(t,e){if("g"!==t.nodeName)t.setAttributeNS(null,"filter",e);else{let i=t.getElementsByTagName("path");for(let t=0;t<i.length;t++)i[t].setAttributeNS(null,"filter",e)}}getDocumentPoint(t,e){if(void 0===e&&(e=new ty),!(t instanceof tv))return e.set(t),this.Ys.xt(e),e;{t.isNoSpot()&&te.o("getDocumentPoint Spot must be a real, specific Spot, not: "+t.toString());let i=this.naturalBounds,s=this.strokeWidth;return e.i(t.x*(i.width+s)-s/2+i.x+t.offsetX,t.y*(i.height+s)-s/2+i.y+t.offsetY),this.Ys.xt(e),e}}getDocumentBounds(t){void 0===t&&(t=new tw);let e=this.naturalBounds,i=this.Ys,s=tw.X(e.x,e.y,e.width,e.height),n=this.strokeWidth;s.inflate(n/2,n/2);let l=ty.X(s.x,s.y).F(i);return t.i(l.x,l.y,0,0),l.i(s.right,s.y).F(i),t.unionNoCheck(l.x,l.y,0,0),l.i(s.right,s.bottom).F(i),t.unionNoCheck(l.x,l.y,0,0),l.i(s.x,s.bottom).F(i),t.unionNoCheck(l.x,l.y,0,0),tw.e(s),ty.e(l),t}mh(t,e){let i=this.geometry;if(null===i||null===this.fill&&null===this.stroke)return!1;let s=i.bounds,n=this.strokeWidth/2;1!==i.type||e||(n+=2);let l=tw.l();if(l.a(s),l.inflate(n+2,n+2),!l.containsPoint(t))return tw.e(l),!1;let r=n+1e-4;if(1===i.type){if(null===this.stroke)return!1;let e=(i.startX-i.endX)*(t.x-i.endX)+(i.startY-i.endY)*(t.y-i.endY),s=(i.endX-i.startX)*(t.x-i.startX)+(i.endY-i.startY)*(t.y-i.startY);return!(e<0)&&!(s<0)&&(tw.e(l),tP.Ei(i.startX,i.startY,i.endX,i.endY,n,t.x,t.y))}if(2===i.type){let e=i.startX,s=i.startY,o=i.endX,h=i.endY;if(l.x=Math.min(e,o),l.y=Math.min(s,h),l.width=Math.abs(o-e),l.height=Math.abs(h-s),null===this.fill){if(l.inflate(-r,-r),l.containsPoint(t))return tw.e(l),!1;l.inflate(r,r)}null!==this.stroke&&l.inflate(n,n);let a=l.containsPoint(t);return tw.e(l),a}if(3===i.type){let e=i.startX,s=i.startY,n=i.endX,o=i.endY,h=Math.min(e,n),a=Math.min(s,o),u=Math.abs(n-e)/2,d=Math.abs(o-s)/2;if(h=t.x-(h+u),a=t.y-(a+d),null===this.fill){if(u-=r,d-=r,u<=0||d<=0||h*h/(u*u)+a*a/(d*d)<=1)return tw.e(l),!1;u+=r,d+=r}return null!==this.stroke&&(u+=r,d+=r),tw.e(l),!(u<=0)&&!(d<=0)&&h*h/(u*u)+a*a/(d*d)<=1}if(4===i.type)return tw.e(l),null===this.fill?i.DC(t.x,t.y,n):i.zk(t,n,this.strokeWidth>1,e);te.o("Unknown Geometry type: "+i.type)}_u(t,e,i,s){let n;let l=this.desiredSize,r=this.qo;if(t=Math.max(t,0),e=Math.max(e,0),null!==this.Ms)n=this.geometry.bounds;else{let t=this.figure,e=e$.z2[t];if(void 0===e){let i=tP.Gn[t];"string"==typeof i&&(i=tP.Gn[i]),te.ot(i)?(e=i(null,100,100),e$.z2[t]=e):te.o("Unsupported Figure: "+t)}n=e.bounds}let o=n.width,h=n.height,a=n.width,u=n.height;switch(this.Hs(!0)){case 0:i=0,s=0;break;case 2:a=Math.max(t-r,0),u=Math.max(e-r,0);break;case 5:a=Math.max(t-r,0),s=0;break;case 4:i=0,u=Math.max(e-r,0)}isFinite(l.width)&&(a=l.width),isFinite(l.height)&&(u=l.height);let d=this.maxSize,c=this.minSize;i=Math.max(i-r,c.width),s=Math.max(s-r,c.height),a=Math.min(d.width,a),u=Math.min(d.height,u),a=isFinite(a)?Math.max(i,a):Math.max(o,i),u=isFinite(u)?Math.max(s,u):Math.max(h,s);let g=this.eS();switch(g){case 0:break;case 2:o=a,h=u;break;case 6:{let t=Math.min(a/o,u/h);isFinite(t)||(t=1),o*=t,h*=t;break}default:te.o(g+" is not a valid geometryStretch.")}if(null!==this.Ms){0===o&&(o=.001),0===h&&(h=.001);let t=(null!==this.Ms?this.Ms:this.at).sF(o,h);this.at=t}else null!==this.at&&tP.Y(this.at.fc,t-r)&&tP.Y(this.at.uc,e-r)||(this.at=e$.vv(this,o,h));n=this.at.bounds,t===1/0||e===1/0?this.so(n.x-r/2,n.y-r/2,0===t&&0===o?0:n.width+r,0===e&&0===h?0:n.height+r):this.so(-(r/2),-(r/2),a+r,u+r),l.isReal()?(a=l.width,u=l.height,a=Math.min(d.width,a),u=Math.min(d.height,u),a=Math.max(c.width,a),u=Math.max(c.height,u),this.Ki.i(0,0,a,u)):this.Ki.a(n)}eS(){let t=this.geometryStretch;return null!==this.Ms?1===t?2:t:1===t?e$.z2[this.figure].defaultStretch:t}ph(t,e,i,s){this.commonArrange(t,e,i,s)}getNearestIntersectionPoint(t,e,i){return this.ef(t.x,t.y,e.x,e.y,i)}ef(t,e,i,s,n){let l=this.F,r=1/(l.m11*l.m22-l.m12*l.m21),o=l.m22*r,h=-l.m12*r,a=-l.m21*r,u=l.m11*r,d=r*(l.m21*l.dy-l.m22*l.dx),c=r*(l.m12*l.dx-l.m11*l.dy),g=t*o+e*a+d,f=t*h+e*u+c,m=i*o+s*a+d,p=i*h+s*u+c,y=this.qo/2,x=this.at;null===x&&(this.ut(1/0,1/0),x=this.at);let w=x.bounds,b=!1;if(1===x.type){if(this.strokeWidth<=1.5)b=tP.Kn(x.startX,x.startY,x.endX,x.endY,g,f,m,p,n);else{let t=0,e=0;if(x.startX===x.endX)t=y,e=0;else{let i=(x.endY-x.startY)/(x.endX-x.startX);t=(e=y/Math.sqrt(1+i*i))*i}let i=te.rt(),s=new ty;tP.Kn(x.startX+t,x.startY+e,x.endX+t,x.endY+e,g,f,m,p,s)&&i.push(s),s=new ty,tP.Kn(x.startX-t,x.startY-e,x.endX-t,x.endY-e,g,f,m,p,s)&&i.push(s),s=new ty,tP.Kn(x.startX+t,x.startY+e,x.startX-t,x.startY-e,g,f,m,p,s)&&i.push(s),s=new ty,tP.Kn(x.endX+t,x.endY+e,x.endX-t,x.endY-e,g,f,m,p,s)&&i.push(s);let l=i.length;if(0===l)return te.tt(i),!1;b=!0;let r=1/0;for(let t=0;t<l;t++){let e=i[t],s=(e.x-g)**2+(e.y-f)**2;s<r&&(r=s,n.x=e.x,n.y=e.y)}te.tt(i)}}else if(2===x.type)b=tP.kl(w.x-y,w.y-y,w.x+w.width+y,w.y+w.height+y,g,f,m,p,n);else if(3===x.type){let t=tw.X(w.x,w.y,w.width,w.height).inflate(y,y);b=this.Ov(t,g,f,m,p,n),tw.e(t)}else if(4===x.type){let l=0,r=0,o=0,h=0,a=ty.l(),u=m-g,d=p-f,c=u*u+d*d,v=g,k=f;if(c>0&&w.contains(v,k)&&(a.x=v,a.y=k,this.containsPoint(a)))for(0!==u&&.5>Math.abs(u)?(d*=.5/u,u=.5):0!==d&&.5>Math.abs(d)&&(u*=.5/d,d=.5),v-=u,k-=d;w.contains(v,k);)v-=u,k-=d;n.x=m,n.y=p;for(let t=0;t<x.figures.count;t++){let e=x.figures.r[t],i=e.isFilled?v:g,s=e.isFilled?k:f,u=e.segments;l=e.startX,r=e.startY;let d=l,y=r;for(let t=0;t<u.count;t++){let g=u.r[t],f=g.type;o=g.endX,h=g.endY;let x=!1;switch(f){case 1:d=o,y=h;break;case 2:x=this.$b(l,r,o,h,i,s,m,p,a);break;case 3:x=tP.zg(l,r,g.point1X,g.point1Y,g.point2X,g.point2Y,o,h,i,s,m,p,.6,a);break;case 4:x=tP.zg(l,r,l+2/3*(g.point1X-l),r+2/3*(g.point1Y-r),o+2/3*(g.point1X-o),h+2/3*(g.point1Y-h),o,h,i,s,m,p,.6,a);break;case 5:case 6:{let t=5===g.type?g.Ao(e):g.Yh(e,l,r),u=t.length;if(0===u){x=this.$b(l,r,5===g.type?g.centerX:g.endX,5===g.type?g.centerY:g.endY,i,s,m,p,a);break}let d=null;for(let e=0;e<u;e++){if(d=t[e],0===e&&this.$b(l,r,d[0],d[1],i,s,m,p,a)){let t=this.Zb(i,s,a,c,n);t<c&&(c=t,b=!0)}if(tP.zg(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],i,s,m,p,.6,a)){let t=this.Zb(i,s,a,c,n);t<c&&(c=t,b=!0)}}o=d[6],h=d[7];break}default:te.o("Unknown Segment type: "+f)}if(l=o,r=h,x){let t=this.Zb(i,s,a,c,n);t<c&&(c=t,b=!0)}if(g.isClosed&&(o=d,h=y,this.$b(l,r,o,h,i,s,m,p,a))){let t=this.Zb(i,s,a,c,n);t<c&&(c=t,b=!0)}}}let P=i-t,S=s-e,M=Math.sqrt(P*P+S*S);0!==M&&(P/=M,S/=M),n.x-=P*y,n.y-=S*y,ty.e(a)}else te.o("Unknown Geometry type: "+x.type);return!!b&&(this.F.xt(n),!0)}Zb(t,e,i,s,n){let l=i.x-t,r=i.y-e,o=l*l+r*r;return o<s?(n.x=i.x,n.y=i.y,o):s}$b(t,e,i,s,n,l,r,o,h){if(tP.Y(t,i)&&tP.Y(e,s)||tP.Y(n,r)&&tP.Y(l,o))return!1;let a=!1,u=(n-r)*(e-s)-(l-o)*(t-i);if(0===u)return!1;if(h.x=((n*o-l*r)*(t-i)-(n-r)*(t*s-e*i))/u,h.y=((n*o-l*r)*(e-s)-(l-o)*(t*s-e*i))/u,(t>i?t-i:i-t)<(e>s?e-s:s-e)){let t=e<s?e:s,i=e<s?s:e;(h.y>t||tP.Y(h.y,t))&&(h.y<i||tP.Y(h.y,i))&&(a=!0)}else{let e=t<i?t:i,s=t<i?i:t;(h.x>e||tP.Y(h.x,e))&&(h.x<s||tP.Y(h.x,s))&&(a=!0)}return a}Iv(t,e,i){return!1!==this.pickable&&(i.ac(this.F),e?this.Ev(t,i):this.containedInRect(t,i))}containedInRect(t,e){if(void 0===e)return t.containsRect(this.actualBounds);let i=this.at;null===i&&(this.ut(1/0,1/0),i=this.at);let s=i.bounds,n=this.strokeWidth/2,l=!1,r=ty.l();return r.i(s.x-n,s.y-n),t.containsPoint(e.xt(r))&&(r.i(s.x-n,s.bottom+n),t.containsPoint(e.xt(r))&&(r.i(s.right+n,s.bottom+n),t.containsPoint(e.xt(r))&&(r.i(s.right+n,s.y-n),t.containsPoint(e.xt(r))&&(l=!0)))),ty.e(r),l}intersectsRect(t,e){if(this.containedInRect(t,e)||void 0===e&&(e=this.F,t.containsRect(this.actualBounds)))return!0;let i=tk.l();i.set(e),i.yw();let s=t.left,n=t.right,l=t.top,r=t.bottom,o=ty.l();if(o.i(s,l),i.xt(o),this.mh(o,!0)||(o.i(n,l),i.xt(o),this.mh(o,!0))||(o.i(s,r),i.xt(o),this.mh(o,!0))||(o.i(n,r),i.xt(o),this.mh(o,!0)))return ty.e(o),!0;let h=ty.l(),a=ty.l();i.set(e),i.xC(this.F),i.yw(),h.x=n,h.y=l,h.F(i),o.x=s,o.y=l,o.F(i);let u=!1;return this.Ea(o,h,a)?u=!0:(o.x=n,o.y=r,o.F(i),this.Ea(o,h,a)?u=!0:(h.x=s,h.y=r,h.F(i),this.Ea(o,h,a)?u=!0:(o.x=s,o.y=l,o.F(i),this.Ea(o,h,a)&&(u=!0)))),ty.e(o),tk.e(i),ty.e(h),ty.e(a),u}Ea(t,e,i){if(!this.getNearestIntersectionPoint(t,e,i))return!1;let s=t.x,n=t.y,l=e.x,r=e.y,o=i.x,h=i.y;if(s===l){let t=0,e=0;return n<r?(t=n,e=r):(t=r,e=n),h>=t&&h<=e}{let t=0,e=0;return s<l?(t=s,e=l):(t=l,e=s),o>=t&&o<=e}}Ev(t,e){if(this.containedInRect(t,e)||void 0===e&&(e=this.F,t.containsRect(this.actualBounds)))return!0;let i=t.left,s=t.right,n=t.top,l=t.bottom,r=ty.l(),o=ty.l(),h=ty.l(),a=tk.l();a.set(e),a.xC(this.F),a.yw(),o.x=s,o.y=n,o.F(a),r.x=i,r.y=n,r.F(a);let u=!1;return this.Ea(r,o,h)?u=!0:(r.x=s,r.y=l,r.F(a),this.Ea(r,o,h)?u=!0:(o.x=i,o.y=l,o.F(a),this.Ea(r,o,h)?u=!0:(r.x=i,r.y=n,r.F(a),this.Ea(r,o,h)&&(u=!0)))),tk.e(a),ty.e(r),ty.e(o),ty.e(h),u}dA(t,e,i){if(i&&null!==this.fill&&this.mh(t,!0))return!0;let s=t.distanceSquaredPoint(e),n=s;this.strokeWidth>1.5&&(s=this.strokeWidth/2+Math.sqrt(s),s*=s);let l=this.at;if(null===l&&(this.ut(1/0,1/0),null===(l=this.at)))return!1;if(!i){let e=l.bounds,i=e.x,n=e.y,r=e.x+e.width,o=e.y+e.height;if(ty.distanceSquared(t.x,t.y,i,n)<=s&&ty.distanceSquared(t.x,t.y,r,n)<=s&&ty.distanceSquared(t.x,t.y,i,o)<=s&&ty.distanceSquared(t.x,t.y,r,o)<=s)return!0}function r(t,e){let i=t.length;for(let n=0;n<i;n+=2)if(e.distanceSquared(t[n],t[n+1])>s)return!0;return!1}let o=l.startX,h=l.startY,a=l.endX,u=l.endY;if(1===l.type){let e=ty.distanceLineSegmentSquared(t.x,t.y,o,h,a,u),i=(a-o)*(t.x-o)+(u-h)*(t.y-h),l=(o-a)*(t.x-a)+(h-u)*(t.y-u);return e<=(i>=0&&l>=0?s:n)}if(2===l.type){let e=!1;return i&&(e=ty.distanceLineSegmentSquared(t.x,t.y,o,h,o,u)<=s||ty.distanceLineSegmentSquared(t.x,t.y,o,h,a,h)<=s||ty.distanceLineSegmentSquared(t.x,t.y,a,h,a,u)<=s||ty.distanceLineSegmentSquared(t.x,t.y,o,u,a,u)<=s),e}if(3===l.type){let e=(o+a)/2,n=(h+u)/2,l=t.x-e,r=t.y-n,d=Math.abs(a-o)/2,c=Math.abs(u-h)/2;if(0===d||0===c)return ty.distanceLineSegmentSquared(t.x,t.y,o,h,a,u)<=s;if(!i)return!(ty.distanceSquared(l,r,-d,0)>=s||ty.distanceSquared(l,r,0,-c)>=s||ty.distanceSquared(l,r,0,c)>=s||ty.distanceSquared(l,r,d,0)>=s);{let t=tP.WD(d,c,l,r);return t*t<=s}}if(4===l.type){let e=l.bounds,n=e.x,o=e.y,h=e.x+e.width,a=e.y+e.height;if(t.x>h&&t.x<n&&t.y>a&&t.y<o&&ty.distanceLineSegmentSquared(t.x,t.y,n,o,n,a)>s&&ty.distanceLineSegmentSquared(t.x,t.y,n,o,h,o)>s&&ty.distanceLineSegmentSquared(t.x,t.y,h,a,n,a)>s&&ty.distanceLineSegmentSquared(t.x,t.y,h,a,h,o)>s)return!1;let u=Math.sqrt(s);if(i){if(null===this.fill?l.DC(t.x,t.y,u):l.zk(t,u,!0,!1))return!0}else{let e=l.figures;for(let i=0;i<e.count;i++){let n=e.r[i],l=n.startX,o=n.startY;if(t.distanceSquared(l,o)>s)return!1;let h=n.segments.r,a=h.length;for(let e=0;e<a;e++){let i=h[e];switch(i.type){case 1:case 2:if(l=i.endX,o=i.endY,t.distanceSquared(l,o)>s)return!1;break;case 3:{let e=te.rt();tP.Yn(l,o,i.point1X,i.point1Y,i.point2X,i.point2Y,i.endX,i.endY,.8,e);let n=r(e,t);if(te.tt(e),n||(l=i.endX,o=i.endY,t.distanceSquared(l,o)>s))return!1;break}case 4:{let e=te.rt();tP.Vg(l,o,i.point1X,i.point1Y,i.endX,i.endY,.8,e);let n=r(e,t);if(te.tt(e),n||(l=i.endX,o=i.endY,t.distanceSquared(l,o)>s))return!1;break}case 5:case 6:{let e=5===i.type?i.Ao(n):i.Yh(n,l,o),h=e.length;if(0===h){if(l=5===i.type?i.centerX:i.endX,o=5===i.type?i.centerY:i.endY,t.distanceSquared(l,o)>s)return!1;break}let a=null,u=te.rt();for(let i=0;i<h;i++)if(a=e[i],u.length=0,tP.Yn(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],.8,u),r(u,t))return te.tt(u),!1;te.tt(u),null!==a&&(l=a[6],o=a[7]);break}default:te.o("Unknown Segment type: "+i.type)}}}return!0}}return!1}Ov(t,e,i,s,n,l){if(0===t.width)return tP.Kn(t.x,t.y,t.x,t.y+t.height,e,i,s,n,l);if(0===t.height)return tP.Kn(t.x,t.y,t.x+t.width,t.y,e,i,s,n,l);{let r=t.width/2,o=t.height/2,h=t.x+r,a=t.y+o,u=9999;if(e!==s&&(u=(i-n)/(e-s)),9999>Math.abs(u)){let t=i-a-u*(e-h);if(r*r*(u*u)+o*o-t*t<0)return l.x=NaN,l.y=NaN,!1;let s=Math.sqrt(r*r*(u*u)+o*o-t*t),n=(-(r*r*u*t)+r*o*s)/(o*o+r*r*(u*u))+h,d=(-(r*r*u*t)-r*o*s)/(o*o+r*r*(u*u))+h,c=u*(n-h)+t+a,g=u*(d-h)+t+a;Math.abs((e-n)**2)+Math.abs((i-c)**2)<Math.abs((e-d)**2)+Math.abs((i-g)**2)?(l.x=n,l.y=c):(l.x=d,l.y=g)}else{let t=o*o,s=e-h,n=t-t/(r*r)*(s*s);if(n<0)return l.x=NaN,l.y=NaN,!1;let u=Math.sqrt(n),d=a+u,c=a-u;Math.abs(d-i)<Math.abs(c-i)?(l.x=e,l.y=d):(l.x=e,l.y=c)}return!0}}Nv(){return this.qo/2*this.strokeMiterLimit*this.getDocumentScale()}get geometry(){return null!==this.at?this.at:this.Ms}set geometry(t){let e=this.at,i=this.Ms;if(e===t)return;null!==t?(this.at=t.u(),this.Ms=this.at):(this.at=null,this.Ms=null);let s=this.part;if(null!==s&&s.pf(),this.c(),this.t("geometry",e||i,t),this.tf()){let t=this.part;null!==t&&this.Na(t,"geometryString")}}get geometryString(){return null===this.geometry?"":this.geometry.toString()}set geometryString(t){let e=tN.parse(t),i=e.normalize();this.geometry=e;let s=ty.X(-i.x,-i.y);this.position=s,ty.e(s)}get isGeometryPositioned(){return(1048576&this.n)!=0}set isGeometryPositioned(t){let e=(1048576&this.n)!=0;e!==t&&(this.n=1048576^this.n,this.c(),this.t("isGeometryPositioned",e,t))}oe(){this.at=null}get fill(){return this.Oa}set fill(t){let e=this.Oa;e!==t&&(null!==t&&eD.nd(t,"Shape.fill"),t instanceof eD&&t.u(),this.Oa=t,this.C(),this.t("fill",e,t))}get stroke(){return this.Wi}set stroke(t){let e=this.Wi;e!==t&&(null!==t&&eD.nd(t,"Shape.stroke"),t instanceof eD&&t.u(),this.Wi=t,this.C(),this.t("stroke",e,t))}get strokeWidth(){return this.qo}set strokeWidth(t){let e=this.qo;if(e!==t){if(t>=0){this.qo=t,this.c();let i=this.part;null!==i&&i.pf(),this.t("strokeWidth",e,t)}else te._(t,"value >= 0",e$,"strokeWidth:value")}}k0(){return this.qo}get strokeCap(){return null!==this.Wt?this.Wt.yp:"butt"}set strokeCap(t){let e=this.strokeCap;e!==t&&("string"==typeof t&&("butt"===t||"round"===t||"square"===t)?(this.Ia().yp=t,this.C(),this.t("strokeCap",e,t)):te._(t,'"butt", "round", or "square"',e$,"strokeCap"))}get strokeJoin(){return null!==this.Wt?this.Wt.wp:"miter"}set strokeJoin(t){let e=this.strokeJoin;e!==t&&("string"==typeof t&&("miter"===t||"bevel"===t||"round"===t)?(this.Ia().wp=t,this.C(),this.t("strokeJoin",e,t)):te._(t,'"miter", "bevel", or "round"',e$,"strokeJoin"))}get strokeMiterLimit(){return null!==this.Wt?this.Wt.xp:10}set strokeMiterLimit(t){let e=this.strokeMiterLimit;if(e!==t&&t>=1){this.Ia().xp=t,this.C();let i=this.part;null!==i&&i.pf(),this.t("strokeMiterLimit",e,t)}}get strokeDashArray(){return this.Ko}set strokeDashArray(t){let e=this.Ko;if(e!==t){if(null===t||Array.isArray(t)||te.te(t,"Array",e$,"strokeDashArray:value"),null!==t){let i=t.length,s=0;for(let e=0;e<i;e++){let i=t[e];i>=0&&isFinite(i)||te.o("strokeDashArray:value "+i+" at index "+e+" must be a positive number or zero."),s+=i}if(0===s){if(null===e)return;t=null}}this.Ko=t,this.C(),this.t("strokeDashArray",e,t)}}get strokeDashOffset(){return null!==this.Wt?this.Wt.bh:0}set strokeDashOffset(t){let e=this.strokeDashOffset;e!==t&&t>=0&&(this.Ia().bh=t,this.C(),this.t("strokeDashOffset",e,t))}get figure(){return this.xd}set figure(t){let e=this.xd;if(e!==t){let i=tP.Gn[t];if(te.ot(i)?i=t:(i=tP.Gn[t.toLowerCase()])||te.o("Unknown Shape.figure: "+t),e!==i){let t=this.part;null!==t&&t.pf(),this.xd=i,this.Ms=null,this.oe(),this.c(),this.t("figure",e,i)}}}get toArrow(){return null!==this.Ut?this.Ut.bp:"None"}set toArrow(t){let e=this.toArrow;if(!0===t?t="Standard":!1===t&&(t=""),e!==t){let i=e$.XA(t);null===i?te.o("Unknown Shape.toArrow: "+t):e!==i&&(null===this.Ut&&(this.Ut=new iw),this.Ut.bp=i,this.Ms=null,this.oe(),this.c(),this.YA(i),this.t("toArrow",e,i))}}get fromArrow(){return null!==this.Ut?this.Ut.kp:"None"}set fromArrow(t){let e=this.fromArrow;if(!0===t?t="Standard":!1===t&&(t=""),e!==t){let i=e$.XA(t);null===i?te.o("Unknown Shape.fromArrow: "+t):e!==i&&(null===this.Ut&&(this.Ut=new iw),this.Ut.kp=i,this.Ms=null,this.oe(),this.c(),this.YA(i),this.t("fromArrow",e,i))}}YA(t){let e=this.diagram;if(null!==e&&e.undoManager.isUndoingRedoing)return;this.WR();let i=tv.MiddleRight;"None"!==this.toArrow?(this.segmentIndex=-1,this.alignmentFocus=i):"None"!==this.fromArrow&&(this.segmentIndex=0,this.alignmentFocus=new tv(1-i.x,i.y))}get spot1(){return null!==this.Wt?this.Wt.Hn:tv.Default}set spot1(t){let e=this.spot1;e.equals(t)||(t=t.N(),this.Ia().Hn=t,this.c(),this.t("spot1",e,t))}get spot2(){return null!==this.Wt?this.Wt.jn:tv.Default}set spot2(t){let e=this.spot2;e.equals(t)||(t=t.N(),this.Ia().jn=t,this.c(),this.t("spot2",e,t))}get parameter1(){return this.bd}set parameter1(t){let e=this.bd;e!==t&&(this.bd=t,this.oe(),this.c(),this.t("parameter1",e,t))}get parameter2(){return this.kd}set parameter2(t){let e=this.kd;e!==t&&(this.kd=t,this.oe(),this.c(),this.t("parameter2",e,t))}get naturalBounds(){return this.Ki}gv(){let t=this.desiredSize;if(t.isReal()||null===this.at)this.Ki.i(0,0,t.width,t.height);else{let t=this.at.bounds;this.Ki.a(t)}}get pathPattern(){return null!==this.Wt?this.Wt.Pp:null}set pathPattern(t){let e=this.pathPattern;e!==t&&(this.Ia().Pp=t,this.C(),this.t("pathPattern",e,t))}get geometryStretch(){return null!==this.Wt?this.Wt.Sp:1}set geometryStretch(t){let e=this.geometryStretch;e!==t&&(this.Ia().Sp=t,this.c(),this.t("geometryStretch",e,t))}get interval(){return null!==this.W?this.W.wf:1}set interval(t){let e=this.interval;if(e!==(t=Math.round(t))&&0!==t&&isFinite(t)){null===this.W&&(this.W=new e5),this.W.wf=t;let i=this.diagram;null!==i&&this.panel===i.grid&&i.rh(),this.c();let s=this.panel;null!==s&&(s.rs=null),this.t("interval",e,t)}}get graduatedStart(){return null!==this.W?this.W.xf:0}set graduatedStart(t){let e=this.graduatedStart;e!==t&&(t<0?t=0:t>1&&(t=1),null===this.W&&(this.W=new e5),this.W.xf=t,this.c(),this.t("graduatedStart",e,t))}get graduatedEnd(){return null!==this.W?this.W.bf:1}set graduatedEnd(t){let e=this.graduatedEnd;e!==t&&(t<0?t=0:t>1&&(t=1),null===this.W&&(this.W=new e5),this.W.bf=t,this.c(),this.t("graduatedEnd",e,t))}get graduatedSkip(){return null!==this.W?this.W.kf:null}set graduatedSkip(t){let e=this.graduatedSkip;e!==t&&(null!==t&&te.S(t,e$,"graduatedSkip"),null===this.W&&(this.W=new e5),this.W.kf=t,this.c(),this.t("graduatedSkip",e,t))}static vv(t,e,i){let s=null;if("None"!==t.toArrow)s=e$.Sn[t.toArrow];else if("None"!==t.fromArrow)s=e$.Sn[t.fromArrow];else{let n=tP.Gn[t.figure];"string"==typeof n&&(n=tP.Gn[n]),void 0===n&&te.o("Unknown Shape.figure: "+t.figure),(s=n(t,e,i)).fc=e,s.uc=i}if(null===s){let n=tP.Gn.Rectangle;te.ot(n)&&(s=n(t,e,i))}return s}static getFigureGenerators(){let t=new tp;for(let e in tP.Gn){if(e===e.toLowerCase())continue;let i=tP.Gn[e];t.set(e,i)}return t.u(),t}static defineFigureGenerator(t,e){te.s(t,"string",e$,"defineFigureGenerator:name"),"string"==typeof e||te.S(e,e$,"defineFigureGenerator:func");let i=t.toLowerCase(),s=tP.Gn;s[t]=e,s[i]=t}static isFigureDefined(t){return tP.Gn.has(t)}static getArrowheadGeometries(){let t=new tp;for(let t in tP.Kg)if(void 0===e$.Sn[t]){let e=tN.parse(tP.Kg[t],!1);e$.Sn[t]=e;let i=t.toLowerCase();i!==t&&(e$.Sn[i]=t)}for(let e in e$.Sn){if(e===e.toLowerCase())continue;let i=e$.Sn[e];i instanceof tN&&t.set(e,i)}return t.u(),t}static defineArrowheadGeometry(t,e){te.s(t,"string",e$,"defineArrowheadGeometry:name");let i=null;"string"==typeof e?(te.s(e,"string",e$,"defineArrowheadGeometry:pathstr"),i=tN.parse(e,!1)):i=e;let s=t.toLowerCase();("none"===s||t===s)&&te.o("Shape.defineArrowheadGeometry name must not be empty or None or all-lower-case: "+t);let n=e$.Sn;n[t]=i,n[s]=t}static isArrowheadDefined(t){return e$.Sn.has(t)}static Sn=new ts;static z2=new ts;static XA(t){let e=e$.Sn[t];if(void 0===e){let i=t.toLowerCase();if("none"===i)return"None";if(void 0===(e=e$.Sn[i])){let t=null;for(let e in tP.Kg)if(e.toLowerCase()===i){t=e;break}if(null!==t){let e=tN.parse(tP.Kg[t],!1);return e$.Sn[t]=e,i!==t&&(e$.Sn[i]=t),t}}}return"string"==typeof e?e:e instanceof tN?t:null}}class eQ{gi;yp;wp;xp;bh;Pp;Sp;Hn;jn;constructor(){this.gi=!1,this.yp="butt",this.wp="miter",this.xp=10,this.bh=0,this.Pp=null,this.Sp=1,this.Hn=tv.Default,this.jn=tv.Default}copy(){let t=new eQ;return t.yp=this.yp,t.wp=this.wp,t.xp=this.xp,t.bh=this.bh,t.Pp=this.Pp,t.Sp=this.Sp,t.Hn=this.Hn.N(),t.jn=this.jn.N(),t}}var e0=((S=e0||{})[S.None=0]="None",S[S.Fit=1]="Fit",S[S.DesiredSize=2]="DesiredSize",S[S.BreakAll=3]="BreakAll",S),e1=((M=e1||{})[M.Clip=0]="Clip",M[M.Ellipsis=1]="Ellipsis",M),e2=((N=e2||{})[N.Trim=0]="Trim",N[N.None=1]="None",N);class e3 extends eb{ai;Wi;Mn;ye;mi;P0;Sd;W;ct;El;ao;Nn;Te;Ri;Cn;constructor(t,e){return super(),this.n|=2097152,this.ai="",this.Wi="black",this.Mn="13px sans-serif",this.ye=0,this.mi=0,this.P0=0,this.Sd=null,this.W=null,this.ct=null,this.El=0,this.ao=null,this.Nn=0,this.Te=null,this.Ri=null,this.Cn=null,"string"==typeof t?this.text=t:t&&Object.assign(this,t),e&&Object.assign(this,e),this}cloneProtected(t){super.cloneProtected(t),t.ai=this.ai,t.Wi=this.Wi,t.Mn=this.Mn,t.ye=this.ye,t.mi=this.mi,t.P0=this.P0,t.Sd=this.Sd,null!==this.W&&(t.W=this.W.copy()),null!==this.ct&&(this.ct.gi?t.ct=this.ct:t.ct=this.ct.copy()),t.El=this.El,t.ao=this.ao,t.Nn=this.Nn,t.Te=this.Te,t.Ri=this.Ri,t.Cn=this.Cn}Ln(){return null===this.ct?this.ct=new e4:this.ct.gi&&(this.ct=this.ct.copy()),this.ct}gh(){super.gh(),null!==this.ct&&(this.ct.gi=!0)}kv(t){this.n=6144|t.n,this._t=t.opacity,this.Dt=t.background,this.ns=t.desiredSize.N(),this.minSize=t.minSize.N(),this.maxSize=t.maxSize.N(),null!==t.ki?this.ki=t.ki.copy():this.ki=null,this.nt=t.scale,this.Ht=t.angle,this.stretch=t.stretch,this.tl=t.margin.N(),this.fi=t.alignment.N(),this.$u=t.alignmentFocus.N(),this.segmentFraction=t.segmentFraction,this.segmentOffset=t.segmentOffset.N(),this.segmentOrientation=t.segmentOrientation,null!==t.ri&&(this.ri=t.ri.copy()),this.shadowVisible=t.shadowVisible,this.ai=t.ai,this.Wi=t.Wi,this.Mn=t.Mn,null!==this.W&&(this.W=t.W.copy()),null!==t.ct&&(t.ct.gi?this.ct=t.ct:this.ct=t.ct.copy()),this.El=t.El}xv(t){if(this.ai=t.text||"",this.Ht=t.labelAngle||0,this.ye=t.lineCount||0,this.Bv(t.lines),t.naturalBounds&&(this.Ki=t.naturalBounds),t.actualBounds){let e=t.actualBounds;this.Yt(e.x,e.y,e.width,e.height)}}hi(t){t in e0?this.wrap=t:super.hi(t)}toString(){return this.ai.length>22?'TextBlock("'+this.ai.substring(0,20)+'"...)':'TextBlock("'+this.ai+'")'}static getEllipsis(){return e3.Mp}static setEllipsis(t){e3.Mp=t,e3.Qb=new ts,e3.X2=0}static getBaseline(){return e3._b}static setBaseline(t){e3._b=t}static _b=null;static getUnderline(){return e3.t1}static setUnderline(t){e3.t1=t}static t1=null;static None=0;static WrapFit=1;static WrapDesiredSize=2;static WrapBreakAll=3;static OverflowClip=0;static OverflowEllipsis=1;static FormatTrim=0;static FormatNone=1;c(){super.c(),this.Ye(!0)}get font(){return this.Mn}set font(t){let e=this.Mn;e!==t&&(this.Mn=t,this.ao=null,this.c(),this.t("font",e,t))}static isValidFont(t){return!tt.CSS||tt.CSS.supports("font",t)}get text(){return this.ai}set text(t){let e=this.ai;e!==(t=null!=t?t.toString():"")&&(this.ai=t,this.c(),this.t("text",e,t))}get textAlign(){return null!==this.ct?this.ct.Np:"start"}set textAlign(t){let e=this.textAlign;e!==t&&("start"===t||"end"===t||"left"===t||"right"===t||"center"===t)&&(this.Ln().Np=t,this.C(),this.t("textAlign",e,t))}get flip(){return null!==this.ct?this.ct.co:0}set flip(t){let e=this.flip;e!==t&&(this.Ln().co=t,this.C(),this.t("flip",e,t))}get verticalAlignment(){return null!==this.ct?this.ct.ll:tv.Top}set verticalAlignment(t){let e=this.verticalAlignment;e.equals(t)||(t=t.N(),this.Ln().ll=t,this.hf(),this.t("verticalAlignment",e,t))}get naturalBounds(){if(!this.Ki.isReal()){let t=tx.l();this.Y2(this.ai,999999,t);let e=t.width;tx.e(t);let i=this.KA(e),s=this.desiredSize;isNaN(s.width)||(e=s.width),isNaN(s.height)||(i=s.height),this.Ki.zn(e,i)}return this.Ki}get isMultiline(){return(2097152&this.n)!=0}set isMultiline(t){let e=(2097152&this.n)!=0;e!==t&&(this.n=2097152^this.n,this.c(),this.t("isMultiline",e,t))}get isUnderline(){return(4194304&this.n)!=0}set isUnderline(t){let e=(4194304&this.n)!=0;e!==t&&(this.n=4194304^this.n,this.Ye(!0),this.C(),this.t("isUnderline",e,t))}get isStrikethrough(){return(8388608&this.n)!=0}set isStrikethrough(t){let e=(8388608&this.n)!=0;e!==t&&(this.n=8388608^this.n,this.Ye(!0),this.C(),this.t("isStrikethrough",e,t))}get wrap(){return null!==this.ct?this.ct.Cp:2}set wrap(t){let e=this.wrap;e!==t&&(this.Ln().Cp=t,this.c(),this.t("wrap",e,t))}get overflow(){return null!==this.ct?this.ct.Lp:0}set overflow(t){let e=this.overflow;e!==t&&(this.Ln().Lp=t,this.c(),this.t("overflow",e,t))}get isOverflowed(){return(0x1000000&this.n)!=0}K2(t){t?this.n|=0x1000000:this.n&=-0x1000001}get stroke(){return this.Wi}set stroke(t){let e=this.Wi;e!==t&&(null!==t&&eD.nd(t,"TextBlock.stroke"),t instanceof eD&&t.u(),this.Wi=t,"string"!=typeof t&&this.of(),this.C(),this.t("stroke",e,t))}get lineCount(){return this.ye}get lineHeight(){return this.Ap()}get editable(){return(1048576&this.n)!=0}set editable(t){let e=(1048576&this.n)!=0;e!==t&&(this.n=1048576^this.n,this.t("editable",e,t))}get R2(){return(0x2000000&this.n)!=0}set R2(t){this.n=0x2000000^this.n}get textEditor(){return null!==this.ct?this.ct.Tp:null}set textEditor(t){let e=this.textEditor;e!==t&&(this.Ln().Tp=t,this.t("textEditor",e,t))}get errorFunction(){return null!==this.ct?this.ct.ls:null}set errorFunction(t){let e=this.errorFunction;e!==t&&(null!==t&&te.S(t,e3,"errorFunction"),this.Ln().ls=t,this.t("errorFunction",e,t))}get interval(){return null!==this.W?this.W.wf:1}set interval(t){let e=this.interval;if(e!==(t=Math.round(t))&&0!==t&&isFinite(t)){null===this.W&&(this.W=new e5),this.W.wf=t,this.c();let i=this.panel;null!==i&&(i.rs=null),this.t("interval",e,t)}}get graduatedStart(){return null!==this.W?this.W.xf:0}set graduatedStart(t){let e=this.graduatedStart;e!==t&&(t<0?t=0:t>1&&(t=1),null===this.W&&(this.W=new e5),this.W.xf=t,this.c(),this.t("graduatedStart",e,t))}get graduatedEnd(){return null!==this.W?this.W.bf:1}set graduatedEnd(t){let e=this.graduatedEnd;e!==t&&(t<0?t=0:t>1&&(t=1),null===this.W&&(this.W=new e5),this.W.bf=t,this.c(),this.t("graduatedEnd",e,t))}get graduatedFunction(){return null!==this.W?this.W.Dp:null}set graduatedFunction(t){let e=this.graduatedFunction;e!==t&&(null!==t&&te.S(t,e3,"graduatedFunction"),null===this.W&&(this.W=new e5),this.W.Dp=t,this.c(),this.t("graduatedFunction",e,t))}get graduatedSkip(){return null!==this.W?this.W.kf:null}set graduatedSkip(t){let e=this.graduatedSkip;e!==t&&(null!==t&&te.S(t,e3,"graduatedSkip"),null===this.W&&(this.W=new e5),this.W.kf=t,this.c(),this.t("graduatedSkip",e,t))}wh(t,e){if(null===this.Wi||0===this.ai.length||null===this.Mn)return;let i=this.naturalBounds,s=this.actualBounds,n=i.width,l=i.height,r=this.Ap(),o=t.textAlign=this.textAlign,h=e.Hu;"start"===o?o=h?"right":"left":"end"===o&&(o=h?"left":"right");let a=this.isUnderline,u=this.isStrikethrough;this.mn(t,this.Wi,!0,!1,i,s),(a||u)&&this.mn(t,this.Wi,!1,!1,i,s);let d=0,c=!1;e.ii!==t||e.ii instanceof eM||this.R2||!0!==e.getRenderingHint("textGreeking")||!(r*this.wa*e.scale<3)||(c=!0);let g=this.spacingAbove,f=this.spacingBelow;switch(this.flip){case 0:break;case 2:t.translate(n,0),t.scale(-1,1);break;case 1:t.translate(0,l),t.scale(1,-1);break;case 3:t.translate(n,l),t.scale(-1,-1)}t.commitTransform();let m=this.ye,p=(g+r+f)*m;if(l>p){let t=this.verticalAlignment;d=t.y*l-t.y*p+t.offsetY}if(1===m&&null!==this.Cn){let e=this.mi;e>n&&(e=n),d+=g,this.GA(this.Cn,t,0,d,n,r,e,c,o,a,u)}else if(null!==this.Te&&null!==this.Ri)for(let e=0;e<m;e++){let i=this.Te[e];i>n&&(i=n),d+=g,this.GA(this.Ri[e],t,0,d,n,r,i,c,o,a,u),d+=r+f}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-n,0);break;case 1:t.scale(1,-1),t.translate(0,-l);break;case 3:t.scale(-1,-1),t.translate(-n,-l)}}GA(t,e,i,s,n,l,r,o,h,a,u){let d=0;if(o){"left"===h?d=0:"right"===h?d=n-r:"center"===h&&(d=(n-r)/2);let t=e.globalAlpha;e.globalAlpha=t/2,e.fillRect(i+d,s+l/4,r,l/2),e.globalAlpha=t;return}"left"===h?d=0:"right"===h?d=n:"center"===h&&(d=n/2);let c=null!==e3._b?e3._b(this,l):.75*l;e.fillText(t,i+d,s+c);let g=l/20|0;if(0===g&&(g=1),"right"===h?d-=r:"center"===h&&(d-=r/2),a){let t=null!==e3.t1?e3.t1(this,l):.8*l;this.HA(i+d,s+t,i+d+r,s+t,g,e),e instanceof eM&&e.lastCreatedElement.classList.add("gojs-td")}if(u){let t=s+l-l/2.2|0;g%2!=0&&(t+=.5),this.HA(i+d,t,i+d+r,t,g,e),e instanceof eM&&e.lastCreatedElement.classList.add("gojs-td")}}HA(t,e,i,s,n,l){l.beginPath(),l.lineWidth=n,l.moveTo(t,e),l.lineTo(i,s),l.stroke(),l.endPath()}nf(t,e,i){if(!super.nf(t,e,i))return!1;if(this.mn(t,this.Wi,!0,!1,this.naturalBounds,this.actualBounds),i){if(0===this.svg.getElementsByTagName("text").length)return!0;let e=this.svg.getElementsByClassName("gojs-td");for(let i=0;i<e.length;i++)t.setFillOrStrokeInPlace(e[i],!1)}else this.Uv(this.svg,this.text,t);return!0}Uv(t,e,i){t.innerHTML=e,i.setFillOrStrokeInPlace(t,!0)}ed(t){return this.lineCount>1||!!this.isUnderline||!!this.isStrikethrough||super.ed(t)}u2(t,e){if("g"!==t.nodeName)t.setAttributeNS(null,"filter",e);else{let i=t.getElementsByTagName("text");for(let t=0;t<i.length;t++)i[t].setAttributeNS(null,"filter",e)}}Vv(){this.Nn=0,this.mi=0,this.ao=null,this.Te=null,this.Ri=null,this.Cn=null}_u(t,e,i,s){let n=this.ye;this.El=t,this.K2(!1);let l=this.Mn;null!==e3.nl&&e3.jA!==l&&(e3.nl.font=l,e3.jA=l),this.Vv();let r=0,o=0;r=isNaN(this.desiredSize.width)?Math.min(r=this.zv(),t/this.scale):this.desiredSize.width,null!==this.panel&&(r=Math.min(r,this.panel.maxSize.width)),o=this.KA(r),o=isNaN(this.desiredSize.height)?Math.min(o,e/this.scale):this.desiredSize.height,this.Xv(t,o),(1===this.wrap||isNaN(this.desiredSize.width))&&(r=isNaN(t)?this.mi:Math.min(t,this.mi)),r=Math.max(i,r),o=Math.max(s,o),this.Ki.zn(r,o),this.so(0,0,r,o),null!==this.svg&&n!==this.ye&&this.Ye(!0)}ph(t,e,i,s){this.commonArrange(t,e,i,s)}An(t,e){null===this.Cn?(this.Cn=t,this.mi=e):((null===this.Ri||null===this.Te)&&(this.Ri=[],this.Te=[],this.Ri.push(this.Cn),this.Te.push(this.mi)),this.Ri.push(t),this.Te.push(e),this.Ri.length>this.maxLines&&(this.n|=0x1000000))}Y2(t,e,i){let s=0===this.formatting;s&&(t=t.trim());let n=0,l=0,r=0,o=this.Mn,h=this.spacingAbove+this.spacingBelow,a=Math.max(0,this.Ap()+h),u=1===this.overflow?this.qA(o):0;if(this.ye>=this.maxLines){null!==i&&i.i(0,a);return}let d=t;if(0===this.wrap){if(this.Nn=1,l=this.getStringWidth(t),0===u||l<=e){this.mi=Math.max(this.mi,l),this.An(t,this.mi),null!==i&&i.i(l,a);return}let n=this.Md(d);d=d.substring(n.length);let o=this.Md(d);for(l=this.getStringWidth(n+o),r=0;o.length>0&&l<=e;){n+=o,d=d.substring(o.length),o=this.Md(d),r=l;let t=n+o;s&&(t=t.trim()),l=this.getStringWidth(t)}for(s&&(o=o.trim()),n+=o,e=Math.max(1,e-u);this.getStringWidth(n)>e&&n.length>1;)n=n.substring(0,n.length-1);this.K2(!0),n+=e3.Mp,r=this.getStringWidth(n),this.mi=r,this.An(n,r),null!==i&&i.i(r,a);return}let c=0;for(0===d.length&&(c=1,this.An(d,0));d.length>0;){let t=this.Md(d);for(d=d.substring(t.length);this.getStringWidth(t)>e;){let i=1;for(l=this.getStringWidth(t.substring(0,i)),r=0;l<=e;)i++,r=l,l=this.getStringWidth(t.substring(0,i));let s=0;1===i?(s=l,n=Math.max(n,l)):(s=r,n=Math.max(n,r)),--i<1&&(i=1);let o=t.substring(0,i);if(this.An(o,s),c++,t=t.substring(i),this.ye+c>this.maxLines)break}let i=this.Md(d);for(l=this.getStringWidth(t+i),r=0;i.length>0&&l<=e;){t+=i,d=d.substring(i.length),i=this.Md(d),r=l;let e=t+i;s&&(e=e.trim()),l=this.getStringWidth(e)}if(s&&(t=t.trim()),""===t)continue;"\xad"===t[t.length-1]&&(t=t.substring(0,t.length-1)+"");let o=0;if(0===i.length?(o=l,n=Math.max(n,l)):(o=r=this.getStringWidth(t),n=Math.max(n,r)),this.An(t,o),c++,this.ye+c>this.maxLines)break}this.Nn=Math.min(this.maxLines-this.ye,c),this.mi=Math.max(this.mi,n),null!==i&&i.i(this.mi,a*this.Nn)}Xv(t,e){if(0===this.mi||null===this.Te||null===this.Ri||1!==this.overflow)return;let i=this.Mn,s=1===this.overflow?this.qA(i):0,n=this.spacingAbove+this.spacingBelow,l=Math.max(0,this.Ap()+n),r=Math.min(this.maxLines-1,Math.max(Math.floor(e/l+.01)-1,0));if(r+1>=this.Ri.length)return;this.K2(!0);let o=this.Ri[r],h=Math.max(1,t-s);for(;this.getStringWidth(o)>h&&o.length>1;)o=o.substring(0,o.length-1);o+=e3.Mp;let a=this.getStringWidth(o);this.Ri[r]=o,this.Ri=this.Ri.slice(0,r+1),this.Te[r]=a,this.Te=this.Te.slice(0,r+1),this.Nn=this.Ri.length,this.mi=Math.max(this.mi,a),this.ye=this.Nn,1===this.ye&&(this.Cn=this.Ri[0])}Md(t){if(3===this.wrap)return t.substring(0,1);let e=t.length,i=0,s=e3.Yv;for(;i<e&&!s.test(t.charAt(i));)i++;for(1===this.formatting&&(e=Math.min(e,i+1));i<e&&s.test(t.charAt(i));)i++;return i>=t.length?t:t.substring(0,i)}getStringWidth(t){return null===e3.nl?8*t.length:e3.nl.measureText(t).width}Ap(){if(null!==this.ao)return this.ao;let t=this.Mn,e=0;return null===e3.nl?e=16:void 0!==e3.G2[t]&&e3.WA<5e3?e=e3.G2[t]:(e=1.3*e3.nl.measureText("M").width,e3.G2[t]=e,e3.WA++),this.ao=e,e}qA(t){if(null===e3.nl)return 6;let e=0;return void 0!==e3.Qb[t]&&e3.X2<5e3?e=e3.Qb[t]:(e=e3.nl.measureText(e3.Mp).width,e3.Qb[t]=e,e3.X2++),e}i1(t,e){return t.indexOf(`
`,e)}KA(t){let e=this.ai.replace(/\r\n/g,`
`).replace(/\r/g,`
`),i=this.spacingAbove+this.spacingBelow,s=Math.max(0,this.Ap()+i);if(0===e.length)return this.mi=0,this.ye=1,s;if(!this.isMultiline){let t=this.i1(e,0);t>=0&&(e=e.substring(0,t))}let n=0;this.ye=0;let l=0,r=-1,o=!1;for(;!o;){if(-1===(r=this.i1(e,l))&&(r=e.length,o=!0),l<=r){let i=e.substring(l,r);if(0!==this.wrap){this.Nn=0;let e=tx.l();this.Y2(i,t,e),n+=e.height,tx.e(e),this.ye+=this.Nn}else this.Y2(i,t,null),n+=s,this.ye++;this.ye===this.maxLines&&(o=!0)}l=r+1}return this.P0=n,n}zv(){let t=this.ai.replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(0===t.length)return 8;if(this.isMultiline){let e=0,i=0,s=!1;for(;!s;){let n=this.i1(t,i);-1===n&&(n=t.length,s=!0);let l=t.substring(i,n);0===this.formatting&&(l=l.trim()),e=Math.max(e,this.getStringWidth(l)),i=n+1}return e}{let e=this.i1(t,0);return e>=0&&(t=t.substring(0,e)),this.getStringWidth(t)}}get textValidation(){return null!==this.ct?this.ct.Il:null}set textValidation(t){let e=this.textValidation;e!==t&&(null!==t&&te.S(t,e3,"textValidation"),this.Ln().Il=t,this.t("textValidation",e,t))}get textEdited(){return null!==this.ct?this.ct.Fp:null}set textEdited(t){let e=this.textEdited;e!==t&&(null!==t&&te.S(t,e3,"textEdited"),this.Ln().Fp=t,this.t("textEdited",e,t))}get spacingAbove(){return null!==this.ct?this.ct.Rp:0}set spacingAbove(t){let e=this.spacingAbove;e!==t&&(this.Ln().Rp=t,this.c(),this.t("spacingAbove",e,t))}get spacingBelow(){return null!==this.ct?this.ct.vp:0}set spacingBelow(t){let e=this.spacingBelow;e!==t&&(this.Ln().vp=t,this.c(),this.t("spacingBelow",e,t))}get formatting(){return null!==this.ct?this.ct.Op:0}set formatting(t){let e=this.formatting;e!==t&&(this.Ln().Op=t,this.c(),this.t("formatting",e,t))}get maxLines(){return null!==this.ct?this.ct.Ip:1/0}set maxLines(t){let e=this.maxLines;e!==t&&((t=Math.floor(t))<=0&&te._(t,"> 0",e3,"maxLines"),this.Ln().Ip=t,this.c(),this.t("maxLines",e,t))}getMetrics(){return[this.mi,this.El,this.ao,this.Nn,this.Te,this.Ri,this.Cn]}Bv(t){void 0!==t&&(this.mi=t[0],this.El=t[1],this.ao=t[2],this.Nn=t[3],this.Te=t[4],this.Ri=t[5],this.Cn=t[6])}get metrics(){return{arrSize:null!==this.Te?this.Te:[this.mi],arrText:null!==this.Ri?this.Ri:[this.Cn],maxLineWidth:this.mi,fontHeight:this.ao}}get choices(){return this.Sd}set choices(t){let e=this.Sd;e!==t&&(this.Sd=t,this.t("choices",e,t))}static Yv=RegExp("[ \xad]");static G2=new ts;static WA=0;static Qb=new ts;static X2=0;static Mp="...";static jA="";static nl=eh.isUsingDOM()?new eN(null).ci:null}class e4{gi;ls;co;Op;Ip;Lp;Rp;vp;Np;Fp;Tp;Il;ll;Cp;constructor(){this.gi=!1,this.ls=null,this.co=0,this.Op=0,this.Ip=1/0,this.Lp=0,this.Rp=0,this.vp=0,this.Np="start",this.Fp=null,this.Tp=null,this.Il=null,this.ll=tv.Top,this.Cp=2}copy(){let t=new e4;return t.ls=this.ls,t.co=this.co,t.Op=this.Op,t.Ip=this.Ip,t.Lp=this.Lp,t.Rp=this.Rp,t.vp=this.vp,t.Np=this.Np,t.Fp=this.Fp,t.Tp=this.Tp,t.Il=this.Il,t.ll=this.ll,t.Cp=this.Cp,t}}class e5{wf;xf;bf;Dp;kf;constructor(){this.wf=1,this.xf=0,this.bf=1,this.Dp=null,this.kf=null}copy(){let t=new e5;return t.wf=this.wf,t.xf=this.xf,t.bf=this.bf,t.Dp=this.Dp,t.kf=this.kf,t}}var e8=((C=e8||{})[C.None=0]="None",C[C.Fill=2]="Fill",C[C.Uniform=6]="Uniform",C[C.UniformToFill=7]="UniformToFill",C);class e6 extends eb{hl;wt;al;Pf;ls;cl;Sf;co;Mf;Nf;Ib;constructor(t,e){super(),this.n|=2097152,this.hl=null,this.wt="",this.al=tw.KD,this.Pf=2,this.ls=null,this.cl=null,this.Sf=tv.Center,this.co=0,this.Mf=null,this.Nf=null,this.Ib=null,"string"==typeof t?this.source=t:t&&Object.assign(this,t),e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.wt=this.wt,t.element=this.hl,t.al=this.al.N(),t.Pf=this.Pf,t.co=this.co,t.ls=this.ls,t.cl=this.cl,t.Sf=this.Sf.N(),t.Nf=this.Nf}hi(t){t in e8?this.imageStretch=t:super.hi(t)}toString(){return"Picture("+this.source+")#"+tu.us(this)}get Cf(){return(1048576&this.n)!=0}set Cf(t){this.Cf!==t&&(this.n=1048576^this.n)}get Ep(){return(2097152&this.n)!=0}set Ep(t){this.Ep!==t&&(this.n=2097152^this.n)}get yn(){return(4194304&this.n)!=0}set yn(t){this.yn!==t&&(this.n=4194304^this.n)}static clearCache(t){void 0===t&&(t=""),te.s(t,"string",e6,"clearCache:url"),""!==t?e6.Bp[t]&&(delete e6.Bp[t],e6.e1--):(e6.Bp=new ts,e6.e1=0)}static WL(t,e){e.JA||(e.s1=i=>{e6.Kv(e,i),t.desiredSize.isReal()||(t.me(!1),t.c())},e.o1=t=>e6.Gv(e,t),e.addEventListener("load",e.s1),e.addEventListener("error",e.o1),e.JA=!0)}static FR(t){t.s1&&t.removeEventListener("load",t.s1),t.o1&&t.removeEventListener("error",t.o1),delete t.s1,delete t.o1,delete t.JA}get element(){return this.hl}set element(t){let e=this.hl;if(this.Ye(!0),e!==t){this.Cf=t instanceof HTMLCanvasElement;let i=t instanceof HTMLImageElement;null===t||i||t instanceof HTMLVideoElement||this.Cf||te.o("Picture.element must be an instance of Image, Canvas, or Video, not: "+t);let s=this.diagram;null!==s&&s.EM(this),this.hl=t,null!==t&&i&&void 0===t.ss&&(t.ss=new tu),null!==s&&i&&s.IM(this),this.t("element",e,t),this.C()}}TR(){let t=this.hl;if(null===t)return;let e=this.desiredSize.isReal();(this.Cf||!0===t.complete)&&(t.c0&&(t.Up instanceof Event&&null!==this.ls?this.ls(this,t.Up):!0===t.yn&&!t.Up&&null!==this.cl&&t.H2&&this.cl(this,t.H2)),t.yn=!0),t.yn&&e&&null!==this.diagram&&this.diagram.Gu.add(this)}Hv(){if(null===this.hl){this.Mf=!1;return}let t=new eN(null).ci;try{t.drawImage(this.hl,0,0)}catch{this.Ep=!1}try{t.getImageData(0,0,1,1).data[3]&&(this.Mf=!1),this.Mf=!1}catch{this.Mf=!0}}get source(){return this.wt}set source(t){let e=this.wt;if(e!==t){this.Ye(!0),te.s(t,"string",e6,"source"),this.wt=t;let i=e6.Bp;if(!eh.isUsingDOM()){this.t("source",e,t);return}let s=null;if(void 0!==i[t])s=i[t];else if(""!==t){e6.e1>30&&(e6.clearCache(),i=e6.Bp),(s=te.fs("img")).c0=!0,e6.WL(this,s);let e=this.Nf;null!==e&&(s.crossOrigin=e(this)),s.src=t,i[t]=s,e6.e1++}this.element=s,null!==s&&void 0===s.__goCache&&(s.__goCache=new e9),this.c(),this.C(),this.t("source",e,t)}}static Kv(t,e){let i;t.yn=!0,t.Up=!1;let s=t.ss.copy();if(null==s)return;let n=s.iterator;for(;n.next();){let s=n.value;s.C();let l=t.getAttribute("src")||"",r=s.ih.get(l);if(null===r)continue;let o=r.length;for(let n=0;n<o;n++)(i=r[n]).desiredSize.isReal()||s.Gu.add(i),i.Ye(!0),s.requestUpdate(),t.c0&&(void 0===t.H2&&(t.H2=e),null!==i.cl&&i.cl(i,e))}t.ss.clear()}static Gv(t,e){let i;t.Up=e;let s=t.ss.copy();if(null==s)return;let n=s.iterator;for(;n.next();){let s=n.value,l=t.getAttribute("src")||"",r=s.ih.get(l);if(null===r)continue;let o=r.length,h=te.rt();for(let t=0;t<o;t++)h.push(r[t]);if(t.c0)for(let t=0;t<o;t++)null!==(i=h[t]).ls&&i.ls(i,e);te.tt(h)}t.ss.clear()}reloadSource(){if(""===this.source)return;e6.clearCache(this.source);let t=this.source;this.source="",this.source=t}redraw(){this.C(),this.Ye(!0)}get sourceCrossOrigin(){return this.Nf}set sourceCrossOrigin(t){if(this.Nf!==t&&(null!==t&&te.S(t,e6,"sourceCrossOrigin"),this.Nf=t,null!==this.element)){let e=this.element.getAttribute("src");null===t&&"string"==typeof e?this.element.crossOrigin=null:null!==t&&(this.element.crossOrigin=t(this)),this.element.src=e}}get sourceRect(){return this.al}set sourceRect(t){let e=this.al;e.equals(t)||(t=t.N(),this.al=t,this.C(),this.t("sourceRect",e,t))}get imageStretch(){return this.Pf}set imageStretch(t){let e=this.Pf;e!==t&&(this.Pf=t,this.C(),this.t("imageStretch",e,t))}get flip(){return this.co}set flip(t){let e=this.co;e!==t&&(this.co=t,this.C(),this.t("flip",e,t))}get imageAlignment(){return this.Sf}set imageAlignment(t){let e=this.Sf;e.equals(t)||(t=t.N(),this.Sf=t,this.C(),this.t("imageAlignment",e,t))}get errorFunction(){return this.ls}set errorFunction(t){let e=this.ls;e!==t&&(null!==t&&te.S(t,e6,"errorFunction"),this.ls=t,this.t("errorFunction",e,t))}get successFunction(){return this.cl}set successFunction(t){let e=this.cl;e!==t&&(null!==t&&te.S(t,e6,"successFunction"),this.cl=t,this.t("successFunction",e,t))}wh(t,e){let i=this.hl;if(null===i)return;let s=i.getAttribute("src");if(i instanceof HTMLImageElement&&(null===s||""===s)||i.Up instanceof Event&&t instanceof eC)return;let n=t instanceof eM,l=this.naturalBounds,r=0,o=0,h=this.Cf,a=h?+i.width:i.naturalWidth,u=h?+i.height:i.naturalHeight;if(void 0===a&&i.videoWidth&&(a=i.videoWidth),void 0===u&&i.videoHeight&&(u=i.videoHeight),0===a||0===u)return;let d=a,c=u;this.sourceRect.isReal()&&(r=this.al.x,o=this.al.y,a=this.al.width,u=this.al.height);let g=a,f=u,m=this.Pf,p=this.Sf;switch(m){case 0:if(this.sourceRect.isReal())break;g>=l.width&&(r=r+p.offsetX+(g*p.x-l.width*p.x)),f>=l.height&&(o=o+p.offsetY+(f*p.y-l.height*p.y)),a=Math.min(l.width,g),u=Math.min(l.height,f);break;case 2:g=l.width,f=l.height;break;case 6:case 7:let y=0;6===m?(y=Math.min(l.height/f,l.width/g),g*=y,f*=y):7===m&&(y=Math.max(l.height/f,l.width/g),g*=y,f*=y,g>=l.width&&(r=(r+p.offsetX+(g*p.x-l.width*p.x)/g)*a),f>=l.height&&(o=(o+p.offsetY+(f*p.y-l.height*p.y)/f)*u),a*=1/(g/l.width),u*=1/(f/l.height),g=l.width,f=l.height)}let x=a*u,w=this.getDocumentScale()*e.scale,b=g*w*(f*w),v=x/b,k=i.__goCache,P=null,S=e6.jv;if(!n){if(i.yn&&void 0!==k&&b>4&&v>S*S){null===k.Ot&&(k.$A(4,d,c,i),k.$A(16,d,c,i));let t=k.Ot,e=t.length;for(let i=0;i<e&&t[i].Nd*t[i].Nd<v;i++)P=t[i]}if(!e.Ku&&(null===this.Mf&&this.Hv(),this.Mf))return}let M=g<l.width?p.offsetX+(l.width*p.x-g*p.x):0,N=f<l.height?p.offsetY+(l.height*p.y-f*p.y):0;switch(this.flip){case 0:break;case 2:t.translate(Math.min(l.width,g),0),t.scale(-1,1);break;case 1:t.translate(0,Math.min(l.height,f)),t.scale(1,-1);break;case 3:t.translate(Math.min(l.width,g),Math.min(l.height,f)),t.scale(-1,-1)}if(t.commitTransform(),e.getRenderingHint("pictureRatioOptimization")&&!e.oa&&void 0!==k&&null!==P&&1!==P.Nd){t.save();let e=P.Nd;try{t.drawImage(P.wt,r/e,o/e,Math.min(P.wt.width,a/e),Math.min(P.wt.height,u/e),M,N,Math.min(l.width,g),Math.min(l.height,f)),t instanceof eM&&(this.Ib=[r/e,o/e,Math.min(P.wt.width,a/e),Math.min(P.wt.height,u/e),M,N,Math.min(l.width,g),Math.min(l.height,f)])}catch{this.Ep=!1}t.restore()}else try{t.drawImage(i,r,o,a,u,M,N,Math.min(l.width,g),Math.min(l.height,f)),t instanceof eM&&(this.Ib=[r,o,a,u,M,N,Math.min(l.width,g),Math.min(l.height,f)])}catch{this.Ep=!1}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-Math.min(l.width,g),0);break;case 1:t.scale(1,-1),t.translate(0,-Math.min(l.height,f));break;case 3:t.scale(-1,-1),t.translate(-Math.min(l.width,g),-Math.min(l.height,f))}}get naturalBounds(){return this.Ki}_u(t,e,i,s){let n=this.desiredSize,l=this.Hs(!0),r=this.hl,o=this.Cf,h=0,a=0;(o||!this.yn&&r&&r.complete)&&(this.yn=!0),null===r?(isFinite(n.width)||(t=i),isFinite(n.height)||(e=s)):(h=o?+r.width:r.naturalWidth,a=o?+r.height:r.naturalHeight),isFinite(n.width)||2===l||5===l?(isFinite(t)||(this.sourceRect.isReal()?t=this.sourceRect.width:null!==r&&(t=h)),i=0):null!==r&&!1!==this.yn&&(t=this.sourceRect.isReal()?this.sourceRect.width:h),isFinite(n.height)||2===l||4===l?(isFinite(e)||(this.sourceRect.isReal()?e=this.sourceRect.height:null!==r&&(e=a)),s=0):null!==r&&!1!==this.yn&&(e=this.sourceRect.isReal()?this.sourceRect.height:a),isFinite(n.width)&&(t=n.width),isFinite(n.height)&&(e=n.height);let u=this.maxSize,d=this.minSize;i=Math.max(i||0,d.width),s=Math.max(s||0,d.height),t=Math.min(u.width,t),e=Math.min(u.height,e),t=Math.max(i,t),e=Math.max(s,e),null!==r&&!r.complete&&(isFinite(t)||(t=0),isFinite(e)||(e=0)),this.Ki.zn(t,e),this.so(0,0,t,e)}ph(t,e,i,s){this.commonArrange(t,e,i,s)}static Bp=new ts;static e1=0;static jv=4}class e9{Ot;constructor(){this.Ot=null}$A(t,e,i,s){null===this.Ot&&(this.Ot=[]);let n=new eN(null),l=n.ci,r=1/t;if(n.width=e/t,n.height=i/t,0===n.width||0===n.height)return;let o=new e7(n.Rt,t),h=s,a=1;if(this.Ot.length>0){let t=this.Ot[this.Ot.length-1];h=t.wt,a=t.Nd}l.setTransform(r*a,0,0,r*a,0,0),l.commitTransform(),l.drawImage(h,0,0),this.Ot.push(o)}}class e7{wt;Nd;constructor(t,e){this.wt=t,this.Nd=e}}class it{Si;Wg;constructor(){this.Wg=new tN,this.Si=null}Ii(t){null!==t?(this.Wg=t,t.figures.clear()):this.Wg=new tN,this.Si=null}gu(t,e,i,s,n,l){if(void 0!==s&&!0===s){let i=new tT(1);i.endX=t,i.endY=e,this.Si.segments.add(i)}else this.Si=new tC,this.Si.startX=t,this.Si.startY=e,this.Si.isFilled=i,this.Si.isEvenOdd=l||!1,this.Wg.figures.add(this.Si);void 0!==n&&(this.Si.isShadowed=n)}_D(){let t=this.Si.segments.length;t>0&&this.Si.segments.elt(t-1).close()}tF(){this.Si.segments.length>0&&(this.Si.isFilled=!0)}iF(t){this.Si.isShadowed=t}NE(t){this.Si.isEvenOdd=t}$D(t,e,i){void 0===i&&(i=!1);let s=new tT(1);s.endX=t,s.endY=e,i&&s.close(),this.Si.segments.add(s)}mr(t,e,i){void 0===i&&(i=!1);let s=new tT(2);s.endX=t,s.endY=e,i&&s.close(),this.Si.segments.add(s)}pr(t,e,i,s,n,l,r){void 0===r&&(r=!1);let o=new tT(3);o.point1X=t,o.point1Y=e,o.point2X=i,o.point2Y=s,o.endX=n,o.endY=l,r&&o.close(),this.Si.segments.add(o)}Sw(t,e,i,s,n){void 0===n&&(n=!1);let l=new tT(4);l.point1X=t,l.point1Y=e,l.endX=i,l.endY=s,n&&l.close(),this.Si.segments.add(l)}ZD(t,e,i,s,n,l,r){void 0===l&&(l=0),void 0===r&&(r=!1);let o=new tT(5);o.startAngle=t,o.sweepAngle=e,o.centerX=i,o.centerY=s,o.radiusX=n,0!==l?o.radiusY=l:o.radiusY=n,r&&o.close(),this.Si.segments.add(o)}QD(t,e,i,s,n,l,r,o){void 0===o&&(o=!1);let h=new tT(6,l,r,t,e,i,s,n);o&&h.close(),this.Si.segments.add(h)}static j2=null;static CC(t){let e=it.j2;if(null!==e)return it.j2=null,e.Ii(t),e;{let e=new it;return e.Ii(t),e}}static LC(t){it.j2=t}}{let t=function(t,e){let i=t.toLowerCase(),s=tP.Gn;s[t]=e,s[i]=t};t("Rectangle",(t,e,i)=>{let s="r"+e+","+i,n=tP.dr[s];return void 0!==n||((n=new tN(2)).endX=e,n.endY=i,tP.gr<tP.Gg&&(tP.dr[s]=n,tP.gr++)),n}),t("Square",(t,e,i)=>{let s="s"+e+","+i,n=tP.dr[s];return void 0!==n||((n=new tN(2)).endX=e,n.endY=i,n.defaultStretch=6,tP.gr<tP.Gg&&(tP.dr[s]=n,tP.gr++)),n});let e=(t,e,i,s,n)=>{(isNaN(s)||s<0)&&(s=5),isNaN(n)&&(n=15);let l="rr"+e+","+i+","+s+","+n,r=tP.dr[l];if(void 0!==r)return r;let o=s,h=new tC(o=(1&n)==1?Math.min(o=Math.min(o,(2&n)==2?e/3:e),(8&n)==8?i/3:i):0,0,!0);r=new tN().add(h);let a=tv.TopLeft.copy(),u=tv.BottomRight.copy();if((2&n)==2){let t=s,l=(t=Math.min(t=Math.min(t,(1&n)==1?e/3:e),(4&n)==4?i/3:i))*tP.Xn;h.add(new tT(2,e-t,0)).add(new tT(3,e,t,e-l,0,e,l)),a.offsetY=l,u.offsetX=-l}else h.add(new tT(2,e,0));if((4&n)==4){let t=s,l=(t=Math.min(t=Math.min(t,(8&n)==8?e/3:e),(2&n)==2?i/3:i))*tP.Xn;h.add(new tT(2,e,i-t)).add(new tT(3,e-t,i,e,i-l,e-l,i)),u.offsetX=-l,u.offsetY=-l}else h.add(new tT(2,e,i));if((8&n)==8){let t=s,l=(t=Math.min(t=Math.min(t,(4&n)==4?e/3:e),(1&n)==1?i/3:i))*tP.Xn;h.add(new tT(2,t,i)).add(new tT(3,0,i-t,l,i,0,i-l)),a.offsetX=l,u.offsetY=-l}else h.add(new tT(2,0,i));if((1&n)==1){let t=o*tP.Xn;h.add(new tT(2,0,o)).add(new tT(3,o,0,0,t,t,0).close()),a.offsetX=t,a.offsetY=t}else h.add(new tT(2,0,0).close());return r.spot1=a,r.spot2=u,tP.gr<tP.Gg&&(tP.dr[l]=r,tP.gr++),r};t("RoundedRectangle",(t,i,s)=>{let n=t?t.parameter1:NaN,l=t?t.parameter2:NaN;return e(t,i,s,n,l)}),t("Border","RoundedRectangle"),t("RoundedTopRectangle",(t,i,s)=>{let n=t?t.parameter1:NaN;return e(t,i,s,n,3)}),t("RoundedBottomRectangle",(t,i,s)=>{let n=t?t.parameter1:NaN;return e(t,i,s,n,12)}),t("RoundedLeftRectangle",(t,i,s)=>{let n=t?t.parameter1:NaN;return e(t,i,s,n,9)}),t("RoundedRightRectangle",(t,i,s)=>{let n=t?t.parameter1:NaN;return e(t,i,s,n,6)}),t("Ellipse",(t,e,i)=>{let s="e"+e+","+i,n=tP.dr[s];return void 0!==n||((n=new tN(3)).endX=e,n.endY=i,n.spot1=tv.vk,n.spot2=tv.Ok,tP.gr<tP.Gg&&(tP.dr[s]=n,tP.gr++)),n}),t("Circle",(t,e,i)=>{let s="c"+e+","+i,n=tP.dr[s];return void 0!==n||((n=new tN(3)).endX=e,n.endY=i,n.spot1=tv.vk,n.spot2=tv.Ok,n.defaultStretch=6,tP.gr<tP.Gg&&(tP.dr[s]=n,tP.gr++)),n}),t("TriangleRight",(t,e,i)=>new tN().add(new tC(0,0).add(new tT(2,e,.5*i)).add(new tT(2,0,i).close())).setSpots(0,.25,.5,.75)),t("TriangleDown",(t,e,i)=>new tN().add(new tC(0,0).add(new tT(2,e,0)).add(new tT(2,.5*e,i).close())).setSpots(.25,0,.75,.5)),t("TriangleLeft",(t,e,i)=>new tN().add(new tC(e,i).add(new tT(2,0,.5*i)).add(new tT(2,e,0).close())).setSpots(.5,.25,1,.75)),t("TriangleUp",(t,e,i)=>new tN().add(new tC(e,i).add(new tT(2,0,i)).add(new tT(2,.5*e,0).close())).setSpots(.25,.5,.75,1)),t("Triangle","TriangleUp"),t("Diamond",(t,e,i)=>new tN().add(new tC(.5*e,0).add(new tT(2,0,.5*i)).add(new tT(2,.5*e,i)).add(new tT(2,e,.5*i).close())).setSpots(.25,.25,.75,.75)),t("LineH",(t,e,i)=>{let s=new tN(1);return s.startX=0,s.startY=i/2,s.endX=e,s.endY=i/2,s}),t("LineV",(t,e,i)=>{let s=new tN(1);return s.startX=e/2,s.startY=0,s.endX=e/2,s.endY=i,s}),t("None","Rectangle"),t("BarH","Rectangle"),t("BarV","Rectangle"),t("MinusLine","LineH"),t("PlusLine",(t,e,i)=>new tN().add(new tC(0,i/2,!1).add(new tT(2,e,i/2)).add(new tT(1,e/2,0)).add(new tT(2,e/2,i)))),t("XLine",(t,e,i)=>new tN().add(new tC(0,i,!1).add(new tT(2,e,0)).add(new tT(1,0,0)).add(new tT(2,e,i)))),t("LineRight",(t,e,i)=>new tN().add(new tC(.25*e,0,!1).add(new tT(2,.75*e,.5*i)).add(new tT(2,.25*e,i)))),t("LineDown",(t,e,i)=>new tN().add(new tC(0,.25*i,!1).add(new tT(2,.5*e,.75*i)).add(new tT(2,e,.25*i)))),t("LineLeft",(t,e,i)=>new tN().add(new tC(.75*e,0,!1).add(new tT(2,.25*e,.5*i)).add(new tT(2,.75*e,i)))),t("LineUp",(t,e,i)=>new tN().add(new tC(0,.75*i,!1).add(new tT(2,.5*e,.25*i)).add(new tT(2,e,.75*i)))),t("Capsule",(t,e,i)=>{let s=new tN;if(e<i){let n=e/2,l=new tC(0,n,!0);s.add(l),l.add(new tT(5,180,180,n,n,n,n)),l.add(new tT(2,e,i-n)),l.add(new tT(5,0,180,n,i-n,n,n)),l.add(new tT(2,0,n));let r=isFinite(t.parameter1)?t.parameter1:.156*e;return s.spot1=new tv(0,0,0,r),s.spot2=new tv(1,1,0,-r),s}if(!(e>i))return s.type=3,s.endX=e,s.endY=i,s.spot1=tv.vk,s.spot2=tv.Ok,s;{let n=i/2,l=new tC(n,0,!0);s.add(l),l.add(new tT(2,e-n,0)),l.add(new tT(5,270,180,e-n,n,n,n)),l.add(new tT(2,n,i)),l.add(new tT(5,90,180,n,n,n,n));let r=isFinite(t.parameter1)?t.parameter1:.156*i;return s.spot1=new tv(0,0,r,0),s.spot2=new tv(1,1,-r,0),s}});let i=(t,e)=>new tC(t,e,!1,!1),s=(t,e,i)=>t.add(new tT(2,e,i)),n=(t,e,i)=>t.add(new tT(1,e,i));t("Borders",(t,e,l)=>{let r,o=t?t.parameter1:NaN;isNaN(o)?o=10:o&=15;let h=new tN;return 10===o?(s(r=i(e,0),e,l),n(r,0,l),s(r,0,0)):5===o?(s(r=i(0,0),e,0),n(r,e,l),s(r,0,l)):1===o?(s(r=i(0,0),e,0),n(r,e,l)):2===o?s(r=i(e,0),e,l):4===o?s(r=i(e,l),0,l):8===o?(s(r=i(0,l),0,0),n(r,e,l)):3===o?(s(r=i(0,0),e,0),s(r,e,l)):6===o?(s(r=i(e,0),e,l),s(r,0,l)):12===o?(s(r=i(e,l),0,l),s(r,0,0)):9===o?(s(r=i(0,l),0,0),s(r,e,0)):7===o?(s(r=i(0,0),e,0),s(r,e,l),s(r,0,l)):14===o?(s(r=i(e,0),e,l),s(r,0,l),s(r,0,0)):13===o?(s(r=i(e,l),0,l),s(r,0,0),s(r,e,0)):11===o?(s(r=i(0,l),0,0),s(r,e,0),s(r,e,l)):15===o?(s(r=i(0,0),e,0),s(r,e,l),s(r,0,l),r.add(new tT(2,0,0).close())):n(r=i(0,0),e,l),h.add(r),h})}tP.Kg={"":"",Standard:"F1 m 0,0 l 8,4 -8,4 2,-4 z",Backward:"F1 m 8,0 l -2,4 2,4 -8,-4 z",Triangle:"F1 m 0,0 l 8,4.62 -8,4.62 z",BackwardTriangle:"F1 m 8,4 l 0,4 -8,-4 8,-4 0,4 z",Boomerang:"F1 m 0,0 l 8,4 -8,4 4,-4 -4,-4 z",BackwardBoomerang:"F1 m 8,0 l -8,4 8,4 -4,-4 4,-4 z",SidewaysV:"m 0,0 l 8,4 -8,4 0,-1 6,-3 -6,-3 0,-1 z",BackwardV:"m 8,0 l -8,4 8,4 0,-1 -6,-3 6,-3 0,-1 z",OpenTriangle:"m 0,0 l 8,4 -8,4",BackwardOpenTriangle:"m 8,0 l -8,4 8,4",OpenTriangleLine:"m 0,0 l 8,4 -8,4 m 8.5,0 l 0,-8",BackwardOpenTriangleLine:"m 8,0 l  -8,4 8,4 m -8.5,0 l 0,-8",OpenTriangleTop:"m 0,0 l 8,4 m 0,4",BackwardOpenTriangleTop:"m 8,0 l -8,4 m 0,4",OpenTriangleBottom:"m 0,8 l 8,-4",BackwardOpenTriangleBottom:"m 0,4 l 8,4",HalfTriangleTop:"F1 m 0,0 l 0,4 8,0 z m 0,8",BackwardHalfTriangleTop:"F1 m 8,0 l 0,4 -8,0 z m 0,8",HalfTriangleBottom:"F1 m 0,4 l 0,4 8,-4 z",BackwardHalfTriangleBottom:"F1 m 8,4 l 0,4 -8,-4 z",ForwardSemiCircle:"m 4,0 b 270 180 0 4 4",BackwardSemiCircle:"m 4,8 b 90 180 0 -4 4",Feather:"m 0,0 l 3,4 -3,4",BackwardFeather:"m 3,0 l -3,4 3,4",DoubleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardDoubleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4",TripleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardTripleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4 m 3,-8 l -3,4 3,4",ForwardSlash:"m 0,8 l 5,-8",BackSlash:"m 0,0 l 5,8",DoubleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8",DoubleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8",TripleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8 m -2,8 l 4,-8",TripleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8 m -2,-8 l 4,8",Fork:"m 0,4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4",LineFork:"m 0,0 l 0,8 m 0,-4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardLineFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4 m 8,-8 l 0,8",CircleFork:"F1 m 6,4 b 0 360 -3 0 3 z m 0,0 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 6,0 b 0 360 -3 0 3",CircleLineFork:"F1 m 6,4 b 0 360 -3 0 3 z m 1,-4 l 0,8 m 0,-4 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleLineFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 0,-4 l 0,8 m 7,-4 b 0 360 -3 0 3",Circle:"F1 m 8,4 b 0 360 -4 0 4 z",Block:"F1 m 0,0 l 0,8 8,0 0,-8 z",StretchedDiamond:"F1 m 0,3 l 5,-3 5,3 -5,3 -5,-3 z",Diamond:"F1 m 0,4 l 4,-4 4,4 -4,4 -4,-4 z",Chevron:"F1 m 0,0 l 5,0 3,4 -3,4 -5,0 3,-4 -3,-4 z",StretchedChevron:"F1 m 0,0 l 8,0 3,4 -3,4 -8,0 3,-4 -3,-4 z",NormalArrow:"F1 m 0,2 l 4,0 0,-2 4,4 -4,4 0,-2 -4,0 z",X:"m 0,0 l 8,8 m 0,-8 l -8,8",TailedNormalArrow:"F1 m 0,0 l 2,0 1,2 3,0 0,-2 2,4 -2,4 0,-2 -3,0 -1,2 -2,0 1,-4 -1,-4 z",DoubleTriangle:"F1 m 0,0 l 4,4 -4,4 0,-8 z  m 4,0 l 4,4 -4,4 0,-8 z",BigEndArrow:"F1 m 0,0 l 5,2 0,-2 3,4 -3,4 0,-2 -5,2 0,-8 z",ConcaveTailArrow:"F1 m 0,2 h 4 v -2 l 4,4 -4,4 v -2 h -4 l 2,-2 -2,-2 z",RoundedTriangle:"F1 m 0,1 a 1,1 0 0 1 1,-1 l 7,3 a 0.5,1 0 0 1 0,2 l -7,3 a 1,1 0 0 1 -1,-1 l 0,-6 z",SimpleArrow:"F1 m 1,2 l -1,-2 2,0 1,2 -1,2 -2,0 1,-2 5,0 0,-2 2,2 -2,2 0,-2 z",AccelerationArrow:"F1 m 0,0 l 0,8 0.2,0 0,-8 -0.2,0 z m 2,0 l 0,8 1,0 0,-8 -1,0 z m 3,0 l 2,0 2,4 -2,4 -2,0 0,-8 z",BoxArrow:"F1 m 0,0 l 4,0 0,2 2,0 0,-2 2,4 -2,4 0,-2 -2,0 0,2 -4,0 0,-8 z",TriangleLine:"F1 m 8,4 l -8,-4 0,8 8,-4 z m 0.5,4 l 0,-8",CircleEndedArrow:"F1 m 10,4 l -2,-3 0,2 -2,0 0,2 2,0 0,2 2,-3 z m -4,0 b 0 360 -3 0 3 z",DynamicWidthArrow:"F1 m 0,3 l 2,0 2,-1 2,-2 2,4 -2,4 -2,-2 -2,-1 -2,0 0,-2 z",EquilibriumArrow:"m 0,3 l 8,0 -3,-3 m 3,5 l -8,0 3,3",FastForward:"F1 m 0,0 l 3.5,4 0,-4 3.5,4 0,-4 1,0 0,8 -1,0 0,-4 -3.5,4 0,-4 -3.5,4 0,-8 z",Kite:"F1 m 0,4 l 2,-4 6,4 -6,4 -2,-4 z",HalfArrowTop:"F1 m 0,0 l 4,4 4,0 -8,-4 z m 0,8",HalfArrowBottom:"F1 m 0,8 l 4,-4 4,0 -8,4 z",OpposingDirectionDoubleArrow:"F1 m 0,4 l 2,-4 0,2 4,0 0,-2 2,4 -2,4 0,-2 -4,0 0,2 -2,-4 z",PartialDoubleTriangle:"F1 m 0,0 4,3 0,-3 4,4 -4,4 0,-3 -4,3 0,-8 z",LineCircle:"F1 m 0,0 l 0,8 m 7 -4 b 0 360 -3 0 3 z",DoubleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",TripleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",CircleLine:"F1 m 6 4 b 0 360 -3 0 3 z m 1,-4 l 0,8",DiamondCircle:"F1 m 8,4 l -4,4 -4,-4 4,-4 4,4 m 8,0 b 0 360 -4 0 4 z",PlusCircle:"F1 m 8,4 b 0 360 -4 0 4 l -8 0 z m -4 -4 l 0 8",OpenRightTriangleTop:"m 8,0 l 0,4 -8,0 m 0,4",OpenRightTriangleBottom:"m 8,8 l 0,-4 -8,0",Line:"m 0,0 l 0,8",DoubleLine:"m 0,0 l 0,8 m 2,0 l 0,-8",TripleLine:"m 0,0 l 0,8 m 2,0 l 0,-8 m 2,0 l 0,8",PentagonArrow:"F1 m 8,4 l -4,-4 -4,0 0,8 4,0 4,-4 z"};var ie=((L=ie||{})[L.None=0]="None",L[L.Added=1]="Added",L[L.Removed=2]="Removed",L[L.Shown=4]="Shown",L[L.Hidden=8]="Hidden",L[L.NodeSized=16]="NodeSized",L[L.GroupLayout=32]="GroupLayout",L[L.NodeReplaced=64]="NodeReplaced",L[L.Standard=127]="Standard",L[L.All=0xffffff]="All",L);class ii extends eq{k;Wo;J;fl;ul;Jo;ai;$o;Sh;Js;Zo;Cd;XS;ZA;Vp;zp;constructor(t,e){let i;void 0===t||t instanceof eF||"string"==typeof t?i=t:t&&(e=t),super(i),this.k=2408959,this.Wo="",this.J=null,this.fl="",this.ul=null,this.Jo=null,this.ai="",this.$o=null,this.Sh=null,this.Js=new ty(NaN,NaN).u(),this.Zo=null,this.Cd=NaN,this.XS=-1,this.ZA=new tw,this.Vp=null,this.zp=NaN,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.k=-4097&this.k|49152,t.Wo=this.Wo,null!==this.J&&(this.J.gi?t.J=this.J:t.J=this.J.copy()),t.fl=this.fl,t.Jo=null,t.ai=this.ai,t.Js.a(this.Js),t.Cd=this.Cd}Xo(t){super.Xo(t),t.yh(),t.ul=null,t.Zo=null,t.Vp=null}toString(){let t=te.Vn(this.constructor)+"#"+tu.us(this);return null!==this.data&&(t+="("+te.toString(this.data)+")"),t}static LayoutNone=0;static LayoutAdded=1;static LayoutRemoved=2;static LayoutShown=4;static LayoutHidden=8;static LayoutNodeSized=16;static LayoutGroupLayout=32;static LayoutNodeReplaced=64;static LayoutStandard=127;static LayoutAll=0xffffff;Ji(){return null===this.J?this.J=new is:this.J.gi&&(this.J=this.J.copy()),this.J}gh(){super.gh(),null!==this.J&&(this.J.gi=!0)}_c(t,e,i,s,n,l,r){let o=this.diagram;null!==o&&(3===t&&"elements"===e?n instanceof eq?n.$r(t=>{o.partManager.AM(t,o)}):n instanceof e6&&o.IM(n):4===t&&"elements"===e&&(n instanceof eq?n.$r(t=>o.partManager.TM(t,o)):n instanceof e6&&o.EM(n)),o.raiseChangedEvent(t,e,i,s,n,l,r))}updateTargetBindings(t){if(super.updateTargetBindings(t),null===this.data)return;let e=this.T.r,i=e.length;for(let t=0;t<i;t++){let i=e[t];i instanceof eq&&i.$r(t=>{null!==t.data&&t.updateTargetBindings()})}let s=this.adornments;for(;s.next();)s.value.updateTargetBindings(t)}Uo(){if(super.Uo(),this.b2()){let t=this.T.r,e=t.length;for(let i=0;i<e;i++){let e=t[i];e instanceof eq&&e.$r(t=>t.Uo())}}let t=this.adornments;for(;t.next();)t.value.Uo()}updateRelationshipsFromData(){null!==this.data&&this.diagram?.partManager.updateRelationshipsFromData(this)}get key(){let t=this.diagram;if(null!==t)return t.model.getKeyForNodeData(this.data)}get adornments(){return null===this.Jo?tn.instance:this.Jo.iteratorValues}findAdornment(t){let e=this.Jo;return null===e?null:e.get(t)}addAdornment(t,e){if(null===e)return;let i=null,s=this.Jo;if(null!==s&&(i=s.get(t)),i!==e){if(null!==i){let t=i.diagram;null!==t&&t.remove(i)}null===s&&(s=new tp,this.Jo=s),e.Wo!==t&&(e.category=t),s.set(t,e);let n=this.diagram;if(null!==n){n.add(e);let t=e.adornedObject;if(null!==t){let i=t.findBindingPanel();null!==i&&(e.data=i.data)}}}}removeAdornment(t){let e=this.Jo;if(null===e)return;let i=e.get(t);if(null!==i){let t=i.diagram;null!==t&&(t.remove(i),i.data=null)}e.delete(t),0===e.count&&(this.Jo=null)}clearAdornments(){let t=this.Jo;if(null===t)return;let e=te.rt(),i=t.iterator;for(;i.next();){let t=i.key;e.push(t)}let s=e.length;for(let t=0;t<s;t++)this.removeAdornment(e[t]);te.tt(e)}updateAdornments(){let t=this.diagram;if(null===t)return;this.qv(t),this.Wv(t);let e=this.adornments;for(;e.next();){let t=e.value;t.c(),t.hasPlaceholder()&&t.placeholder?.c()}for(e=this.adornments;e.next();)e.value.updateTargetBindings()}invalidateAdornments(){let t=this.diagram;null!==t&&(t.oh(),!0!==this.QA()&&this._A(!0))}YS(){!1!==this.QA()&&(this.updateAdornments(),this._A(!1))}qv(t){let e="Selection";if(this.isSelected&&this.selectionAdorned){let i=this.selectionObject;if(null!==i&&this.actualBounds.isReal()&&this.isVisible()&&i.isVisibleObject()&&i.actualBounds.isReal()){let s=this.findAdornment(e);if(null===s){let e=this.selectionAdornmentTemplate;null===e&&(e=this.Rl()?t.linkSelectionAdornmentTemplate:this instanceof ib?t.groupSelectionAdornmentTemplate:t.nodeSelectionAdornmentTemplate),null!==(s=e.copy())&&(this.Rl()&&this.selectionObject===this.path&&(s.type=eq.Link),s.adornedObject=i)}if(null!==s){s.type===eq.Link&&s.c(),this.addAdornment(e,s);return}}}this.removeAdornment(e)}Wv(t){let e=this;t.toolManager.mouseDownTools.each(t=>{t.isEnabled&&t.updateAdornments(e)}),t.toolManager.updateAdornments(e)}VS(t){this.$o=t,null===t&&this.HR()}get layer(){return this.$o}get diagram(){let t=this.$o;return null==t?null:t.diagram}get layerName(){return this.fl}set layerName(t){let e=this.fl;if(e===t)return;let i=this.diagram;if(null!==i&&(null===i.findLayer(t)||i.partManager.addsToTemporaryLayer))return;this.fl=t,null!==i&&i.invalidateDocumentBounds(),this.t("layerName",e,t);let s=this.layer;if(null===s||s.name===t||null===(i=s.diagram))return;let n=i.findLayer(t);if(null===n||n===s)return;let l=s.se(-1,this,!0);l>=0&&i.raiseChangedEvent(4,"parts",s,this,null,l,!0),l=n._h(0x5f5e0ff,this,!0),s.visible!==n.visible&&this.Vi(n.visible),l>=0&&i.raiseChangedEvent(3,"parts",n,null,this,!0,l);let r=this.layerChanged;if(null===r)return;let o=i.K;i.K=!0,r(this,s,n),i.K=o}get layerChanged(){return null!==this.J?this.J.Xp:null}set layerChanged(t){let e=this.layerChanged;e!==t&&(null!==t&&te.S(t,ii,"layerChanged"),this.Ji().Xp=t,this.t("layerChanged",e,t))}get zOrder(){return this.Cd}set zOrder(t){let e=this.Cd;if(e===t)return;this.Cd=t;let i=this.layer;null!==i&&i.mx(-1,this),this.t("zOrder",e,t);let s=this.diagram;null!==s&&s.C()}Jv(){let t=this.layer;null!==t&&t.mx(-1,this)}l1(){if(!1!==this.lh())return;this.q2(!0),this.sf();let t=this.diagram;null!==t&&(t.o0(this),t.requestUpdate())}tT(){if(this.k|=2097152,!1===this.lh())return;let t=this.position,e=this.location;e.isReal()&&t.isReal()||this.iT(t,e);let i=this.Ai,s=tw.l().a(i);i.At(),i.x=t.x,i.y=t.y,i.u(),this.td(s,i),tw.e(s),this.q2(!1),this.sf()}so(t,e,i,s){let n=this.re;n.i(t,e,i,s),null===this.ki&&(this.ki=new tk);let l=this.ki;l.Ii(),this.x0(l,t,e,i,s),this.ki=l,l.Ik()||l.Ug(n)}x0(t,e,i,s,n){if(1!==this.nt&&t.nt(this.nt),0===this.Ht)return;let l=tv.Center;this.locationSpot.isSpot()&&(l=this.locationSpot);let r=ty.l();if(this.locationObject!==this){let t=this.locationObject,e=t.naturalBounds;r.setSpot(e.x,e.y,e.width,e.height,l),null!==t.ki&&t.ki.xt(r),r.offset(-t.measuredBounds.x,-t.measuredBounds.y);let i=t.panel;for(;null!==i&&i!==this;)null!==i.ki&&i.ki.xt(r),r.offset(-i.measuredBounds.x,-i.measuredBounds.y),i=i.panel}else r.setSpot(e,i,s,n,l);t.ds(this.Ht,r.x,r.y),ty.e(r)}get locationObject(){if(null===this.Zo){if(this instanceof il&&this.type!==eq.Link&&this.hasPlaceholder())this.Zo=this.placeholder;else{let t=this.locationObjectName;if(""!==t){let e=this.findObject(t);null!==e?this.Zo=e:this.Zo=this}else this.Zo=this}}return this.Zo?.visible?this.Zo:this}get minLocation(){return null!==this.J?this.J.Yp:ty.hC}set minLocation(t){let e=this.minLocation;e.equals(t)||(t=t.N(),this.Ji().Yp=t,this.t("minLocation",e,t))}get maxLocation(){return null!==this.J?this.J.Kp:ty.aC}set maxLocation(t){let e=this.maxLocation;e.equals(t)||(t=t.N(),this.Ji().Kp=t,this.t("maxLocation",e,t))}get locationObjectName(){return null!==this.J?this.J.Gp:""}set locationObjectName(t){let e=this.locationObjectName;e!==t&&(this.Ji().Gp=t,this.Zo=null,this.c(),this.t("locationObjectName",e,t))}get locationSpot(){return null!==this.J?this.J.Hp:tv.TopLeft}set locationSpot(t){let e=this.locationSpot;e.equals(t)||(t=t.N(),this.Ji().Hp=t,this.c(),this.t("locationSpot",e,t))}move(t,e){!0===e?this.location=t:this.position=t}moveTo(t,e,i){let s=ty.X(t,e);this.move(s,i),ty.e(s)}isVisible(){if(!this.visible)return!1;let t=this.layer;if(null!==t){if(!t.visible)return!1;let e=t.diagram;if(null!==e&&e.animationManager.ex(this))return!0}let e=this.containingGroup;return!(null!==e&&(!e.isSubGraphExpanded||!e.isVisible()))}Vi(t){let e=this.diagram;t?(this.invalidateLayout(4),this.invalidateAdornments(),null!==e&&e.o0(this)):(this.invalidateLayout(8),this.clearAdornments()),this.yh(),null!==e&&(e.invalidateDocumentBounds(),e.C())}findObject(t){if(this.name===t)return this;let e=this.Vp;if(null===e&&(this.Vp=e=new tp),null!==e.get(t))return e.get(t);let i=super.findObject(t);return null!==i?(e.set(t,i),i):(e.set(t,null),null)}R0(){this.Vp=null}getRelativePoint(t,e,i){void 0===i&&(i=new ty);let s=e.isNoSpot()?tv.Center:e,n=t.naturalBounds;if(i.i(n.width*s.x+s.offsetX,n.height*s.y+s.offsetY),null===t||t===this)return i;t.F.xt(i);let l=t.panel;for(;null!==l&&l!==this;)l.F.xt(i),l=l.panel;return null!==this.ki&&this.ki.xt(i),i.offset(-this.re.x,-this.re.y),i}getDocumentBounds(t){return void 0===t&&(t=new tw),t.a(this.actualBounds)}ensureBounds(){this.ut(1/0,1/0),this.Yt()}TA(t){let e=this.locationSpot,i=this.locationObject,s=i.naturalBounds;s.isReal()||(s=tw.Eg);let n=i instanceof e$?i.strokeWidth:0;if(t.setSpot(0,0,s.width+n,s.height+n,e),i!==this){t.offset(-n/2,-n/2),i.F.xt(t);let e=i.panel;for(;null!==e&&e!==this;)e.F.xt(t),e=e.panel}return null!==this.ki&&this.ki.xt(t),t.offset(-this.re.x,-this.re.y),t}Qh(t,e){let i=void 0===e?this.ZA:e,s=this.$v(),n=2*s;if(!this.isShadowed)return i.i(t.x-1-s,t.y-1-s,t.width+2+n,t.height+2+n),i;let l=t.x,r=t.y,o=t.width,h=t.height,a=this.shadowBlur,u=this.shadowOffset;return o+=a,h+=a,l-=a/2,r-=a/2,u.x>0?o+=u.x:(l+=u.x,o-=u.x),u.y>0?h+=u.y:(r+=u.y,h-=u.y),i.i(l-1,r-1,o+2,h+2),i}Rv(){return this.type===eq.Link&&this instanceof il&&"Selection"===this.category&&this.adornedObject instanceof e$&&this.adornedPart.findMainElement()===this.adornedObject?this.adornedObject.strokeWidth:0}$v(){return isNaN(this.zp)&&(this.zp=this.EA()),this.zp}pf(){this.zp=NaN}Yt(){if(!1===this.es()){this.tT();return}this.no(!1);let t=this.Ai,e=tw.l();e.a(t);let i=this.Fl();this.ph(0,0,this.re.width,this.re.height);let s=this.position;this.iT(s,this.location),t.At(),t.x=s.x,t.y=s.y,t.u(),this.td(e,t),e.equals(t)?this.xs(i):this.Me()&&(!tP.f(e.width,t.width)||!tP.f(e.height,t.height))&&this.XS>=0&&this.invalidateLayout(16),tw.e(e),this.q2(!1)}td(t,e){let i=this.diagram;if(null===i)return;let s=!1;if(!1===i.na&&t.isReal()){let n=tw.l();n.a(i.documentBounds),n.subtractMargin(i.padding),t.x>n.x&&t.y>n.y&&t.right<n.right&&t.bottom<n.bottom&&e.x>n.x&&e.y>n.y&&e.right<n.right&&e.bottom<n.bottom&&(s=!0),tw.e(n)}!0!==this.Zv()&&t.equals(e)||this.UL(s,i),i.C(),!t.isReal()&&!e.isReal()||t.equalsApproxClose(e)||(this instanceof io&&!i.undoManager.isUndoingRedoing&&this.invalidateConnectedLinks(),this.yh())}get location(){return this.Js}set location(t){let e=t.x,i=t.y,s=this.Js;(s.x===e||isNaN(s.x)&&isNaN(e))&&(s.y===i||isNaN(s.y)&&isNaN(i))||(t=t.copy(),this.Qv(t,s)&&this.t("location",s,t.copy()))}Qv(t,e){if(this.Rl())return!1;if(this.Js=t,this.k|=2097152,!1===this.es()){this.l1();let i=this.dt;if(i.isReal()){let s=this.diagram;if(null===s||s.animationManager.isTicking||!s.undoManager.isUndoingRedoing){let n=i.copy();i.i(i.x+(t.x-e.x),i.y+(t.y-e.y)),this.eT(s,i,n.x,n.y),this.t("position",n,i.copy())}}}return!0}m2(t,e,i){if(this.Rl()||!t.isReal())return!1;let s=this.diagram;if(null!==s&&this.eT(s,t,e,i),this.dt=t,this.k&=-2097153,this.Js.isReal()&&(null===s||s.animationManager.isTicking||!s.undoManager.isUndoingRedoing)){let s=this.Js;this.Js=new ty(s.x+(t.x-e),s.y+(t.y-i)),this.t("location",s,this.Js.copy())}return!1===this.lh()&&!1===this.es()&&(this.l1(),this.tT()),!0}eT(t,e,i,s){if(null===t||this instanceof il)return;let n=t.animationManager;n.xi&&n.lL(this,new ty(i,s),e,!1)}Cc(t,e,i){let s=this.Js,n=this.dt;if(i){if(s.x===t&&s.y===e)return;this.lh()||this.es()?n.i(NaN,NaN):n.i(n.x+t-s.x,n.y+e-s.y),s.i(t,e)}else{if(n.x===t&&n.y===e)return;s.i(s.x+t-n.x,s.y+e-n.y),n.i(t,e)}this.l1()}p2(){this.k&=-2097153,this.l1()}iT(t,e){let i=this.TA(ty.l()),s=this.diagram,n=e.isReal(),l=t.isReal();n&&l?2097152&this.k?this.sT(t,e,s,i):this.nT(t,e,s,i):n?this.sT(t,e,s,i):l&&this.nT(t,e,s,i),this.k|=2097152,ty.e(i),this.sf()}sT(t,e,i,s){let n=t.x,l=t.y;if(t.i(e.x-s.x,e.y-s.y),null!==i){let e=i.animationManager,s=e.defaultAnimation.isAnimating;s||!e.xi||this instanceof il||e.lL(this,new ty(n,l),t,!1),s||t.x===n&&t.y===l||this.t("position",new ty(n,l),t.copy())}}nT(t,e,i,s){let n=e.copy();e.i(t.x+s.x,t.y+s.y),e.equals(n)||null===i||this.t("location",n,e.copy())}UL(t,e){this.c2(!1),this instanceof io&&e.YM(this),this.layer.isTemporary||t||e.invalidateDocumentBounds();let i=this.Ai,s=e.viewportBounds;s.isReal()?this.Fl()?(i.intersectsRectPlus(s,10)||this.xs(!1),this.updateAdornments()):this.isVisible()&&i.intersectsRect(s)?(this.xs(!0),this.updateAdornments()):this.invalidateAdornments():e.Xc=!0}Jr(){return!0}Me(){return!0}Rl(){return!1}js(){return!0}hasPlaceholder(){return!1}get category(){return this.Wo}set category(t){let e=this.Wo;if(e===t)return;null!==this.svg&&(this.svg.remove(),this.Ye(!0));let i=this.diagram,s=this.data,n=null;if(null!==i&&null!==s&&!(this instanceof il)){let t=i.model.undoManager;t.isEnabled&&!t.isUndoingRedoing&&(n=this.clone()).T.addAll(this.T)}if(this.Wo=t,this.t("category",e,t),null===i||null===s||this instanceof il){if(this instanceof il){let t=this.adornedPart;if(null!==t){let i=t.Jo;null!==i&&i.delete(e),t.addAdornment(this.category,this)}}}else{let l=i.model;if(l.undoManager.isUndoingRedoing)return;if(this.Rl()){i.partManager.setLinkCategoryForData(s,t);let n=i.partManager.findLinkTemplateForCategory(t);if(null!==n){n.zt();let i=n.copy();null!==i&&this.W2(i,e,t)}}else{null!==l&&l.setCategoryForNodeData(s,t);let n=i.partManager.findTemplateForNodeData(s,t);if(null!==n){n.zt();let i=n.copy();if(null!==i&&!(i instanceof ic)){let s=this.location.copy();this.W2(i,e,t),this.location.isReal()||(this.location=s)}}}if(null!==n){let t=this.clone();t.T.addAll(this.T),this.t("self",n,t)}}}get self(){return this}set self(t){this.W2(t,this.category,t.category)}static oT=!1;W2(t,e,i){t.constructor!==this.constructor&&(ii.oT||(ii.oT=!0,te.li('Should not change the class of the Part when changing category from "'+e+'" to "'+i+'"'),te.li("  Old class: "+te.Vn(this.constructor)+", new class: "+te.Vn(t.constructor)+", part: "+this.toString()))),this.clearAdornments();let s=this.data,n=this.layerName,l=this.isSelected,r=this.isHighlighted,o=!0,h=!0,a=!1;this instanceof io&&(o=this.isTreeLeaf,h=this.isTreeExpanded,a=this.wasTreeExpanded),t.Xo(this),t.cloneProtected(this),this.Wo=i,null!==this.svg&&(this.svg.remove(),this.svg=null,this.Ye(!0)),this.c(),this.C();let u=this.diagram,d=!0;null!==u&&(d=u.skipsUndoManager,u.skipsUndoManager=!0),this.ei=s,this.k=l?4096|this.k:-4097&this.k,this.k=r?524288|this.k:-524289&this.k,this instanceof io&&(this.E=o?4|this.E:-5&this.E,this.E=h?1|this.E:-2&this.E,this.E=a?2|this.E:-3&this.E),null!==s&&this.updateTargetBindings();let c=this.layerName;c!==n&&(this.fl=n,this.layerName=c),null!==u&&(u.skipsUndoManager=d),this.Me()&&this.invalidateLayout(64)}canCopy(){if(!this.copyable)return!1;let t=this.layer;if(null===t)return!0;if(!t.allowCopy)return!1;let e=t.diagram;return null===e||!!e.allowCopy}canDelete(){if(!this.deletable)return!1;let t=this.layer;if(null===t)return!0;if(!t.allowDelete)return!1;let e=t.diagram;return null===e||!!e.allowDelete}canEdit(){if(!this.textEditable)return!1;let t=this.layer;if(null===t)return!0;if(!t.allowTextEdit)return!1;let e=t.diagram;return null===e||!!e.allowTextEdit}canGroup(){if(!this.groupable)return!1;let t=this.layer;if(null===t)return!0;if(!t.allowGroup)return!1;let e=t.diagram;return null===e||!!e.allowGroup}canMove(){if(!this.movable)return!1;let t=this.layer;if(null===t)return!0;if(!t.allowMove)return!1;let e=t.diagram;return null===e||!!e.allowMove}canReshape(){if(!this.reshapable)return!1;let t=this.layer;if(null===t)return!0;if(!t.allowReshape)return!1;let e=t.diagram;return null===e||!!e.allowReshape}canResize(){if(!this.resizable)return!1;let t=this.layer;if(null===t)return!0;if(!t.allowResize)return!1;let e=t.diagram;return null===e||!!e.allowResize}canRotate(){if(!this.rotatable)return!1;let t=this.layer;if(null===t)return!0;if(!t.allowRotate)return!1;let e=t.diagram;return null===e||!!e.allowRotate}canSelect(){if(!this.selectable)return!1;let t=this.layer;if(null===t)return!0;if(!t.allowSelect)return!1;let e=t.diagram;return null===e||!!e.allowSelect}get copyable(){return(1&this.k)!=0}set copyable(t){let e=(1&this.k)!=0;e!==t&&(this.k=1^this.k,this.t("copyable",e,t))}get deletable(){return(2&this.k)!=0}set deletable(t){let e=(2&this.k)!=0;e!==t&&(this.k=2^this.k,this.t("deletable",e,t))}get textEditable(){return(4&this.k)!=0}set textEditable(t){let e=(4&this.k)!=0;e!==t&&(this.k=4^this.k,this.t("textEditable",e,t),this.invalidateAdornments())}get groupable(){return(8&this.k)!=0}set groupable(t){let e=(8&this.k)!=0;e!==t&&(this.k=8^this.k,this.t("groupable",e,t))}get movable(){return(16&this.k)!=0}set movable(t){let e=(16&this.k)!=0;e!==t&&(this.k=16^this.k,this.t("movable",e,t))}get selectionAdorned(){return(32&this.k)!=0}set selectionAdorned(t){let e=(32&this.k)!=0;e!==t&&(this.k=32^this.k,this.t("selectionAdorned",e,t),this.invalidateAdornments())}get isInDocumentBounds(){return(64&this.k)!=0}set isInDocumentBounds(t){let e=(64&this.k)!=0;if(e!==t){this.k=64^this.k;let i=this.diagram;null!==i&&i.invalidateDocumentBounds(),this.t("isInDocumentBounds",e,t)}}get isLayoutPositioned(){return(128&this.k)!=0}set isLayoutPositioned(t){let e=(128&this.k)!=0;e!==t&&(this.k=128^this.k,this.t("isLayoutPositioned",e,t),this.invalidateLayout(t?4:8))}get selectable(){return(256&this.k)!=0}set selectable(t){let e=(256&this.k)!=0;e!==t&&(this.k=256^this.k,this.t("selectable",e,t),this.invalidateAdornments())}get reshapable(){return(512&this.k)!=0}set reshapable(t){let e=(512&this.k)!=0;e!==t&&(this.k=512^this.k,this.t("reshapable",e,t),this.invalidateAdornments())}get resizable(){return(1024&this.k)!=0}set resizable(t){let e=(1024&this.k)!=0;e!==t&&(this.k=1024^this.k,this.t("resizable",e,t),this.invalidateAdornments())}get rotatable(){return(2048&this.k)!=0}set rotatable(t){let e=(2048&this.k)!=0;e!==t&&(this.k=2048^this.k,this.t("rotatable",e,t),this.invalidateAdornments())}get isSelected(){return(4096&this.k)!=0}set isSelected(t){let e=(4096&this.k)!=0;if(e!==t){let i=this.diagram;if(t){if(!this.canSelect())return;if(null!==i){let t=i.maxSelectionCount;if(i.selection.count>=t)return}}this.k=4096^this.k;let s=!1;if(null!==i){s=i.skipsUndoManager,i.skipsUndoManager=!0;let e=i.selection;e.At(),t?e.add(this):e.delete(this),e.u()}this.t("isSelected",e,t),this.invalidateAdornments();let n=this.selectionChanged;null!==n&&n(this),null!==i&&(i.requestUpdate(),i.skipsUndoManager=s)}}get isHighlighted(){return(524288&this.k)!=0}set isHighlighted(t){let e=(524288&this.k)!=0;if(e!==t){this.k=524288^this.k;let i=this.diagram;if(null!==i){let e=i.highlighteds;e.At(),t?e.add(this):e.delete(this),e.u()}this.t("isHighlighted",e,t),this.C();let s=this.highlightedChanged;null!==s&&s(this)}}get isShadowed(){return(8192&this.k)!=0}set isShadowed(t){let e=(8192&this.k)!=0;e!==t&&(this.k=8192^this.k,this.Ye(!0),this.t("isShadowed",e,t),this.C())}QA(){return(16384&this.k)!=0}_A(t){t?this.k|=16384:this.k&=-16385}lh(){return(32768&this.k)!=0}q2(t){t?this.k|=32768:this.k&=-32769}Zv(){return(65536&this.k)!=0}c2(t){t?this.k|=65536:this.k&=-65537}Fl(){return(131072&this.k)!=0}xs(t){t?this.k|=131072:this.k&=-131073}rT(){return(1048576&this.k)!=0}h1(t){t?this.k|=1048576:this.k&=-1048577}get isAnimated(){return(262144&this.k)!=0}set isAnimated(t){let e=(262144&this.k)!=0;e!==t&&(this.k=262144^this.k,this.t("isAnimated",e,t))}get highlightedChanged(){return null!==this.J?this.J.jp:null}set highlightedChanged(t){let e=this.highlightedChanged;e!==t&&(null!==t&&te.S(t,ii,"highlightedChanged"),this.Ji().jp=t,this.t("highlightedChanged",e,t))}get selectionObjectName(){return null!==this.J?this.J.qp:""}set selectionObjectName(t){let e=this.selectionObjectName;e!==t&&(this.Ji().qp=t,this.ul=null,this.t("selectionObjectName",e,t))}get selectionAdornmentTemplate(){return null!==this.J?this.J.Wp:null}set selectionAdornmentTemplate(t){let e=this.selectionAdornmentTemplate;e!==t&&(null!==t&&t.zt(),this.Ji().Wp=t,this.t("selectionAdornmentTemplate",e,t))}get selectionObject(){if(null===this.ul){let t=this.selectionObjectName;if(null!==t&&""!==t){let e=this.findObject(t);null!==e?this.ul=e:this.ul=this}else if(this instanceof ic){let t=this.path;null!==t?this.ul=t:this.ul=this}else this.ul=this}return this.ul}get selectionChanged(){return null!==this.J?this.J.Jp:null}set selectionChanged(t){let e=this.selectionChanged;e!==t&&(null!==t&&te.S(t,ii,"selectionChanged"),this.Ji().Jp=t,this.t("selectionChanged",e,t))}get resizeAdornmentTemplate(){return null!==this.J?this.J.$p:null}set resizeAdornmentTemplate(t){let e=this.resizeAdornmentTemplate;e!==t&&(this.Ji().$p=null!==t?t.zt():null,this.t("resizeAdornmentTemplate",e,t))}get resizeObjectName(){return null!==this.J?this.J.Zp:""}set resizeObjectName(t){let e=this.resizeObjectName;e!==t&&(this.Ji().Zp=t,this.t("resizeObjectName",e,t))}get resizeObject(){let t=this.resizeObjectName;if(""!==t){let e=this.findObject(t);if(null!==e)return e}return this}get resizeCellSize(){return null!==this.J?this.J.Qp:tx.mw}set resizeCellSize(t){let e=this.resizeCellSize;e.equals(t)||(t=t.N(),this.Ji().Qp=t,this.t("resizeCellSize",e,t))}get rotateAdornmentTemplate(){return null!==this.J?this.J._p:null}set rotateAdornmentTemplate(t){let e=this.rotateAdornmentTemplate;e!==t&&(this.Ji()._p=null!==t?t.zt():null,this.t("rotateAdornmentTemplate",e,t))}get rotateObjectName(){return null!==this.J?this.J.ty:""}set rotateObjectName(t){let e=this.rotateObjectName;e!==t&&(this.Ji().ty=t,this.t("rotateObjectName",e,t))}get rotateObject(){let t=this.rotateObjectName;if(""!==t){let e=this.findObject(t);if(null!==e)return e}return this}get rotationSpot(){return null!==this.J?this.J.iy:tv.Default}set rotationSpot(t){let e=this.rotationSpot;e.equals(t)||(t=t.N(),this.Ji().iy=t,this.t("rotationSpot",e,t))}get text(){return this.ai}set text(t){let e=this.ai;e!==t&&(this.ai=t,this.t("text",e,t))}get containingGroup(){return this.Sh}set containingGroup(t){if(this.Me()){let e=this.Sh;if(e!==t){null!==t&&(this===t||t.isMemberOf(this))&&(this===t&&te.o("Cannot make a Group a member of itself: "+this.toString()),te.o("Cannot make a Group indirectly contain itself: "+this.toString()+" already contains "+t.toString())),this.invalidateLayout(2);let i=this.diagram;if(null!==e?e.J2(this):this instanceof ib&&null!==i&&i.qr.delete(this),this.Sh=t,null!==t?t.$2(this):this instanceof ib&&null!==i&&i.qr.add(this),this.invalidateLayout(1),null!==i&&i.K){let e=this.data,s=i.model;if(null!==e&&s.Qc()){let i=null!==t?t.data:null;s.setGroupForData(e,s.getKeyForNodeData(i))}}let s=this.containingGroupChanged;if(null!==s){let n=!0;null!==i&&(n=i.K,i.K=!0),s(this,e,t),null!==i&&(i.K=n)}if(this instanceof ib){let t=new tu;ii.ch(t,this,!0,0,!0);let e=t.iterator;for(;e.next();){let t=e.value;if(t instanceof io){let e=t.linksConnected;for(;e.next();)e.value.Ld()}}}if(this instanceof io){let t=this.linksConnected;for(;t.next();)t.value.Ld();let e=this.labeledLink;null!==e&&e.Ld()}this.t("containingGroup",e,t),null!==t&&t.Jv()}}else te.o("cannot set the Part.containingGroup of a Link or Adornment")}yh(){let t=this.containingGroup;null!==t&&(t.hasPlaceholder()&&t.placeholder?.c(),t.c(),t.invalidateConnectedLinks())}C(){let t=this.diagram;null!==t&&!this.es()&&!this.lh()&&this.isVisible()&&this.Ai.isReal()&&t.C(this.Qh(this.Ai))}c(){if(this.Bo())return;super.c();let t=this.diagram;null!==t&&(t.o0(this),this instanceof io&&null!==this.labeledLink&&this.labeledLink.hf(),t.requestUpdate(!0))}hf(t){if(this.es())return;let e=this.diagram;null!==e&&(e.o0(this),this instanceof io&&this.invalidateConnectedLinks(),e.requestUpdate()),this.no(!0)}Bm(t){if(!t){let t=this.Sh;null!==t&&t.$2(this)}}Um(t){if(!t){let t=this.Sh;null!==t&&t.J2(this)}}qc(){let t=this.data;if(null!==t){let e=this.diagram;if(null!==e){let i=e.model;null!==i&&i.removeNodeData(t)}}}get containingGroupChanged(){return null!==this.J?this.J.ey:null}set containingGroupChanged(t){let e=this.containingGroupChanged;e!==t&&(null!==t&&te.S(t,ii,"containingGroupChanged"),this.Ji().ey=t,this.t("containingGroupChanged",e,t))}findSubGraphLevel(){return this.Z2(this)}Z2(t){let e=t.containingGroup;if(null!==e)return 1+this.Z2(e);if(t instanceof io){let e=t.labeledLink;if(null!==e)return this.Z2(e)}return 0}findTopLevelPart(){return this.Q2(this)}Q2(t){let e=t.containingGroup;if(null!==e)return this.Q2(e);if(t instanceof io){let e=t.labeledLink;if(null!==e)return this.Q2(e)}return t}get isTopLevel(){return!(null!==this.containingGroup||this instanceof io&&null!==this.labeledLink)}isMemberOf(t){return t instanceof ib&&this._2(this,t)}_2(t,e){if(t===e||null===e)return!1;let i=t.containingGroup;if(null!==i&&(i===e||this._2(i,e)))return!0;if(t instanceof io){let i=t.labeledLink;if(null!==i)return this._2(i,e)}return!1}findCommonContainingGroup(t){if(null===t)return null;if(this===t)return this.containingGroup;let e=this;for(;null!==e;){if(e instanceof ib&&e.h1(!0),e instanceof io){let t=e.labeledLink;null!==t&&(e=t)}e=e.containingGroup}let i=null;for(e=t;null!==e;){if(e.rT()){i=e;break}if(e instanceof io){let t=e.labeledLink;null!==t&&(e=t)}e=e.containingGroup}for(e=this;null!==e;){if(e instanceof ib&&e.h1(!1),e instanceof io){let t=e.labeledLink;null!==t&&(e=t)}e=e.containingGroup}return i}get layoutConditions(){return null!==this.J?this.J.sy:127}set layoutConditions(t){let e=this.layoutConditions;e!==t&&(this.Ji().sy=t,this.t("layoutConditions",e,t))}canLayout(){if(!this.isLayoutPositioned||!this.isVisible())return!1;let t=this.layer;return!(null!==t&&t.isTemporary||this instanceof io&&this.isLinkLabel)}_v(t){if(!this.isLayoutPositioned||!(t&this.layoutConditions))return!1;let e=this.layer;if(null!==e&&e.isTemporary||this instanceof io&&this.isLinkLabel)return!1;let i=this.diagram;return!(null!==i&&i.undoManager.isUndoingRedoing)}invalidateLayout(t){if(void 0===t&&(t=0xffffff),!this._v(t))return;let e=this.Sh;if(null!==e){let i=e.layout;null!==i?i.invalidateLayout():e.invalidateLayout(t)}else{let t=this.diagram;if(null!==t){let e=t.layout;null!==e&&e.invalidateLayout()}}}VL(){if(!this.isVisible())return!1;let t=this.layer;return!(null!==t&&t.isTemporary)}static ch(t,e,i,s,n,l){if(void 0===l&&(l=null),!t.has(e)&&!(null!==l&&!l(e))&&!(e instanceof il)){if(t.add(e),e instanceof io){if(i&&e instanceof ib){let r=e.memberParts;for(;r.next();){let e=r.value;ii.ch(t,e,i,s,n,l)}}if(!1!==n){let r=e.linksConnected;for(;r.next();){let e=r.value;if(t.has(e))continue;let o=e.fromNode,h=e.toNode,a=null===o||t.has(o),u=null===h||t.has(h);(n?a&&u:a||u)&&ii.ch(t,e,i,s,n,l)}}if(s>1){let r=e.findTreeChildrenNodes();for(;r.next();){let e=r.value;ii.ch(t,e,i,s-1,n,l)}}}else if(e instanceof ic){let r=e.labelNodes;for(;r.next();){let e=r.value;ii.ch(t,e,i,s,n,l)}}}}get dragComputation(){return null!==this.J?this.J.ny:null}set dragComputation(t){let e=this.dragComputation;e!==t&&(null!==t&&te.S(t,ii,"dragComputation"),this.Ji().ny=t,this.t("dragComputation",e,t))}get shadowOffset(){return null!==this.J?this.J.oy:ty.cC}set shadowOffset(t){let e=this.shadowOffset;e.equals(t)||(t=t.N(),this.Ji().oy=t,this.C(),this.t("shadowOffset",e,t))}get shadowColor(){return null!==this.J?this.J.ry:"gray"}set shadowColor(t){let e=this.shadowColor;e!==t&&(this.Ji().ry=t,this.C(),this.t("shadowColor",e,t))}get shadowBlur(){return null!==this.J?this.J.kn:4}set shadowBlur(t){let e=this.shadowBlur;e!==t&&(this.Ji().kn=t,this.C(),this.t("shadowBlur",e,t))}}class is{gi;Xp;ey;Wp;qp;Jp;jp;$p;Zp;Qp;_p;ty;iy;Gp;Hp;Yp;Kp;ny;sy;oy;ry;kn;constructor(){this.gi=!1,this.Xp=null,this.ey=null,this.Wp=null,this.qp="",this.Jp=null,this.jp=null,this.$p=null,this.Zp="",this.Qp=tx.mw,this._p=null,this.ty="",this.iy=tv.Default,this.Gp="",this.Hp=tv.TopLeft,this.Yp=ty.hC,this.Kp=ty.aC,this.ny=null,this.sy=127,this.oy=ty.cC,this.ry="gray",this.kn=4}copy(){let t=new is;return t.Xp=this.Xp,t.ey=this.ey,t.Wp=this.Wp,t.qp=this.qp,t.Jp=this.Jp,t.jp=this.jp,t.$p=this.$p,t.Zp=this.Zp,t.Qp=this.Qp.N(),t._p=this._p,t.ty=this.ty,t.iy=this.iy.N(),t.Gp=this.Gp,t.Hp=this.Hp.N(),t.Yp=this.Yp.N(),t.Kp=this.Kp.N(),t.ny=this.ny,t.sy=this.sy,t.oy=this.oy.N(),t.ry=this.ry,t.kn=this.kn,t}}class il extends ii{ms;It;ZP;QP;gf;constructor(t,e){let i;void 0===t||t instanceof eF||"string"==typeof t?i=t:t&&(e=t),super(i),this.k&=-257,this.fl="Adornment",this.ms=null,this.ZP=0,this.QP=!1,this.It=null,this.gf=null,e&&Object.assign(this,e)}toString(){let t=this.adornedPart;return"Adornment("+this.category+")"+(null!==t?t.toString():"")}updateRelationshipsFromData(){}hd(t){let e=this.adornedObject;if(!(e instanceof e$))return;let i=e.part;if(!(i instanceof ic))return;let s=i.path,n=s.geometry;i.hd(t),n=s.geometry;let l=this.T.r,r=l.length;for(let t=0;t<r;t++){let e=l[t];e.isPanelMain&&e instanceof e$&&(e.at=n)}}hasPlaceholder(){return null!==this.It&&this.It.isVisibleObject()}get placeholder(){return this.It}get adornedObject(){return this.ms}set adornedObject(t){let e=this.adornedPart,i=null;null!==t&&(i=t.part),null!==e&&(null===t||e!==i)&&e.removeAdornment(this.category),this.ms=t,null!==i&&i.addAdornment(this.category,this)}get adornedPart(){let t=this.ms;return null!==t?t.part:null}Jr(){let t=this.ms;if(null===t)return!0;let e=t.part;return null===e||!e.es()}Me(){return!1}get containingGroup(){return null}_c(t,e,i,s,n,l,r){if(3===t&&"elements"===e){if(n instanceof iv)null===this.It&&(this.It=n);else if(n instanceof eq){let t=n.findInVisualTree(t=>t instanceof iv);t instanceof iv&&null===this.It&&(this.It=t)}}else 4===t&&"elements"===e&&null!==this.It&&(s===this.It?this.It=null:s instanceof eq&&this.It.isContainedBy(s)&&(this.It=null));super._c(t,e,i,s,n,l,r)}updateAdornments(){}qc(){}}var ir=((T=ir||{})[T.None=0]="None",T[T.Evenly=1]="Evenly",T[T.Packed=2]="Packed",T);class io extends ii{E;Et;Lf;dl;Mh;le;si;constructor(t,e){let i;void 0===t||t instanceof eF||"string"==typeof t?i=t:t&&(e=t),super(i),this.E=13,this.Et=null,this.si=new th,this.Lf=null,this.dl=null,this.le=null,this.Mh=!1,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.E=this.E,null!==this.Et&&(this.Et.gi?t.Et=this.Et:t.Et=this.Et.copy())}Xo(t){super.Xo(t),t.invalidateConnectedLinks(),t.dl=this.dl,t.le=null}static SpreadingNone=0;static SpreadingEvenly=1;static SpreadingPacked=2;gl(){return null===this.Et?this.Et=new ih:this.Et.gi&&(this.Et=this.Et.copy()),this.Et}gh(){super.gh(),null!==this.Et&&(this.Et.gi=!0)}lT(t){null!==t&&(null===this.dl&&(this.dl=new tu),this.dl.add(t))}hT(t){null!==t&&null!==this.dl&&this.dl.delete(t)}aT(t,e,i){if(null===t||null===this.dl)return null;let s=this.dl.iterator;for(;s.next();){let n=s.value;if(n.ly===this&&n.a1===t&&n.tN===e&&n.iN===i||n.ly===t&&n.a1===this&&n.tN===i&&n.iN===e)return n}return null}invalidateLinkBundle(t,e,i){null==e&&(e=""),null==i&&(i="");let s=this.aT(t,e,i);null!==s&&s.Ad()}_c(t,e,i,s,n,l,r){3===t&&"elements"===e?this.le=null:4===t&&"elements"===e&&(this.le=null),super._c(t,e,i,s,n,l,r)}invalidateConnectedLinks(t){let e=this.linksConnected;for(;e.next();){let i=e.value;void 0!==t&&t.has(i)||(this.$i(i.fromPort),this.$i(i.toPort),i.invalidateRoute())}}gA(t){let e=this.linksConnected;for(;e.next();){let i=e.value;i.fromPort!==t&&i.toPort!==t||(this.$i(i.fromPort),this.$i(i.toPort),i.invalidateRoute())}}$i(t){if(null===t)return;let e=t.Ju;null!==e&&e.Ad();let i=t.part,s=i.containingGroup;null===s||i.isVisible()||s.$i(s.port)}Jr(){return!0}get portSpreading(){return null!==this.Et?this.Et.hy:1}set portSpreading(t){let e=this.portSpreading;if(e!==t){this.gl().hy=t,this.t("portSpreading",e,t);let i=this.diagram;if(null!==i&&i.undoManager.isUndoingRedoing)return;this.invalidateConnectedLinks()}}get avoidable(){return(8&this.E)!=0}set avoidable(t){let e=(8&this.E)!=0;if(e!==t){this.E=8^this.E;let i=this.diagram;null!==i&&i.YM(this),this.t("avoidable",e,t)}}get avoidableMargin(){return null!==this.Et?this.Et.ay:tb.pC}set avoidableMargin(t){"number"==typeof t&&(t=new tb(t));let e=this.avoidableMargin;if(!e.equals(t)){t=t.N(),this.gl().ay=t;let i=this.diagram;null!==i&&i.YM(this),this.t("avoidableMargin",e,t)}}canAvoid(){return this.avoidable&&!this.isLinkLabel}getAvoidableRect(t){return t.set(this.actualBounds),t.addMargin(this.avoidableMargin),t}findVisibleNode(){let t=this;for(;null!==t&&!t.isVisible();)t=t.containingGroup;return t}isVisible(){if(!super.isVisible())return!1;let t=!0,e=1,i=this.diagram;if(null!==i){if(i.animationManager.ex(this))return!0;t=i.isTreePathToChildren,e=i.treeCollapsePolicy}if(1===e){let t=this.findTreeParentNode();if(null!==t&&!t.isTreeExpanded)return!1}else if(2===e){let e=t?this.findLinksInto():this.findLinksOutOf(),i=!1,s=!1;for(;e.next();){let n=e.value;if(n.isTreeLink){i=!0;let e=t?n.fromNode:n.toNode;if(e&&e.isTreeExpanded){s=!0;break}}}if(i&&!s)return!1}else if(3===e){let e=t?this.findLinksInto():this.findLinksOutOf(),i=!1,s=!1;for(;e.next();){let n=e.value;if(n.isTreeLink){i=!0;let e=t?n.fromNode:n.toNode;if(e&&!e.isTreeExpanded){s=!0;break}}}if(i&&s)return!1}let s=this.labeledLink;return null===s||s.isVisible()}Vi(t){super.Vi(t);let e=this.linksConnected;for(;e.next();){let i=e.value;if(t&&null!==this.containingGroup){let t=i.getOtherNode(this);null===t||t.isMemberOf(this.containingGroup)||i.invalidateRoute()}i.Vi(t)}}get linksConnected(){return this.si.iterator}findExternalTreeLinksConnected(){let t=new tu,e=new tu;return this.cT(this,t,e),e.iterator}cT(t,e,i){if(null===t||e.has(t))return;e.add(t);let s=!0,n=this.diagram;null!==n&&(s=n.isTreePathToChildren),t.linksConnected.each(n=>{n.isTreeLink?(s?n.fromNode===t:n.toNode===t)&&this.cT(s?n.toNode:n.fromNode,e,i):i.add(n)})}findLinksConnected(t){if(void 0===t&&(t=null),null===t)return this.si.iterator;let e=new tr(this.si),i=this;return e.predicate=e=>e.fromNode===i&&e.fromPortId===t||e.toNode===i&&e.toPortId===t,e}findLinksOutOf(t){void 0===t&&(t=null);let e=new tr(this.si),i=this;return e.predicate=e=>e.fromNode===i&&(null===t||e.fromPortId===t),e}findLinksInto(t){void 0===t&&(t=null);let e=new tr(this.si),i=this;return e.predicate=e=>e.toNode===i&&(null===t||e.toPortId===t),e}findNodesConnected(t){void 0===t&&(t=null);let e=null,i=null,s=this.si.iterator;for(;s.next();){let n=s.value;if(n.fromNode===this){if(null===t||n.fromPortId===t){let t=n.toNode;null!==e?e.add(t):null!==i&&i!==t?((e=new tu).add(i),e.add(t)):i=t}}else if(n.toNode===this&&(null===t||n.toPortId===t)){let t=n.fromNode;null!==e?e.add(t):null!==i&&i!==t?((e=new tu).add(i),e.add(t)):i=t}}return null!==e?e.iterator:null!==i?new tl(i):tn.instance}findNodesOutOf(t){void 0===t&&(t=null);let e=null,i=null,s=this.si.iterator;for(;s.next();){let n=s.value;if(n.fromNode===this&&(null===t||n.fromPortId===t)){let t=n.toNode;null!==e?e.add(t):null!==i&&i!==t?((e=new tu).add(i),e.add(t)):i=t}}return null!==e?e.iterator:null!==i?new tl(i):tn.instance}findNodesInto(t){void 0===t&&(t=null);let e=null,i=null,s=this.si.iterator;for(;s.next();){let n=s.value;if(n.toNode===this&&(null===t||n.toPortId===t)){let t=n.fromNode;null!==e?e.add(t):null!==i&&i!==t?((e=new tu).add(i),e.add(t)):i=t}}return null!==e?e.iterator:null!==i?new tl(i):tn.instance}findLinksBetween(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null);let s=new tr(this.si),n=this;return s.predicate=s=>s.fromNode===n&&s.toNode===t&&(null===e||s.fromPortId===e)&&(null===i||s.toPortId===i)||s.fromNode===t&&s.toNode===n&&(null===i||s.fromPortId===i)&&(null===e||s.toPortId===e),s}findLinksTo(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null);let s=new tr(this.si),n=this;return s.predicate=s=>s.fromNode===n&&s.toNode===t&&(null===e||s.fromPortId===e)&&(null===i||s.toPortId===i),s}get linkConnected(){return null!==this.Et?this.Et.cy:null}set linkConnected(t){let e=this.linkConnected;e!==t&&(null!==t&&te.S(t,io,"linkConnected"),this.gl().cy=t,this.t("linkConnected",e,t))}get linkDisconnected(){return null!==this.Et?this.Et.fy:null}set linkDisconnected(t){let e=this.linkDisconnected;e!==t&&(null!==t&&te.S(t,io,"linkDisconnected"),this.gl().fy=t,this.t("linkDisconnected",e,t))}get linkValidation(){return null!==this.Et?this.Et.Dl:null}set linkValidation(t){let e=this.linkValidation;e!==t&&(null!==t&&te.S(t,io,"linkValidation"),this.gl().Dl=t,this.t("linkValidation",e,t))}c1(t,e){this.$i(e);let i=this.si.has(t);if(i||this.si.add(t),!i||t.fromNode===t.toNode){let i=this.linkConnected;if(null!==i){let s=!0,n=this.diagram;null!==n&&(s=n.K,n.K=!0),i(this,t,e),null!==n&&(n.K=s)}}if(!i){if(!t.isTreeLink)return;let e=t.fromNode,i=t.toNode;if(null!==e&&null!==i&&e!==i){let t=!0,s=this.diagram;null!==s&&(t=s.isTreePathToChildren);let n=t?i:e,l=t?e:i;if(n.Mh||(n.Mh=l),l.isTreeLeaf){if(null!==s&&s.undoManager.isUndoingRedoing)return;t?e===l&&(l.isTreeLeaf=!1):i===l&&(l.isTreeLeaf=!1)}}}}f1(t,e){this.$i(e);let i=this.si.delete(t),s=null;if(i||t.toNode===t.fromNode){let i=this.linkDisconnected;if(s=this.diagram,null!==i){let n=!0;null!==s&&(n=s.K,s.K=!0),i(this,t,e),null!==s&&(s.K=n)}}if(i){if(!t.isTreeLink)return;let e=!0;null!==s&&(e=s.isTreePathToChildren);let i=e?t.toNode:t.fromNode,n=e?t.fromNode:t.toNode;if(null!==i&&(i.Mh=!1),null!==n&&!n.isTreeLeaf){if(0===n.si.count){if(n.Mh=null,null!==s&&s.undoManager.isUndoingRedoing)return;n.isTreeLeaf=!0}else n.f0()}}}f0(){if(this.Mh=!1,0===this.si.count)return;let t=!0,e=this.diagram;if(null!==e&&e.undoManager.isUndoingRedoing)return;null!==e&&(t=e.isTreePathToChildren);let i=this.si.iterator;for(;i.next();){let e=i.value;if(e.isTreeLink){if(t){if(e.fromNode===this){this.isTreeLeaf=!1;return}}else if(e.toNode===this){this.isTreeLeaf=!1;return}}}this.isTreeLeaf=!0}updateRelationshipsFromData(){let t=this.diagram;null!==t&&t.partManager.updateRelationshipsFromData(this)}Bm(t){if(super.Bm(t),!t){this.f0();let t=this.Lf;null!==t&&t.fT(this)}}Um(t){if(super.Um(t),!t){let t=this.Lf;null!==t&&t.uT(this)}}qc(){if(this.si.count>0){let t=this.diagram;if(null!==t){let e=null===t.commandHandler||t.commandHandler.deletesConnectedLinks,i=this.si.copy().iterator;for(;i.next();){let s=i.value;e?t.remove(s):(s.fromNode===this&&(s.fromNode=null),s.toNode===this&&(s.toNode=null))}}}this.labeledLink=null,super.qc()}get isLinkLabel(){return null!==this.Lf}get labeledLink(){return this.Lf}set labeledLink(t){let e=this.Lf;if(e!==t){let i=this.diagram,s=this.data;if(null!==e){if(e.uT(this),null!==i&&null!==s&&!i.undoManager.isUndoingRedoing){let t=e.data,n=i.model;if(null!==t&&n.Ba()){let e=n.getKeyForNodeData(s);void 0!==e&&n.removeLabelKeyForLinkData(t,e)}}this.containingGroup=null}if(this.Lf=t,null!==t){if(t.fT(this),null!==i&&null!==s&&!i.undoManager.isUndoingRedoing){let e=t.data,n=i.model;if(null!==e&&n.Ba()){let t=n.getKeyForNodeData(s);void 0!==t&&n.addLabelKeyForLinkData(e,t)}}this.containingGroup=t.containingGroup}this.hf(),this.t("labeledLink",e,t)}}findVisiblePort(t){let e=t;for(;null!==e&&(!e.actualBounds.isReal()||!e.isVisibleObject());)e=e.panel;return null===e?this.port:e}findPort(t){if(null===this.le){if(""===t&&!1===this.bn)return this;this.dT()}let e=this.le.get(t);return null!==e||""!==t&&null!==(e=this.le.get(""))?e:this}get port(){return this.findPort("")}get ports(){return null===this.le&&this.dT(),this.le.iteratorValues}dT(){null===this.le?this.le=new tp:this.le.clear(),this.walkVisualTreeFrom(this,(t,e)=>t.kA(e)),0===this.le.count&&this.le.set("",this)}kA(t){let e=t.portId;null!==e&&null!==this.le&&this.le.set(e,t)}w2(t,e){let i=t.portId;if(null!==i){null!==this.le&&this.le.delete(i);let t=this.diagram;if(null!==t&&e){let e=null,s=this.findLinksConnected(i);for(;s.next();){let t=s.value;null===e&&(e=te.rt()),e.push(t)}if(null!==e){for(let i=0;i<e.length;i++){let s=e[i];t.remove(s)}te.tt(e)}}}}isInTreeOf(t){let e;if(null===t||t===this)return!1;let i=!0,s=this.diagram;null!==s&&(i=s.isTreePathToChildren);let n=this;if(i)for(;n!==t;){e=null;let t=n.si.iterator;for(;t.next();){let i=t.value;if(i.isTreeLink&&(e=i.fromNode)!==n&&e!==this)break}if(e===this||null===e||e===n)return!1;n=e}else for(;n!==t;){e=null;let t=n.si.iterator;for(;t.next();){let i=t.value;if(i.isTreeLink&&(e=i.toNode)!==n&&e!==this)break}if(e===this||null===e||e===n)return!1;n=e}return!0}findTreeRoot(){let t=!0,e=this.diagram;null!==e&&(t=e.isTreePathToChildren);let i=this,s;if(t)for(;;){s=null;let t=i.si.iterator;for(;t.next();){let e=t.value;if(e.isTreeLink&&(s=e.fromNode)!==i&&s!==this)break}if(s===this)return this;if(null===s||s===i)return i;i=s}else for(;;){s=null;let t=i.si.iterator;for(;t.next();){let e=t.value;if(e.isTreeLink&&(s=e.toNode)!==i&&s!==this)break}if(s===this)return this;if(null===s||s===i)return i;i=s}}findCommonTreeParent(t){if(null===t)return null;if(this===t)return this;let e=this;for(;null!==e;)e.h1(!0),e=e.findTreeParentNode();let i=null;for(e=t;null!==e;){if(e.rT()){i=e;break}e=e.findTreeParentNode()}for(e=this;null!==e;)e.h1(!1),e=e.findTreeParentNode();return i}findTreeParentLink(){let t=!0,e=this.diagram;null!==e&&(t=e.isTreePathToChildren);let i=this.si.iterator;if(t)for(;i.next();){let t=i.value;if(t.isTreeLink&&t.fromNode!==this)return t}else for(;i.next();){let t=i.value;if(t.isTreeLink&&t.toNode!==this)return t}return null}findTreeParentNode(){let t=this.Mh;if(null===t)return null;if(t instanceof io)return t;let e=this.diagram,i=null===e||e.isTreePathToChildren,s=this.si.iterator;for(;s.next();){let t=s.value;if(!t.isTreeLink)continue;let e=i?t.fromNode:t.toNode;if(e!==this)return this.Mh=e,e}return this.Mh=null,null}findTreeParentChain(){let t=new tu;return function t(e,i){i.add(e);let s=e.findTreeParentLink();if(null!==s){i.add(s);let n=e.findTreeParentNode();if(null===n)return;t(n,i)}}(this,t),t}findTreeLevel(){return this.tO(this)}tO(t){let e=0,i=t.findTreeParentNode();for(;null!==i&&i!==t;)i=i.findTreeParentNode(),e++;return e}findTreeChildrenLinks(){let t=!0,e=this.diagram;null!==e&&(t=e.isTreePathToChildren);let i=new tr(this.si),s=this;return t?i.predicate=t=>!(!t.isTreeLink||t.fromNode!==s):i.predicate=t=>!(!t.isTreeLink||t.toNode!==s),i}findTreeChildrenNodes(){let t=!0,e=this.diagram;null!==e&&(t=e.isTreePathToChildren);let i=null,s=null,n=this.si.iterator;if(t)for(;n.next();){let t=n.value;if(t.isTreeLink&&t.fromNode===this){let e=t.toNode;null!==i?i.add(e):null!==s&&s!==e?((i=new th).add(s),i.add(e)):s=e}}else for(;n.next();){let t=n.value;if(t.isTreeLink&&t.toNode===this){let e=t.fromNode;null!==i?i.add(e):null!==s&&s!==e?((i=new th).add(s),i.add(e)):s=e}}return null!==i?i.iterator:null!==s?new tl(s):tn.instance}findTreeParts(t){void 0===t&&(t=1/0),te.s(t,"number",io,"findTreeParts:level");let e=new tu;return ii.ch(e,this,!1,t,!0),e}collapseTree(t){void 0===t&&(t=1),t<1&&(t=1);let e=this.diagram;if(null===e||e.isCollapsingExpanding)return;e.isCollapsingExpanding=!0;let i=new tu;i.add(this),this.gT(i,e.isTreePathToChildren,t,e,this,1===e.treeCollapsePolicy),e.isCollapsingExpanding=!1}gT(t,e,i,s,n,l){if(i>1){let r=e?this.findLinksOutOf():this.findLinksInto();for(;r.next();){let o=r.value;if(!o.isTreeLink)continue;let h=o.getOtherNode(this);null===h||h===this||t.has(h)||(t.add(h),h.gT(t,e,i-1,s,n,l))}}else this.mT(t,e,s,n,l)}mT(t,e,i,s,n){let l=s===this||this.isTreeExpanded,r=e?this.findLinksOutOf():this.findLinksInto();for(;r.next();){let o=r.value;if(!o.isTreeLink)continue;let h=o.getOtherNode(this);if(null!==h&&h!==this){let r=t.has(h);if(r||t.add(h),l){let t=e?h.findNodesInto():h.findNodesOutOf(),n=this;t.all(t=>t===n||!t.isTreeExpanded)&&i.vc(h,s),h.yh(),h.Vi(!1)}h.isTreeExpanded&&(h.wasTreeExpanded=h.isTreeExpanded,r||h.mT(t,e,i,s,n))}}this.isTreeExpanded=!1}expandTree(t){void 0===t&&(t=2),t<2&&(t=2);let e=this.diagram;if(null===e||e.isCollapsingExpanding)return;e.isCollapsingExpanding=!0;let i=new tu;i.add(this),this.pT(i,e.isTreePathToChildren,t,e,this,1===e.treeCollapsePolicy),e.isCollapsingExpanding=!1}pT(t,e,i,s,n,l){let r=n!==this&&this.isTreeExpanded,o=e?this.findLinksOutOf():this.findLinksInto();for(;o.next();){let h=o.value;if(!h.isTreeLink)continue;r||h.Ce||h.invalidateRoute();let a=h.getOtherNode(this);if(null!==a&&a!==this&&!t.has(a)){if(t.add(a),!r){a.Vi(!0),a.yh();let t=e?a.findNodesInto():a.findNodesOutOf(),i=this;t.all(t=>t===i||!t.isTreeExpanded)&&s.Rc(a,n)}(i>2||a.wasTreeExpanded)&&(a.wasTreeExpanded=!1,a.pT(t,e,i-1,s,n,l))}}this.isTreeExpanded=!0}get isTreeExpanded(){return(1&this.E)!=0}set isTreeExpanded(t){let e=(1&this.E)!=0;if(e!==t){this.E=1^this.E;let i=this.diagram;this.t("isTreeExpanded",e,t);let s=this.treeExpandedChanged;if(null!==s){let t=!0;null!==i&&(t=i.K,i.K=!0),s(this),null!==i&&(i.K=t)}if(null!==i&&i.undoManager.isUndoingRedoing){this.Vi(t);return}t?this.expandTree():this.collapseTree()}}get wasTreeExpanded(){return(2&this.E)!=0}set wasTreeExpanded(t){let e=(2&this.E)!=0;e!==t&&(this.E=2^this.E,this.t("wasTreeExpanded",e,t))}get treeExpandedChanged(){return null!==this.Et?this.Et.uy:null}set treeExpandedChanged(t){let e=this.treeExpandedChanged;e!==t&&(null!==t&&te.S(t,io,"treeExpandedChanged"),this.gl().uy=t,this.t("treeExpandedChanged",e,t))}get isTreeLeaf(){return(4&this.E)!=0}set isTreeLeaf(t){let e=(4&this.E)!=0;e!==t&&(this.E=4^this.E,this.t("isTreeLeaf",e,t))}get isTreeRoot(){return null===this.findTreeParentLink()}}class ih{gi;cy;fy;Dl;uy;ay;hy;gy;my;ah;py;constructor(){this.gi=!1,this.cy=null,this.fy=null,this.Dl=null,this.uy=null,this.ay=tb.pC,this.hy=1,this.gy=null,this.my=null,this.ah=null,this.py=null}copy(){let t=new ih;return t.cy=this.cy,t.fy=this.fy,t.Dl=this.Dl,t.uy=this.uy,t.ay=this.ay.N(),t.hy=this.hy,t.gy=this.gy,t.my=this.my,t.ah=this.ah,t.py=this.py,t}}var ia=((A=ia||{})[A.None=0]="None",A[A.End=17]="End",A[A.Scale=18]="Scale",A[A.Stretch=19]="Stretch",A),iu=((D=iu||{})[D.Normal=1]="Normal",D[D.Orthogonal=2]="Orthogonal",D[D.AvoidsNodes=6]="AvoidsNodes",D[D.AvoidsNodesStraight=7]="AvoidsNodesStraight",D),id=((F=id||{})[F.None=0]="None",F[F.Bezier=9]="Bezier",F[F.JumpGap=10]="JumpGap",F[F.JumpOver=11]="JumpOver",F);class ic extends ii{Lt;fo;uo;Td;go;mo;Dd;Af;Fd;Rd;vd;Ua;Od;$s;Pi;ml;Lr;Tf;Qo;eN;sN;u1;nN;oN;Va;d1;at;_o;static za=null;static Xa=null;gf;rN;lN;constructor(t){super(eq.Link),this.Lt=8,this.fo=null,this.uo="",this.Td=null,this.go=null,this.mo="",this.Dd=null,this.Af=0,this.Fd=0,this.Rd=0,this.vd=NaN,this.Ua=1,this.Od=.5,this.$s=null,this.Pi=new th().u(),this.ml=null,this.Lr=null,this.Tf=new tw,this.at=new tN,this.Qo=null,this._o=null,this.eN=null,this.sN=null,this.rN=0,this.lN=0,this.u1=new ty,this.nN=null,this.oN=null,this.Va=null,this.d1=NaN,this.gt=null,this.gf=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Lt=-113&this.Lt,t.uo=this.uo,t.Td=this.Td,t.mo=this.mo,t.Dd=this.Dd,t.Af=this.Af,t.Fd=this.Fd,t.Rd=this.Rd,t.vd=this.vd,t.Ua=this.Ua,t.Od=this.Od,null!==this.gt&&(t.gt=this.gt.copy())}Xo(t){super.Xo(t),this.uo=t.uo,this.mo=t.mo,t.ml=null,t.invalidateRoute(),t._o=this._o;let e=t.fromPort;null!==e&&t.fromNode.$i(e);let i=t.toPort;null!==i&&t.toNode.$i(i)}hi(t){t in iu||t in id||t in ia?ic.hN(t)?this.routing=t:9===t||10===t||11===t?this.curve=t:17===t||18===t||19===t?this.adjusting=t:1===t||0===t||te.o("Unknown Link enum value for a Link property: "+t):super.hi(t)}static Normal=1;static Orthogonal=2;static AvoidsNodes=6;static AvoidsNodesStraight=7;static None=0;static Bezier=9;static JumpGap=10;static JumpOver=11;static End=17;static Scale=18;static Stretch=19;static OrientAlong=21;static OrientPlus90=22;static OrientMinus90=23;static OrientOpposite=24;static OrientUpright=25;static OrientPlus90Upright=26;static OrientMinus90Upright=27;static OrientUpright45=28;static iO=8;static eO=16;static sO=14;static Ya=8;Xe(){return null===this.gt&&(this.gt=new ix),this.gt}dv(t,e,i){let s=t.segmentIndex,n=t.segmentFraction,l=t.alignmentFocus,r=t.segmentOrientation,o=t.segmentOffset,h=0,a=0,u=0,d=0;if(isNaN(s)){let e=this.at,i=te.rt();e.getPointAndAngleAlongPath(n,i);let s=ty.X(i[0],i[1]);if(s.add(this.getPoint(0)),1===e.type)s.offset(-e.startX,-e.startY);else{let t=e.figures.first();s.offset(-t.startX,-t.startY)}d=i[2],0!==r&&(u=this.computeAngle(t,r,d),t.angle=u),h=s.x,a=s.y,ty.e(s),te.tt(i)}else if(s<-e||s>=e){let e=ty.l();this.AA(e),d=this.midAngle,0!==r&&(u=this.computeAngle(t,r,d),t.angle=u),h=e.x,a=e.y,ty.e(e)}else{let l,o,c=0;if(s>=0?(l=i.r[s],o=s<e-1?i.r[s+1]:l):(c=e+s,l=i.r[c],o=c>0?i.r[c-1]:l),l.equalsApprox(o)){let t,n;s>=0?(t=s>0?i.r[s-1]:l,n=s<e-2?i.r[s+2]:o):(t=c<e-1?i.r[c+1]:l,n=c>1?i.r[c-2]:o);let r=t.distanceSquaredPoint(l),h=o.distanceSquaredPoint(n);d=r>h+10?s>=0?t.directionPoint(l):l.directionPoint(t):h>r+10?s>=0?o.directionPoint(n):n.directionPoint(o):s>=0?t.directionPoint(n):n.directionPoint(t)}else d=s>=0?l.directionPoint(o):o.directionPoint(l);0!==r&&(u=this.computeAngle(t,r,d),t.angle=u),h=l.x+(o.x-l.x)*n,a=l.y+(o.y-l.y)*n}if(l.isNone()){t.location=new ty(h,a);return}l.isNoSpot()&&(l=tv.Center);let c=tk.l();c.Ii(),c.nt(t.scale,t.scale),c.ds(t.angle,0,0);let g=t.naturalBounds,f=tw.X(0,0,g.width,g.height),m=ty.l();m.setRectSpot(f,l),c.xt(m);let p=-m.x,y=-m.y,x=g.width,w=g.height,b=ty.l();b.a(o);let v=isNaN(o.x),k=isNaN(o.y);if(v||k){let t=x/2+3,e=w/2+3,i=d>=45&&d<=135,l=d>=225&&d<=315;0===r&&(i||l)?(b.x=k?t:o.y,b.y=v?e:o.x,i?s>=0||isNaN(s)&&n<.5||v&&(b.y=-e):l&&((s>=0||isNaN(s)&&n<.5)&&v&&(b.y=-e),k&&(b.x=-t))):(v&&(s>=0||isNaN(s)&&n<.5?b.x=t:b.x=-t),k&&(b.y=-e),b.rotate(d))}else b.rotate(d);h+=b.x,a+=b.y,c.Ug(f),p+=f.x,y+=f.y;let P=ty.X(h+p,a+y);t.move(P),ty.e(P),ty.e(b),ty.e(m),tw.e(f),tk.e(c)}Jr(){let t=this.fromNode;if(null!==t){let e=t.findVisibleNode();if(null!==e&&(t=e),t.es()||t.lh())return!1}let e=this.toNode;if(null!==e){let t=e.findVisibleNode();if(null!==t&&(e=t),e.es()||e.lh())return!1}return!0}m2(t,e,i){return!1}p2(){}Me(){return!1}computeAngle(t,e,i){return ic.computeAngle(e,i)}static computeAngle(t,e){let i=0;switch(t){default:case 0:i=0;break;case 21:i=e;break;case 22:i=e+90;break;case 23:i=e-90;break;case 24:i=e+180;break;case 25:(i=tP.Yg(e))>90&&i<270&&(i-=180);break;case 26:(i=tP.Yg(e+90))>90&&i<270&&(i-=180);break;case 27:(i=tP.Yg(e-90))>90&&i<270&&(i-=180);break;case 28:if((i=tP.Yg(e))>45&&i<135||i>225&&i<315)return 0;i>90&&i<270&&(i-=180)}return tP.Yg(i)}get fromNode(){return this.fo}set fromNode(t){let e=this.fo;if(e!==t){let i=this.fromPort;null!==e&&(this.go!==e&&e.f1(this,i),this.yy(),this.invalidateLayout(2)),this.fo=t,null!==t&&this.Vi(t.isVisible()),this.Qo=null,this.invalidateRoute();let s=this.diagram;null!==s&&s.K&&s.partManager.setFromNodeForLink(this,t,e);let n=this.fromPort,l=this.fromPortChanged;if(null!==l){let t=!0;null!==s&&(t=s.K,s.K=!0),l(this,i,n),null!==s&&(s.K=t)}null!==t&&(this.go!==t&&t.c1(this,n),this.wy(),this.invalidateLayout(1)),this.t("fromNode",e,t),this.Ld()}}get fromPortId(){return this.uo}set fromPortId(t){let e=this.uo;if(e!==t){let i=this.fromPort;null!==i&&this.fromNode?.$i(i),this.yy(),this.uo=t;let s=this.fromPort;null!==s&&this.fromNode?.$i(s);let n=this.diagram;if(null!==n){let e=this.data,i=n.model;null!==e&&i.Ba()&&i.setFromPortIdForLinkData(e,t)}if(i!==s){this.Qo=null,this.invalidateRoute();let t=this.fromPortChanged;if(null!==t){let e=!0;null!==n&&(e=n.K,n.K=!0),t(this,i,s),null!==n&&(n.K=e)}}this.wy(),this.t("fromPortId",e,t)}}get fromPort(){let t=this.fo;if(null===t)return null;let e=this.uo;return t.findPort(e)}get fromPortChanged(){return this.Td}set fromPortChanged(t){let e=this.Td;e!==t&&(null!==t&&te.S(t,ic,"fromPortChanged"),this.Td=t,this.t("fromPortChanged",e,t))}get toNode(){return this.go}set toNode(t){let e=this.go;if(e!==t){let i=this.toPort;null!==e&&(this.fo!==e&&e.f1(this,i),this.yy(),this.invalidateLayout(2)),this.go=t,null!==t&&this.Vi(t.isVisible()),this.Qo=null,this.invalidateRoute();let s=this.diagram;null!==s&&s.K&&s.partManager.setToNodeForLink(this,t,e);let n=this.toPort,l=this.toPortChanged;if(null!==l){let t=!0;null!==s&&(t=s.K,s.K=!0),l(this,i,n),null!==s&&(s.K=t)}null!==t&&(this.fo!==t&&t.c1(this,n),this.wy(),this.invalidateLayout(1)),this.t("toNode",e,t),this.Ld()}}get toPortId(){return this.mo}set toPortId(t){let e=this.mo;if(e!==t){let i=this.toPort;null!==i&&this.toNode?.$i(i),this.yy(),this.mo=t;let s=this.toPort;null!==s&&this.toNode?.$i(s);let n=this.diagram;if(null!==n){let e=this.data,i=n.model;null!==e&&i.Ba()&&i.setToPortIdForLinkData(e,t)}if(i!==s){this.Qo=null,this.invalidateRoute();let t=this.toPortChanged;if(null!==t){let e=!0;null!==n&&(e=n.K,n.K=!0),t(this,i,s),null!==n&&(n.K=e)}}this.wy(),this.t("toPortId",e,t)}}get toPort(){let t=this.go;if(null===t)return null;let e=this.mo;return t.findPort(e)}get toPortChanged(){return this.Dd}set toPortChanged(t){let e=this.Dd;e!==t&&(null!==t&&te.S(t,ic,"toPortChanged"),this.Dd=t,this.t("toPortChanged",e,t))}get fromSpot(){return null!==this.gt?this.gt.xa:tv.Default}set fromSpot(t){let e=this.fromSpot;if(!e.equals(t)){if(t=t.N(),this.Xe().xa=t,this.t("fromSpot",e,t),e.isSide()||t.isSide()){let t=this.fromNode;null!==t&&t.$i(this.fromPort)}this.invalidateRoute()}}get fromEndSegmentLength(){return null!==this.gt?this.gt.ka:NaN}set fromEndSegmentLength(t){let e=this.fromEndSegmentLength;if(e!==t){if(t<0&&te._(t,">= 0",ic,"fromEndSegmentLength"),this.Xe().ka=t,this.t("fromEndSegmentLength",e,t),this.computeSpot(!0,this.fromPort).isSide()){let t=this.fromNode;null!==t&&t.$i(this.fromPort)}this.invalidateRoute()}}get fromShortLength(){return null!==this.gt?this.gt.Sa:NaN}set fromShortLength(t){let e=this.fromShortLength;e!==t&&(this.Xe().Sa=t,this.oe(),this.t("fromShortLength",e,t))}get toSpot(){return null!==this.gt?this.gt.ba:tv.Default}set toSpot(t){let e=this.toSpot;if(!e.equals(t)){if(t=t.N(),this.Xe().ba=t,this.t("toSpot",e,t),e.isSide()||t.isSide()){let t=this.toNode;null!==t&&t.$i(this.toPort)}this.invalidateRoute()}}get toEndSegmentLength(){return null!==this.gt?this.gt.Pa:NaN}set toEndSegmentLength(t){let e=this.toEndSegmentLength;if(e!==t){if(t<0&&te._(t,">= 0",ic,"toEndSegmentLength"),this.Xe().Pa=t,this.t("toEndSegmentLength",e,t),this.computeSpot(!1,this.toPort).isSide()){let t=this.toNode;null!==t&&t.$i(this.toPort)}this.invalidateRoute()}}get toShortLength(){return null!==this.gt?this.gt.Ma:NaN}set toShortLength(t){let e=this.toShortLength;e!==t&&(this.Xe().Ma=t,this.oe(),this.t("toShortLength",e,t))}Ld(){let t=this.fromNode,e=this.toNode,i=null;if(i=null!==t?null!==e?t.findCommonContainingGroup(e):t.containingGroup:null!==e?e.containingGroup:null,this.nO(i),this.isLabeledLink){let t=this.labelNodes;for(;t.next();)t.value.containingGroup=i}}nO(t){let e=this.Sh;if(e!==t){null!==e&&e.J2(this),this.Sh=t,null!==t&&t.$2(this);let i=this.containingGroupChanged;if(null!==i){let s=!0,n=this.diagram;null!==n&&(s=n.K,n.K=!0),i(this,e,t),null!==n&&(n.K=s)}this.Ce&&(this.nN===e||this.oN===e)&&this.invalidateRoute()}}yh(){let t=this.containingGroup;null!==t&&this.fromNode!==t&&this.toNode!==t&&t.computesBoundsIncludingLinks&&super.yh()}getOtherNode(t){let e=this.fromNode;return t===e?this.toNode:e}getOtherPort(t){let e=this.fromPort;return t===e?this.toPort:e}get isLabeledLink(){return null!==this.$s&&this.$s.count>0}get labelNodes(){return null===this.$s?tn.instance:this.$s.iterator}fT(t){null===this.$s&&(this.$s=new tu),this.$s.add(t),this.c()}uT(t){null!==this.$s&&(this.$s.delete(t),this.c())}Bm(t){if(super.Bm(t),this.Ka()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){let t=this.fo,e=null;null!==t&&(e=this.fromPort,t.c1(this,e));let i=this.go,s=null;null!==i&&(s=this.toPort,(i!==t||s!==e)&&i.c1(this,s)),this.wy()}}Um(t){if(super.Um(t),this.Ka()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){let t=this.fo,e=null;null!==t&&(e=this.fromPort,t.f1(this,e));let i=this.go,s=null;null!==i&&(s=this.toPort,(i!==t||s!==e)&&i.f1(this,s)),this.yy()}}qc(){if(this.Ce=!0,null!==this.$s){let t=this.diagram;if(null!==t){let e=this.$s.copy().iterator;for(;e.next();){let i=e.value;t.remove(i)}}}if(null!==this.data){let t=this.diagram;null!==t&&t.partManager.aN(this)}}updateRelationshipsFromData(){if(null===this.data)return;let t=this.diagram;null!==t&&t.partManager.updateRelationshipsFromData(this)}move(t,e){let i=e?this.location:this.position,s=i.x;isNaN(s)&&(s=0);let n=i.y;isNaN(n)&&(n=0);let l=t.x-s,r=t.y-n;if(!0===e)super.move(t,!1);else{let t=ty.X(i.x+l,i.y+r);super.move(t,!1),ty.e(t)}this.xr(l,r);let o=this.labelNodes;for(;o.next();){let t=o.value,e=t.position;t.moveTo(e.x+l,e.y+r)}}get relinkableFrom(){return(1&this.Lt)!=0}set relinkableFrom(t){let e=(1&this.Lt)!=0;e!==t&&(this.Lt=1^this.Lt,this.t("relinkableFrom",e,t),this.invalidateAdornments())}get relinkableTo(){return(2&this.Lt)!=0}set relinkableTo(t){let e=(2&this.Lt)!=0;e!==t&&(this.Lt=2^this.Lt,this.t("relinkableTo",e,t),this.invalidateAdornments())}canRelinkFrom(){if(!this.relinkableFrom)return!1;let t=this.layer;if(null===t)return!0;if(!t.allowRelink)return!1;let e=t.diagram;return!(null!==e&&!e.allowRelink)}canRelinkTo(){if(!this.relinkableTo)return!1;let t=this.layer;if(null===t)return!0;if(!t.allowRelink)return!1;let e=t.diagram;return!(null!==e&&!e.allowRelink)}get resegmentable(){return(4&this.Lt)!=0}set resegmentable(t){let e=(4&this.Lt)!=0;e!==t&&(this.Lt=4^this.Lt,this.t("resegmentable",e,t),this.invalidateAdornments())}get isTreeLink(){return(8&this.Lt)!=0}set isTreeLink(t){let e=(8&this.Lt)!=0;e!==t&&(this.Lt=8^this.Lt,this.t("isTreeLink",e,t),null!==this.fromNode&&this.fromNode.f0(),null!==this.toNode&&this.toNode.f0())}get path(){let t=this.findMainElement();return t instanceof e$?t:null}get routeBounds(){return this.updateRoute(),this.oO(this.Tf)}oO(t){let e=1/0,i=1/0,s=this.pointsCount;if(0===s)return t.i(NaN,NaN,0,0),t;if(1===s){let s=this.getPoint(0);e=Math.min(s.x,e),i=Math.min(s.y,i),t.i(s.x,s.y,0,0)}else if(2===s){let s=this.getPoint(0),n=this.getPoint(1);e=Math.min(s.x,n.x),i=Math.min(s.y,n.y),t.i(s.x,s.y,0,0),t.unionPoint(n)}else if(9===this.computeCurve()&&s>=3&&!this.isOrthogonal){let n=this.getPoint(0);if(e=n.x,i=n.y,t.i(e,i,0,0),3===s){let s=this.getPoint(1);e=Math.min(s.x,e),i=Math.min(s.y,i);let l=this.getPoint(2);e=Math.min(l.x,e),i=Math.min(l.y,i),tP.fu(n.x,n.y,s.x,s.y,s.x,s.y,l.x,l.y,.5,t)}else for(let l=3;l<s;l+=3){let r=this.getPoint(l-2);l+3>=s&&(l=s-1);let o=this.getPoint(l-1),h=this.getPoint(l);tP.fu(n.x,n.y,r.x,r.y,o.x,o.y,h.x,h.y,.5,t),e=Math.min(h.x,e),i=Math.min(h.y,i),n=h}}else{let n=this.getPoint(0),l=this.getPoint(1);e=Math.min(n.x,l.x),i=Math.min(n.y,l.y),t.i(n.x,n.y,0,0),t.unionPoint(l);for(let n=2;n<s;n++){let s=this.getPoint(n);e=Math.min(s.x,e),i=Math.min(s.y,i),t.unionPoint(s)}}return this.u1.i(e-t.x,i-t.y),t}get midPoint(){return this.updateRoute(),this.computeMidPoint(new ty)}AA(t){return this.updateRoute(),this.computeMidPoint(t)}computeMidPoint(t){let e=this.pointsCount;if(0===e)return t.a(ty.Ak),t;if(1===e)return t.a(this.getPoint(0)),t;if(2===e){let e=this.getPoint(0),i=this.getPoint(1);return t.i((e.x+i.x)/2,(e.y+i.y)/2),t}if(this.isOrthogonal&&(this.computeCorner()>=15||9===this.computeCurve())){this.at.getPointAlongPath(.5,t),t.add(this.getPoint(0));let e=this.at.figures.first();return t.offset(-e.startX,-e.startY),t}if(9===this.computeCurve()){if(3===e){let e=this.getPoint(0),i=this.getPoint(1),s=this.getPoint(2);return tP.PC(e.x,e.y,i.x,i.y,i.x,i.y,s.x,s.y,t),t}let i=(e-1)/3|0,s=(i/2|0)*3;if(i%2!=1)return t.a(this.getPoint(s)),t;{let e=this.getPoint(s),i=this.getPoint(s+1),n=this.getPoint(s+2),l=this.getPoint(s+3);return tP.PC(e.x,e.y,i.x,i.y,n.x,n.y,l.x,l.y,t),t}}let i=this.flattenedLengths,s=this.flattenedTotalLength,n=0,l=0,r=0;for(;n<s/2&&l<e&&!(n+(r=i[l])>s/2);)n+=r,l++;let o=this.getPoint(l),h=this.getPoint(l+1);if(1>Math.abs(o.x-h.x))o.y>h.y?t.i(o.x,o.y-(s/2-n)):t.i(o.x,o.y+(s/2-n));else if(1>Math.abs(o.y-h.y))o.x>h.x?t.i(o.x-(s/2-n),o.y):t.i(o.x+(s/2-n),o.y);else{let e=(s/2-n)/r,i=e*(h.x-o.x),l=e*(h.y-o.y);t.i(o.x+i,o.y+l)}return t}get midAngle(){return this.updateRoute(),this.computeMidAngle()}computeMidAngle(){let t=this.pointsCount;if(t<2)return NaN;if(2===t){let t=this.getPoint(0),e=this.getPoint(1);return t.directionPoint(e)}if(this.isOrthogonal&&(this.computeCorner()>=15||9===this.computeCurve()))return this.at.getAngleAlongPath(.5);if(9===this.computeCurve()&&t>=4){let e=(t-1)/3|0,i=(e/2|0)*3;if(e%2==1){i=Math.floor(i);let t=this.getPoint(i),e=this.getPoint(i+1),s=this.getPoint(i+2),n=this.getPoint(i+3);return tP.jD(t.x,t.y,e.x,e.y,s.x,s.y,n.x,n.y)}if(i>0&&i+1<t){let t=this.getPoint(i-1),e=this.getPoint(i+1);return t.directionPoint(e)}}let e=this.flattenedLengths,i=this.flattenedTotalLength,s=0,n=0,l=0;for(;s<i/2&&n<t&&!(s+(l=e[n])>i/2);)s+=l,n++;let r=this.getPoint(n),o=this.getPoint(n+1);if(1>Math.abs(r.x-o.x)&&1>Math.abs(r.y-o.y)){if(n>0&&n+2<t){let t=this.getPoint(n-1),e=this.getPoint(n+2);return t.directionPoint(e)}}else{if(1>Math.abs(r.x-o.x))return r.y>o.y?270:90;if(1>Math.abs(r.y-o.y))return 180*(r.x>o.x)}return r.directionPoint(o)}get flattenedLengths(){return null!==this.Va?this.Va:(this.Ce||this.g1(),this.rO())}get flattenedTotalLength(){let t=this.d1;if(isNaN(t)){let e=this.flattenedLengths,i=e.length;t=0;for(let s=0;s<i;s++)t+=e[s];this.d1=t}return t}rO(){null===this.Va?this.Va=[]:this.Va.length=0;let t=this.Va,e=this.pointsCount;for(let i=0;i<e-1;i++){let e=0,s=this.getPoint(i),n=this.getPoint(i+1);tP.Y(s.x,n.x)?(e=n.y-s.y)<0&&(e=-e):tP.Y(s.y,n.y)?(e=n.x-s.x)<0&&(e=-e):e=Math.sqrt(s.distanceSquaredPoint(n)),t.push(e)}return t}get points(){return this.Pi}set points(t){let e=this.Pi;if(e===t)return;let i=null;if(Array.isArray(t)){let e=t.length%2==0;if(e){for(let i=0;i<t.length;i++)if("number"!=typeof t[i]||isNaN(t[i])){e=!1;break}}if(e){i=new th;for(let e=0;e<t.length/2;e++){let s=new ty(t[2*e],t[2*e+1]).u();i.add(s)}}else{let e=!0;for(let i=0;i<t.length;i++){let s=t[i];if(!te.H(s)||"number"!=typeof s.x||isNaN(s.x)||"number"!=typeof s.y||isNaN(s.y)){e=!1;break}}if(e){i=new th;for(let e=0;e<t.length;e++){let s=t[e];i.add(new ty(s.x,s.y).u())}}}}else if(t instanceof th){let e=(i=t.copy()).iterator;for(;e.next();)e.value.u()}else te.o("Link.points value is not an instance of List or Array: "+t);if(null===i)return;i.u(),this.Pi=i,this.oe(),this.g1();let s=this.diagram;null!==s&&(s.Kh||s.undoManager.isUndoingRedoing||s.ux.add(this),s.animationManager.xi&&s.animationManager.RS(this,i)),this.t("points",e,i)}get pointsCount(){return this.Pi.count}getPoint(t){return this.Pi.r[t]}setPoint(t,e){this.Pi.setElt(t,e)}setPointAt(t,e,i){this.Pi.setElt(t,new ty(e,i))}insertPoint(t,e){this.Pi.insertAt(t,e)}insertPointAt(t,e,i){this.Pi.insertAt(t,new ty(e,i))}addPoint(t){this.Pi.add(t)}addPointAt(t,e){this.Pi.add(new ty(t,e))}removePoint(t){this.Pi.removeAt(t)}clearPoints(){this.Pi.clear()}xr(t,e){if(0===t&&0===e)return;if(0===this.pointsCount){this.defaultFromPoint&&this.defaultFromPoint.offset(t,e),this.defaultToPoint&&this.defaultToPoint.offset(t,e);return}let i=this.Ce,s=new th,n=this.Pi.iterator;for(;n.next();){let i=n.value;s.add(new ty(i.x+t,i.y+e).u())}s.u();let l=this.Pi;this.Pi=s;let r=this.diagram;isNaN(t)||isNaN(e)||null!==r&&r.animationManager.xi?this.c():(this.Js.i(this.Js.x+t,this.Js.y+e),this.dt.i(this.dt.x+t,this.dt.y+e),this.hf()),i?this.g1():(this.defaultFromPoint&&(this.defaultFromPoint=this.getPoint(0)),this.defaultToPoint&&(this.defaultToPoint=this.getPoint(this.pointsCount-1))),null!==r&&r.animationManager.xi&&r.animationManager.RS(this,s),this.t("points",l,s)}startRoute(){null===this.ml&&(this.ml=this.Pi,this.Pi=this.Pi.copy())}commitRoute(){if(null===this.ml)return;let t=this.ml,e=this.Pi,i=1/0,s=1/0,n=t.r,l=n.length;for(let t=0;t<l;t++){let e=n[t];i=Math.min(e.x,i),s=Math.min(e.y,s)}let r=1/0,o=1/0,h=e.r,a=h.length;for(let t=0;t<a;t++){let e=h[t];r=Math.min(e.x,r),o=Math.min(e.y,o),e.u()}if(e.u(),a===l)for(let t=0;t<a;t++){let e=n[t],l=h[t];if(e.x-i!=l.x-r||e.y-s!=l.y-o){this.oe();break}}else this.oe();this.ml=null;let u=this.diagram;null!==u&&u.animationManager.xi&&u.animationManager.RS(this,e),this.g1(),this.t("points",t,e)}rollbackRoute(){null!==this.ml&&(this.Pi=this.ml,this.ml=null)}FF(){null!==this.Lr&&(this.points=this.Lr,this.Lr=null)}g1(){if(0===this.Pi.count){this.Ce=!1;return}this.Ce=!0,this.Va=null,this.d1=NaN,this.defaultFromPoint=this.getPoint(0),this.defaultToPoint=this.getPoint(this.pointsCount-1),this.m1(!1)}invalidateRoute(){if(this.suspendsRouting)return;let t=this.path;if(null===t)return;let e=this.diagram;if(e){if(e.ux.has(this)||e.undoManager.isUndoingRedoing)return;let t=e.animationManager;if(t.isTicking&&!t.isAnimating)return;null===this.Lr||t.isTicking||(this.Lr=null)}this.Ce=!1,this.c(),t.c()}get Ce(){return(16&this.Lt)!=0}set Ce(t){(16&this.Lt)!=0!==t&&(this.Lt=16^this.Lt)}get suspendsRouting(){return(32&this.Lt)!=0}set suspendsRouting(t){(32&this.Lt)!=0!==t&&(this.Lt=32^this.Lt)}get xy(){return(64&this.Lt)!=0}set xy(t){(64&this.Lt)!=0!==t&&(this.Lt=64^this.Lt)}get cN(){return(512&this.Lt)!=0}set cN(t){(512&this.Lt)!=0!==t&&(this.Lt=512^this.Lt)}get defaultFromPoint(){return this.eN}set defaultFromPoint(t){this.eN=null!==t?t.copy():null}get defaultToPoint(){return this.sN}set defaultToPoint(t){this.sN=null!==t?t.copy():null}updateRoute(){if(this.Ce||this.xy)return;let t=!0;try{this.xy=!0,this.startRoute(),t=this.computePoints()}catch{this.xy=!1,this.rollbackRoute()}finally{this.xy=!1,t?this.commitRoute():this.rollbackRoute()}}computePoints(){let t=this.diagram;if(null===t)return!1;let e=this.fromNode,i=null;if(null===e?(ic.za||(ic.za=new io,ic.za.desiredSize=tx.hc,ic.za.ensureBounds()),this.defaultFromPoint&&(ic.za.location=this.defaultFromPoint,ic.za.ensureBounds(),e=ic.za,i=ic.za)):i=this.fromPort,null!==i&&!e.isVisible()){let t=e.findVisibleNode();null!==t&&t!==e?(e=t,i=t.port):e=t}if(this.nN=e,null===e||!e.location.isReal()||null===i||null===(i=e.findVisiblePort(i)))return!1;let s=this.toNode,n=null;if(null===s?(ic.Xa||(ic.Xa=new io,ic.Xa.desiredSize=tx.hc,ic.Xa.ensureBounds()),this.defaultToPoint&&(ic.Xa.location=this.defaultToPoint,ic.Xa.ensureBounds(),s=ic.Xa,n=ic.Xa)):n=this.toPort,null!==n&&!s.isVisible()){let t=s.findVisibleNode();null!==t&&t!==s?(s=t,n=t.port):s=t}if(this.oN=s,null===s||!s.location.isReal()||null===n||null===(n=s.findVisiblePort(n)))return!1;let l=this.pointsCount,r=this.computeSpot(!0,i),o=this.computeSpot(!1,n),h=this.Id(r),a=this.Id(o),u=i===n&&null!==i,d=this.isOrthogonal,c=9===this.curve;u&&!d?(c=!0,this.Qo=!0):this.Qo=!1;let g=0===this.computeAdjusting()||u;if(!d&&!u&&h&&a){let t=!1;if(!g&&l>=3){let h=this.getLinkPoint(e,i,r,!0,!1,s,n),a=this.getLinkPoint(s,n,o,!1,!1,e,i);(t=this.adjustPoints(0,h,l-1,a))&&(h=this.getLinkPoint(e,i,r,!0,!1,s,n),a=this.getLinkPoint(s,n,o,!1,!1,e,i),this.adjustPoints(0,h,l-1,a))}t||(this.clearPoints(),c?this.lO(e,i,r,s,n,o):this.hO(e,i,r,s,n,o))}else{let t=this.isAvoiding;g&&(d&&t||u)&&this.clearPoints();let c=u?this.computeCurviness():0,f=this.getLinkPoint(e,i,r,!0,d,s,n),m=0,p=0,y=0;if(d||!h||u){let t=this.computeEndSegmentLength(e,i,r,!0);if(y=this.getLinkDirection(e,i,f,r,!0,d,s,n),u&&(h||r.equals(o)||!d&&r.x+o.x===1&&r.y+o.y===1)&&(y-=d?90:30,c<0&&(y-=180)),y<0?y+=360:y>=360&&(y-=360),u&&(t+=Math.abs(c)*(d?1:2)),0===y?m=t:90===y?p=t:180===y?m=-t:270===y?p=-t:(m=t*Math.cos(y*Math.PI/180),p=t*Math.sin(y*Math.PI/180)),r.isNoSpot()&&u){let t=i.getDocumentPoint(tv.Center,ty.l()),s=ty.X(t.x+1e3*m,t.y+1e3*p);this.getLinkPointFromPoint(e,i,t,s,!0,f),ty.e(t),ty.e(s)}}let x=this.getLinkPoint(s,n,o,!1,d,e,i),w=0,b=0,v=0;if(d||!a||u){let t=this.computeEndSegmentLength(s,n,o,!1);if(v=this.getLinkDirection(s,n,x,o,!1,d,e,i),u&&(a||r.equals(o)||!d&&r.x+o.x===1&&r.y+o.y===1)&&(v+=30*!d,c<0&&(v+=180)),v<0?v+=360:v>=360&&(v-=360),u&&(t+=Math.abs(c)*(d?1:2)),0===v?w=t:90===v?b=t:180===v?w=-t:270===v?b=-t:(w=t*Math.cos(v*Math.PI/180),b=t*Math.sin(v*Math.PI/180)),o.isNoSpot()&&u){let t=n.getDocumentPoint(tv.Center,ty.l()),e=ty.X(t.x+1e3*w,t.y+1e3*b);this.getLinkPointFromPoint(s,n,t,e,!1,x),ty.e(t),ty.e(e)}}let k=f;(d||!h||u)&&(k=new ty(f.x+m,f.y+p));let P=x;(d||!a||u)&&(P=new ty(x.x+w,x.y+b)),!g&&!d&&h&&l>3&&this.adjustPoints(0,f,l-2,P)?this.setPoint(l-1,x):!g&&!d&&a&&l>3&&this.adjustPoints(1,k,l-1,x)?this.setPoint(0,f):!g&&(d?l>=6:l>4)&&this.adjustPoints(1,k,l-2,P)?(this.setPoint(0,f),this.setPoint(l-1,x)):(this.clearPoints(),this.addPoint(f),(d||!h||u)&&this.addPoint(k),d&&this.addOrthoPoints(k,y,P,v,e,s),(d||!a||u)&&this.addPoint(P),this.addPoint(x))}return t.addInvalidRoute(this),!0}fN(t,e){return Math.abs(e.x-t.x)>Math.abs(e.y-t.y)?(e.x>=t.x?e.x=t.x+9e9:e.x=t.x-9e9,e.y=t.y):(e.y>=t.y?e.y=t.y+9e9:e.y=t.y-9e9,e.x=t.x),e}getLinkPointFromPoint(t,e,i,s,n,l){if(void 0===l&&(l=new ty),null===t||null===e)return l.a(i),l;if(!t.isVisible()){let i=t.findVisibleNode();null!==i&&i!==t&&(e=(t=i).port)}let r=0,o=0,h=0,a=0,u=null,d=e.panel;if(null===d||d.wn()||(d=d.panel),null===d)r=s.x,o=s.y,h=i.x,a=i.y;else{let t=1/((u=d.Ys).m11*u.m22-u.m12*u.m21),e=u.m22*t,n=-u.m12*t,l=-u.m21*t,c=u.m11*t,g=t*(u.m21*u.dy-u.m22*u.dx),f=t*(u.m12*u.dx-u.m11*u.dy);r=s.x*e+s.y*l+g,o=s.x*n+s.y*c+f,h=i.x*e+i.y*l+g,a=i.x*n+i.y*c+f}return e.ef(r,o,h,a,l),null!==u&&l.F(u),l}aO(t,e){let i=t.Ju;return null!==i?i.yT(e):null}p1(t){if(null===t)return null;let e=t.Ju;return null===e&&(e=new ip(t.part,t),t.Ju=e),e.yT(this)}getLinkPoint(t,e,i,s,n,l,r,o){if(void 0===o&&(o=new ty),i.isSpot()&&!this.Id(i))return e.getDocumentPoint(i,o),o;if(i.isSide()){let h=this.p1(e);if(null!==h){let a=h.Ed;if(o.a(a),n&&7===this.routing){let a=this.p1(r);if(null!==a&&h.Df<a.Df){let h=ty.l(),a=ty.l(),u=new tw(e.getDocumentPoint(tv.TopLeft,h),e.getDocumentPoint(tv.BottomRight,a)),d=this.computeSpot(!s,r),c=this.getLinkPoint(l,r,d,!s,n,t,e,a);(i.includesSide(tv.LeftSide)||i.includesSide(tv.RightSide))&&c.y>=u.y&&c.y<=u.y+u.height?o.y=c.y:(i.includesSide(tv.TopSide)||i.includesSide(tv.BottomSide))&&c.x>=u.x&&c.x<=u.x+u.width&&(o.x=c.x),ty.e(h),ty.e(a)}}return o}}let h=e.getDocumentPoint(this.w1(i,s),ty.l()),a=null;if(this.pointsCount>(n?6:2))a=s?this.getPoint(1):this.getPoint(this.pointsCount-2),n&&(a=this.fN(h,a.copy()));else{let t=this.computeSpot(!s,r),e=ty.l();a=r.getDocumentPoint(this.w1(t,!s),e),n&&(a=this.fN(h,a)),ty.e(e)}return this.getLinkPointFromPoint(t,e,h,a,s,o),ty.e(h),o}getLinkDirection(t,e,i,s,n,l,r,o){let h=this.cO(t,e,i,s,n,l,r,o);if(r&&s.isNoSpot()&&r.isMemberOf(t)&&(h+=180)>=360&&(h-=360),this.Id(s)||null===e)return h;let a=e.getDocumentAngle();return 0===a||(45<=a&&a<135?h+=90:135<=a&&a<225?h+=180:225<=a&&a<315&&(h+=270),h>=360&&(h-=360)),h}cO(t,e,i,s,n,l,r,o){if(s.isSpot())return s.x>s.y?s.x>1-s.y?0:s.x<1-s.y?270:315:s.x<s.y?s.x>1-s.y?90:s.x<1-s.y?180:135:s.x<.5?225:45*(s.x>.5);if(s.isSide()){let t=this.p1(e);if(null===t)return s.includesSide(tv.TopSide)?270:s.includesSide(tv.BottomSide)?90:180*!!s.includesSide(tv.LeftSide);switch(t.we){case 1:return 270;case 2:return 180;default:case 4:return 0;case 8:return 90}}if(null===e||null===o)return 0;let h=e.getDocumentPoint(tv.Center,ty.l()),a=null;if(this.pointsCount>(l?6:2))a=n?this.getPoint(1):this.getPoint(this.pointsCount-2),a=l?this.fN(h,a.copy()):i;else{let t=ty.l();a=o.getDocumentPoint(tv.Center,t),ty.e(t)}let u=0;return u=Math.abs(a.x-h.x)>Math.abs(a.y-h.y)?a.x>=h.x?0:180:a.y>=h.y?90:270,ty.e(h),u}computeEndSegmentLength(t,e,i,s){if(null!==e&&i.isSide()){let t=this.p1(e);if(null!==t)return t.b1}let n=NaN;return n=s?this.fromEndSegmentLength:this.toEndSegmentLength,null!==e&&isNaN(n)&&(n=s?e.fromEndSegmentLength:e.toEndSegmentLength),isNaN(n)&&(n=10),n}computeSpot(t,e){return void 0===e&&(e=null),t?this.fO(e||this.fromPort):this.uO(e||this.toPort)}fO(t){if(null===t)return tv.Center;let e=this.fromSpot;return e.isDefault()&&(e=t.fromSpot),e===tv.Default?tv.None:e}uO(t){if(null===t)return tv.Center;let e=this.toSpot;return e.isDefault()&&(e=t.toSpot),e===tv.Default?tv.None:e}Id(t){return t===tv.None||.5===t.x&&.5===t.y}w1(t,e){return .5===t.x&&.5===t.y?t:tv.Center}computeOtherPoint(t,e){if(0!==this.computeAdjusting()&&this.pointsCount>4)return this.computeMidPoint(new ty);{let t=this.aO(e,this);return null!==t?t.Ed:e.getDocumentPoint(tv.Center)}}computeShortLength(t){if(t){let t=this.fromShortLength;if(isNaN(t)){let e=this.fromPort;null!==e&&(t=e.fromShortLength)}return isNaN(t)?0:t}{let t=this.toShortLength;if(isNaN(t)){let e=this.toPort;null!==e&&(t=e.toShortLength)}return isNaN(t)?0:t}}Om(t,e,i,s,n,l){let r;if(!1===this.pickable)return!1;if(void 0===e&&(e=null),void 0===i&&(i=null),void 0===l?(r=tk.l()).Ii():r=l,r.ac(this.F),this.containedInRect(t,r))return this.I2(e,i,n),void 0===l&&tk.e(r),!0;if(this.intersectsRect(t,r)){let o=!1;if(!this.mf){let l=this.T.r,h=l.length;for(let a=h;a--;){let h=l[a];if(!h.visible&&h!==this.locationObject)continue;let u=h.actualBounds,d=this.naturalBounds;if(u.x>d.width||u.y>d.height||u.x+u.width<0||u.y+u.height<0)continue;let c=tk.l();if(c.set(r),h instanceof eq?o=h.Om(t,e,i,s,n,c):this.path===h?h instanceof e$&&(o=h.Iv(t,s,c)):o=h.uA(t,s,c),o){let t=h;null!==e&&(t=e(h)),t&&(null===i||i(t))&&n.add(t)}tk.e(c)}}return void 0===l&&tk.e(r),o||null!==this.background}return void 0===l&&tk.e(r),!1}get isOrthogonal(){return(2&this.Ua)==2}static hN(t){return(2&t)==2}get isAvoiding(){return(4&this.Ua)==4}computeCurve(){if(null===this.Qo){let t=this.fromPort,e=null!==t&&t===this.toPort,i=this.isOrthogonal;this.Qo=e&&!i}return this.Qo?9:this.curve}computeCorner(){if(9===this.curve)return 0;let t=this.corner;return(isNaN(t)||t<0)&&(t=10),t}findMidLabel(){let t=this.path,e=this.T.r,i=e.length;for(let s=0;s<i;s++){let i=e[s];if(!(i===t||i.isPanelMain)&&(i.segmentIndex===-1/0||isNaN(i.segmentIndex)))return i}let s=this.labelNodes;for(;s.next();){let t=s.value;if(t.segmentIndex===-1/0||isNaN(t.segmentIndex))return t}return null}computeSpacing(){if(!this.isVisible())return 0;let t=ic.sO;t=Math.max(t,this.computeThickness());let e=this.fromPort,i=this.toPort;if(null!==e&&null!==i){let s=this.findMidLabel();if(null!==s){let n=s.naturalBounds,l=s.margin,r=isNaN(n.width)?30:n.width*s.scale+l.left+l.right,o=isNaN(n.height)?14:n.height*s.scale+l.top+l.bottom,h=s.segmentOrientation;if(21===h||25===h||24===h)t=Math.max(t,o);else if(23===h||27===h||22===h||26===h)t=Math.max(t,r);else{let s=e.getDocumentPoint(tv.Center).directionPoint(i.getDocumentPoint(tv.Center))/180*Math.PI;t=Math.max(t,Math.abs(Math.sin(s)*r)+Math.abs(Math.cos(s)*o)+1)}9===this.curve&&(t*=1.333)}}return t}arrangeBundledLinks(t,e){if(e)for(let e=0;e<t.length;e++){let i=t[e];0===i.computeAdjusting()&&i.invalidateRoute()}}computeCurviness(){let t=this.curviness;if(isNaN(t)){t=ic.eO;let e=this._o;if(null!==e){let i=te.rt(),s=0,n=e.Zs;for(let t=0;t<n.length;t++){let e=n[t].computeSpacing();i.push(e),s+=e}let l=-s/2;for(let e=0;e<n.length;e++){if(n[e]===this){t=l+i[e]/2;break}l+=i[e]}e.ly===this.fromNode&&(t=-t),te.tt(i)}}return t}computeThickness(){if(!this.isVisible())return 0;let t=this.path;return null!==t?Math.max(t.strokeWidth,1):1}hasCurviness(){return!isNaN(this.curviness)||null!==this._o}hO(t,e,i,s,n,l){let r=this.getLinkPoint(t,e,i,!0,!1,s,n),o=this.getLinkPoint(s,n,l,!1,!1,t,e);if(this.hasCurviness()){let t=o.x-r.x,e=o.y-r.y,i=this.computeCurviness(),s=r.x+t/2,n=r.y+e/2,l=s,h=n;if(tP.f(e,0))t>0?h-=i:h+=i;else{let r=-t/e,o=Math.sqrt(i*i/(r*r+1));i<0&&(o=-o),h=r*((l=(e<0?-1:1)*o+s)-s)+n}this.addPoint(r),this.addPointAt(l,h),this.addPoint(o)}else{this.addPoint(r),this.addPoint(o);let h=tw.l();e.getDocumentBounds(h);let a=h.containsPoint(o);n.getDocumentBounds(h);let u=h.containsPoint(r);if(a||u){let h=e.getDocumentPoint(this.w1(i,!0),new ty);this.setPoint(0,this.getLinkPointFromPoint(t,e,h,o,!0,h));let a=n.getDocumentPoint(this.w1(l,!1),new ty);this.setPoint(1,this.getLinkPointFromPoint(s,n,a,r,!1,a))}tw.e(h)}}lO(t,e,i,s,n,l){let r=this.getLinkPoint(t,e,i,!0,!1,s,n),o=this.getLinkPoint(s,n,l,!1,!1,t,e),h=o.x-r.x,a=o.y-r.y,u=this.computeCurviness(),d=0,c=0,g=r.x+h/3,f=r.y+a/3,m=g,p=f;tP.f(a,0)?h>0?p-=u:p+=u:(c=Math.sqrt(u*u/((d=-h/a)*d+1)),u<0&&(c=-c),p=d*((m=(a<0?-1:1)*c+g)-g)+f),g=r.x+2*h/3,f=r.y+2*a/3;let y=g,x=f;tP.f(a,0)?h>0?x-=u:x+=u:x=d*((y=(a<0?-1:1)*c+g)-g)+f,this.clearPoints(),this.addPoint(r),this.addPointAt(m,p),this.addPointAt(y,x),this.addPoint(o),this.setPoint(0,this.getLinkPoint(t,e,i,!0,!1,s,n)),this.setPoint(3,this.getLinkPoint(s,n,l,!1,!1,t,e))}adjustPoints(t,e,i,s){let n=this.computeAdjusting();if(this.isOrthogonal){if(18===n)return!1;19===n&&(n=17)}switch(n){case 18:return this.dO(t,e,i,s);case 19:return this.gO(t,e,i,s);case 17:return this.mO(t,e,i,s);default:return!1}}dO(t,e,i,s){let n=this.getPoint(t),l=this.getPoint(i);if(n.equalsApprox(e)&&l.equalsApprox(s))return!0;let r=n.x,o=n.y,h=l.x,a=l.y,u=h-r,d=a-o,c=Math.sqrt(u*u+d*d);if(tP.Y(c,0))return!0;let g=0;tP.Y(u,0)?g=d<0?-Math.PI/2:Math.PI/2:(g=Math.atan(d/Math.abs(u)),u<0&&(g=Math.PI-g));let f=e.x,m=e.y,p=s.x,y=s.y,x=p-f,w=y-m,b=Math.sqrt(x*x+w*w),v=0;tP.Y(x,0)?v=w<0?-Math.PI/2:Math.PI/2:(v=Math.atan(w/Math.abs(x)),x<0&&(v=Math.PI-v));let k=b/c,P=v-g;this.setPoint(t,e);for(let e=t+1;e<i;e++){let t=this.getPoint(e),i=Math.sqrt((u=t.x-r)*u+(d=t.y-o)*d);if(tP.Y(i,0))continue;let s=0;tP.Y(u,0)?s=d<0?-Math.PI/2:Math.PI/2:(s=Math.atan(d/Math.abs(u)),u<0&&(s=Math.PI-s));let n=s+P,l=i*k,h=f+l*Math.cos(n),a=m+l*Math.sin(n);this.setPointAt(e,h,a)}return this.setPoint(i,s),!0}gO(t,e,i,s){let n=this.getPoint(t),l=this.getPoint(i);if(n.equalsApprox(e)&&l.equalsApprox(s))return!0;let r=n.x,o=n.y,h=l.x,a=l.y,u=(h-r)**2+(a-o)**2,d=e.x,c=e.y,g=s.x,f=s.y,m=0,p=1;g-d!=0?p=Math.sqrt(1+1/((m=(f-c)/(g-d))*m)):m=9e9,this.setPoint(t,e);for(let e=t+1;e<i;e++){let t=this.getPoint(e),i=t.x,s=t.y,n=.5;0!==u&&(n=((r-i)*(r-h)+(o-s)*(o-a))/u);let l=r+n*(h-r),y=o+n*(a-o),x=Math.sqrt((i-l)**2+(s-y)**2);s<m*(i-l)+y&&(x=-x),m>0&&(x=-x);let w=d+n*(g-d),b=c+n*(f-c);if(0!==m){let t=w+x/p,i=b-(t-w)/m;this.setPointAt(e,t,i)}else this.setPointAt(e,w,b+x)}return this.setPoint(i,s),!0}mO(t,e,i,s){if(this.isOrthogonal){let n=this.getPoint(t),l=this.getPoint(t+1),r=this.getPoint(t+2),o=l.x,h=l.y,a=o,u=h;tP.f(n.y,l.y)?tP.f(l.x,r.x)?h=e.y:tP.f(l.y,r.y)&&(o=e.x):tP.f(n.x,l.x)&&(tP.f(l.y,r.y)?o=e.x:tP.f(l.x,r.x)&&(h=e.y)),this.setPointAt(t+1,o,h),n=this.getPoint(i),l=this.getPoint(i-1),r=this.getPoint(i-2);let d=l.x,c=l.y,g=d,f=c;if(tP.f(n.y,l.y)?tP.f(l.x,r.x)?c=s.y:tP.f(l.y,r.y)&&(d=s.x):tP.f(n.x,l.x)&&(tP.f(l.y,r.y)?d=s.x:tP.f(l.x,r.x)&&(c=s.y)),this.setPointAt(i-1,d,c),this.YL())return this.setPointAt(t+1,a,u),this.setPointAt(i-1,g,f),!1}return this.setPoint(t,e),this.setPoint(i,s),!0}addOrthoPoints(t,e,i,s,n,l){e<0?e+=360:e>=360&&(e-=360),s<0?s+=360:s>=360&&(s-=360);let r=s;e=e>=315||e<45?0:45<=e&&e<135?90:135<=e&&e<225?180:270,s=s>=315||s<45?0:45<=s&&s<135?90:135<=s&&s<225?180:270;let o=n.actualBounds.copy(),h=l.actualBounds.copy();if(!o.isReal()||!h.isReal())return;o.inflate(ic.Ya,ic.Ya),h.inflate(ic.Ya,ic.Ya),o.unionPoint(t),h.unionPoint(i);let a=ty.l(),u=ty.l();0===e?i.x>t.x||270===s&&i.y<t.y&&h.right>t.x||90===s&&i.y>t.y&&h.right>t.x?(a.i(i.x,t.y),u.i(i.x,(t.y+i.y)/2),180===s?(a.x=this.computeMidOrthoPosition(t.x,t.y,i.x,i.y,!1),u.x=a.x,u.y=i.y):270===s&&i.y<t.y||90===s&&i.y>t.y?(t.x<h.left?a.x=this.computeMidOrthoPosition(t.x,t.y,h.left,i.y,!1):t.x<h.right&&(270===s&&t.y<h.top||90===s&&t.y>h.bottom)?a.x=this.computeMidOrthoPosition(t.x,t.y,i.x,i.y,!1):a.x=h.right,u.x=a.x,u.y=i.y):0===s&&t.x<h.left&&t.y>h.top&&t.y<h.bottom&&(a.x=t.x,t.y<i.y?a.y=Math.min(i.y,h.top):a.y=Math.max(i.y,h.bottom),u.y=a.y)):(a.i(t.x,i.y),u.i((t.x+i.x)/2,i.y),(180===s||90===s&&i.y<o.top||270===s&&i.y>o.bottom)&&(180===s&&(h.containsPoint(t)||o.containsPoint(i))?a.y=this.computeMidOrthoPosition(t.x,t.y,i.x,i.y,!0):i.y<t.y&&(180===s||90===s)?a.y=this.computeMidOrthoPosition(t.x,o.top,i.x,Math.max(i.y,h.bottom),!0):i.y>t.y&&(180===s||270===s)&&(a.y=this.computeMidOrthoPosition(t.x,o.bottom,i.x,Math.min(i.y,h.top),!0)),u.x=i.x,u.y=a.y),a.y>o.top&&a.y<o.bottom&&(i.x>=o.left&&i.x<=t.x||t.x<=h.right&&t.x>=i.x?(90===s||270===s)&&(a.i(Math.max((t.x+i.x)/2,t.x),t.y),u.i(a.x,i.y)):(270===s||(0===s||180===s)&&i.y<t.y?a.y=Math.min(i.y,0===s?o.top:Math.min(o.top,h.top)):a.y=Math.max(i.y,0===s?o.bottom:Math.max(o.bottom,h.bottom)),u.x=i.x,u.y=a.y))):180===e?i.x<t.x||270===s&&i.y<t.y&&h.left<t.x||90===s&&i.y>t.y&&h.left<t.x?(a.i(i.x,t.y),u.i(i.x,(t.y+i.y)/2),0===s?(a.x=this.computeMidOrthoPosition(t.x,t.y,i.x,i.y,!1),u.x=a.x,u.y=i.y):270===s&&i.y<t.y||90===s&&i.y>t.y?(t.x>h.right?a.x=this.computeMidOrthoPosition(t.x,t.y,h.right,i.y,!1):t.x>h.left&&(270===s&&t.y<h.top||90===s&&t.y>h.bottom)?a.x=this.computeMidOrthoPosition(t.x,t.y,i.x,i.y,!1):a.x=h.left,u.x=a.x,u.y=i.y):180===s&&t.x>h.right&&t.y>h.top&&t.y<h.bottom&&(a.x=t.x,t.y<i.y?a.y=Math.min(i.y,h.top):a.y=Math.max(i.y,h.bottom),u.y=a.y)):(a.i(t.x,i.y),u.i((t.x+i.x)/2,i.y),(0===s||90===s&&i.y<o.top||270===s&&i.y>o.bottom)&&(0===s&&(h.containsPoint(t)||o.containsPoint(i))?a.y=this.computeMidOrthoPosition(t.x,t.y,i.x,i.y,!0):i.y<t.y&&(0===s||90===s)?a.y=this.computeMidOrthoPosition(t.x,o.top,i.x,Math.max(i.y,h.bottom),!0):i.y>t.y&&(0===s||270===s)&&(a.y=this.computeMidOrthoPosition(t.x,o.bottom,i.x,Math.min(i.y,h.top),!0)),u.x=i.x,u.y=a.y),a.y>o.top&&a.y<o.bottom&&(i.x<=o.right&&i.x>=t.x||t.x>=h.left&&t.x<=i.x?(90===s||270===s)&&(a.i(Math.min((t.x+i.x)/2,t.x),t.y),u.i(a.x,i.y)):(270===s||(0===s||180===s)&&i.y<t.y?a.y=Math.min(i.y,180===s?o.top:Math.min(o.top,h.top)):a.y=Math.max(i.y,180===s?o.bottom:Math.max(o.bottom,h.bottom)),u.x=i.x,u.y=a.y))):90===e?i.y>t.y||180===s&&i.x<t.x&&h.bottom>t.y||0===s&&i.x>t.x&&h.bottom>t.y?(a.i(t.x,i.y),u.i((t.x+i.x)/2,i.y),270===s?(a.y=this.computeMidOrthoPosition(t.x,t.y,i.x,i.y,!0),u.x=i.x,u.y=a.y):180===s&&i.x<t.x||0===s&&i.x>t.x?(t.y<h.top?a.y=this.computeMidOrthoPosition(t.x,t.y,i.x,h.top,!0):t.y<h.bottom&&(180===s&&t.x<h.left||0===s&&t.x>h.right)?a.y=this.computeMidOrthoPosition(t.x,t.y,i.x,i.y,!0):a.y=h.bottom,u.x=i.x,u.y=a.y):90===s&&t.y<h.top&&t.x>h.left&&t.x<h.right&&(t.x<i.x?a.x=Math.min(i.x,h.left):a.x=Math.max(i.x,h.right),a.y=t.y,u.x=a.x)):(a.i(i.x,t.y),u.i(i.x,(t.y+i.y)/2),(270===s||0===s&&i.x<o.left||180===s&&i.x>o.right)&&(270===s&&(h.containsPoint(t)||o.containsPoint(i))?a.x=this.computeMidOrthoPosition(t.x,t.y,i.x,i.y,!1):i.x<t.x&&(270===s||0===s)?a.x=this.computeMidOrthoPosition(o.left,t.y,Math.max(i.x,h.right),i.y,!1):i.x>t.x&&(270===s||180===s)&&(a.x=this.computeMidOrthoPosition(o.right,t.y,Math.min(i.x,h.left),i.y,!1)),u.x=a.x,u.y=i.y),a.x>o.left&&a.x<o.right&&(i.y>=o.top&&i.y<=t.y||t.y<=h.bottom&&t.y>=i.y?(0===s||180===s)&&(a.i(t.x,Math.max((t.y+i.y)/2,t.y)),u.i(i.x,a.y)):(180===s||(90===s||270===s)&&i.x<t.x?a.x=Math.min(i.x,90===s?o.left:Math.min(o.left,h.left)):a.x=Math.max(i.x,90===s?o.right:Math.max(o.right,h.right)),u.x=a.x,u.y=i.y))):i.y<t.y||180===s&&i.x<t.x&&h.top<t.y||0===s&&i.x>t.x&&h.top<t.y?(a.i(t.x,i.y),u.i((t.x+i.x)/2,i.y),90===s?(a.y=this.computeMidOrthoPosition(t.x,t.y,i.x,i.y,!0),u.x=i.x,u.y=a.y):180===s&&i.x<t.x||0===s&&i.x>=t.x?(t.y>h.bottom?a.y=this.computeMidOrthoPosition(t.x,t.y,i.x,h.bottom,!0):t.y>h.top&&(180===s&&t.x<h.left||0===s&&t.x>h.right)?a.y=this.computeMidOrthoPosition(t.x,t.y,i.x,i.y,!0):a.y=h.top,u.x=i.x,u.y=a.y):270===s&&t.y>h.bottom&&t.x>h.left&&t.x<h.right&&(t.x<i.x?a.x=Math.min(i.x,h.left):a.x=Math.max(i.x,h.right),a.y=t.y,u.x=a.x)):(a.i(i.x,t.y),u.i(i.x,(t.y+i.y)/2),(90===s||0===s&&i.x<o.left||180===s&&i.x>o.right)&&(90===s&&(h.containsPoint(t)||o.containsPoint(i))?a.x=this.computeMidOrthoPosition(t.x,t.y,i.x,i.y,!1):i.x<t.x&&(90===s||0===s)?a.x=this.computeMidOrthoPosition(o.left,t.y,Math.max(i.x,h.right),i.y,!1):i.x>t.x&&(90===s||180===s)&&(a.x=this.computeMidOrthoPosition(o.right,t.y,Math.min(i.x,h.left),i.y,!1)),u.x=a.x,u.y=i.y),a.x>o.left&&a.x<o.right&&(i.y<=o.bottom&&i.y>=t.y||t.y>=h.top&&t.y<=i.y?(0===s||180===s)&&(a.i(t.x,Math.min((t.y+i.y)/2,t.y)),u.i(i.x,a.y)):(180===s||(90===s||270===s)&&i.x<t.x?a.x=Math.min(i.x,270===s?o.left:Math.min(o.left,h.left)):a.x=Math.max(i.x,270===s?o.right:Math.max(o.right,h.right)),u.x=a.x,u.y=i.y))),this.cN=s!==r,this.rN=e,this.lN=s,this.addPoint(a.copy()),this.addPoint(u.copy()),ty.e(a),ty.e(u)}computeMidOrthoPosition(t,e,i,s,n){let l=0;return!this.hasCurviness()||this.computeSpot(!0,this.fromPort).isSide()||this.computeSpot(!1,this.toPort).isSide()||(l=this.computeCurviness()),n?(e+s)/2+l:(t+i)/2+l}YL(){if(null===this.diagram||!this.isAvoiding||this.diagram.animationManager.isTicking)return!1;let t=this.points.r,e=t.length;if(e<4)return!1;let i=this.diagram.getPositions(!1,this.containingGroup,null);for(let s=1;s<e-2;s++){let e=t[s],n=t[s+1];if(!i.isUnoccupied(Math.min(e.x,n.x),Math.min(e.y,n.y),Math.abs(e.x-n.x),Math.abs(e.y-n.y)))return!0}return!1}findClosestSegment(t){let e=t.x,i=t.y,s=this.getPoint(0),n=this.getPoint(1),l=ty.distanceLineSegmentSquared(e,i,s.x,s.y,n.x,n.y),r=0;for(let t=1;t<this.pointsCount-1;t++){s=this.getPoint(t+1);let o=ty.distanceLineSegmentSquared(e,i,n.x,n.y,s.x,s.y);n=s,o<l&&(r=t,l=o)}return r}oe(){this.Nh=!1,this.c()}get Nh(){return(128&this.Lt)!=0}set Nh(t){(128&this.Lt)!=0!==t&&(this.Lt=128^this.Lt)}get geometry(){if(!this.Nh){if(this.updateRoute(),this.pointsCount<2)return this.Nh=!0,this.at;this.at=this.makeGeometry()}return this.at}hd(t){if(!t){if(!1===this.Ce)return;let t=this.findMainElement();if(this.Nh&&(null===t||null!==t.geometry))return}this.pointsCount<2?this.Nh=!0:this.at=this.makeGeometry();let e=this.path;if(null===e)return;e.at=this.at;let i=this.T.r,s=i.length;for(let t=0;t<s;t++){let s=i[t];s!==e&&s.isPanelMain&&s instanceof e$&&(s.at=this.at)}}pO(t){return this.Ka()&&t.eh.has(this)&&(0!==this.Tf.width||0!==this.Tf.height)&&(t.animationManager.isAnimating||t.currentTool!==t.toolManager)}makeGeometry(){let t=this.at,e=this.pointsCount,i=!1,s=this.diagram;null!==s&&this.pO(s)&&(i=!0);let n=0,l=0,r=this.getPoint(0).copy(),o=r.copy(),h=this.Pi.r,a=this.computeCurve();if(9===a&&e>=3&&!tP.Y(this.smoothness,0)){if(3===e){let t=this.getPoint(1);n=Math.min(r.x,t.x),l=Math.min(r.y,t.y),n=Math.min(n,(t=this.getPoint(2)).x),l=Math.min(l,t.y)}else if(this.isOrthogonal){for(let t=0;t<e;t++){let e=h[t];o.x=Math.min(e.x,o.x),o.y=Math.min(e.y,o.y)}n=o.x,l=o.y}else{for(let t=3;t<e;t+=3){t+3>=e&&(t=e-1);let i=this.getPoint(t);o.x=Math.min(i.x,o.x),o.y=Math.min(i.y,o.y)}n=o.x,l=o.y}}else{for(let t=0;t<e;t++){let e=h[t];o.x=Math.min(e.x,o.x),o.y=Math.min(e.y,o.y)}n=o.x,l=o.y}if(n-=this.u1.x,l-=this.u1.y,r.x-=n,r.y-=l,2!==e||this.Ka()){t.type=4;let s=it.CC(t);if(0!==this.computeShortLength(!0)&&(r=this.Ff(r,!0,o)),s.gu(r.x,r.y,!1,!1),9===a&&e>=3&&!tP.Y(this.smoothness,0)){if(3===e){let t=this.getPoint(1),e=t.x-n,i=t.y-l,r=this.getPoint(2).copy();r.x-=n,r.y-=l,0!==this.computeShortLength(!1)&&(r=this.Ff(r,!1,o)),s.pr(e,i,e,i,r.x,r.y)}else if(this.isOrthogonal){let t=ty.X(n,l),e=ty.l();e.a(this.getPoint(1));let i=ty.X(n,l),r=ty.X(n,l),o=this.getPoint(0),h=null,a=this.smoothness/3;for(let u=1;u<this.pointsCount-1;u++){h=this.getPoint(u);let d=o,c=h,g=this.getPoint(this.uN(h,u,!1));tP.Y(d.x,c.x)&&tP.Y(c.x,g.x)||tP.Y(d.y,c.y)&&tP.Y(c.y,g.y)||(this.yO(d,c,g,a,i,r),(1===u||2===u&&tP.Y(o.x,this.getPoint(0).x)&&tP.Y(o.y,this.getPoint(0).y))&&(e.x=(o.x+h.x)*.5,e.y=(o.y+h.y)*.5),s.pr(e.x-n,e.y-l,i.x-n,i.y-l,h.x-n,h.y-l),t.set(i),e.set(r),o=h)}let u=o.x,d=o.y,c=this.getPoint(this.pointsCount-1);0!==this.computeShortLength(!1)&&(c=this.Ff(c.copy(),!1,ty.Lo)),u=.5*(u+c.x),d=.5*(d+c.y),s.pr(r.x-n,r.y-l,u-n,d-l,c.x-n,c.y-l),ty.e(t),ty.e(e),ty.e(i),ty.e(r)}else for(let t=3;t<e;t+=3){let i=this.getPoint(t-2);t+3>=e&&(t=e-1);let r=this.getPoint(t-1),o=this.getPoint(t);t===e-1&&0!==this.computeShortLength(!1)&&(o=this.Ff(o.copy(),!1,ty.Lo)),s.pr(i.x-n,i.y-l,r.x-n,r.y-l,o.x-n,o.y-l)}}else{let t=ty.l();t.a(this.getPoint(0));let r=ty.l();r.a(t);let o=this.computeCorner(),h=1,a=0;for(;h<e;){h=this.uN(t,h,h>1);let u=this.getPoint(h);if(h>=e-1){if(t.equals(u)){if(0===a)for(h=1;h<e;)r.a(t),u=this.getPoint(h++),this.An(s,-n,-l,t,u,i),t.a(u)}else 0!==this.computeShortLength(!1)&&(u=this.Ff(u.copy(),!1,ty.Lo)),this.An(s,-n,-l,t,u,i);break}a=this.uN(u,h+1,h<e-3);let d=this.getPoint(a);this.wO(s,-n,-l,t,u,d,t,r,o,i),r.a(u),h=a}ty.e(t)}return it.LC(s),this.Nh=!0,t}{let e=this.getPoint(1).copy();return e.x-=n,e.y-=l,0!==this.computeShortLength(!0)&&(r=this.Ff(r,!0,o)),0!==this.computeShortLength(!1)&&(e=this.Ff(e,!1,o)),t.type=1,t.startX=r.x,t.startY=r.y,t.endX=e.x,t.endY=e.y,this.Nh=!0,t}}k1(t,e,i,s){let n=i-t;if(isNaN(n)||n===1/0||n===-1/0)return NaN;n<0&&(n=-n);let l=s-e;return isNaN(l)||l===1/0||l===-1/0?NaN:(l<0&&(l=-l),tP.Y(n,0)?l:tP.Y(l,0)?n:Math.sqrt(n*n+l*l))}yO(t,e,i,s,n,l){isNaN(s)&&(s=this.smoothness/3);let r=t.x,o=t.y,h=e.x,a=e.y,u=i.x,d=i.y,c=s*this.k1(r,o,h,a),g=s*this.k1(h,a,u,d);if(tP.Y(o,a)&&tP.Y(h,u)&&(h>r?d>a?(n.x=h-c,n.y=a-c,l.x=h+g,l.y=a+g):(n.x=h-c,n.y=a+c,l.x=h+g,l.y=a-g):d>a?(n.x=h+c,n.y=a-c,l.x=h-g,l.y=a+g):(n.x=h+c,n.y=a+c,l.x=h-g,l.y=a-g)),tP.Y(r,h)&&tP.Y(a,d)&&(a>o?(u>h?(n.x=h-c,n.y=a-c,l.x=h+g):(n.x=h+c,n.y=a-c,l.x=h-g),l.y=a+g):(u>h?(n.x=h-c,n.y=a+c,l.x=h+g):(n.x=h+c,n.y=a+c,l.x=h-g),l.y=a-g)),tP.Y(r,h)&&tP.Y(h,u)||tP.Y(o,a)&&tP.Y(a,d)){let t=.5*(r+u),e=.5*(o+d);n.x=t,n.y=e,l.x=t,l.y=e}}Ff(t,e,i){let s=this.pointsCount;if(s<2)return t;if(e){let e=this.getPoint(1),n=e.x-i.x,l=e.y-i.y,r=this.k1(t.x,t.y,n,l);if(0===r)return t;let o=2===s?.5*r:r,h=this.computeShortLength(!0);h>o&&(h=o);let a=h*(n-t.x)/r,u=h*(l-t.y)/r;t.x+=a,t.y+=u}else{let e=this.getPoint(s-2),n=e.x-i.x,l=e.y-i.y,r=this.k1(t.x,t.y,n,l);if(0===r)return t;let o=2===s?.5*r:r,h=this.computeShortLength(!1);h>o&&(h=o);let a=h*(t.x-n)/r,u=h*(t.y-l)/r;t.x-=a,t.y-=u}return t}uN(t,e,i){let s=this.pointsCount,n=t;for(;tP.Y(t.x,n.x)&&tP.Y(t.y,n.y);){if(e>=s)return s-1;n=this.getPoint(e++)}if(!tP.Y(t.x,n.x)&&!tP.Y(t.y,n.y))return e-1;let l=n;for(;tP.Y(t.x,n.x)&&tP.Y(n.x,l.x)&&(!i||(t.y>=n.y?n.y>=l.y:n.y<=l.y))||tP.Y(t.y,n.y)&&tP.Y(n.y,l.y)&&(!i||(t.x>=n.x?n.x>=l.x:n.x<=l.x));){if(e>=s)return s-1;l=this.getPoint(e++)}return e-2}wO(t,e,i,s,n,l,r,o,h,a){if(tP.f(s.y,n.y)&&tP.f(n.x,l.x)){let u=Math.min(h,Math.abs(n.x-o.x)/2),d=Math.min(u,Math.abs(l.y-n.y)/2);if(u=d,tP.f(u,0)){this.An(t,e,i,s,n,a),r.a(n);return}let c=n.x,g=n.y,f=c,m=g;c=n.x>s.x?n.x-u:n.x+u,m=l.y>n.y?n.y+d:n.y-d;let p=ty.X(c,g);this.An(t,e,i,s,p,a),ty.e(p),t.Sw(n.x+e,n.y+i,f+e,m+i),r.i(f,m)}else if(tP.f(s.x,n.x)&&tP.f(n.y,l.y)){let u=Math.min(h,Math.abs(n.y-o.y)/2),d=Math.min(u,Math.abs(l.x-n.x)/2);if(u=d,tP.f(d,0)){this.An(t,e,i,s,n,a),r.a(n);return}let c=n.x,g=n.y,f=c,m=g;g=n.y>s.y?n.y-u:n.y+u,f=l.x>n.x?n.x+d:n.x-d;let p=ty.X(c,g);this.An(t,e,i,s,p,a),ty.e(p),t.Sw(n.x+e,n.y+i,f+e,m+i),r.i(f,m)}else this.An(t,e,i,s,n,a),r.a(n)}computeJumpLength(){return 10}An(t,e,i,s,n,l){if(l||!this.Ka())t.mr(n.x+e,n.y+i);else{let l=this.computeJumpLength(),r=l/2,o=[],h=0;this.isVisible()&&(h=this.xO(s,n,o));let a=s.x,u=s.y;if(h>0){if(tP.f(s.y,n.y)){if(s.x<n.x){let d=0;for(;d<h;){let c=Math.max(s.x,Math.min(o[d++]-r,n.x-l));t.mr(c+e,n.y+i),a=c+e,u=n.y+i;let g=Math.min(c+l,n.x);for(;d<h;){let t=o[d];if(t<g+l)d++,g=Math.min(t+r,n.x);else break}let f=n.y-l+i,m=g+e,p=n.y+i;10===this.curve?t.gu(m,p,!1,!1):t.pr(a,f,m,f,m,p),a=m,u=p}}else{let d=h-1;for(;d>=0;){let h=Math.min(s.x,Math.max(o[d--]+r,n.x+l));t.mr(h+e,n.y+i),a=h+e,u=n.y+i;let c=Math.max(h-l,n.x);for(;d>=0;){let t=o[d];if(t>c-l)d--,c=Math.max(t-r,n.x);else break}let g=n.y-l+i,f=c+e,m=n.y+i;10===this.curve?t.gu(f,m,!1,!1):t.pr(a,g,f,g,f,m),a=f,u=m}}}else if(tP.f(s.x,n.x)){if(s.y<n.y){let d=0;for(;d<h;){let c=Math.max(s.y,Math.min(o[d++]-r,n.y-l));t.mr(n.x+e,c+i),a=n.x+e,u=c+i;let g=Math.min(c+l,n.y);for(;d<h;){let t=o[d];if(t<g+l)d++,g=Math.min(t+r,n.y);else break}let f=n.x-l+e,m=n.x+e,p=g+i;10===this.curve?t.gu(m,p,!1,!1):t.pr(f,u,f,p,m,p),a=m,u=p}}else{let d=h-1;for(;d>=0;){let h=Math.min(s.y,Math.max(o[d--]+r,n.y+l));t.mr(n.x+e,h+i),a=n.x+e,u=h+i;let c=Math.max(h-l,n.y);for(;d>=0;){let t=o[d];if(t>c-l)d--,c=Math.max(t-r,n.y);else break}let g=n.x-l+e,f=n.x+e,m=c+i;10===this.curve?t.gu(f,m,!1,!1):t.pr(g,u,g,m,f,m),a=f,u=m}}}}t.mr(n.x+e,n.y+i)}}xO(t,e,i){let s=this.diagram;if(null===s||t.equals(e))return 0;let n=s.layers;for(;n.next();){let s=n.value;if(null!==s&&s.visible){let n=s.zS(),l=n.length;for(let s=0;s<l;s++){let l=n[s];if(!(l instanceof ic))continue;if(l===this)return i.length>0&&i.sort((t,e)=>t-e),i.length;if(!l.isVisible()||!l.Ka())continue;let r=l.routeBounds;if(!r.isReal()||!this.routeBounds.intersectsRect(r)||this.usesSamePort(l))continue;let o=l.path;null!==o&&o.isVisibleObject()&&this.bO(t,e,i,l)}}}return i.length>0&&i.sort((t,e)=>t-e),i.length}bO(t,e,i,s){let n=tP.f(t.y,e.y),l=s.pointsCount,r=s.getPoint(0),o=ty.l();for(let h=1;h<l;h++){let a=s.getPoint(h);if(h<l-1){let t=s.getPoint(h+1);if(r.y===a.y&&a.y===t.y){if(a.x>r.x&&t.x>=a.x||a.x<r.x&&t.x<=a.x)continue}else if(r.x===a.x&&a.x===t.x&&(a.y>r.y&&t.y>=a.y||a.y<r.y&&t.y<=a.y))continue}this.kO(t,e,r,a,o)&&(n?i.push(o.x):i.push(o.y)),r=a}ty.e(o)}kO(t,e,i,s,n){let l=t.x,r=t.y,o=e.x,h=e.y,a=i.x,u=i.y,d=s.x,c=s.y;if(tP.f(l,o)){if(!tP.f(r,h)&&tP.f(u,c)&&Math.min(r,h)<u&&Math.max(r,h)>u&&Math.min(a,d)<l&&Math.max(a,d)>l&&!tP.f(a,d))return n.x=l,n.y=u,!0}else if(tP.f(r,h)&&tP.f(a,d)&&Math.min(l,o)<a&&Math.max(l,o)>a&&Math.min(u,c)<r&&Math.max(u,c)>r&&!tP.f(u,c))return n.x=a,n.y=r,!0;return n.x=0,n.y=0,!1}get firstPickIndex(){return this.pointsCount<=2?0:this.isOrthogonal||!this.Id(this.computeSpot(!0))?1:0}get lastPickIndex(){let t=this.pointsCount;return 0===t?0:t<=2?t-1:this.isOrthogonal||!this.Id(this.computeSpot(!1))?t-2:t-1}Ka(){let t=this.curve;return 11===t||10===t}m1(t){if(t||this.Ka()){let t=this.diagram;null===t||t.animationManager.isTicking||t.eh.has(this)||0===this.Tf.width&&0===this.Tf.height||t.eh.set(this,this.Tf.copy())}}invalidateOtherJumpOvers(t){let e=this.layer;if(null===e||!e.visible||e.isTemporary)return;let i=e.diagram;if(null===i||i.animationManager.isTicking)return;let s=!1,n=i.layers;for(;n.next();){let i=n.value;if(i.visible){if(i===e){s=!0;let e=!1,n=i.zS(),l=n.length;for(let i=0;i<l;i++){let s=n[i];s instanceof ic&&(s===this?e=!0:e&&this.wT(s,t))}}else if(s){let e=i.zS(),s=e.length;for(let i=0;i<s;i++){let s=e[i];s instanceof ic&&this.wT(s,t)}}}}}wT(t,e){if(null===t||!t.Nh||!t.Ce||!t.Ka())return;let i=t.routeBounds;i.isReal()&&(!this.routeBounds.intersectsRect(i)&&!e.intersectsRect(i)||this.usesSamePort(t)||t.oe())}usesSamePort(t){let e=this.pointsCount,i=t.pointsCount;if(e>0&&i>0){let s=this.getPoint(0),n=t.getPoint(0);if(s.equalsApprox(n))return!0;let l=this.getPoint(e-1),r=t.getPoint(i-1);if(l.equalsApprox(r)||s.equalsApprox(r)||l.equalsApprox(n))return!0}else if(this.fromNode===t.fromNode||this.toNode===t.toNode||this.fromNode===t.toNode||this.toNode===t.fromNode)return!0;return!1}isVisible(){if(!super.isVisible())return!1;let t=this.containingGroup,e=!0,i=this.diagram;null!==i&&(e=i.isTreePathToChildren);let s=this.fromNode;if(null!==s){if(this.isTreeLink&&e&&!s.isTreeExpanded)return!1;if(s===t)return!0;let i=s;for(;null!==i;){if(i.labeledLink===this)return!0;i=i.containingGroup}let n=s.findVisibleNode();if(null===n||n===t)return!1}let n=this.toNode;if(null!==n){if(this.isTreeLink&&!e&&!n.isTreeExpanded)return!1;if(n===t)return!0;let i=n;for(;null!==i;){if(i.labeledLink===this)return!0;i=i.containingGroup}let s=n.findVisibleNode();if(null===s||s===t)return!1}return!0}Vi(t){if(super.Vi(t),t&&this.m1(!1),null!==this._o&&this._o.Ad(),null!==this.$s){let e=this.$s.iterator;for(;e.next();)e.value.Vi(t)}}get adjusting(){return this.Af}set adjusting(t){let e=this.Af;e!==t&&(this.Af=t,this.t("adjusting",e,t))}computeAdjusting(){return this.isAvoiding&&null!==this.diagram&&this.diagram.animationManager.defaultAnimation.isAnimating?17:this.Af}get corner(){return this.Fd}set corner(t){let e=this.Fd;e!==t&&(this.Fd=t,this.oe(),this.t("corner",e,t))}get curve(){return this.Rd}set curve(t){let e=this.Rd;e!==t&&(this.Rd=t,this.invalidateRoute(),this.oe(),this.m1(10===e||11===e||10===t||11===t),this.t("curve",e,t))}get curviness(){return this.vd}set curviness(t){let e=this.vd;e!==t&&(this.vd=t,this.invalidateRoute(),this.oe(),this.t("curviness",e,t))}get routing(){return this.Ua}set routing(t){let e=this.Ua;e!==t&&(this.Ua=t,this.isAvoiding&&null!==this.diagram&&(this.diagram.Gm=!0),this.Qo=null,this.invalidateRoute(),this.m1(ic.hN(e)||ic.hN(t)),this.t("routing",e,t))}get smoothness(){return this.Od}set smoothness(t){let e=this.Od;e!==t&&(this.Od=t,this.oe(),this.t("smoothness",e,t))}wy(){let t=this.fo;if(null===t)return;let e=this.go;if(null===e||!isNaN(this.curviness))return;let i=this.uo,s=this.mo,n=null,l=null,r=t.si.r,o=r.length;for(let h=0;h<o;h++){let o=r[h];(o.fo!==t||o.uo!==i||o.go!==e||o.mo!==s)&&(o.fo!==e||o.uo!==s||o.go!==t||o.mo!==i)||(null===l?l=o:(null===n&&(n=[]).push(l),n.push(o)))}if(null!==n){let l=t.aT(e,i,s);null===l&&(l=new ig(t,i,e,s),t.lT(l),e.lT(l)),l.Zs=n;for(let t=0;t<n.length;t++)n[t]._o=l;l.Ad()}}yy(){let t=this._o;if(null!==t){if(!isNaN(this.curviness))return;this._o=null;let e=t.Zs.indexOf(this);e>=0&&(t.Zs.splice(e,1),t.Ad())}}Rl(){return!0}get key(){let t=this.diagram;if(!(null===t||!t.model.Ba()))return t.model.getKeyForLinkData(this.data)}}class ig{Vo;zs;ly;tN;a1;iN;Zs;constructor(t,e,i,s){tu.qi(this),this.Vo=!1,this.zs=!1,this.ly=t,this.tN=e,this.a1=i,this.iN=s,this.Zs=[]}Ad(){if(!this.Vo){let t=this.Zs;if(t.length>0){let e=t[0].diagram;null!==e&&(e.fM.add(this),this.zs=e.undoManager.isUndoingRedoing)}}this.Vo=!0}NM(){if(this.Vo){this.Vo=!1;let t=this.Zs;if(t.length>0){let e=t[0],i=e.diagram,s=null===i||i.Kh&&!this.zs;this.zs=!1,e.arrangeBundledLinks(t,s),1===t.length&&(e._o=null,t.length=0)}0===t.length&&(this.ly.hT(this),this.a1.hT(this))}}}class im{he;ae;Ga;Ha;pi;yi;Ot;Ch;Lh;pa;UM;Vo;by;Jc;VM;zM;constructor(t){tu.qi(this),this.pa=null,this.UM=null,this.Vo=!0,this.by=!1,this.he=1,this.ae=1,this.Ga=-1,this.Ha=-1,this.pi=t.width,this.yi=t.height,this.Ot=[],this.Ch=0,this.Lh=0,this.Jc=11,this.VM=2*this.Jc,this.zM=2*this.Jc}static Qs=0;static ja=1;static Bd=999999;static dN=im.Bd+1;static gN=im.Bd+2;bb(t){if(t.width<=0||t.height<=0)return;let e=t.x,i=t.y,s=t.x+t.width,n=t.y+t.height;this.he=Math.floor((e-this.pi)/this.pi)*this.pi,this.ae=Math.floor((i-this.yi)/this.yi)*this.yi,this.Ga=Math.ceil((s+2*this.pi)/this.pi)*this.pi,this.Ha=Math.ceil((n+2*this.yi)/this.yi)*this.yi;let l=1+(0|Math.ceil((this.Ga-this.he)/this.pi)),r=1+(0|Math.ceil((this.Ha-this.ae)/this.yi));if(null===this.Ot||this.Ch<l-1||this.Lh<r-1){let t=[];for(let e=0;e<=l;e++)t[e]=new Uint32Array(r);this.Ot=t,this.Ch=l-1,this.Lh=r-1}this.PO(im.dN)}get bounds(){return new tw(this.he,this.ae,this.Ga-this.he,this.Ha-this.ae)}get cellWidth(){return this.pi}set cellWidth(t){t>0&&t!==this.pi&&(this.pi=t,this.bb(this.bounds))}get cellHeight(){return this.yi}set cellHeight(t){t>0&&t!==this.yi&&(this.yi=t,this.bb(this.bounds))}Ud(t,e){return this.he<=t&&t<=this.Ga&&this.ae<=e&&e<=this.Ha}po(t,e){if(!this.Ud(t,e))return im.dN;t-=this.he,t/=this.pi,e-=this.ae,e/=this.yi;let i=0|t,s=0|e;return this.Ot[i][s]}RR(t,e,i,s){if(!this.Ud(t,e))return;let n=(t-this.he)/this.pi|0,l=(e-this.ae)/this.yi|0,r=(t+i-this.he)/this.pi|0,o=(e+s-this.ae)/this.yi|0,h=Math.min(r,this.Ch),a=Math.min(o,this.Lh);for(let t=n;t<=h;t++){let e=this.Ot[t];if(e.fill)e.fill(im.Qs,l,a+1);else for(let t=l;t<=a;t++)e[t]=im.Qs}}PO(t){if(null!==this.Ot)for(let e=0;e<=this.Ch;e++){let i=this.Ot[e];if(i.fill)i.fill(t);else for(let e=0;e<=this.Lh;e++)i[e]=t}}tA(){if(null!==this.Ot)for(let t=0;t<=this.Ch;t++){let e=this.Ot[t];for(let t=0;t<=this.Lh;t++)e[t]>=im.ja&&(e[t]=im.dN)}}SO(t,e){return this.po(t,e)===im.Qs}isUnoccupied(t,e,i,s){if(t>this.Ga||t+i<this.he||e>this.Ha||e+s<this.ae)return!0;let n=(t-this.he)/this.pi|0,l=(e-this.ae)/this.yi|0,r=Math.max(0,i)/this.pi+1|0,o=Math.max(0,s)/this.yi+1|0;if(n<0&&(r+=n,n=0),l<0&&(o+=l,l=0),r<0||o<0)return!0;let h=0|Math.min(n+r-1,this.Ch),a=0|Math.min(l+o-1,this.Lh);for(let t=n;t<=h;t++){let e=this.Ot[t];for(let t=l;t<=a;t++)if(e[t]===im.Qs)return!1}return!0}maxAvoidsLinksSpaceH(t,e,i,s){let n;if(t>this.Ga||e<this.he||i>this.Ha||i<this.ae)return 0;let l=(t-this.he)/this.pi|0,r=(e-this.he)/this.pi|0,o=(i-this.ae)/this.yi|0,h=s/this.yi+1|0;for(n=0;n<h/2;n++){let t=!1;for(let e=l;e<=r;e++)if(this.Ot[e][o+n]===im.Qs||this.Ot[e][o-n]===im.Qs){t=!0;break}if(t)return Math.max(0,(2*n-1)*this.yi)}return s}maxAvoidsLinksSpaceV(t,e,i,s){let n;if(t>this.Ha||e<this.ae||i>this.Ga||i<this.he)return 0;let l=(t-this.ae)/this.yi|0,r=(e-this.ae)/this.yi|0,o=(i-this.he)/this.pi|0,h=s/this.pi+1|0;for(n=0;n<h/2;n++){let t=!1;for(let e=l;e<=r;e++)if(this.Ot[o+n][e]===im.Qs||this.Ot[o-n][e]===im.Qs){t=!0;break}if(t)return Math.max(0,(2*n-1)*this.pi)}return s}MO(t,e,i,s,n,l,r,o){t|=0,e|=0;let h=this.Ot[t][e];if(h>=im.ja&&h<im.Bd)for(s?e+=i:t+=i,h+=1;n<=t&&t<=l&&r<=e&&e<=o&&!(h>=this.Ot[t][e]);)this.Ot[t][e]=h,h+=1,s?e+=i:t+=i;return s?e:t}yo(t,e,i,s,n,l,r,o){if(t<n||t>l||e<r||e>o)return;let h=this.MO(t,e,i,s,n,l,r,o);if(s){if(i>0)for(let a=e+i;a<h;a+=i)this.yo(t,a,1,!s,n,l,r,o),this.yo(t,a,-1,!s,n,l,r,o);else for(let a=e+i;a>h;a+=i)this.yo(t,a,1,!s,n,l,r,o),this.yo(t,a,-1,!s,n,l,r,o)}else if(i>0)for(let a=t+i;a<h;a+=i)this.yo(a,e,1,!s,n,l,r,o),this.yo(a,e,-1,!s,n,l,r,o);else for(let a=t+i;a>h;a+=i)this.yo(a,e,1,!s,n,l,r,o),this.yo(a,e,-1,!s,n,l,r,o)}P1(t,e,i,s,n,l,r,o,h,a){let u=0|t,d=0|e,c=im.Qs,g=im.ja;for(this.Ot[u][d]=g;c===im.Qs&&u>r&&u<o&&d>h&&d<a;)g+=1,this.Ot[u][d]=g,l?d+=n:u+=n,c=this.Ot[u][d];return l?d:u}S1(t,e,i,s,n,l,r,o,h,a){let u=0|i,d=0|s,c=im.Qs,g=im.Bd;for(this.Ot[u][d]=g;c===im.Qs&&u>r&&u<o&&d>h&&d<a;)this.Ot[u][d]=g,l?d+=n:u+=n,c=this.Ot[u][d]}xT(t,e,i,s,n,l){if(null===this.Ot)return;this.by=!1;let r=t.x,o=t.y;if(!this.Ud(r,o))return;r-=this.he,r/=this.pi,o-=this.ae,o/=this.yi;let h=i.x,a=i.y;if(!this.Ud(h,a))return;if(h-=this.he,h/=this.pi,a-=this.ae,a/=this.yi,1>=Math.abs(r-h)&&1>=Math.abs(o-a)){this.by=!0;return}let u=n.x,d=n.y,c=n.x+n.width,g=n.y+n.height;u-=this.he,u/=this.pi,d-=this.ae,d/=this.yi,c-=this.he,c/=this.pi,g-=this.ae,g/=this.yi;let f=Math.max(0,Math.min(this.Ch,0|u)),m=Math.min(this.Ch,Math.max(0,0|c)),p=Math.max(0,Math.min(this.Lh,0|d)),y=Math.min(this.Lh,Math.max(0,0|g)),x=this.Ot,w=0|r,b=0|o,v=0|h,k=0|a,P=0===e||90===e?1:-1,S=90===e||270===e;x[w][b]===im.Qs?(this.P1(w,b,v,k,P,S,f,m,p,y),this.P1(w,b,v,k,1,!S,f,m,p,y),this.P1(w,b,v,k,-1,!S,f,m,p,y)):this.P1(w,b,v,k,P,S,w,b,w,b),x[v][k]===im.Qs?(this.S1(w,b,v,k,0===s||90===s?1:-1,90===s||270===s,f,m,p,y),this.S1(w,b,v,k,1,90!==s&&270!==s,f,m,p,y),this.S1(w,b,v,k,-1,90!==s&&270!==s,f,m,p,y)):this.S1(w,b,v,k,P,S,v,k,v,k);let M=te.rt();if(l&&this.bT(v,k,s,w,b,M)){(M[0]!==v||M[1]!==k)&&(M.unshift(k),M.unshift(v)),(M[M.length-2]!==w||M[M.length-1]!==b)&&(M.push(w),M.push(b));let t=im.ja,e=M[M.length-2],i=M[M.length-1];x[e][i]=t++;for(let s=M.length-4;s>=0;s-=2){e=M[s+2],i=M[s+3];let n=M[s],l=M[s+1];for(;n>e?e++:n<e?e--:l>i?i++:l<i&&i--,x[e][i]=t++,e!==n||i!==l;);}}else this.yo(w,b,1,!1,f,m,p,y),this.yo(w,b,-1,!1,f,m,p,y),this.yo(w,b,1,!0,f,m,p,y),this.yo(w,b,-1,!0,f,m,p,y);te.tt(M)}bT(t,e,i,s,n,l){let r=this.Ot,o=t,h=e;for(;;){if(o===s&&h===n)return!0;let t=o,e=h;if(0===i){if(t<s)t++;else break}else if(90===i){if(e<n)e++;else break}else if(180===i){if(t>s)t--;else break}else if(e>n)e--;else break;let l=r[t][e];if(0===l||l===im.gN)break;o=t,h=e}for(;;){let a=i,u=o,d=h;0===i?d<n?(a=90,d++):d>n&&(a=270,d--):90===i?u<s?(a=0,u++):u>s&&(a=180,u--):180===i?d<n?(a=90,d++):d>n&&(a=270,d--):u<s?(a=0,u++):u>s&&(a=180,u--);let c=r[u][d];if(a!==i&&0!==c&&c!==im.gN){if(l.push(o),l.push(h),this.bT(o,h,a,s,n,l))return!0;l.pop(),l.pop()}if(r[o][h]=im.gN,0===i){if(o===t)return!1;o--}else if(90===i){if(h===e)return!1;h--}else if(180===i){if(o===t)return!1;o++}else{if(h===e)return!1;h++}}}}class ip{Le;pl;hs;Vd;constructor(t,e){tu.qi(this),this.Le=t,this.pl=e,this.hs=[],this.Vd=!1}toString(){let t=this.hs,e=this.Le.toString()+" "+t.length.toString()+":";for(let i=0;i<t.length;i++){let s=t[i];null!==s&&(e+=`
  `+s.toString())}return e}NO(t,e,i,s){let n=e.offsetY;switch(n){case 8:return 90;case 2:return 180;case 1:return 270;case 4:return 0}let l=i;switch(n){case 9:return l>180?270:90;case 6:return 180*(l>90&&l<=270)}let r=180*Math.atan2(t.height,t.width)/Math.PI;switch(n){case 3:return l>r&&l<=180+r?180:270;case 5:return 270*(l>180-r&&l<=360-r);case 12:return 90*(l>r&&l<=180+r);case 10:return l>180-r&&l<=360-r?180:90;case 7:return l>90&&l<=180+r?180:270*(l>180+r&&l<=360-r);case 13:return l>180&&l<=360-r?270:90*(l>r&&l<=180);case 14:return l>r&&l<=180-r?90:180*(l>180-r&&l<=270);case 11:return l>180-r&&l<=180+r?180:l>180+r?270:90}return s&&15!==n&&(l-=15)<0&&(l+=360),l>r&&l<180-r?90:l>=180-r&&l<=180+r?180:270*(l>180+r&&l<360-r)}Ad(){this.hs.length=0}yT(t){let e=this.hs;0===e.length&&(this.CO(),e=this.hs);for(let i=0;i<e.length;i++){let s=e[i];if(null!==s&&s.qe===t)return s}return null}CO(){if(!this.Vd){let t=this.Vd;this.Vd=!0;let e,i=null,s=this.Le,n=s instanceof ib?s:null;if(null===n||n.isSubGraphExpanded)e=s.isTreeExpanded?s.findLinksConnected(this.pl.portId):s.findExternalTreeLinksConnected();else{if(!n.actualBounds.isReal())return this.Vd=t,this.hs;e=(i=n).findExternalLinksConnected()}this.hs.length=0;let l=0,r=this.pl.getDocumentPoint(tv.TopLeft,ty.l()),o=this.pl.getDocumentPoint(tv.BottomRight,ty.l()),h=tw.X(r.x,r.y,0,0);h.unionPoint(o),ty.e(r),ty.e(o);let a=ty.X(h.x+h.width/2,h.y+h.height/2),u=this.pl.getDocumentAngle(),d=e.iterator;for(;d.next();){let t;let e=d.value;if(!e.isVisible()||e.fromPort===e.toPort)continue;let s=e.fromPort===this.pl||null!==e.fromNode&&null!==i&&e.fromNode.isMemberOf(i),n=e.computeSpot(s,this.pl);if(!n.isSide()||null===(t=s?e.toPort:e.fromPort))continue;let r=t.part;if(null===r)continue;let o=r.findVisibleNode();null!==o&&o!==r&&(t=(r=o).port);let c=e.computeOtherPoint(r,t),g=a.directionPoint(c);(g-=u)<0?g+=360:g>=360&&(g-=360);let f=this.NO(h,n,g,e.isOrthogonal),m=0;0===f?(m=4,g>180&&(g-=360)):90===f?(m=8,g>270&&(g-=360)):180===f?m=2:(m=1,g<90&&(g+=360));let p=this.hs[l];void 0===p?(p=new iy(e,g,m),this.hs[l]=p):(p.qe=e,p.Ht=g,p.we=m),p.M1.set(c),l++}ty.e(a),this.LO();let c=this.hs.length,g=-1,f=0;for(l=0;l<c;l++){let t=this.hs[l];void 0!==t&&(t.we!==g&&(g=t.we,f=0),t.zd=f,f++)}for(g=-1,f=0,l=c-1;l>=0;l--){let t=this.hs[l];void 0!==t&&(t.we!==g&&(g=t.we,f=t.zd+1),t.Df=f)}this.AO(this.hs),this.TO(this.hs),this.Vd=t,tw.e(h)}return this.hs}DO(t,e){return t===e?0:null===t?-1:null===e?1:t.we<e.we?-1:t.we>e.we?1:t.Ht<e.Ht?-1:+(t.Ht>e.Ht)}LO(){this.hs.sort(ip.prototype.DO)}AO(t){let e=this.pl,i=this.Le.portSpreading,s=ty.l(),n=ty.l(),l=ty.l(),r=ty.l();e.getDocumentPoint(tv.TopLeft,s),e.getDocumentPoint(tv.TopRight,n),e.getDocumentPoint(tv.BottomRight,l),e.getDocumentPoint(tv.BottomLeft,r);let o=0,h=0,a=0,u=0;if(2===i)for(let e=0;e<t.length;e++){let i=t[e];if(null===i)continue;let s=i.qe.computeThickness();switch(i.we){case 8:a+=s;break;case 2:u+=s;break;case 1:o+=s;break;default:h+=s}}let d=0,c=0,g=1,f=n,m=l,p=0,y=0;for(let e=0;e<t.length;e++){let x=t[e];if(null===x)continue;if(d!==x.we){switch(d=x.we){case 8:f=l,m=r;break;case 2:f=r,m=s;break;case 1:f=s,m=n;break;default:f=n,m=l}switch(p=m.x-f.x,y=m.y-f.y,d){case 8:a>Math.abs(p)?(g=Math.abs(p)/a,a=Math.abs(p)):g=1;break;case 2:u>Math.abs(y)?(g=Math.abs(y)/u,u=Math.abs(y)):g=1;break;case 1:o>Math.abs(p)?(g=Math.abs(p)/o,o=Math.abs(p)):g=1;break;default:h>Math.abs(y)?(g=Math.abs(y)/h,h=Math.abs(y)):g=1}c=0}let w=x.Ed;if(2===i){let t=x.qe.computeThickness();switch(t*=g,w.set(f),d){case 8:w.x=f.x+p/2+a/2-c-t/2;break;case 2:w.y=f.y+y/2+u/2-c-t/2;break;case 1:w.x=f.x+p/2-o/2+c+t/2;break;default:w.y=f.y+y/2-h/2+c+t/2}c+=t}else{let t=.5;1===i&&(t=(x.zd+1)/(x.Df+1)),w.x=f.x+p*t,w.y=f.y+y*t}}ty.e(s),ty.e(n),ty.e(l),ty.e(r)}TO(t){for(let e=0;e<t.length;e++){let i=t[e];null!==i&&(i.b1=this.FO(i))}}FO(t){let e=t.qe,i=e.fromPort===this.pl,s=e.computeEndSegmentLength(this.Le,this.pl,tv.None,i),n=t.zd;if(n<0)return s;let l=t.Df;if(l<=1||!e.isOrthogonal)return s;let r=t.M1,o=t.Ed;(2===t.we||8===t.we)&&(n=l-1-n);let h=ic.iO,a=2===t.we||4===t.we;return(a?r.y<o.y:r.x<o.x)?s+n*h:(a?r.y===o.y:r.x===o.x)?s:s+(l-1-n)*h}}class iy{qe;Ht;we;M1;zd;Df;Ed;b1;constructor(t,e,i){this.qe=t,this.Ht=e,this.we=i,this.M1=new ty,this.zd=0,this.Df=0,this.Ed=new ty,this.b1=0}toString(){return this.qe.toString()+" "+this.Ht.toString()+" "+this.we.toString()+":"+this.zd.toString()+"/"+this.Df.toString()+" "+this.Ed.toString()+" "+this.b1.toString()+" "+this.M1.toString()}}class ix{xa;ba;ka;Pa;Sa;Ma;U0;E0;V0;B0;constructor(){this.xa=tv.Default,this.ba=tv.Default,this.ka=NaN,this.Pa=NaN,this.Sa=NaN,this.Ma=NaN,this.U0=null,this.E0=null,this.V0=1/0,this.B0=1/0}copy(){let t=new ix;return t.xa=this.xa.N(),t.ba=this.ba.N(),t.ka=this.ka,t.Pa=this.Pa,t.Sa=this.Sa,t.Ma=this.Ma,t.U0=this.U0,t.E0=this.E0,t.V0=this.V0,t.B0=this.B0,t}}class iw{T0;D0;F0;A0;bp;kp;constructor(){this.T0=-1/0,this.D0=0,this.F0=ty.Lo,this.A0=0,this.bp="None",this.kp="None"}copy(){let t=new iw;return t.T0=this.T0,t.D0=this.D0,t.F0=this.F0.N(),t.A0=this.A0,t.bp=this.bp,t.kp=this.kp,t}}class ib extends io{Xd;It;ga;u0;ri;ne;constructor(t,e){let i;void 0===t||t instanceof eF||"string"==typeof t?i=t:t&&(e=t),super(i),this.E=4608|this.E,this.Xd=new tu,this.It=null,this.ne=new ik,this.ne.group=this,this.ga=new tu,this.u0=null,this.ri=null,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),this.E=-32769&this.E;let e=t.findInVisualTree(t=>t instanceof iv);e instanceof iv?t.It=e:t.It=null,null!==this.ne?(t.ne=this.ne.copy(),t.ne.group=t):(null!==t.ne&&(t.ne.group=null),t.ne=null),null!==this.ri&&(t.ri=this.ri.copy())}Xo(t){super.Xo(t);let e=t.findSubGraphParts(),i=t.memberParts;for(;i.next();){let t=i.value;if(t.c(),t.invalidateLayout(8),t.clearAdornments(),t instanceof io)t.invalidateConnectedLinks(e);else if(t instanceof ic){let i=t.labelNodes;for(;i.next();)i.value.invalidateConnectedLinks(e)}}}_c(t,e,i,s,n,l,r){if(3===t&&"elements"===e){if(n instanceof iv)null===this.It?this.It=n:this.It!==n&&te.o("Cannot insert a second Placeholder into the visual tree of a Group.");else if(n instanceof eq){let t=n.findInVisualTree(t=>t instanceof iv);t instanceof iv&&(null===this.It?this.It=t:this.It!==t&&te.o("Cannot insert a second Placeholder into the visual tree of a Group."))}}else 4===t&&"elements"===e&&null!==this.It&&(s===this.It?this.It=null:s instanceof eq&&this.It.isContainedBy(s)&&(this.It=null));super._c(t,e,i,s,n,l,r)}td(t,e){if(super.td(t,e),this.isClipping&&this.type!==eq.Spot&&this.isSubGraphExpanded){let t=this.resizeObject;t instanceof eq&&(t=t.findMainElement()),null===this.ri&&(this.ri=new tw),t.getDocumentBounds(this.ri),t instanceof e$&&this.ri.inflate(-t.strokeWidth,-t.strokeWidth)}}ph(t,e,i,s){this.hasPlaceholder()&&(this.Zo=this.placeholder),super.ph(t,e,i,s)}ensureBounds(){this.isSubGraphExpanded&&this.memberParts.each(t=>{t.ensureBounds()}),super.ensureBounds()}Jr(){if(!super.Jr())return!1;let t=this.memberParts;for(;t.next();){let e=t.value;if(e instanceof io){if(!e.isVisible())continue;if(e.es())return!1}else if(e instanceof ic){if(!e.isVisible())continue;if(e.es()&&e.fromNode!==this&&e.toNode!==this)return!1}}return!0}hasPlaceholder(){return null!==this.It&&this.It.isVisibleObject()&&this.isSubGraphExpanded}get placeholder(){return this.It}get computesBoundsAfterDrag(){return(2048&this.E)!=0}set computesBoundsAfterDrag(t){let e=(2048&this.E)!=0;e!==t&&(this.E=2048^this.E,this.t("computesBoundsAfterDrag",e,t))}get computesBoundsIncludingLinks(){return(4096&this.E)!=0}set computesBoundsIncludingLinks(t){let e=(4096&this.E)!=0;e!==t&&(this.E=4096^this.E,this.t("computesBoundsIncludingLinks",e,t))}get computesBoundsIncludingLocation(){return(8192&this.E)!=0}set computesBoundsIncludingLocation(t){let e=(8192&this.E)!=0;e!==t&&(this.E=8192^this.E,this.t("computesBoundsIncludingLocation",e,t))}get handlesDragDropForMembers(){return(16384&this.E)!=0}set handlesDragDropForMembers(t){let e=(16384&this.E)!=0;e!==t&&(this.E=16384^this.E,this.t("handlesDragDropForMembers",e,t))}get avoidableMembers(){return(131072&this.E)!=0}set avoidableMembers(t){let e=(131072&this.E)!=0;e!==t&&(this.E=131072^this.E,this.t("avoidableMembers",e,t))}get memberParts(){return this.Xd.iterator}$2(t){if(this.Xd.add(t)){t instanceof ib&&this.ga.add(t);let e=this.memberAdded;if(null!==e){let i=!0,s=this.diagram;null!==s&&(i=s.K,s.K=!0),e(this,t),null!==s&&(s.K=i)}this.isVisible()&&this.isSubGraphExpanded||t.Vi(!1)}if(t instanceof ic&&!this.computesBoundsIncludingLinks)return;let e=this.It;null===e&&(e=this),e.c()}J2(t){if(this.Xd.delete(t)){t instanceof ib&&this.ga.delete(t);let e=this.memberRemoved;if(null!==e){let i=!0,s=this.diagram;null!==s&&(i=s.K,s.K=!0),e(this,t),null!==s&&(s.K=i)}this.isVisible()&&this.isSubGraphExpanded||t.Vi(!0)}if(t instanceof ic&&!this.computesBoundsIncludingLinks)return;let e=this.It;null===e&&(e=this),e.c()}qc(){if(this.Xd.count>0){let t=this.diagram;if(null!==t){let e=this.Xd.copy().iterator;for(;e.next();){let i=e.value;t.remove(i)}}}super.qc()}get layout(){return this.ne}set layout(t){let e=this.ne;if(e!==t){null!==t&&null!==t.diagram&&t.diagram.layout===t&&te.o("A layout cannot be both the Diagram.layout and a Group.layout: "+t),null!==e&&(e.diagram=null,e.group=null),this.ne=t;let i=this.diagram;null!==t&&(t.diagram=i,t.group=this),null!==i&&(i.jr=!0),this.t("layout",e,t),null!==i&&i.requestUpdate()}}get memberAdded(){return null!==this.Et?this.Et.gy:null}set memberAdded(t){let e=this.memberAdded;e!==t&&(null!==t&&te.S(t,ib,"memberAdded"),this.gl().gy=t,this.t("memberAdded",e,t))}get memberRemoved(){return null!==this.Et?this.Et.my:null}set memberRemoved(t){let e=this.memberRemoved;e!==t&&(null!==t&&te.S(t,ib,"memberRemoved"),this.gl().my=t,this.t("memberRemoved",e,t))}get memberValidation(){return null!==this.Et?this.Et.ah:null}set memberValidation(t){let e=this.memberValidation;e!==t&&(null!==t&&te.S(t,ib,"memberValidation"),this.gl().ah=t,this.t("memberValidation",e,t))}canAddMembers(t){let e=this.diagram;if(null===e)return!1;let i=e.commandHandler,s=i.h2(t).iterator;for(;s.next();){let t=s.value;if(!i.isValidMember(this,t))return!1}return!0}addMembers(t,e){let i=this.diagram;if(null===i)return!1;let s=i.commandHandler,n=s.h2(t),l=!0,r=n.iterator;for(;r.next();){let t=r.value;!e||s.isValidMember(this,t)?t.containingGroup=this:l=!1}return l}get ungroupable(){return(256&this.E)!=0}set ungroupable(t){let e=(256&this.E)!=0;e!==t&&(this.E=256^this.E,this.t("ungroupable",e,t))}canUngroup(){if(!this.ungroupable)return!1;let t=this.layer;if(null===t||!t.allowUngroup)return!1;let e=t.diagram;return!(null!==e&&!e.allowUngroup)}invalidateConnectedLinks(t){let e=this.RO();if(super.invalidateConnectedLinks(t),e)return;this.IL(!0);let i=this.findExternalLinksConnected();for(;i.next();){let e=i.value;if(void 0!==t&&t.has(e))continue;let s=e.fromNode;if(null!==s&&s!==this&&s.isMemberOf(this)&&!s.isVisible())s.$i(e.fromPort),s.$i(e.toPort),e.invalidateRoute();else{let t=e.toNode;null!==t&&t!==this&&t.isMemberOf(this)&&!t.isVisible()&&(t.$i(e.fromPort),t.$i(e.toPort),e.invalidateRoute())}}}findExternalLinksConnected(){let t=null!==this.diagram&&this.diagram.yM;if(t&&null!==this.u0)return this.u0.iterator;let e=this.findSubGraphParts();e.add(this);let i=new tu,s=e.iterator;for(;s.next();){let t=s.value;if(!(t instanceof io))continue;let n=t.linksConnected;for(;n.next();){let t=n.value;e.has(t)||i.add(t)}}return t&&(this.u0=i),i.iterator}findExternalNodesConnected(){let t=this.findSubGraphParts();t.add(this);let e=new tu,i=t.iterator;for(;i.next();){let s=i.value;if(!(s instanceof io))continue;let n=s.linksConnected;for(;n.next();){let i=n.value,s=i.fromNode;null===s||t.has(s)&&s!==this||e.add(s);let l=i.toNode;null===l||t.has(l)&&l!==this||e.add(l)}}return e.iterator}CE(){let t=new tu;return function t(e,i){null!==e&&(i.add(e),t(e.containingGroup,i))}(this,t),t}findSubGraphParts(){let t=new tu;return ii.ch(t,this,!0,0,!0),t.delete(this),t}Vi(t){super.Vi(t);let e=this.memberParts;for(;e.next();)e.value.Vi(t)}collapseSubGraph(){let t=this.diagram;if(null===t||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;let e=this.findSubGraphParts();this.kT(e,t,this),t.isCollapsingExpanding=!1}kT(t,e,i){let s=this.memberParts;for(;s.next();){let n=s.value;if(n.Vi(!1),n instanceof ib&&n.isSubGraphExpanded&&(n.wasSubGraphExpanded=n.isSubGraphExpanded,n.kT(t,e,i)),n instanceof io)n.invalidateConnectedLinks(t),e.vc(n,i);else if(n instanceof ic){let e=n.labelNodes;for(;e.next();)e.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!1}expandSubGraph(){let t=this.diagram;if(null===t||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;let e=this.findSubGraphParts();this.PT(e,t,this),t.isCollapsingExpanding=!1}PT(t,e,i){let s=this.memberParts;for(;s.next();){let n=s.value;if(n.Vi(!0),n instanceof ib&&n.wasSubGraphExpanded&&(n.wasSubGraphExpanded=!1,n.PT(t,e,i)),n instanceof io)n.invalidateConnectedLinks(t);else if(n instanceof ic){let e=n.labelNodes;for(;e.next();)e.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!0}get isSubGraphExpanded(){return(512&this.E)!=0}set isSubGraphExpanded(t){let e=(512&this.E)!=0;if(e!==t){this.E=512^this.E;let i=this.diagram;this.t("isSubGraphExpanded",e,t);let s=this.subGraphExpandedChanged;if(null!==s){let t=!0;null!==i&&(t=i.K,i.K=!0),s(this),null!==i&&(i.K=t)}if(null!==i&&i.undoManager.isUndoingRedoing){null!==this.It&&this.It.c(),this.memberParts.each(t=>t.updateAdornments());return}t?this.expandSubGraph():this.collapseSubGraph()}}get wasSubGraphExpanded(){return(1024&this.E)!=0}set wasSubGraphExpanded(t){let e=(1024&this.E)!=0;e!==t&&(this.E=1024^this.E,this.t("wasSubGraphExpanded",e,t))}get subGraphExpandedChanged(){return null!==this.Et?this.Et.py:null}set subGraphExpandedChanged(t){let e=this.subGraphExpandedChanged;e!==t&&(null!==t&&te.S(t,ib,"subGraphExpandedChanged"),this.gl().py=t,this.t("subGraphExpandedChanged",e,t))}move(t,e){void 0===e&&(e=!1);let i=e?this.location:this.position,s=i.x,n=i.y,l=t.x,r=t.y;if((s===l||isNaN(s)&&isNaN(l))&&(n===r||isNaN(n)&&isNaN(r)))return;let o=l-(isNaN(s)?0:s),h=r-(isNaN(n)?0:n),a=ty.l();super.move(t,e);let u=new tu,d=this.findSubGraphParts().iterator;for(;d.next();){let t=d.value;t instanceof ic&&(t.suspendsRouting&&u.add(t),(t.Ce||t.fromNode!==this&&t.toNode!==this)&&(t.suspendsRouting=!0))}for(d.reset();d.next();){let t=d.value;if(t.Rl()||t instanceof io&&t.isLinkLabel)continue;let e=t.position,i=t.location;e.isReal()?(a.x=e.x+o,a.y=e.y+h,t.position=a):i.isReal()&&(a.x=i.x+o,a.y=i.y+h,t.location=a)}for(d.reset();d.next();){let t=d.value;if(!(t instanceof ic)||(t.suspendsRouting=u.has(t),!t.Ce&&(t.fromNode===this||t.toNode===this)))continue;let e=t.position;a.x=e.x+o,a.y=e.y+h,a.isReal()?t.move(a):t.invalidateRoute()}ty.e(a)}RO(){return(65536&this.E)!=0}IL(t){(65536&this.E)!=0!==t&&(this.E=65536^this.E)}get ma(){return(32768&this.E)!=0}set ma(t){(32768&this.E)!=0!==t&&(this.E=32768^this.E)}}class iv extends eb{ti;Yd;constructor(t){super(),this.ti=tb.Bg,this.Yd=new tw(NaN,NaN,NaN,NaN),t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.ti=this.ti.N(),t.Yd=this.Yd.copy()}mh(t){if(null===this.background)return!1;let e=this.naturalBounds;return tw.contains(0,0,e.width,e.height,t.x,t.y)}_u(t,e,i,s){let n=this.part;if(null!==n&&(n instanceof ib||n instanceof il)||te.o("Placeholder is not inside a Group or Adornment."),n instanceof ib){let t=this.computeBorder(this.Yd),e=this.minSize,i=isFinite(e.width)?Math.max(e.width,t.width):t.width,s=isFinite(e.height)?Math.max(e.height,t.height):t.height,l=this.Ki;l.zn(i||0,s||0),this.so(0,0,l.width,l.height);let r=n.memberParts,o=!1;for(;r.next();)if(r.value.isVisible()){o=!0;break}let h=n.diagram;if(o&&null!==h&&!h.animationManager.DS(n)&&!isNaN(t.x)&&!isNaN(t.y)){let e=ty.l();e.setRectSpot(t,n.locationSpot),n.location=e,ty.e(e)}}else{let t=this.Ki,e=this.ti,i=e.left+e.right,s=e.top+e.bottom,l=n.adornedObject;n.angle=l.getDocumentAngle();let r=0;l instanceof e$&&(r=l.strokeWidth);let o=l.getDocumentScale(),h=l.naturalBounds,a=(h.width+r)*o,u=(h.height+r)*o;if(n.type!==eq.Link){let t="Selection"===n.category?tv.TopLeft:n.locationSpot,e=l.getDocumentPoint(t,ty.l());n.location=e,ty.e(e)}if(isNaN(a)||isNaN(u)){let n=l.getDocumentPoint(tv.TopLeft,ty.l()),r=tw.X(n.x,n.y,0,0);r.unionPoint(l.getDocumentPoint(tv.BottomRight,n)),r.unionPoint(l.getDocumentPoint(tv.TopRight,n)),r.unionPoint(l.getDocumentPoint(tv.BottomLeft,n)),t.zn(r.width+i||0,r.height+s||0),this.so(-e.left,-e.top,t.width,t.height),ty.e(n),tw.e(r)}else t.zn(a+i||0,u+s||0),this.so(-e.left,-e.top,t.width,t.height)}}ph(t,e,i,s){this.actualBounds.i(t,e,i,s)}computeBorder(t){let e=this.part,i=e.diagram,s=null===i||!i.animationManager.isAnimating;if(null!==i&&e instanceof ib&&!e.layer.isTemporary&&e.computesBoundsAfterDrag&&this.Yd.isReal()){let s=i.toolManager.findTool("Dragging");if(s===i.currentTool){let i=s.computeBorder(e,this.Yd,t);if(null!==i)return i}}let n=tw.l(),l=this.computeMemberBounds(n),r=this.ti;return e instanceof ib&&!e.isSubGraphExpanded?t.i(l.x-r.left,l.y-r.top,0,0):t.i(l.x-r.left,l.y-r.top,Math.max(l.width+r.left+r.right,0),Math.max(l.height+r.top+r.bottom,0)),tw.e(n),s&&e instanceof ib&&e.computesBoundsIncludingLocation&&e.location.isReal()&&t.unionPoint(e.location),t}computeMemberBounds(t){if(!(this.part instanceof ib))return t.i(0,0,0,0),t;let e=this.part,i=1/0,s=1/0,n=-1/0,l=-1/0,r=e.memberParts;for(;r.next();){let t=r.value;if(!t.isVisible()||t instanceof ic&&(!e.computesBoundsIncludingLinks||t.Bo()||t.fromNode===e||t.toNode===e))continue;let o=t.actualBounds;o.left<i&&(i=o.left),o.top<s&&(s=o.top),o.right>n&&(n=o.right),o.bottom>l&&(l=o.bottom)}if(isFinite(i)&&isFinite(s))t.i(i,s,n-i,l-s);else{let i=e.location;t.i(i.x,i.y,0,0)}return t}get padding(){return this.ti}set padding(t){"number"==typeof t&&(t=new tb(t));let e=this.ti;e.equals(t)||(t=t.N(),this.ti=t,this.t("padding",e,t),this.c())}}class ik{L;pa;Kd;Nr;Gd;Hd;Oo;yl;jd;qd;wo;constructor(t){tu.qi(this),this.L=null,this.pa=null,this.Kd=!0,this.Nr=!0,this.Gd=!1,this.Hd=new ty(0,0).u(),this.Oo=!0,this.yl=null,this.jd=null,this.qd=!1,this.wo=null,t&&Object.assign(this,t)}cloneProtected(t){t.Kd=this.Kd,t.Nr=this.Nr,t.Gd=this.Gd,t.Hd.a(this.Hd),t.Oo=this.Oo,t.yl=this.yl,t.jd=this.jd,t.qd=!0}copy(){let t=new this.constructor;return this.cloneProtected(t),t}hi(t){te.cr(this,t)}toString(){let t=te.Vn(this.constructor);return t+="(",null!==this.group&&(t+=" in "+this.group),null!==this.diagram&&(t+=" for "+this.diagram),t+=")"}get diagram(){return this.L}set diagram(t){this.L=t}get group(){return this.pa}set group(t){this.pa!==t&&(this.pa=t,null!==t&&(this.L=t.diagram))}get isOngoing(){return this.Kd}set isOngoing(t){this.Kd!==t&&(te.s(t,"boolean",ik,"isOngoing"),this.Kd=t)}get isInitial(){return this.Nr}set isInitial(t){te.s(t,"boolean",ik,"isInitial"),this.Nr=t,t||(this.qd=!0)}get isViewportSized(){return this.Gd}set isViewportSized(t){this.Gd!==t&&(te.s(t,"boolean",ik,"isViewportSized"),this.Gd=t,t&&this.invalidateLayout())}get isRouting(){return this.Oo}set isRouting(t){this.Oo!==t&&(te.s(t,"boolean",ik,"isRouting"),this.Oo=t)}get isRealtime(){return this.yl}set isRealtime(t){this.yl!==t&&(null!==t&&te.s(t,"boolean",ik,"isRealtime"),this.yl=t)}get isValidLayout(){return this.qd}set isValidLayout(t){if(this.qd!==t&&(te.s(t,"boolean",ik,"isValidLayout"),this.qd=t,!t)){let t=this.diagram;null!==t&&(t.jr=!0)}}invalidateLayout(){if(this.isValidLayout){let t=this.diagram;if(null===t||t.undoManager.isUndoingRedoing)return;let e=t.animationManager;!e.isTicking&&(e.defaultAnimation.isAnimating&&e.stopAnimation(),(this.isOngoing&&t.Kh||this.isInitial&&!t.Kh)&&(this.isValidLayout=!1,t.requestUpdate()))}}get network(){return this.wo}set network(t){this.wo!==t&&(this.wo=t,null!==t&&(t.layout=this))}createNetwork(){return new iP(this)}makeNetwork(t){let e=this.createNetwork();return t instanceof eh?(e.addParts(t.nodes,!0),e.addParts(t.links,!0)):t instanceof ib?e.addParts(t.memberParts):e.addParts(t.iterator),e}updateParts(){this.isValidLayout=!0;let t=this.diagram;if(null===t&&null!==this.network){let e=this.network.vertexes.iterator;for(;e.next();){let i=e.value.node;if(null!==i&&null!==(t=i.diagram))break}}try{null!==t&&t.startTransaction("Layout"),this.commitLayout()}finally{null!==t&&t.commitTransaction("Layout")}}commitLayout(){if(null===this.network)return;let t=this.network.vertexes.iterator;for(;t.next();)t.value.commit();if(this.isRouting){let t=this.network.edges.iterator;for(;t.next();)t.value.commit()}}doLayout(t){let e=new tu;if(t instanceof eh?(this.Ah(e,t.nodes,!0,this.ma,!0,!1,!0),this.Ah(e,t.parts,!0,this.ma,!0,!1,!0)):t instanceof ib?this.Ah(e,t.memberParts,!1,this.ma,!0,!1,!0):e.addAll(t.iterator),e.count>0){let t=this.diagram;null!==t&&t.startTransaction("Layout"),this.doMinimalNoNetworkLayout(e),null!==t&&t.commitTransaction("Layout")}this.isValidLayout=!0}doMinimalNoNetworkLayout(t){let e=Math.ceil(Math.sqrt(t.count));this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);let i=this.arrangementOrigin.x,s=this.arrangementOrigin.y,n=i,l=s,r=0,o=0,h=t.iterator;for(;h.next();){let t=h.value;t.ensureBounds();let s=t.measuredBounds,a=s.width,u=s.height;t.moveTo(n,l),t instanceof ib&&(t.ma=!1),n+=Math.max(a,50)+20,o=Math.max(o,Math.max(u,50)),r>=e-1?(r=0,n=i,l+=o+20,o=0):r++}}ma(t){return!!(!t.location.isReal()&&!t.position.isReal()||t instanceof ib&&t.ma)}Ah(t,e,i,s,n,l,r){let o=e.iterator;for(;o.next();){let e=o.value;if(!(i&&!e.isTopLevel)&&!(null!==s&&!s(e))&&e.canLayout()){if(n&&e instanceof io){if(e.isLinkLabel)continue;e instanceof ib&&null===e.layout?this.Ah(t,e.memberParts,!1,s,n,l,r):(e.ensureBounds(),t.add(e))}else l&&e instanceof ic?t.add(e):r&&e.Me()&&!(e instanceof io)&&(e.ensureBounds(),t.add(e))}}}getLayoutBounds(t,e){let i=this.boundsComputation;return null!==i?(e||(e=new tw),i(t,this,e)):!e&&t.margin.equalTo(0,0,0,0)?t.actualBounds:(e||(e=new tw),e.set(t.actualBounds),e.addMargin(t.margin),e)}get boundsComputation(){return this.jd}set boundsComputation(t){this.jd!==t&&(null!==t&&te.S(t,ik,"boundsComputation"),this.jd=t,this.invalidateLayout())}collectParts(t){let e=new tu;return t instanceof eh?(this.Ah(e,t.nodes,!0,null,!0,!0,!0),this.Ah(e,t.links,!0,null,!0,!0,!0),this.Ah(e,t.parts,!0,null,!0,!0,!0)):t instanceof ib?this.Ah(e,t.memberParts,!1,null,!0,!0,!0):this.Ah(e,t.iterator,!1,null,!0,!0,!0),e}get arrangementOrigin(){return this.Hd}set arrangementOrigin(t){this.Hd.equals(t)||(this.Hd.a(t),this.invalidateLayout())}initialOrigin(t){let e=this.group;if(null!==e){if(e.hasPlaceholder()){let i=e.placeholder,s=i.getDocumentPoint(tv.TopLeft);(isNaN(s.x)||isNaN(s.y))&&s.set(t);let n=i.padding;return s.x+=n.left,s.y+=n.top,s}{let i=e.position.copy();return(isNaN(i.x)||isNaN(i.y))&&i.set(t),i}}return t}}class iP{ne;xo;Tn;ky;Py;constructor(t){tu.qi(this),this.ne=t,this.xo=new tu,this.Tn=new tu,this.ky=new tp,this.Py=new tp}clear(){if(this.xo){let t=this.xo.iterator;for(;t.next();)t.value.clear()}if(this.Tn){let t=this.Tn.iterator;for(;t.next();)t.value.clear()}this.xo=new tu,this.Tn=new tu,this.ky=new tp,this.Py=new tp}toString(t){void 0===t&&(t=0);let e="LayoutNetwork"+(null!==this.layout?"("+this.layout.toString()+")":"");if(t<=0)return e;if(e+=" vertexes: "+this.xo.count+" edges: "+this.Tn.count,t>1){let i=this.xo.iterator;for(;i.next();)e+=`
    `+i.value.toString(t-1);let s=this.Tn.iterator;for(;s.next();)e+=`
    `+s.value.toString(t-1)}return e}get layout(){return this.ne}set layout(t){null!==t&&(this.ne=t)}get vertexes(){return this.xo}get edges(){return this.Tn}createVertex(){return new iS(this)}createEdge(){return new iM(this)}addParts(t,e,i){if(null===t)return;void 0===e&&(e=!1),te.s(e,"boolean",iP,"addParts:toplevelonly"),void 0===i&&(i=null),null===i&&(i=t=>{if(t instanceof io)return!t.isLinkLabel;if(t instanceof ic){let e=t.fromNode;if(null===e||e.isLinkLabel)return!1;let i=t.toNode;return!(null===i||i.isLinkLabel)}return!1});let s=t.iterator;for(;s.next();){let t=s.value;if(t instanceof io&&!(e&&!t.isTopLevel)&&t.canLayout()&&i(t)){if(t instanceof ib&&null===t.layout)this.addParts(t.memberParts,!1);else{if(null!==this.findVertex(t))continue;let e=this.createVertex();e.node=t,this.addVertex(e)}}}for(s.reset();s.next();){let t=s.value;if(!(t instanceof ic)||e&&!t.isTopLevel||!t.canLayout()||!i(t)||null!==this.findEdge(t))continue;let n=t.fromNode,l=t.toNode;if(null===n||null===l||n===l)continue;let r=this.findGroupVertex(n),o=this.findGroupVertex(l);this.linkVertexes(r,o,t)}}findGroupVertex(t){let e=t.findVisibleNode();if(null===e)return null;let i=this.findVertex(e);if(null!==i)return i;let s=e.containingGroup;for(;null!==s;){if(null!==(i=this.findVertex(s)))return i;s=s.containingGroup}return null}addVertex(t){this.xo.add(t);let e=t.node;null!==e&&this.ky.set(e,t),t.network=this}addNode(t){let e=this.findVertex(t);return null===e&&((e=this.createVertex()).node=t,this.addVertex(e)),e}deleteVertex(t){if(this.ST(t)){let e=t.tr;for(let t=e.count-1;t>=0;t--){let i=e.elt(t);this.deleteEdge(i)}e=t.ir;for(let t=e.count-1;t>=0;t--){let i=e.elt(t);this.deleteEdge(i)}}}ST(t){let e=this.xo.delete(t);if(e){let e=t.node;null!==e&&this.ky.delete(e)}return e}deleteNode(t){let e=this.findVertex(t);null!==e&&this.deleteVertex(e)}findVertex(t){return this.ky.get(t)}addEdge(t){this.mN(t);let e=t.toVertex;null!==e&&e.addSourceEdge(t);let i=t.fromVertex;null!==i&&i.addDestinationEdge(t)}mN(t){this.Tn.add(t);let e=t.link;null!==e&&null===this.findEdge(e)&&this.Py.set(e,t),t.network=this}addLink(t){let e=t.fromNode,i=t.toNode,s=this.findEdge(t);return null===s?((s=this.createEdge()).link=t,null!==e&&(s.fromVertex=this.addNode(e)),null!==i&&(s.toVertex=this.addNode(i)),this.addEdge(s)):(null!==e?s.fromVertex=this.addNode(e):s.fromVertex=null,null!==i?s.toVertex=this.addNode(i):s.toVertex=null),s}deleteEdge(t){let e=t.toVertex;null!==e&&e.deleteSourceEdge(t);let i=t.fromVertex;null!==i&&i.deleteDestinationEdge(t),this.pN(t)}pN(t){let e=this.Tn.delete(t);if(e){let e=t.link;null!==e&&this.Py.delete(e)}return e}deleteLink(t){let e=this.findEdge(t);null!==e&&this.deleteEdge(e)}findEdge(t){return this.Py.get(t)}linkVertexes(t,e,i){if(null===t||null===e)return null;if(t.network===this&&e.network===this){let s=this.createEdge();return s.link=i,s.fromVertex=t,s.toVertex=e,this.addEdge(s),s}return null}reverseEdge(t){let e=t.fromVertex,i=t.toVertex;null===e||null===i||(e.deleteDestinationEdge(t),i.deleteSourceEdge(t),t.reverseEdge(),e.addSourceEdge(t),i.addDestinationEdge(t))}deleteSelfEdges(){let t=te.rt(),e=this.Tn.iterator;for(;e.next();){let i=e.value;i.fromVertex===i.toVertex&&t.push(i)}let i=t.length;for(let e=0;e<i;e++)this.deleteEdge(t[e]);te.tt(t)}deleteArtificialVertexes(){let t=te.rt(),e=this.xo.iterator;for(;e.next();){let i=e.value;null===i.node&&null===i.data&&t.push(i)}let i=t.length;for(let e=0;e<i;e++)this.deleteVertex(t[e]);let s=te.rt(),n=this.Tn.iterator;for(;n.next();){let t=n.value;null===t.link&&null===t.data&&s.push(t)}i=s.length;for(let t=0;t<i;t++)this.deleteEdge(s[t]);te.tt(t),te.tt(s)}deleteUselessEdges(){let t=te.rt(),e=this.Tn.iterator;for(;e.next();){let i=e.value;(null===i.fromVertex||null===i.toVertex)&&t.push(i)}let i=t.length;for(let e=0;e<i;e++)this.deleteEdge(t[e]);te.tt(t)}isSingleton(t){return!(t.tr.count>0||t.ir.count>0)}splitIntoSubNetworks(t){void 0===t&&(t=!0),t&&(this.deleteArtificialVertexes(),this.deleteUselessEdges(),this.deleteSelfEdges());let e=new th,i=!0;for(;i;){i=!1;let t=this.xo.iterator;for(;t.next();){let s=t.value;if(this.isSingleton(s))continue;let n=this.layout.createNetwork();e.add(n),this.vO(n,s),i=!0;break}}return e.sort((t,e)=>null===t||null===e||t===e?0:e.vertexes.count-t.vertexes.count),e}vO(t,e){if(null===e)return;let i=new th;for(i.add(e);i.count>0;){let e=i.first();if(i.removeAt(0),!e||e.network===t)continue;this.ST(e),t.addVertex(e);let s=e.sourceEdges;for(;s.next();){let e=s.value;e.network!==t&&(this.pN(e),t.mN(e),e.fromVertex&&i.add(e.fromVertex))}for(s=e.destinationEdges;s.next();){let e=s.value;e.network!==t&&(this.pN(e),t.mN(e),e.toVertex&&i.add(e.toVertex))}}}findAllParts(){let t=new tu,e=this.xo.iterator;for(;e.next();){let i=e.value;i.node&&t.add(i.node)}let i=this.Tn.iterator;for(;i.next();){let e=i.value;e.link&&t.add(e.link)}return t}}class iS{wo;ei;Le;De;We;tr;ir;constructor(t){tu.qi(this),this.wo=t,this.De=new tw(0,0,10,10).u(),this.We=new ty(5,5).u(),this.ei=null,this.Le=null,this.tr=new th,this.ir=new th}clear(){this.ei=null,this.Le=null,this.tr=new th,this.ir=new th}toString(t){void 0===t&&(t=0);let e="LayoutVertex#"+tu.us(this);if(t>0&&(e+=null!==this.node?"("+this.node.toString()+")":"",t>1)){let t="",i=!0,s=this.tr.iterator;for(;s.next();)i?i=!1:t+=",",t+=s.value.toString(0);let n="";for(i=!0,s=this.ir.iterator;s.next();)i?i=!1:n+=",",n+=s.value.toString(0);e+=" sources: "+t+" destinations: "+n}return e}get bo(){return this.tr.rC}get er(){return this.ir.rC}get data(){return this.ei}set data(t){if(this.ei=t,null!==t&&t.bounds){let e=t.bounds,i=e.x,s=e.y,n=e.width,l=e.height;this.We.i(n/2,l/2),this.De.i(i,s,n,l)}}get node(){return this.Le}set node(t){if(this.Le!==t){if(this.Le=t,null===t)return;t.ensureBounds();let e=this.network.layout,i=tw.l(),s=e.getLayoutBounds(t,i),n=s.x,l=s.y,r=s.width,o=s.height;if(isNaN(n)&&(n=0),isNaN(l)&&(l=0),this.De.i(n,l,r,o),tw.e(i),!(t instanceof ib)){let e=t.locationObject.getDocumentPoint(tv.Center);if(e.isReal()){this.We.i(e.x-n,e.y-l);return}}this.We.i(r/2,o/2)}}get bounds(){return this.De}set bounds(t){this.De.equals(t)||this.De.a(t)}get focus(){return this.We}set focus(t){this.We.equals(t)||this.We.a(t)}get centerX(){return this.De.x+this.We.x}set centerX(t){let e=this.De;e.x+this.We.x!==t&&(e.At(),e.x=t-this.We.x,e.u())}get centerY(){return this.De.y+this.We.y}set centerY(t){let e=this.De;e.y+this.We.y!==t&&(e.At(),e.y=t-this.We.y,e.u())}get focusX(){return this.We.x}set focusX(t){let e=this.We;e.x!==t&&(e.At(),e.x=t,e.u())}get focusY(){return this.We.y}set focusY(t){let e=this.We;e.y!==t&&(e.At(),e.y=t,e.u())}get x(){return this.De.x}set x(t){let e=this.De;e.x!==t&&(e.At(),e.x=t,e.u())}get y(){return this.De.y}set y(t){let e=this.De;e.y!==t&&(e.At(),e.y=t,e.u())}get width(){return this.De.width}set width(t){let e=this.De;e.width!==t&&(e.At(),e.width=t,e.u())}get height(){return this.De.height}set height(t){let e=this.De;e.height!==t&&(e.At(),e.height=t,e.u())}commit(){let t=this.ei;if(null!==t){let e=this.bounds,i=t.bounds;te.H(i)?(i.x=e.x,i.y=e.y,i.width=e.width,i.height=e.height):t.bounds=e.copy();return}let e=this.node;if(null!==e){let t=this.bounds;if(!(e instanceof ib)){let i=tw.l();e.ensureBounds();let s=this.network.layout.getLayoutBounds(e,i),n=e.locationObject.getDocumentPoint(tv.Center);if(s.isReal()&&n.isReal()){e.moveTo(t.x+this.focusX-(n.x-s.x)+e.margin.left,t.y+this.focusY-(n.y-s.y+e.margin.top)),tw.e(i);return}tw.e(i)}e.moveTo(t.x+e.margin.left,t.y+e.margin.top)}}addSourceEdge(t){null!==t&&(this.tr.has(t)||this.tr.add(t))}deleteSourceEdge(t){null!==t&&this.tr.delete(t)}addDestinationEdge(t){null!==t&&(this.ir.has(t)||this.ir.add(t))}deleteDestinationEdge(t){null!==t&&this.ir.delete(t)}get network(){return this.wo}set network(t){this.wo=t}get sourceVertexes(){let t=new tu,e=this.sourceEdges;for(;e.next();){let i=e.value;i.fromVertex&&t.add(i.fromVertex)}return t.iterator}get destinationVertexes(){let t=new tu,e=this.destinationEdges;for(;e.next();){let i=e.value;i.toVertex&&t.add(i.toVertex)}return t.iterator}get vertexes(){let t=new tu,e=this.sourceEdges;for(;e.next();){let i=e.value;i.fromVertex&&t.add(i.fromVertex)}for(e=this.destinationEdges;e.next();){let i=e.value;i.toVertex&&t.add(i.toVertex)}return t.iterator}get sourceEdges(){return this.tr.iterator}get destinationEdges(){return this.ir.iterator}get edges(){let t=new th,e=this.sourceEdges;for(;e.next();){let i=e.value;t.add(i)}for(e=this.destinationEdges;e.next();){let i=e.value;t.add(i)}return t.iterator}get edgesCount(){return this.tr.count+this.ir.count}static standardComparer(t,e){let i=t.Le,s=e.Le;if(!i)return null!==s?-1:0;if(!s)return 1;{let t=i.text,e=s.text;return t<e?-1:+(t>e)}}static smartComparer(t,e){if(null===t)return null!==e?-1:0;if(null===e)return 1;{let i=t.Le,s=e.Le;if(null===i)return null!==s?-1:0;if(null===s)return 1;{let t=i.text.toLocaleLowerCase(),e=s.text.toLocaleLowerCase(),n=t.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),l=e.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),r=0;for(;r<n.length;r++)if(""!==l[r]&&void 0!==l[r]){let t=parseFloat(n[r]),e=parseFloat(l[r]);if(isNaN(t)){if(!isNaN(e))return 1;if(0!==n[r].localeCompare(l[r]))return n[r].localeCompare(l[r]);continue}if(isNaN(e))return -1;if(t-e!=0)return t-e;continue}else{if(""===n[r])continue;return 1}return""!==l[r]&&void 0!==l[r]?-1:0}}}}class iM{wo;ei;qe;Je;$e;constructor(t){tu.qi(this),this.wo=t,this.ei=null,this.qe=null,this.Je=null,this.$e=null}clear(){this.ei=null,this.qe=null,this.Je=null,this.$e=null}toString(t){void 0===t&&(t=0);let e="LayoutEdge#"+tu.us(this);return t>0&&(e+=null!==this.qe?"("+this.qe.toString()+")":"",t>1&&(e+=" "+(this.Je?this.Je.toString():"null")+" --\x3e "+(this.$e?this.$e.toString():"null"))),e}reverseEdge(){let t=this.Je;this.Je=this.$e,this.$e=t}commit(){}getOtherVertex(t){return this.$e===t?this.Je:this.Je===t?this.$e:null}get network(){return this.wo}set network(t){this.wo=t}get data(){return this.ei}set data(t){this.ei!==t&&(this.ei=t)}get link(){return this.qe}set link(t){this.qe!==t&&(this.qe=t)}get fromVertex(){return this.Je}set fromVertex(t){this.Je!==t&&(this.Je=t)}get toVertex(){return this.$e}set toVertex(t){this.$e!==t&&(this.$e=t)}}var iN=((O=iN||{})[O.Position=0]="Position",O[O.Location=1]="Location",O),iC=((R=iC||{})[R.LeftToRight=10]="LeftToRight",R[R.RightToLeft=11]="RightToLeft",R),iL=((B=iL||{})[B.Forwards=20]="Forwards",B[B.Reverse=21]="Reverse",B[B.Ascending=22]="Ascending",B[B.Descending=23]="Descending",B);class iT extends ik{Wd;Jd;Do;Dn;fi;Gi;xe;be;constructor(t){super(),this.isViewportSized=!0,this.Wd=NaN,this.Jd=NaN,this.Do=new tx(NaN,NaN).u(),this.Dn=new tx(10,10).u(),this.fi=1,this.Gi=10,this.xe=22,this.be=iT.standardComparer,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Wd=this.Wd,t.Jd=this.Jd,t.Do.a(this.Do),t.Dn.a(this.Dn),t.fi=this.fi,t.Gi=this.Gi,t.xe=this.xe,t.be=this.be}hi(t){t in iL?this.sorting=t:t in iC?this.arrangement=t:t in iN?this.alignment=t:super.hi(t)}doLayout(t){this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);let e=this.collectParts(t),i=this.diagram,s=e.copy().iterator;for(;s.next();){let t=s.value;if(t.Rl()&&(null!==t.fromNode||null!==t.toNode)){e.delete(t);continue}if(t.ensureBounds(),t instanceof ib){let i=t.memberParts;for(;i.next();){let t=i.value;e.delete(t)}}}let n=e.toArray();if(0===n.length)return;switch(this.sorting){case 20:break;case 21:n.reverse();break;case 22:n.sort(this.comparer);break;case 23:n.sort(this.comparer),n.reverse()}let l=this.wrappingColumn;isNaN(l)&&(l=0);let r=this.wrappingWidth;if(isNaN(r)&&null!==i){let t=i.viewportBounds,e=i.padding;r=Math.max(t.width-e.left-e.right,0)}else r=Math.max(this.wrappingWidth,0);l<=0&&r<=0&&(l=1);let o=this.spacing.width;isFinite(o)||(o=0);let h=this.spacing.height;isFinite(h)||(h=0),null!==i&&i.startTransaction("Layout");let a=[];switch(this.alignment){case 0:this.OO(n,r,l,o,h,a);break;case 1:this.IO(n,r,l,o,h,a)}let u=0,d=0,c=0;for(let t=0;t<a.length;t++){let e=a[t];u=Math.min(u,e.x),d=Math.min(d,e.y),c=Math.max(c,e.x+e.width)}11===this.arrangement?this.commitLayers(a,new ty(u+o/2-(c+u),d-h/2)):this.commitLayers(a,new ty(u-o/2,d-h/2)),null!==i&&i.commitTransaction("Layout"),this.isValidLayout=!0}OO(t,e,i,s,n,l){let r=tw.l(),o=Math.max(this.cellSize.width,1);if(!isFinite(o)){o=0;for(let e=0;e<t.length;e++){let i=t[e];o=Math.max(o,this.getLayoutBounds(i,r).width)}}o+=s,o=Math.max(o,1);let h=Math.max(this.cellSize.height,1);if(!isFinite(h)){h=0;for(let e=0;e<t.length;e++){let i=t[e];h=Math.max(h,this.getLayoutBounds(i,r).height)}}h+=n,h=Math.max(h,1);let a=this.arrangement,u=this.arrangementOrigin.x,d=this.arrangementOrigin.y,c=u,g=d,f=0,m=0;for(let d=0;d<t.length;d++){let p=t[d],y=this.getLayoutBounds(p,r),x=Math.ceil((y.width+s)/o),w=Math.ceil((y.height+n)/h),b=x*o,v=w*h,k=0;k=11===a?Math.abs(c-y.width):c+y.width,(i>0&&f>i-1||e>0&&f>0&&k-u>e)&&(l.push(new tw(0,g,e+s,m)),f=0,c=u,g+=m,m=0),m=Math.max(m,v);let P=0;P=11===a?-y.width:0,(p.moveTo(c+P+p.margin.left,g+p.margin.top),11===a)?c-=b:c+=b,f++}l.push(new tw(0,g,e+s,m)),tw.e(r)}IO(t,e,i,s,n,l){let r=tw.l(),o=Math.max(this.cellSize.width,1),h=0,a=0,u=0,d=ty.l();for(let e=0;e<t.length;e++){let i=t[e],s=this.getLayoutBounds(i,r),n=i.getRelativePoint(i.locationObject,i.locationSpot,d);h=Math.max(h,n.x),a=Math.max(a,s.width-n.x),u=Math.max(u,n.y)}let c=this.arrangement;11===c?h+=s:a+=s,o=isFinite(o)?Math.max(o+s,1):Math.max(h+a,1);let g=this.arrangementOrigin.x,f=this.arrangementOrigin.y,m=g,p=f,y=0;e>=h&&(e-=h);let x=0,w=0,b=Math.max(this.cellSize.height,1);u=0;let v=0,k=!0,P=ty.l();for(let h=0;h<t.length;h++){let a=t[h],f=this.getLayoutBounds(a,r),S=a.getRelativePoint(a.locationObject,a.locationSpot,d);if(y>0){if(11===c){let t=(m-g-(f.width-S.x))/o;m=(t=tP.Y(Math.round(t),t)?Math.round(t):Math.floor(t))*o+g}else{let t=(m-g+S.x)/o;m=(t=tP.Y(Math.round(t),t)?Math.round(t):Math.ceil(t))*o+g}}else x=11===c?m+S.x+f.width:m-S.x;let M=0;if(M=11===c?-(m+S.x)+x:m+f.width-S.x-x,i>0&&y>i-1||e>0&&y>0&&M>e){l.push(new tw(0,k?p-u:p,e+s,v+u+n));for(let e=0;e<y&&h!==y;e++){let i=t[h-y+e],s=i.getRelativePoint(i.locationObject,i.locationSpot,P);i.moveTo(i.position.x,i.position.y+u-s.y)}v+=n,k?p+=v:p+=v+u,u=0,v=0,y=0,m=g,k=!1}(m===g&&(w=11===c?Math.max(w,f.width-S.x):Math.min(w,-S.x)),u=Math.max(u,S.y),v=Math.max(v,f.height-S.y),isFinite(b)&&(v=Math.max(v,Math.max(f.height,b)-S.y)),k?a.moveTo(m-S.x,p-S.y):a.moveTo(m-S.x,p),11===c)?m-=S.x+s:m+=f.width-S.x+s,y++}if(l.push(new tw(0,p,e+s,(k?v:v+u)+n)),t.length!==y)for(let e=0;e<y;e++){let i=t[t.length-y+e],s=i.getRelativePoint(i.locationObject,i.locationSpot,d);i.moveTo(i.position.x,i.position.y+u-s.y)}if(ty.e(d),ty.e(P),11===c)for(let t=0;t<l.length;t++){let e=l[t];e.width+=w,e.x-=w}else for(let t=0;t<l.length;t++){let e=l[t];e.x>w&&(e.width+=e.x-w,e.x=w)}tw.e(r)}commitLayers(t,e){}get wrappingWidth(){return this.Wd}set wrappingWidth(t){this.Wd!==t&&(te.s(t,"number",iT,"wrappingWidth"),(t>0||isNaN(t))&&(this.Wd=t,this.isViewportSized=isNaN(t),this.invalidateLayout()))}get wrappingColumn(){return this.Jd}set wrappingColumn(t){this.Jd!==t&&(te.s(t,"number",iT,"wrappingColumn"),(t>0||isNaN(t))&&(this.Jd=t,this.invalidateLayout()))}get cellSize(){return this.Do}set cellSize(t){this.Do.equals(t)||(this.Do.a(t),this.invalidateLayout())}get spacing(){return this.Dn}set spacing(t){this.Dn.equals(t)||(this.Dn.a(t),this.invalidateLayout())}get alignment(){return this.fi}set alignment(t){this.fi!==t&&(1===t||0===t)&&(this.fi=t,this.invalidateLayout())}get arrangement(){return this.Gi}set arrangement(t){this.Gi!==t&&(10===t||11===t)&&(this.Gi=t,this.invalidateLayout())}get sorting(){return this.xe}set sorting(t){this.xe!==t&&(20===t||21===t||22===t||23===t)&&(this.xe=t,this.invalidateLayout())}get comparer(){return this.be}set comparer(t){this.be!==t&&(te.S(t,iT,"comparer"),this.be=t,this.invalidateLayout())}static standardComparer(t,e){let i=t.text,s=e.text;return i<s?-1:+(i>s)}static smartComparer(t,e){if(null===t)return null!==e?-1:0;if(null===e)return 1;{let i=t.text.toLocaleLowerCase(),s=e.text.toLocaleLowerCase(),n=i.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),l=s.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),r=0;for(;r<n.length;r++)if(""!==l[r]&&void 0!==l[r]){let t=parseFloat(n[r]),e=parseFloat(l[r]);if(isNaN(t)){if(!isNaN(e))return 1;if(0!==n[r].localeCompare(l[r]))return n[r].localeCompare(l[r]);continue}if(isNaN(e))return -1;if(t-e!=0)return t-e;continue}else{if(""===n[r])continue;return 1}return""!==l[r]&&void 0!==l[r]?-1:0}}static Position=0;static Location=1;static LeftToRight=10;static RightToLeft=11;static Forward=20;static Reverse=21;static Ascending=22;static Descending=23}class iA{$d;Zs;Tt;ko;Zd;Qd;L;yN;constructor(){this.$d=new tu,this.Zs=new tu,this.Tt=new tu,this.ko=new tp,this.Zd=new tp,this.Qd=new tp,this.L=null,this.yN=!1}clear(){this.$d.clear(),this.Zs.clear(),this.Tt.clear(),this.ko.clear(),this.Zd.clear(),this.Qd.clear()}Ro(t){this.L=t}_h(t){if(t instanceof io){if(this.$d.add(t),t instanceof ib){let e=t.containingGroup;null===e?this.diagram.qr.add(t):e.ga.add(t);let i=t.layout;null!==i&&(i.diagram=this.diagram)}}else t instanceof ic?(this.Zs.add(t),t.isAvoiding&&(this.diagram.Gm=!0)):t instanceof il||this.Tt.add(t);let e=t.data;null!==e&&(t instanceof il||(t instanceof ic?this.MT(e,t):this.ko.set(e,t)))}se(t){if(t.clearAdornments(),t instanceof io){if(this.$d.delete(t),t instanceof ib){let e=t.containingGroup;null===e?this.diagram.qr.delete(t):e.ga.delete(t);let i=t.layout;null!==i&&(i.diagram=null)}}else t instanceof ic?this.Zs.delete(t):t instanceof il||this.Tt.delete(t);let e=t.data;null!==e&&(t instanceof il||(t instanceof ic?this.NT(e,t):this.ko.delete(e)))}MT(t,e){this.Zd.set(t,e)}NT(t,e){this.Zd.delete(t)}rebuildParts(){let t=this.diagram;if(null===t)return;let e=t.nodeTemplateMap.iterator;for(;e.next();){let t=e.value,i=e.key;(!t.Me()||t instanceof ib)&&te.o(`Invalid node template in Diagram.nodeTemplateMap: template for "${i}" must be a Node or a simple Part, not a Group or Link: ${t}`)}let i=t.groupTemplateMap.iterator;for(;i.next();){let t=i.value,e=i.key;t instanceof ib||te.o(`Invalid group template in Diagram.groupTemplateMap: template for "${e}" must be a Group, not a normal Node or Link: ${t}`)}let s=t.linkTemplateMap.iterator;for(;s.next();){let t=s.value,e=s.key;t instanceof ic||te.o(`Invalid link template in Diagram.linkTemplateMap: template for "${e}" must be a Link, not a normal Node or simple Part: ${t}`)}let n=te.rt(),l=t.selection.iterator;for(;l.next();){let t=l.value.data;t&&n.push(t)}let r=te.rt(),o=t.highlighteds.iterator;for(;o.next();){let t=o.value.data;t&&r.push(t)}let h=te.rt(),a=this.nodes.iterator;for(;a.next();){let t=a.value;null!==t.data&&(h.push(t.data),h.push(t.location))}let u=this.links.iterator;for(;u.next();){let t=u.value;null!==t.data&&(h.push(t.data),h.push(t.location))}let d=this.parts.iterator;for(;d.next();){let t=d.value;null!==t.data&&(h.push(t.data),h.push(t.location))}this.CT(),this.vM();for(let t=0;t<n.length;t++){let e=this.findPartForData(n[t]);null!==e&&(e.isSelected=!0)}for(let t=0;t<r.length;t++){let e=this.findPartForData(r[t]);null!==e&&(e.isHighlighted=!0)}for(let t=0;t<h.length;t+=2){let e=this.findPartForData(h[t]);null!==e&&(e.location=h[t+1])}te.tt(n),te.tt(r),te.tt(h)}vM(){let t=this.diagram.model;this.Sy(t.nodeDataArray)}Sy(t,e){let i=this.diagram.model;t.forEach(t=>{i.containsNodeData(t)&&this.LT(t,!1)}),t.forEach(t=>{i.containsNodeData(t)&&this.N1(t)}),!1!==e&&this.diagram.xb(!1)}LT(t,e){if(null==t||this.diagram.undoManager.isUndoingRedoing||this.ko.has(t))return null;void 0===e&&(e=!0);let i=this.EO(t);return null!==i&&e&&this.N1(t),i}EO(t){if(null==t||this.diagram.undoManager.isUndoingRedoing||this.ko.has(t))return null;let e=this.BO(t),i=this.findTemplateForNodeData(t,e);if(null!==i){i.zt();let s=i.copy();if(null!==s){let i=this.diagram.ge;return this.diagram.ge=!0,s.Wo=e,s.ei=t,this.addsToTemporaryLayer&&(s.fl="Tool"),this.diagram.add(s),s.ei=null,s.data=t,this.diagram.ge=i,s}}return null}insertLink(t,e,i,s){return null}N1(t){}BO(t){return this.diagram.model.getCategoryForNodeData(t)}static AT=!1;static TT=!1;findTemplateForNodeData(t,e){let i=this.diagram,s=i.model,n=s.Qc()&&s.isGroupForData(t),l=null;return n?null===(l=i.groupTemplateMap.get(e))&&null===(l=i.groupTemplateMap.get(""))&&(iA.TT||(iA.TT=!0,te.li('No Group template found for category "'+e+'"'),te.li("  Using default group template")),l=i.cM):null===(l=i.nodeTemplateMap.get(e))&&null===(l=i.nodeTemplateMap.get(""))&&(iA.AT||(iA.AT=!0,te.li('No Node template found for category "'+e+'"'),te.li("  Using default node template")),l=i.lM),l}getLinkCategoryForData(t){return""}setLinkCategoryForData(t,e){}setFromNodeForLink(t,e,i){}setToNodeForLink(t,e,i){}static DT=!1;findLinkTemplateForCategory(t){let e=this.diagram,i=e.linkTemplateMap.get(t);return null===i&&null===(i=e.linkTemplateMap.get(""))&&(iA.DT||(iA.DT=!0,te.li('No Link template found for category "'+t+'"'),te.li("  Using default link template")),i=e.hM),i}Cv(t,e,i){t instanceof ic?(null!==e&&this.NT(e,t),null!==i&&this.MT(i,t)):t instanceof ii&&(null!==e&&this.ko.delete(e),null!==i&&this.ko.set(i,t))}CT(){let t=this.diagram.model;this.wN(t.nodeDataArray)}wN(t){t.forEach(t=>{this.C1(t)})}C1(t){let e=this.findPartForData(t);null!==e&&(this.diagram.DM(e,!1),this.xN(e))}xN(t){}aN(t){}findPartForKey(t){if(null==t)return null;let e=this.diagram.model.findNodeDataForKey(t);return null!==e?this.ko.get(e):null}findNodeForKey(t){if(null==t)return null;let e=this.diagram.model.findNodeDataForKey(t);if(null===e)return null;let i=this.ko.get(e);return i instanceof io?i:null}findLinkForKey(t){return null}findPartForData(t){if(null===t)return null;let e=this.ko.get(t);return null!==e||(e=this.Zd.get(t)),e}findNodeForData(t){if(null===t)return null;let e=this.ko.get(t);return e instanceof io?e:null}findLinkForData(t,e){return null===t?null:this.Zd.get(t)}findNodesByExample(...t){let e=new tu,i=this.$d.iterator;for(;i.next();){let t=i.value,s=t.data;if(null!==s)for(let i=0;i<arguments.length;i++){let n=arguments[i];if(te.H(n)&&this.bN(s,n)){e.add(t);break}}}return e.iterator}findLinksByExample(...t){let e=new tu,i=this.Zs.iterator;for(;i.next();){let t=i.value,s=t.data;if(null!==s)for(let i=0;i<arguments.length;i++){let n=arguments[i];if(te.H(n)&&this.bN(s,n)){e.add(t);break}}}return e.iterator}bN(t,e){for(let i in e){let s=t[i],n=e[i];if(Array.isArray(n)){if(!Array.isArray(s)||s.length<n.length)return!1;for(let t=0;t<s.length;t++){let e=s[t],i=n[t];if(void 0!==i&&!this.FT(e,i))return!1}}else if(!this.FT(s,n))return!1}return!0}FT(t,e){if(te.ot(e)){if(!e(t))return!1}else if(e instanceof RegExp){if(!t||!e.test(t.toString()))return!1}else if(te.H(t)&&te.H(e)){if(!this.bN(t,e))return!1}else if(t!==e)return!1;return!0}doModelDataChanged(t){if(t.model===this.diagram.model&&this.diagram.K){this.diagram.K=!1;try{let e=t.change;""===t.modelChange&&null!==t.object&&2===e&&this.My(t.object,t.propertyName)}finally{this.diagram.K=!0}}}doModelChanged(t){let e=this.diagram;if(!e||t.model!==e.model)return;let i=t.change;if(e.AR(t),e.K){e.K=!1;try{let s=t.modelChange;if(""!==s){if(2===i){if("nodeCategory"===s){let e=t.object;if(null!==e){let i=this.findPartForData(e),s=t.newValue;null!==i&&"string"==typeof s&&(i.category=s)}}else if("nodeDataArray"===s){let e=t.oldValue;this.wN(e);let i=t.newValue;this.Sy(i)}e.isModified=!0}else if(3===i){let i=t.newValue;"nodeDataArray"===s&&te.H(i)&&this.LT(i),e.isModified=!0}else if(4===i){let i=t.oldValue;"nodeDataArray"===s&&te.H(i)&&this.C1(i),e.isModified=!0}else 1===i&&("SourceChanged"===s?null!==t.object?this.My(t.object,t.propertyName):(this.updateAllRelationshipsFromData(),this.updateAllTargetBindings()):"ModelDisplaced"===s&&this.rebuildParts())}else if(2===i){let i=t.propertyName,s=t.object,n=e.model;s===n?("nodeKeyProperty"===i||"nodeCategoryProperty"===i)&&(e.undoManager.isUndoingRedoing||this.rebuildParts()):null!==s&&this.My(s,i),e.isModified=!0}else(3===i||4===i)&&(this.UO(t,e.model),e.isModified=!0)}finally{e.K=!0}}}updateAllTargetBindings(t){void 0===t&&(t="");let e=this.parts.iterator;for(;e.next();)e.value.updateTargetBindings(t);for(e=this.nodes.iterator;e.next();)e.value.updateTargetBindings(t);for(e=this.links.iterator;e.next();)e.value.updateTargetBindings(t)}updateAllThemeBindings(){let t=this.parts.iterator;for(;t.next();)t.value.Uo();for(t=this.nodes.iterator;t.next();)t.value.Uo();for(t=this.links.iterator;t.next();)t.value.Uo()}updateAllRelationshipsFromData(){let t=this.diagram.model,e=new tu,i=t.nodeDataArray;for(let t=0;t<i.length;t++){let s=i[t];e.add(s)}let s=[];this.nodes.each(t=>{null===t.data||e.has(t.data)||s.push(t.data)}),this.parts.each(t=>{null===t.data||e.has(t.data)||s.push(t.data)}),s.forEach(e=>t.RT(e,!1));for(let e=0;e<i.length;e++){let s=i[e];null===this.findPartForData(s)&&t.vT(s,!1)}this.OT();let n=this.parts.iterator;for(;n.next();)n.value.updateRelationshipsFromData();for(n=this.nodes.iterator;n.next();)n.value.updateRelationshipsFromData();for(n=this.links.iterator;n.next();)n.value.updateRelationshipsFromData()}OT(){}updateRelationshipsFromData(t){}My(t,e){if("string"==typeof e){let i=this.findPartForData(t);if(null!==i)i.updateTargetBindings(e);else{let i=this.VO(t);if(null!==i&&i.length>0){for(let t=0;t<i.length;t++)i[t].updateTargetBindings(e);let t=i[0].part;if(null!==t){let i=t.adornments;for(;i.next();)i.value.updateTargetBindings(e)}te.tt(i)}}t===this.diagram.model.modelData&&this.updateAllTargetBindings(e)}}VO(t){let e=null,i=this.Qd.iterator;for(;i.next();){let s=i.value;for(let i=0;i<s.length;i++){let n=s[i].findItemPanelForData(t);null!==n&&(null===e&&(e=te.rt()),e.push(n))}if(null!==e)break}return e}kN(t){return this.Qd.get(t)}UO(t,e){let i=t.object;if(!Array.isArray(i))return;let s=3===t.change,n=s?t.newParam:t.oldParam,l=s?t.newValue:t.oldValue,r=this.kN(i);if(Array.isArray(r))for(let t=0;t<r.length;t++){let e=r[t];s?e.Jb(l,n,!0):e.Av(n)}}AM(t,e){null!==e&&t.$r(t=>e.BL(t));let i=t.Ph;if(Array.isArray(i)){let e=this.kN(i);if(null===e)this.Qd.set(i,[t]);else{for(let i=0;i<e.length;i++)if(e[i]===t)return;e.push(t)}}}TM(t,e){t.$r(t=>e.DR(t));let i=t.Ph;if(Array.isArray(i)){let e=this.kN(i);if(null!==e){for(let s=0;s<e.length;s++)if(e[s]===t){e.splice(s,1),0===e.length&&this.Qd.delete(i);return}}}}copyParts(t,e,i){void 0===i&&(i=!1);let s=new tp;if(Array.isArray(t))for(let n=0;n<t.length;n++)this.L1(t[n],e,s,i);else{let n=t.iterator;for(;n.next();)this.L1(n.value,e,s,i)}if(null!==e){let t=e.model,i=e.a0().dragsLink,n=new tu,l=new tp,r=s.iterator;for(;r.next();){let o=r.value;if(o instanceof ic)i||null!==o.fromNode&&null!==o.toNode||n.add(o);else if(o instanceof io&&null!==o.data){if(t.km()){let i=r.key,n=i.findTreeParentNode();if(null!==n){let r=s.get(n);if(null!==r){t.setParentKeyForNodeData(o.data,t.getKeyForNodeData(r.data));let s=e.findLinkForData(o.data),n=i.findTreeParentLink();null!==n&&null!==s&&l.set(n,s)}}}else if(t.yb()){let i=r.key,n=t.isRelatedKeysPathTo?i.findNodesOutOf():i.findNodesInto();for(;n.next();){let r=n.value,h=s.get(r);if(null!==h){t.addRelatedKeyForNodeData(o.data,h.key);let s=e.partManager.findLinkForData(o.data,h.key),n=this.findLinkForData(i.data,r.key);null!==n&&null!==s&&l.set(n,s)}else t.removeRelatedKeyForNodeData(o.data,r.key)}}}}if(n.count>0&&e.removeParts(n,!1),l.count>0){let t=l.iterator;for(;t.next();){let e=t.key,i=t.value;s.set(e,i)}}}if(null!==e&&null!==this.diagram){let t=e.model,i=t.afterCopyFunction;if(null!==i){let e=new tp;s.each(t=>{null!==t.key.data&&e.set(t.key.data,t.value.data)}),i(e,t,this.diagram.model)}}let n=s.iterator;for(;n.next();)n.value.updateTargetBindings();return s}L1(t,e,i,s){if(null===t||s&&!t.canCopy())return null;if(i.has(t))return i.get(t);let n=this.PN(t,e);if(!(n instanceof ii))return null;if(n.isSelected=!1,n.isHighlighted=!1,i.set(t,n),t instanceof io){let l=t.linksConnected;for(;l.next();){let e=l.value;if(e.fromNode===t){let t=i.get(e);null!==t&&(t.fromNode=n)}if(e.toNode===t){let t=i.get(e);null!==t&&(t.toNode=n)}}if(t instanceof ib&&n instanceof ib){let l=t.memberParts;for(;l.next();){let t=l.value,r=this.L1(t,e,i,s);r instanceof ic||null!==r&&(r.containingGroup=n)}}}else if(t instanceof ic&&n instanceof ic){let l=t.fromNode;if(null!==l){let t=i.get(l);null!==t&&(n.fromNode=t)}let r=t.toNode;if(null!==r){let t=i.get(r);null!==t&&(n.toNode=t)}let o=t.labelNodes;for(;o.next();){let t=o.value,l=this.L1(t,e,i,s);null!==l&&l instanceof io&&(l.labeledLink=n)}}return n}PN(t,e){let i=null,s=t.data;if(null!==s&&null!==e){let n=e.model;if(!(t instanceof ic)){let t=n.copyNodeData(s);te.H(t)&&(n.addNodeData(t),i=e.findPartForData(t))}}else if(t.zt(),null!==(i=t.copy())){let t=this.diagram;if(null!==e)e.add(i);else if(null!==s&&null!==t&&null!==t.commandHandler&&t.commandHandler.copiesClipboardData){let e=t.model,n=null;i instanceof ic||(n=e.copyNodeData(s)),te.H(n)&&(i.data=n)}}return i}get nodes(){return this.$d}get links(){return this.Zs}get parts(){return this.Tt}get diagram(){return this.L}get addsToTemporaryLayer(){return this.yN}set addsToTemporaryLayer(t){this.yN=t}}class iD extends iA{vM(){let t=this.diagram.model;this.Sy(t.nodeDataArray),this.IT(t.linkDataArray)}Sy(t){super.Sy(t,!1);let e=this.links.iterator;for(;e.next();)e.value.Ld();this.diagram.xb(!1)}IT(t){t.forEach(t=>{this.ET(t)}),this.diagram.xb(!1)}ET(t){if(null==t||this.diagram.undoManager.isUndoingRedoing||this.findLinkForData(t))return null;let e=this.getLinkCategoryForData(t),i=this.findLinkTemplateForCategory(e);if(null!==i){i.zt();let s=i.copy();if(null!==s){let i=this.diagram.ge;this.diagram.ge=!0,s.Wo=e,s.ei=t;let n=this.diagram.model,l=n.A1(t,!0);""!==l&&(s.fromPortId=l);let r=n.Fe(t,!0);if(void 0!==r){let t=this.findNodeForKey(r);t instanceof io&&(s.fromNode=t)}let o=n.A1(t,!1);""!==o&&(s.toPortId=o);let h=n.Fe(t,!1);if(void 0!==h){let t=this.findNodeForKey(h);t instanceof io&&(s.toNode=t)}let a=n.getLabelKeysForLinkData(t);return Array.isArray(a)&&a.forEach(t=>{let e=this.findNodeForKey(t);null!==e&&(e.labeledLink=s)}),this.addsToTemporaryLayer&&(s.fl="Tool"),this.diagram.add(s),s.ei=null,s.data=t,this.diagram.ge=i,s}}return null}CT(){let t=this.diagram.model;this.BT(t.linkDataArray),this.wN(t.nodeDataArray)}BT(t){t.forEach(t=>{this.C1(t)})}getLinkCategoryForData(t){return this.diagram.model.getCategoryForLinkData(t)}setLinkCategoryForData(t,e){return this.diagram.model.setCategoryForLinkData(t,e)}setFromNodeForLink(t,e){let i=this.diagram.model,s=null!==e?e.data:null;i.setFromKeyForLinkData(t.data,i.getKeyForNodeData(s))}setToNodeForLink(t,e){let i=this.diagram.model,s=null!==e?e.data:null;i.setToKeyForLinkData(t.data,i.getKeyForNodeData(s))}aN(t){this.diagram.model.removeLinkData(t.data)}findPartForKey(t){let e=super.findPartForKey(t);if(null===e){let e=this.diagram.model.findLinkDataForKey(t);if(null!==e)return this.findLinkForData(e)}return e}findLinkForKey(t){if(null==t)return null;let e=this.diagram.model.findLinkDataForKey(t);return null!==e?this.findLinkForData(e):null}doModelChanged(t){if(super.doModelChanged(t),!this.diagram)return;let e=this.diagram;if(t.model!==e.model)return;let i=t.change;if(e.K){e.K=!1;try{let s=t.modelChange;if(""!==s){if(2===i){if("linkFromKey"===s){let e=t.object,i=this.findLinkForData(e);if(null!==i){let e=t.newValue;i.fromNode=this.findNodeForKey(e)}}else if("linkToKey"===s){let e=t.object,i=this.findLinkForData(e);if(null!==i){let e=t.newValue;i.toNode=this.findNodeForKey(e)}}else if("linkFromPortId"===s){let e=t.object,i=this.findLinkForData(e);if(null!==i){let e=t.newValue;"string"==typeof e&&(i.fromPortId=e)}}else if("linkToPortId"===s){let e=t.object,i=this.findLinkForData(e);if(null!==i){let e=t.newValue;"string"==typeof e&&(i.toPortId=e)}}else if("nodeGroupKey"===s){let e=t.object,i=this.findPartForData(e);if(null!==i){let e=t.newValue;if(void 0!==e){let t=this.findNodeForKey(e);t instanceof ib?i.containingGroup=t:i.containingGroup=null}else i.containingGroup=null}}else if("linkLabelKeys"===s){let e=t.object,i=this.findLinkForData(e);if(null!==i){let e=t.oldValue,s=t.newValue;Array.isArray(e)&&e.forEach(t=>{if(s.indexOf(t)>=0)return;let e=this.findNodeForKey(t);null!==e&&(e.labeledLink=null)}),Array.isArray(s)&&s.forEach(t=>{let e=this.findNodeForKey(t);null!==e&&(e.labeledLink=i)})}}else if("linkCategory"===s){let e=t.object,i=this.findLinkForData(e),s=t.newValue;null!==i&&"string"==typeof s&&(i.category=s)}else if("linkDataArray"===s){let e=t.oldValue;this.BT(e);let i=t.newValue;this.IT(i)}e.isModified=!0}else if(3===i){let i=t.newValue;if("linkDataArray"===s&&te.H(i))this.ET(i);else if("linkLabelKeys"===s&&t.model.isKeyType(i)){let e=t.object,s=this.findLinkForData(e),n=this.findNodeForKey(i);null!==s&&null!==n&&(n.labeledLink=s)}e.isModified=!0}else if(4===i){let i=t.oldValue;if("linkDataArray"===s&&te.H(i))this.C1(i);else if("linkLabelKeys"===s&&t.model.isKeyType(i)){let t=this.findNodeForKey(i);null!==t&&(t.labeledLink=null)}e.isModified=!0}}else if(2===i){let i=t.propertyName,s=t.object,n=e.model;s===n&&("linkFromKeyProperty"===i||"linkToKeyProperty"===i||"linkFromPortIdProperty"===i||"linkToPortIdProperty"===i||"linkLabelKeysProperty"===i||"nodeIsGroupProperty"===i||"nodeGroupKeyProperty"===i||"linkCategoryProperty"===i)&&(e.undoManager.isUndoingRedoing||this.rebuildParts()),e.isModified=!0}}finally{e.K=!0}}}OT(){let t=this.diagram.model,e=new tu,i=t.linkDataArray;i.forEach(t=>{e.add(t)});let s=[];this.links.each(t=>{null===t.data||e.has(t.data)||s.push(t.data)}),s.forEach(e=>{t.UT(e,!1)}),i.forEach(e=>{null===this.findLinkForData(e)&&t.VT(e,!1)})}updateRelationshipsFromData(t){let e=t.data;if(null===e)return;let i=t.diagram;if(null===i)return;let s=i.model;if(t instanceof ic){let n=s.Fe(e,!0),l=i.findNodeForKey(n);t.fromNode=l,n=s.Fe(e,!1),t.toNode=l=i.findNodeForKey(n);let r=s.getLabelKeysForLinkData(e);if(r.length>0||t.labelNodes.count>0){if(1===r.length&&1===t.labelNodes.count){let e=r[0],i=t.labelNodes.first();if(s.getKeyForNodeData(i.data)===e)return}let e=new tu().addAll(r),n=new tu;t.labelNodes.each(t=>{if(null!==t.data){let e=s.getKeyForNodeData(t.data);void 0!==e&&n.add(e)}});let l=n.copy();l.removeAll(e);let o=e.copy();o.removeAll(n),(l.count>0||o.count>0)&&(l.each(e=>{let s=i.findNodeForKey(e);null!==s&&s.labeledLink===t&&(s.labeledLink=null)}),o.each(e=>{let s=i.findNodeForKey(e);null!==s&&s.labeledLink!==t&&(s.labeledLink=t)}))}}else if(!(t instanceof il)){let n=s.getGroupKeyForNodeData(e),l=i.findPartForKey(n);(null===l||l instanceof ib)&&(t.containingGroup=l)}}N1(t){let e=this.diagram.model,i=e.getKeyForNodeData(t);if(void 0!==i){let s=e.Ny(i),n=this.findPartForData(t);if(null!==s&&null!==n){let t=s.iterator;for(;t.next();){let s=t.value;if(e.containsNodeData(s)){if(n instanceof ib&&e.getGroupKeyForNodeData(s)===i){let t=this.findPartForData(s);null!==t&&(t.containingGroup=n)}}else{let t=this.findLinkForData(s);if(null!==t&&n instanceof io){e.Fe(s,!0)===i&&(t.fromNode=n),e.Fe(s,!1)===i&&(t.toNode=n);let l=e.getLabelKeysForLinkData(s);Array.isArray(l)&&l.some(e=>e===i&&(n.labeledLink=t,!0))}}}e._s(i)}let l=e.getGroupKeyForNodeData(t);if(void 0!==l){let t=this.findNodeForKey(l);t instanceof ib&&(n.containingGroup=t)}}}xN(t){let e=this.diagram.model;if(t instanceof io){let i=e.getKeyForNodeData(t.data);if(void 0!==i){let s=t.linksConnected;for(;s.next();){let t=s.value;e.tn(i,t.data)}if(t.isLinkLabel){let s=t.labeledLink;null!==s&&e.tn(i,s.data)}if(t instanceof ib){let s=t.memberParts;for(;s.next();){let t=s.value.data;e.containsNodeData(t)&&e.tn(i,t)}}}}}PN(t,e){let i=super.PN(t,e);if(t instanceof ic){let s=t.data;if(null!==s&&null!==e){let t=e.model,n=t.copyLinkData(s);te.H(n)&&(t.addLinkData(n),i=e.findLinkForData(n))}else if(null!==i){let t=this.diagram;if(null!==s&&null!==t&&null!==t.commandHandler&&t.commandHandler.copiesClipboardData){let e=t.model.copyLinkData(s);te.H(e)&&(i.data=e)}}}return i}insertLink(t,e,i,s){let n=this.diagram,l=n.model,r=n.toolManager.findTool("Linking"),o="";null!==t&&(null===e&&(e=t),null===(o=e.portId)&&(o=""));let h="";null!==i&&(null===s&&(s=i),null===(h=s.portId)&&(h=""));let a=r.archetypeLinkData;if(a instanceof ic){a.zt();let e=a.copy();if(null!==e){e.fromNode=t,e.fromPortId=o,e.toNode=i,e.toPortId=h,n.add(e);let s=r.archetypeLabelNodeData;if(s instanceof io){s.zt();let t=s.copy();null!==t&&(t.labeledLink=e,n.add(t))}return e}}else if(null!==a){let e=l.copyLinkData(a);if(te.H(e)){null!==t&&l._d(e,l.getKeyForNodeData(t.data),!0),l.tg(e,o,!0),null!==i&&l._d(e,l.getKeyForNodeData(i.data),!1),l.tg(e,h,!1),l.addLinkData(e);let s=r.archetypeLabelNodeData;if(null!==s&&!(s instanceof io)){let t=l.copyNodeData(s);if(te.H(t)){l.addNodeData(t);let i=l.getKeyForNodeData(t);void 0!==i&&l.addLabelKeyForLinkData(e,i)}}return n.findLinkForData(e)}}return null}}class iF extends iA{Th=null;T1(t,e){if(null===t||null===e||null!==e.findTreeParentLink())return null;let i=this.diagram.toolManager.findTool("Linking"),s=t,n=e;if(this.diagram.isTreePathToChildren){if(null!==i&&i.Pu(s,n,null,!0))return null}else if(s=e,n=t,null!==i&&i.Pu(s,n,null,!0))return null;let l=this.getLinkCategoryForData(e.data),r=this.findLinkTemplateForCategory(l);if(null!==r){r.zt();let t=r.copy();if(null!==t){let i=this.diagram.ge;return this.diagram.ge=!0,t.Wo=l,t.ei=e.data,t.fromNode=s,t.toNode=n,this.diagram.add(t),t.ei=null,t.data=e.data,this.diagram.ge=i,t}}return null}getLinkCategoryForData(t){return this.diagram.model.getParentLinkCategoryForNodeData(t)}setLinkCategoryForData(t,e){this.diagram.model.setParentLinkCategoryForNodeData(t,e)}setFromNodeForLink(t,e,i){let s=this.diagram.model;void 0===i&&(i=null);let n=null!==e?e.data:null;if(this.diagram.isTreePathToChildren)s.setParentKeyForNodeData(t.data,s.getKeyForNodeData(n));else{let e=this.Th;this.Th=t,null!==i&&s.setParentKeyForNodeData(i.data,void 0);let l=null!==t.toNode?t.toNode.data:null;s.setParentKeyForNodeData(n,s.getKeyForNodeData(l)),this.Th=e}}setToNodeForLink(t,e,i){let s=this.diagram.model;void 0===i&&(i=null);let n=null!==e?e.data:null;if(this.diagram.isTreePathToChildren){let e=this.Th;this.Th=t,null!==i&&s.setParentKeyForNodeData(i.data,void 0);let l=null!==t.fromNode?t.fromNode.data:null;s.setParentKeyForNodeData(n,s.getKeyForNodeData(l)),this.Th=e}else s.setParentKeyForNodeData(t.data,s.getKeyForNodeData(n))}aN(t){this.diagram.model.setParentKeyForNodeData(t.data,void 0)}findLinkForKey(t){if(null==t)return null;let e=this.diagram.model.findNodeDataForKey(t);return null!==e?this.findLinkForData(e):null}doModelChanged(t){if(super.doModelChanged(t),!this.diagram)return;let e=this.diagram;if(t.model!==e.model)return;let i=t.change;if(e.K){e.K=!1;try{let s=t.modelChange;if(""!==s){if(2===i){if("nodeParentKey"===s){let i=t.object,s=t.newValue,n=this.findNodeForKey(s),l=this.findNodeForData(i);if(null!==this.Th)null!==n&&(this.Th.data=i,this.Th.category=this.getLinkCategoryForData(i));else if(null!==l){let t=l.findTreeParentLink();null!==t?null===n?e.remove(t):e.isTreePathToChildren?t.fromNode=n:t.toNode=n:this.T1(n,l)}}else if("parentLinkCategory"===s){let e=t.object,i=this.findNodeForData(e),s=t.newValue;if(null!==i&&"string"==typeof s){let t=i.findTreeParentLink();null!==t&&(t.category=s)}}e.isModified=!0}}else if(2===i){let i=t.propertyName,s=t.object,n=e.model;s===n&&"nodeParentKeyProperty"===i&&(e.undoManager.isUndoingRedoing||this.rebuildParts()),e.isModified=!0}}finally{e.K=!0}}}updateRelationshipsFromData(t){let e=t.data;if(null===e)return;let i=t.diagram;if(null===i)return;let s=i.model;if(t instanceof io){let n=s.getParentKeyForNodeData(e),l=i.findNodeForKey(n);if(l!==t.findTreeParentNode()){let e=t.findTreeParentLink();null!==l?null!==e?i.isTreePathToChildren?e.fromNode=l:e.toNode=l:this.T1(l,t):null!==e&&i.DM(e,!1)}}}My(t,e){if(super.My(t,e),"string"==typeof e&&null!==this.findPartForData(t)){let i=this.findLinkForData(t);null!==i&&i.updateTargetBindings(e)}}N1(t){let e=this.diagram.model,i=e.getKeyForNodeData(t);if(void 0!==i){let s=e.Ny(i),n=this.findPartForData(t);if(null!==s&&null!==n){let t=s.iterator;for(;t.next();){let s=t.value;if(e.containsNodeData(s)&&n instanceof io&&e.getParentKeyForNodeData(s)===i){let t=this.findNodeForData(s);this.T1(n,t)}}e._s(i)}let l=e.getParentKeyForNodeData(t);if(void 0!==l&&n instanceof io){let t=this.findNodeForKey(l);this.T1(t,n)}}}xN(t){let e=this.diagram.model;if(t instanceof io){let i=e.getKeyForNodeData(t.data),s=this.findLinkForData(t.data);if(null!==s){s.isSelected=!1,s.isHighlighted=!1;let t=s.layer;if(null!==t){let e=t.se(-1,s,!1);e>=0&&this.diagram.raiseChangedEvent(4,"parts",t,s,null,e,null);let i=s.layerChanged;null!==i&&i(s,t,null)}}let n=this.diagram.isTreePathToChildren,l=t.linksConnected;for(;l.next();){let t=l.value,s=(n?t.toNode:t.fromNode).data;e.containsNodeData(s)&&e.tn(i,s)}}}insertLink(t,e,i,s){let n=this.diagram.model,l=t,r=i;if(this.diagram.isTreePathToChildren||(l=i,r=t),null!==l&&null!==r){let t=l.data,e=r.data;return n.setParentKeyForNodeData(e,n.getKeyForNodeData(t)),r.findTreeParentLink()}return null}}var iO=((E=iO||{})[E.OneWay=1]="OneWay",E[E.TwoWay=2]="TwoWay",E);class iR{n;SN;qa;Rf;Dh;vf;Of;If;D1;Se;gd;yf;constructor(t,e,i,s){tu.qi(this),void 0===t?t="":te.s(t,"string",iR,"constructor:targetprop"),void 0===e?e=t:te.s(e,"string",iR,"constructor:sourceprop"),void 0===i?i=null:null!==i&&te.S(i,iR,"constructor:conv"),this.SN=-1,this.Se=null,this.qa=t,this.gd=0,this.yf=0,this.Rf=null,this.Dh=e,this.vf=i,void 0===s?(this.Of=1,this.If=null):(this.Of=2,this.If=s),this.D1=new tu,this.n=2}copy(){let t=new this.constructor;return this.cloneProtected(t),t}cloneProtected(t){t.qa=this.qa,t.gd=this.gd,t.yf=this.yf,t.Rf=this.Rf,t.Dh=this.Dh,t.vf=this.vf,t.Of=this.Of,t.If=this.If,t.n=-2&this.n}static OneWay=1;static TwoWay=2;static parseEnum(t,e){return te.S(t,iR,"parseEnum:ctor"),i=>{let s=parseInt(i);return isNaN(s)&&null===(s=te.Xh(t,i))?e:s}}hi(t){t in iO?this.mode=t:te.cr(this,t)}static toString(t){return te.toString(t)}toString(){return"Binding("+this.targetProperty+":"+this.sourceProperty+(-1!==this.targetId?" "+this.targetId:"")+" "+iO[this.mode]+")"}u(){return this.n=1|this.n,this}get targetId(){return this.SN}set targetId(t){this.h&&te.D(this),this.SN=t}get targetProperty(){return this.qa}set targetProperty(t){this.h&&te.D(this),te.s(t,"string",iR,"targetProperty"),this.qa=t}get sourceProperty(){return this.Dh}set sourceProperty(t){this.h&&te.D(this),te.s(t,"string",iR,"sourceProperty"),this.Dh=t}get h(){return(1&this.n)!=0}get isToData(){return(2&this.n)!=0}get isToObject(){return(4&this.n)!=0}get isToModel(){return(8&this.n)!=0}get isToTheme(){return(16&this.n)!=0}get MN(){return this.isToTheme&&!(this.isToData||this.isToObject||this.isToModel)}Qu(){return!1}get sourceName(){return this.Rf}set sourceName(t){this.h&&te.D(this),null!==t&&te.s(t,"string",iR,"sourceName"),this.Rf=t,null!==t?this.n=-3&this.n|4:this.n=2|this.n}get converter(){return this.vf}set converter(t){this.h&&te.D(this),null!==t&&te.S(t,iR,"converter"),this.vf=t}get backConverter(){return this.If}set backConverter(t){this.h&&te.D(this),null!==t&&te.S(t,iR,"backConverter"),this.If=t}get mode(){return this.Of}set mode(t){this.h&&te.D(this),this.isToTheme&&2===t&&te.o("Theme Bindings cannot be TwoWay."),this.Of=t}makeTwoWay(t){return this.isToTheme&&te.o("Theme Bindings cannot be TwoWay."),this.mode=2,t&&(te.S(t,iR,"makeTwoWay"),this.backConverter=t),this}ofObject(t){return this.h&&te.D(this),void 0===t&&(t=""),this.sourceName=t,this}ofModel(){return this.h&&te.D(this),this.n=-7&this.n|8,this.Rf=null,this}fA(t,e){let i=this.sourceName;return null===i||""===i?t:"/"===i?e.part:"."===i?e:".."===i?e.panel:t.findObject(i)}check(t){let e=this.qa,i=this.Dh,s=this.vf;(this.Qu()&&null===s&&null===this.Fh&&""===e||null===s&&""===e)&&te.li("Binding error: target property is the empty string: "+this.toString()),this.Qu()&&this.MN&&""===i&&null===s&&null===this.Fh&&te.li("Binding error: theme bindings require a source property when not using a converter: "+this.toString()),t&&"string"==typeof e&&(te.ot(["setAttribute"])||!(e.length>0)||"_"===e[0]||te.fw(t,e)?"name"===e&&t instanceof eb&&te.li("Binding error: cannot modify GraphObject.name on "+t.toString()):te.li("Binding error: undefined target property: "+e+" on "+t.toString()))}updateTarget(t,e,i,s){let n=this.Dh;if(void 0!==i&&""!==n&&n!==i)return;let l=this.qa,r=this.vf,o=e;if(""===n||this.MN||(o=s?s.bt(e,n):iE.bt(e,n)),void 0===o)return;let h=t.diagram?.themeManager;if(null===r){if(""!==l){if(this.Qu()&&void 0===(o=this.zT(h,o,t,l)))return;s?s.et(t,l,o):(e instanceof eb||e instanceof eZ)&&iE.et(t,l,o)}}else try{if(""!==l){let i=r(o,t);if(this.Qu()&&(i=this.zT(h,i,t,l),void 0===i))return;s?s.et(t,l,i):(e instanceof eb||e instanceof eZ)&&iE.et(t,l,i)}else r(o,t)}catch{}}updateSource(t,e,i,s){if(2!==this.Of)return;let n=this.qa;if(void 0!==i&&n!==i)return;let l=this.Dh,r=this.If,o=null!==s?s.diagram:null,h=null!==o?o.model:null,a=t;if(""!==n&&(a=h?h.bt(t,n):iE.bt(t,n)),void 0!==a&&!this.D1.has(t))try{if(this.D1.add(t),null===r){if(""!==l)null!==h?h.setDataProperty(e,l,a):(e instanceof eb||e instanceof eZ)&&(e[l]=a);else if(null!==h&&null!==s&&s.itemIndex>=0&&null!==s.panel&&Array.isArray(s.panel.itemArray)){let t=s.itemIndex,e=s.panel.itemArray;h.removeArrayItem(e,t),h.insertArrayItem(e,t,a)}}else try{if(""!==l){let t=r(a,e,h);null!==h?h.setDataProperty(e,l,t):(e instanceof eb||e instanceof eZ)&&(e[l]=t)}else{let t=r(a,e,h);if(void 0!==t&&null!==h&&null!==s&&s.itemIndex>=0&&null!==s.panel&&Array.isArray(s.panel.itemArray)){let e=s.itemIndex,i=s.panel.itemArray;h.removeArrayItem(i,e),h.insertArrayItem(i,e,t)}}}catch{}}finally{this.D1.delete(t)}}}class iB extends iR{Cy;Fh;Wa;constructor(t,e,i,s,n){super(t,e,s),null==i&&(i=""),void 0===n&&(n=null),this.Cy=i,this.Fh=n,this.Wa=null,this.n=16}cloneProtected(t){super.cloneProtected(t),t.Cy=this.Cy,t.Fh=this.Fh,t.Wa=this.Wa}Qu(){return!0}get themeSource(){return this.Cy}set themeSource(t){this.h&&te.D(this),null!==t&&te.s(t,"string",iB,"themeSource"),this.Cy=t,this.Wa=null,null!==t?this.n=16|this.n:this.n=-17&this.n}get themeConverter(){return this.Fh}set themeConverter(t){this.h&&te.D(this),null!==t&&te.S(t,iB,"themeConverter"),this.Fh=t}ofData(){return this.h&&te.D(this),this.n=2|this.n,this.Rf=null,this}zT(t,e,i,s){if(!t||(this.MN&&(e=this.Dh),!e&&0!==e))return;let n=this.themeSource;null!==this.Wa?n=this.Wa:"string"==typeof n&&n.includes(".")&&(this.Wa=n.split("."),n=this.Wa);let l=t.findValue(e,n,s);return void 0===l&&te.li(`Theme warning: ${e} could not be found when setting target property ${s}.`),te.ot(this.Fh)&&(l=this.Fh(l,i)),l}}class iE{Nt;ig;Eo;NN;Re;wi;Rh;Ef;Bf;eg;sg;ng;og;Ly;Ja;sr;Ay;Io;F1;constructor(t,e){if(tu.qi(this),this.Nt="",this.ig="",this.Eo=!1,this.NN={},this.Re=[],this.wi=new tp,this.Rh="key",this.Ef=null,this.Bf=null,this.eg=!1,this.sg=!1,this.ng=!1,this.og=null,this.Ly=100,this.Ja="category",this.sr=new tp,this.Ay=[],this.Io=!1,this.F1=null,this.undoManager=new tB,void 0!==t&&(Array.isArray(t)?this.nodeDataArray=t:e=t),e){Object.assign(this,e);let t=e.Changed;t&&(delete this.Changed,this.addChangedListener(t))}}cloneProtected(t){t.Nt=this.Nt,t.ig=this.ig,t.Eo=this.Eo,t.Rh=this.Rh,t.Ef=this.Ef,t.Bf=this.Bf,t.eg=this.eg,t.sg=this.sg,t.ng=this.ng,t.og=this.og,t.Ly=this.Ly,t.Ja=this.Ja}copy(){let t=new this.constructor;return this.cloneProtected(t),t}clear(){this.Re=[],this.wi.clear(),this.sr.clear(),this.undoManager.clear()}toString(t){if(void 0===t&&(t=0),t>1)return this.toJson();{let e=(""!==this.name?this.name:"")+" Model";if(t>0){e+=`
 node data:`;let t=this.nodeDataArray,i=t.length;for(let s=0;s<i;s++){let i=t[s];e+=" "+this.getKeyForNodeData(i)+":"+te.toString(i)}}return e}}toIncrementalData(t){1!==t.change&&te.o("Model.toIncrementalData argument is not a Transaction ChangedEvent:"+t.toString());let e=t.object;if(!t.isTransactionFinished||!(e instanceof tR))return null;let i=this.XT(e);return this.CN(e,"FinishedUndo"===t.propertyName,i)}CN(t,e,i){let s=this,n=!1,l=new tu,r=new tu,o=new tu;t.changes.each(t=>{if(t.model===s){if("nodeDataArray"===t.modelChange)3===t.change?l.add(t.newValue):4===t.change&&o.add(t.oldValue);else if(s.containsNodeData(t.object))r.add(t.object);else if(2===t.change&&(s.modelData===t.object||"modelData"===t.propertyName))n=!0;else if(null!==t.object){if(i.has(t.object))i.get(t.object).each(t=>{s.containsNodeData(t)&&r.add(t)});else{if(t.object instanceof iE||s.Ba()&&s.containsLinkData(t.object))return;s.YT(t.object).each(t=>{r.add(t)})}}}});let h=new tu;l.each(t=>{h.add(s.getKeyForNodeData(t)),e||r.add(t)});let a=new tu;o.each(t=>{a.add(s.getKeyForNodeData(t)),e&&r.add(t)});let u=s.cloneDeep(r.toArray()),d=null;return n&&(null===d&&(d={}),d.modelData=this.cloneDeep(this.modelData)),h.count>0&&(null===d&&(d={}),e?d.removedNodeKeys=h.toArray():d.insertedNodeKeys=h.toArray()),u.length>0&&(null===d&&(d={}),d.modifiedNodeData=u),a.count>0&&(null===d&&(d={}),e?d.insertedNodeKeys=a.toArray():d.removedNodeKeys=a.toArray()),d}cloneDeep(t){return this.rg(t,!0)}rg(t,e,i,s){let n;if(!te.H(t))return t;i||(i=new tp);let l=i.get(t);if(l)return l;if(Array.isArray(t)){n=[],i.set(t,n);for(let e=0;e<t.length;e++){let l=t[e];n.push(this.rg(l,!1,i,s))}}else if(t instanceof ty||t instanceof tx||t instanceof tw||t instanceof tb||t instanceof tv)n=t.copy(),i.set(t,n);else{if(t instanceof eD||t instanceof tN)return t;if(t instanceof th)n=new th().addAll(this.rg(t.toArray(),!1,i,s)),i.set(t,n);else if(t instanceof tu)n=new tu().addAll(this.rg(t.toArray(),!1,i,s)),i.set(t,n);else if(t instanceof tp)n=new tp().addAll(this.rg(t.toArray(),!1,i,s)),i.set(t,n);else if(t instanceof Date)n=new Date(t),i.set(t,n);else if(t instanceof RegExp)n=new RegExp(t),i.set(t,n),n.lastIndex=t.lastIndex;else if(iE.LN(null,"",t))n=t;else if(te.ot(t.copy))n=t.copy(),i.set(t,n);else for(let e in n={},i.set(t,n),t){if("__gohashid"===e)continue;let l=t[e];n[e]=this.rg(l,!1,i,s)}}return n}ve(t){return JSON.stringify(t).replace(/[\u007F-\uFFFF]/g,t=>{let e="0000"+t.charCodeAt(0).toString(16);return"\\u"+e.substring(e.length-4)})}lg(){let t="";return""!==this.name&&(t+=`,
  "name": `+this.ve(this.name)),""!==this.dataFormat&&(t+=`,
  "dataFormat": `+this.ve(this.dataFormat)),this.isReadOnly&&(t+=`,
  "isReadOnly": `+this.isReadOnly),"key"!==this.nodeKeyProperty&&"string"==typeof this.nodeKeyProperty&&(t+=`,
  "nodeKeyProperty": `+this.ve(this.nodeKeyProperty)),this.copiesArrays&&(t+=`,
  "copiesArrays": true`),this.copiesArrayObjects&&(t+=`,
  "copiesArrayObjects": true`),this.copiesKey&&(t+=`,
  "copiesKey": true`),100!==this.pointsDigits&&(t+=`,
  "pointsDigits": `+this.pointsDigits.toString()),"category"!==this.nodeCategoryProperty&&"string"==typeof this.nodeCategoryProperty&&(t+=`,
  "nodeCategoryProperty": `+this.ve(this.nodeCategoryProperty)),t}Ty(t){t.name&&(this.name=t.name),t.dataFormat&&(this.dataFormat=t.dataFormat),t.isReadOnly&&(this.isReadOnly=!0),t.nodeKeyProperty&&(this.nodeKeyProperty=t.nodeKeyProperty),t.copiesArrays&&(this.copiesArrays=!0),t.copiesArrayObjects&&(this.copiesArrayObjects=!0),void 0!==t.copiesKey&&(this.copiesKey=t.copiesKey),void 0!==t.pointsDigits&&(this.pointsDigits=parseInt(t.pointsDigits)),t.nodeCategoryProperty&&(this.nodeCategoryProperty=t.nodeCategoryProperty)}KT(){let t=this.modelData;return`,
  "modelData": `+this.GT(t)}HT(t){let e=t.modelData;te.H(e)&&(this.replaceJsonObjects(e),this.modelData=e)}AN(){let t=this.modelData,e=!1;for(let i in t)if(!this.R1(t,i,t[i])){e=!0;break}let i="";return e&&(i=this.KT()),i+`,
  "nodeDataArray": `+this.vh(this.nodeDataArray,!0)}TN(t){this.HT(t);let e=t.nodeDataArray;Array.isArray(e)&&(this.replaceJsonObjects(e),this.nodeDataArray=e)}DN(t,e,i){if(t===e)return!0;if(typeof t!=typeof e||te.ot(t)||te.ot(e))return!1;if(Array.isArray(t)&&Array.isArray(e)){if(i.get(t)===e)return!0;if(i.set(t,e),t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(!this.DN(t[s],e[s],i))return!1;return!0}if(te.H(t)&&te.H(e)){if(i.get(t)===e)return!0;for(let s in i.set(t,e),t){let n=t[s];if(this.R1(t,s,n))continue;let l=e[s];if(void 0===l||!this.DN(n,l,i))return!1}for(let s in e){let n=e[s];if(this.R1(e,s,n))continue;let l=t[s];if(void 0===l||!this.DN(l,n,i))return!1}return!0}return!1}static jT=`,
  "insertedNodeKeys": `;static zO=`,
  "modifiedNodeData": `;static qT=`,
  "removedNodeKeys": `;XT(t){let e=new tp,i=(t,i)=>{let s=i.part;if(!s)return;let n=s.data;if(t===n)return;let l=e.get(t);null===l?((l=new tu).add(n),e.set(t,l)):l.add(n)};return t.changes.each(t=>{if(null!==t.diagram){let e=t.change;if(2===e){let e=t.object.panel;if(e){let t=e.data;t&&i(t,e)}}else if(3===e||4===e){let e=t.object,s=e.itemArray;s&&i(s,e)}}}),e}YT(t){let e=new tu;for(let i=0;i<this.nodeDataArray.length;i++){let s=this.nodeDataArray[i];this.v1(t,s,s,e)}return e}v1(t,e,i,s){if(Array.isArray(e))for(let n=0;n<e.length;n++){let l=e[n];if(l===t)return s.add(i),!0;if(this.v1(t,l,i,s))return!0}else if(te.H(e)&&Object.getPrototypeOf(e)===Object.prototype)for(let n in e){let l=e[n];if(l===t)return s.add(i),!0;if(this.v1(t,l,i,s))return!0}return!1}FN(t,e,i){let s=this,n=!1,l=new tu,r=new tu,o=new tu;t.changes.each(t=>{if(t.model===s){if("nodeDataArray"===t.modelChange)3===t.change?l.add(t.newValue):4===t.change&&o.add(t.oldValue);else if(s.containsNodeData(t.object))r.add(t.object);else if(2===t.change&&(s.modelData===t.object||"modelData"===t.propertyName))n=!0;else if(null!==t.object){if(i.has(t.object))i.get(t.object).each(t=>{s.containsNodeData(t)&&r.add(t)});else{if(t.object instanceof iE||s.Ba()&&s.containsLinkData(t.object))return;s.YT(t.object).each(t=>{r.add(t)})}}}});let h=new tu;l.each(t=>{h.add(s.getKeyForNodeData(t)),e||r.add(t)});let a=new tu;o.each(t=>{a.add(s.getKeyForNodeData(t)),e&&r.add(t)});let u="";return n&&(u+=this.KT()),h.count>0&&(u+=(e?iE.qT:iE.jT)+this.vh(h.toArray(),!0)),r.count>0&&(u+=iE.zO+this.vh(r.toArray(),!0)),a.count>0&&(u+=(e?iE.jT:iE.qT)+this.vh(a.toArray(),!0)),u}Dy(t){(void 0!==t.name&&t.name!==this.name||void 0!==t.dataFormat&&t.dataFormat!==this.dataFormat||void 0!==t.isReadOnly&&t.isReadOnly!==this.isReadOnly||void 0!==t.nodeKeyProperty&&t.nodeKeyProperty!==this.nodeKeyProperty||void 0!==t.copiesArrays&&t.copiesArrays!==this.copiesArrays||void 0!==t.copiesArrayObjects&&t.copiesArrayObjects!==this.copiesArrayObjects||void 0!==t.copiesKey&&t.copiesKey!==this.copiesKey||void 0!==t.nodeCategoryProperty&&t.nodeCategoryProperty!==this.nodeCategoryProperty)&&te.o("applyIncrementalJson cannot change Model properties"),this.HT(t);let e=t.insertedNodeKeys,i=t.modifiedNodeData,s=new tp;if(Array.isArray(i))for(let t=0;t<i.length;t++){let e=i[t],n=this.getKeyForNodeData(e);null!=n&&s.set(n,e)}if(Array.isArray(e)){let t=e.length;for(let i=0;i<t;i++){let t=e[i],n=this.findNodeDataForKey(t);null===n&&(n=s.get(t)||this.copyNodeData({}),this.setKeyForNodeData(n,t),this.addNodeData(n))}}if(Array.isArray(i)){let t=i.length;for(let e=0;e<t;e++){let t=i[e],s=this.getKeyForNodeData(t),n=this.findNodeDataForKey(s);if(null!==n){for(let e in t)"__gohashid"===e||e===this.nodeKeyProperty||(this.bm()||this.yb())&&e===this.nodeIsGroupProperty||this.setDataProperty(n,e,t[e]);this.hg(t,n)}}}let n=t.removedNodeKeys;if(Array.isArray(n)){let t=n.length;for(let e=0;e<t;e++){let t=n[e],i=this.findNodeDataForKey(t);null!==i&&this.removeNodeData(i)}}}toIncrementalJson(t,e){1!==t.change&&te.o("Model.toIncrementalJson argument is not a Transaction ChangedEvent:"+t.toString());let i=t.object;if(!t.isTransactionFinished||!(i instanceof tR))return'{ "incremental": 0 }';void 0===e&&(e=te.Vn(this));let s=this.XT(i),n=this.FN(i,"FinishedUndo"===t.propertyName,s);return'{ "class": '+this.ve(e)+', "incremental": 1'+this.lg()+n+"}"}toIncrementalJSON(t,e){return this.toIncrementalJson(t,e)}toJson(t){return void 0===t&&(t=te.Vn(this)),'{ "class": '+this.ve(t)+this.lg()+this.AN()+"}"}toJSON(t){return this.toJson(t)}applyIncrementalJson(t){let e=null;if("string"==typeof t)try{e=tt.JSON.parse(t)}catch{}else te.H(t)?e=t:te.o("Unable to modify a Model from: "+t);let i=e.incremental;"number"!=typeof i&&te.o("Unable to apply non-incremental changes to Model: "+t),0!==i&&(this.startTransaction("applyIncrementalJson"),this.Dy(e),this.commitTransaction("applyIncrementalJson"))}applyIncrementalJSON(t){return this.applyIncrementalJson(t)}static fromJson(t,e){void 0===e&&(e=null);let i=null;if("string"==typeof t)try{i=tt.JSON.parse(t)}catch{}else te.H(t)?i=t:te.o("Unable to construct a Model from: "+t);if(null===e){let t=iE.XO(i);null===t||t instanceof iE?e=t:te.o("Unable to construct a Model of declared class: "+i.class)}return null===e&&(e=iE.WT()),e.Ty(i),e.TN(i),e}static fromJSON(t,e){return this.fromJson(t,e)}static WT(){return new iE}static XO(t){let e=null,i=t.class;if("string"==typeof i)try{let t=null;0===i.indexOf("go.")?t=iE.RN(i.substring(3)):(t=iE.RN(i),null===t&&(t=tt[i])),te.ot(t)&&(e=new t)}catch{}return e}replaceJsonObjects(t){if(Array.isArray(t)){let e=t.length;for(let i=0;i<e;i++){let e=t[i];te.H(e)&&this.JT(t,i,this.replaceJsonObjects(e))}}else if(te.H(t)){for(let e in t){let i=t[e];if(te.H(i)){let s=this.replaceJsonObjects(i);if(t[e]=s,"points"===e&&Array.isArray(s)){let i=s.length%2==0;for(let t=0;t<s.length;t++)if("number"!=typeof s[t]){i=!1;break}if(i){let i=new th;for(let t=0;t<s.length/2;t++)i.add(new ty(s[2*t],s[2*t+1]));i.u(),t[e]=i}}}}return this.YO(t)}return t}writeJsonValue(t){return void 0===t?"undefined":null===t?"null":!0===t?"true":!1===t?"false":"string"==typeof t?this.ve(t):"number"==typeof t?t===1/0?"9e9999":t===-1/0?"-9e9999":isNaN(t)?'{"class":"NaN"}':t.toString():t instanceof Boolean?this.writeJsonValue(t.valueOf()):t instanceof String?this.writeJsonValue(t.valueOf()):t instanceof Number?this.writeJsonValue(t.valueOf()):t instanceof Date?'{"class":"Date", "value":"'+t.toJSON()+'"}':Array.isArray(t)?this.vh(t):te.H(t)?this.GT(t):te.ot(t)?"null":'"'+t.toString()+'"'}vh(t,e){void 0===e&&(e=!1);let i=t.length;if(i<=0)return"[]";let s=new ti;s.add("["),e&&i>1&&s.add(`
`);for(let n=0;n<i;n++){let i=t[n];void 0!==i&&(n>0&&(s.add(","),e&&s.add(`
`)),s.add(this.writeJsonValue(i)))}return e&&i>1&&s.add(`
`),s.add("]"),s.toString()}R1(t,e,i){return!!(void 0===i||"__gohashid"===e||"_"===e[0]||te.ot(i))}Hi(t){return isNaN(t)?"NaN":t===1/0?"9e9999":t===-1/0?"-9e9999":t}GT(t){let e=t;if(e instanceof ty)t={class:"go.Point",x:this.Hi(e.x),y:this.Hi(e.y)};else if(e instanceof tx)t={class:"go.Size",width:this.Hi(e.width),height:this.Hi(e.height)};else if(e instanceof tw)t={class:"go.Rect",x:this.Hi(e.x),y:this.Hi(e.y),width:this.Hi(e.width),height:this.Hi(e.height)};else if(e instanceof tb)t={class:"go.Margin",top:this.Hi(e.top),right:this.Hi(e.right),bottom:this.Hi(e.bottom),left:this.Hi(e.left)};else if(e instanceof tv)t=e.isSpot()?{class:"go.Spot",x:this.Hi(e.x),y:this.Hi(e.y),offsetX:this.Hi(e.offsetX),offsetY:this.Hi(e.offsetY)}:{class:"go.Spot",enum:e.toString()};else if(e instanceof eD){if(t={class:"go.Brush",type:eL[e.type]},1===e.type?t.color=e.color:(2===e.type||3===e.type)&&(t.start=e.start,t.end=e.end,3===e.type&&(0!==e.startRadius&&(t.startRadius=this.Hi(e.startRadius)),isNaN(e.endRadius)||(t.endRadius=this.Hi(e.endRadius)))),null!==e.colorStops){let i={},s=e.colorStops.iterator;for(;s.next();){let t=s.key,e=s.value;i[t]=e}t.colorStops=i}}else if(e instanceof tN)t={class:"go.Geometry",type:tS[e.type]},0!==e.startX&&(t.startX=this.Hi(e.startX)),0!==e.startY&&(t.startY=this.Hi(e.startY)),0!==e.endX&&(t.endX=this.Hi(e.endX)),0!==e.endY&&(t.endY=this.Hi(e.endY)),e.spot1.equals(tv.TopLeft)||(t.spot1=e.spot1),e.spot2.equals(tv.BottomRight)||(t.spot2=e.spot2),4===e.type&&(t.path=tN.stringify(e));else if(iE.LN(null,"",e))return"{}";let i="{",s=!0;for(let e in t){let n=this.bt(t,e);if(!this.R1(t,e,n)){if(s?s=!1:i+=",",i+=this.ve(e)+":","points"===e&&n instanceof th){let t="[",e=n.iterator;for(;e.next();){let i=e.value;t.length>1&&(t+=","),t+=this.$T(i.x),t+=",",t+=this.$T(i.y)}t+="]",i+=t}else i+=this.writeJsonValue(n)}}return i+"}"}$T(t){if(t===1/0)return"9e9999";if(t===-1/0)return"-9e9999";if(isNaN(t))return"0";let e=this.pointsDigits;return e>16?t.toString():t.toFixed(e)}get pointsDigits(){return this.Ly}set pointsDigits(t){t<0?t=0:t>100&&(t=100),this.Ly=t}ji(t){return"number"==typeof t?t:"NaN"===t?NaN:"9e9999"===t?1/0:"-9e9999"===t?-1/0:parseFloat(t)}YO(t){if(!te.H(t))return t;let e=t.class||"";if("string"!=typeof e||""===e)return t;if("NaN"===e)return NaN;if("Date"===e)return new Date(t.value);if(0!==e.indexOf("go."))return t;e=e.substring(3);let i=t;if("Point"===e)i=new ty(this.ji(t.x),this.ji(t.y));else if("Size"===e)i=new tx(this.ji(t.width),this.ji(t.height));else if("Rect"===e)i=new tw(this.ji(t.x),this.ji(t.y),this.ji(t.width),this.ji(t.height));else if("Margin"===e)i=new tb(this.ji(t.top),this.ji(t.right),this.ji(t.bottom),this.ji(t.left));else if("Spot"===e)i="string"==typeof t.enum?tv.parse(t.enum):new tv(this.ji(t.x),this.ji(t.y),this.ji(t.offsetX),this.ji(t.offsetY));else if("Brush"===e){let e=new eD;e.type=te.Xh(eL,t.type)??1,"string"==typeof t.color&&(e.color=t.color),t.start instanceof tv&&(e.start=t.start),t.end instanceof tv&&(e.end=t.end),"number"==typeof t.startRadius&&(e.startRadius=this.ji(t.startRadius)),"number"==typeof t.endRadius&&(e.endRadius=this.ji(t.endRadius));let s=t.colorStops;if(te.H(s))for(let t in s){let i=parseFloat(t);e.addColorStop(i,s[t])}i=e}else if("Geometry"===e){let e=null;(e="string"==typeof t.path?tN.parse(t.path):new tN).type=te.Xh(tS,t.type)??1,"number"==typeof t.startX&&(e.startX=this.ji(t.startX)),"number"==typeof t.startY&&(e.startY=this.ji(t.startY)),"number"==typeof t.endX&&(e.endX=this.ji(t.endX)),"number"==typeof t.endY&&(e.endY=this.ji(t.endY)),t.spot1 instanceof tv&&(e.spot1=t.spot1),t.spot2 instanceof tv&&(e.spot2=t.spot2),i=e}else if("EnumValue"===e){let e=t.classType;0===e.indexOf("go.")&&(e=e.substring(3));let s=iE.RN(e);te.ot(s)&&(i=te.Xh(s,t.name))}return i}get name(){return this.Nt}set name(t){let e=this.Nt;e!==t&&(te.s(t,"string",iE,"name"),this.Nt=t,this.t("name",e,t))}get dataFormat(){return this.ig}set dataFormat(t){let e=this.ig;e!==t&&(te.s(t,"string",iE,"dataFormat"),this.ig=t,this.t("dataFormat",e,t))}get isReadOnly(){return this.Eo}set isReadOnly(t){let e=this.Eo;e!==t&&(te.s(t,"boolean",iE,"isReadOnly"),this.Eo=t,this.t("isReadOnly",e,t))}get modelData(){return this.NN}set modelData(t){let e=this.modelData;e!==t&&(te.lc(t,iE,"modelData"),this.containsNodeData(t)&&te.o("Model.modelData Object must not be used by the rest of the model: "+t),this.NN=t,this.t("modelData",e,t),this.updateTargetBindings(t))}addChangedListener(t){return te.S(t,iE,"addChangedListener:listener"),this.Ay.push(t),this}removeChangedListener(t){te.S(t,iE,"removeChangedListener:listener");let e=this.Ay.indexOf(t);e>=0&&this.Ay.splice(e,1)}RM(t){this.skipsUndoManager||this.undoManager.handleChanged(t),this.ZT(t)}ZT(t){this.Ay.forEach(e=>e(t))}rF(t){this.ZT(t)}raiseChangedEvent(t,e,i,s,n,l,r){this.Bt("",t,e,i,s,n,l,r)}raiseChanged(t,e,i,s,n){this.Bt("",2,t,this,e,i,s,n)}t(t,e,i,s,n){this.Bt("",2,t,this,e,i,s,n)}raiseDataChanged(t,e,i,s,n,l){this.Bt("",2,e,t,i,s,n,l)}Bt(t,e,i,s,n,l,r,o){void 0===r&&(r=null),void 0===o&&(o=null);let h=new tO;h.model=this,h.change=e,h.modelChange=t,h.propertyName=i,h.object=s,h.oldValue=n,h.oldParam=r,h.newValue=l,h.newParam=o,this.RM(h)}get undoManager(){return this.F1}set undoManager(t){let e=this.F1;e!==t&&(null!==e&&e.removeModel(this),this.F1=t,null!==t&&t.addModel(this))}get skipsUndoManager(){return this.Io}set skipsUndoManager(t){te.s(t,"boolean",iE,"skipsUndoManager"),this.Io=t}changeState(t,e){if(null!==t&&t.model===this){if(2===t.change){let i=t.object,s=t.propertyName,n=t.getValue(e);if(s===this.nodeKeyProperty&&this.containsNodeData(i)){let s=t.getValue(!e);void 0!==s&&this.wi.delete(s),void 0!==n&&this.wi.set(n,i)}this.et(i,s,n)}else if(3===t.change){let i=t.newParam;if("nodeDataArray"===t.modelChange){let s=t.newValue;if(te.H(s)&&"number"==typeof i){let t=this.getKeyForNodeData(s);e?(this.Re[i]===s&&this.Po(this.Re,i),void 0!==t&&this.wi.delete(t)):(this.Re[i]!==s&&this.nr(this.Re,i,s),void 0!==t&&this.wi.set(t,s))}}else if(""===t.modelChange){let s=t.object;if(s&&!Array.isArray(s)&&t.propertyName&&(s=this.bt(s,t.propertyName)),Array.isArray(s)&&"number"==typeof i){let n=t.newValue;e?this.Po(s,i):this.nr(s,i,n)}}else te.o("unknown ChangeType.Insert modelChange: "+t.toString())}else if(4===t.change){let i=t.oldParam;if("nodeDataArray"===t.modelChange){let s=t.oldValue;if(te.H(s)&&"number"==typeof i){let t=this.getKeyForNodeData(s);e?(this.Re[i]!==s&&this.nr(this.Re,i,s),void 0!==t&&this.wi.set(t,s)):(this.Re[i]===s&&this.Po(this.Re,i),void 0!==t&&this.wi.delete(t))}}else if(""===t.modelChange){let s=t.object;if(s&&!Array.isArray(s)&&t.propertyName&&(s=this.bt(s,t.propertyName)),Array.isArray(s)&&"number"==typeof i){let n=t.oldValue;e?this.nr(s,i,n):this.Po(s,i)}}else te.o("unknown ChangeType.Remove modelChange: "+t.toString())}else 1===t.change||te.o("unknown ChangedEvent: "+t.toString())}}startTransaction(t){return this.undoManager.startTransaction(t)}commitTransaction(t){return this.undoManager.commitTransaction(t)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(t,e){let i=e;void 0===i&&(i="");let s=this.skipsUndoManager;null===i&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{t(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateTargetBindings(t,e){void 0===e&&(e=""),this.Bt("SourceChanged",1,e,t,null,null)}get nodeKeyProperty(){return this.Rh}set nodeKeyProperty(t){let e=this.Rh;e!==t&&(this.Fn(t,iE,"nodeKeyProperty"),""===t&&te.o("Model.nodeKeyProperty may not be the empty string"),this.wi.count>0&&te.o("Cannot set Model.nodeKeyProperty when there is existing node data"),this.Rh=t,this.t("nodeKeyProperty",e,t))}Fn(t,e,i){"string"==typeof t||te.ot(t)||te.te(t,"string or function",e,i)}getKeyForNodeData(t){if(null===t)return;let e=this.Rh;if(""===e)return;let i=this.bt(t,e);if(void 0!==i){if(this.isKeyType(i))return i;te.o("Key value for node data "+t+" is not a number or a string: "+i)}}setKeyForNodeData(t,e){if(null!=e&&this.isKeyType(e)||te.te(e,"number or string",iE,"setKeyForNodeData:key"),null===t)return;let i=this.Rh;if(""===i)return;if(!this.containsNodeData(t)){this.et(t,i,e);return}let s=this.bt(t,i);if(s!==e){if(null!==this.findNodeDataForKey(e))return;this.et(t,i,e),void 0!==s&&this.wi.delete(s),this.wi.set(e,t),this.Bt("nodeKey",2,i,t,s,e),"string"==typeof i&&this.updateTargetBindings(t,i),this.Fy(s,e)}}get makeUniqueKeyFunction(){return this.Ef}set makeUniqueKeyFunction(t){let e=this.Ef;e!==t&&(null!==t&&te.S(t,iE,"makeUniqueKeyFunction"),this.Ef=t,this.t("makeUniqueKeyFunction",e,t))}isKeyType(t){return"number"==typeof t||"string"==typeof t}containsNodeData(t){if(null===t)return!1;let e=this.getKeyForNodeData(t);return void 0!==e&&this.wi.get(e)===t}findNodeDataForKey(t){return null===t&&te.o("Model.findNodeDataForKey:key must not be null"),void 0!==t&&this.isKeyType(t)?this.wi.get(t):null}get nodeDataArray(){return this.Re}set nodeDataArray(t){let e=this.Re;if(e!==t){this.vN(t,iE,"nodeDataArray"),this.wi.clear(),this.ON();let i=t.length;for(let e=0;e<i;e++){let i=t[e];te.H(i)||te.o("Model.nodeDataArray must only contain Objects, not: "+i),i===this.modelData&&te.o("nodeDataArray Objects must not be the shared Model.modelData")}this.Re=t;let s=new th;for(let e=0;e<i;e++){let i=t[e],n=this.getKeyForNodeData(i);void 0===n||null!==this.wi.get(n)?s.add(i):this.wi.set(n,i)}let n=s.iterator;for(;n.next();){let t=n.value;this.makeNodeDataKeyUnique(t);let e=this.getKeyForNodeData(t);void 0!==e&&this.wi.set(e,t)}this.Bt("nodeDataArray",2,"nodeDataArray",this,e,t);for(let e=0;e<i;e++){let i=t[e];this.ag(i),this.cg(i)}}}O1(t){return void 0!==t&&this.wi.has(t)}makeNodeDataKeyUnique(t){if(null===t)return;let e=this.Rh;if(""===e)return;let i=this.getKeyForNodeData(t);if(void 0!==i&&!this.O1(i))return;let s=this.Ef;if(null!==s&&null!=(i=s(this,t))&&!this.O1(i)){this.et(t,e,i);return}if("string"==typeof i){let s=2;for(;this.O1(i+s);)s++;this.et(t,e,i+s)}else if(void 0===i||"number"==typeof i){let i=-this.wi.count-1;for(;this.O1(i);)i--;this.et(t,e,i)}}addNodeData(t){null!==t&&(t===this.modelData&&te.o("Model.addNodeData cannot add the shared Model.modelData Object"),this.containsNodeData(t)||this.vT(t,!0))}vT(t,e){let i=this.getKeyForNodeData(t);if(void 0===i)this.makeNodeDataKeyUnique(t),i=this.getKeyForNodeData(t);else{if(this.wi.get(i)===t)return;this.makeNodeDataKeyUnique(t),i=this.getKeyForNodeData(t)}void 0===i&&te.o("Model.makeNodeDataKeyUnique failed on "+t+".  Data not added to Model."),this.wi.set(i,t);let s=null;e&&(s=this.Re.length,this.nr(this.Re,s,t)),this.Bt("nodeDataArray",3,"nodeDataArray",this,null,t,null,s),this.ag(t),this.cg(t)}addNodeDataCollection(t){if(Array.isArray(t)){let e=t.length;for(let i=0;i<e;i++)this.addNodeData(t[i])}else{let e=t.iterator;for(;e.next();){let t=e.value;this.addNodeData(t)}}}removeNodeData(t){null!==t&&this.RT(t,!0)}RT(t,e){let i=this.getKeyForNodeData(t);void 0!==i&&this.wi.delete(i);let s=null;if(e){if((s=this.Re.indexOf(t))<0)return;this.Po(this.Re,s)}this.Bt("nodeDataArray",4,"nodeDataArray",this,t,null,s,null),this.Ry(t)}removeNodeDataCollection(t){if(Array.isArray(t)){let e=t.length;for(let i=0;i<e;i++)this.removeNodeData(t[i])}else{let e=t.iterator;for(;e.next();){let t=e.value;this.removeNodeData(t)}}}mergeNodeDataArray(t){if(t===this.nodeDataArray||!Array.isArray(t))return;let e=new tu;e.addAll(this.wi.iteratorKeys);let i=new tu,s=t.length;for(let e=0;e<s;e++){let s=t[e],n=this.getKeyForNodeData(s);if(void 0!==n){i.add(n);let t=this.findNodeDataForKey(n);if(t===s)continue;if(null!==t)this.assignAllDataProperties(t,s),this.hg(s,t);else{let t=this.cloneDeep(s);this.setKeyForNodeData(t,n),this.addNodeData(t)}}else{let t=this.cloneDeep(s);this.addNodeData(t),i.add(this.getKeyForNodeData(t))}}let n=e.iterator;for(;n.next();){let t=n.value;if(!i.has(t)){let e=this.findNodeDataForKey(t);e&&this.removeNodeData(e)}}}Fy(t,e){if(void 0===e)return;let i=this.Ny(t);i instanceof tu&&this.sr.set(e,i)}ON(){}ag(t){}cg(t){}Ry(t){}tn(t,e){if(void 0===t)return;let i=this.sr.get(t);null===i&&(i=new tu,this.sr.set(t,i)),i.add(e)}_s(t,e){if(void 0===t)return;let i=this.sr.get(t);i instanceof tu&&(null==e?this.sr.delete(t):(i.delete(e),0===i.count&&this.sr.delete(t)))}Ny(t){if(void 0===t)return null;let e=this.sr.get(t);return e instanceof tu?e:null}LE(t){void 0===t?this.sr.clear():this.sr.delete(t)}get copyNodeDataFunction(){return this.Bf}set copyNodeDataFunction(t){let e=this.Bf;e!==t&&(null!==t&&te.S(t,iE,"copyNodeDataFunction"),this.Bf=t,this.t("copyNodeDataFunction",e,t))}get copiesArrays(){return this.eg}set copiesArrays(t){let e=this.eg;e!==t&&(null!==t&&te.s(t,"boolean",iE,"copiesArrays"),this.eg=t,this.t("copiesArrays",e,t))}get copiesArrayObjects(){return this.sg}set copiesArrayObjects(t){let e=this.sg;e!==t&&(null!==t&&te.s(t,"boolean",iE,"copiesArrayObjects"),this.sg=t,this.t("copiesArrayObjects",e,t))}get copiesKey(){return this.ng}set copiesKey(t){let e=this.ng;e!==t&&(null!==t&&te.s(t,"boolean",iE,"copiesKey"),this.ng=t,this.t("copiesKey",e,t))}copyNodeData(t){if(null===t)return null;let e=null,i=this.Bf;return e=null!==i?i(t,this):this.I1(t,!0),te.H(e),e}I1(t,e){if(!te.H(t))return t;if(Array.isArray(t)){if(!this.copiesArrays)return t;{let e=[];for(let i=0;i<t.length;i++){let s=t[i],n=this.I1(s,this.copiesArrayObjects);e.push(n)}return e}}if(t instanceof ty||t instanceof tx||t instanceof tw||t instanceof tb||t instanceof tv)return t.copy();if(!e)return t;{let e=t.constructor,i=e?new e:{},s=this.copiesKey||"string"!=typeof this.nodeKeyProperty?null:this.nodeKeyProperty;for(let e in t){if("__gohashid"===e){i.__gohashid=void 0;continue}if(e===s){i[s]=void 0;continue}let n=this.bt(t,e);if(te.H(n)){if(iE.LN(t,e,n))this.et(i,e,n);else{let t=this.I1(n,!1);this.et(i,e,t)}}else i[e]=n}return i}}get afterCopyFunction(){return this.og}set afterCopyFunction(t){let e=this.og;e!==t&&(null!==t&&te.S(t,iE,"afterCopyFunction"),this.og=t,this.t("afterCopyFunction",e,t))}static LN(t,e,i){let s=te.Vn(i);return i instanceof iE||i instanceof tB||i instanceof tR||i instanceof tO||i instanceof eb||i instanceof eZ||i instanceof eh||i instanceof EventTarget||"Layer"===s||"RowColumnDefinition"===s||s.indexOf("Animation")>=0||s.indexOf("Tool")>=0||s.indexOf("CommandHandler")>=0||s.indexOf("Layout")>=0}static QT=!1;setDataProperty(t,e,i){if(this.containsNodeData(t)){if(e===this.nodeKeyProperty){this.setKeyForNodeData(t,i);return}if(e===this.nodeCategoryProperty){this.setCategoryForNodeData(t,i);return}}else!iE.QT&&t instanceof eb&&(iE.QT=!0,te.li('Model.setDataProperty is modifying a GraphObject, "'+t.toString()+'"'),te.li("  Is that really your intent?"));let s=this.bt(t,e);s!==i&&(this.et(t,e,i),this.raiseDataChanged(t,e,s,i))}set(t,e,i){this.setDataProperty(t,e,i)}assignAllDataProperties(t,e){if(!e)return;let i=this.containsNodeData(t);for(let s in e)"__gohashid"!==s&&(i&&s===this.nodeKeyProperty||this.setDataProperty(t,s,e[s]))}addArrayItem(t,e){this.insertArrayItem(t,-1,e)}insertArrayItem(t,e,i){e<0&&(e=t.length),t=this.nr(t,e,i),this.Bt("",3,"",t,null,i,null,e)}removeArrayItem(t,e){void 0===e&&(e=-1),t===this.Re&&te.o("Model.removeArrayItem should not be called on the Model.nodeDataArray"),-1===e&&(e=t.length-1);let i=t[e];t=this.Po(t,e),this.Bt("",4,"",t,i,null,e,null)}get nodeCategoryProperty(){return this.Ja}set nodeCategoryProperty(t){let e=this.Ja;e!==t&&(this.Fn(t,iE,"nodeCategoryProperty"),this.Ja=t,this.t("nodeCategoryProperty",e,t))}getCategoryForNodeData(t){if(null===t)return"";let e=this.Ja;if(""===e)return"";let i=this.bt(t,e);return void 0===i?"":"string"==typeof i?i:void te.o("getCategoryForNodeData found a non-string category for "+t+": "+i)}setCategoryForNodeData(t,e){if(te.s(e,"string",iE,"setCategoryForNodeData:cat"),null===t)return;let i=this.Ja;if(""===i)return;if(!this.containsNodeData(t)){this.et(t,i,e);return}let s=this.bt(t,i);void 0===s&&(s=""),s!==e&&(this.et(t,i,e),this.Bt("nodeCategory",2,i,t,s,e))}hg(t,e){this.setCategoryForNodeData(e,this.getCategoryForNodeData(t))}get type(){return"Model"}km(){return!1}bm(){return!1}yb(){return!1}Ba(){return!1}Uw(){return!1}Qc(){return!1}static bM(){return new iE}bt(t,e){return iE.bt(t,e)}static bt(t,e){let i;if(!t||!e)return null;try{te.ot(e)?i=e(t):te.ot(t.getAttribute)?(i=t.getAttribute(e),null===i&&(i=void 0)):i=t[e]}catch{}return i}et(t,e,i){iE.et(t,e,i)}static et(t,e,i){if(!(!t||!e)){try{te.ot(e)?e(t,i):te.ot(t.setAttribute)?t.setAttribute(e,i):t[e]=i}catch{}return t}}vN(t,e,i){Array.isArray(t)||te.te(t,"Array",e,i)}JT(t,e,i){return t[e]=i,t}nr(t,e,i){return e>=t.length?t.push(i):t.splice(e,0,i),t}Po(t,e){return e>=t.length?t.pop():t.splice(e,1),t}static RN(t){return iE.IN[t]?iE.IN[t]:void 0!==tt.go&&tt.go[t]?tt.go[t]:null}static wl(t,e){iE.IN[e]=t}static IN={};static{iE.wl(eD,"Brush"),iE.wl(tN,"Geometry"),iE.wl(tb,"Margin"),iE.wl(ty,"Point"),iE.wl(tw,"Rect"),iE.wl(tx,"Size"),iE.wl(tv,"Spot"),iE.wl(iE,"Model")}}iE.fromJSON=iE.fromJson=iE.fromJson;class iI extends iE{Ns;or;vi;Oh;Uf;Vf;vl;So;Mo;$a;Za;Qa;en;zf;Rn;fg;constructor(t,e,i){if(super(),this.Ns=[],this.or=new tu,this.vi=new tp,this.Oh="",this.Uf=null,this.Vf=null,this.vl=null,this.So="from",this.Mo="to",this.$a="",this.Za="",this.Qa="category",this.en="",this.zf="isGroup",this.Rn="group",this.fg=!1,void 0!==e&&(this.linkDataArray=e),void 0!==t&&(Array.isArray(t)?this.nodeDataArray=t:i=t),i){Object.assign(this,i);let t=i.Changed;t&&(delete this.Changed,this.addChangedListener(t))}}cloneProtected(t){super.cloneProtected(t),t.Oh=this.Oh,t.Uf=this.Uf,t.Vf=this.Vf,t.So=this.So,t.Mo=this.Mo,t.$a=this.$a,t.Za=this.Za,t.Qa=this.Qa,t.en=this.en,t.zf=this.zf,t.Rn=this.Rn,t.fg=this.fg}clear(){this.Ns=[],this.vi.clear(),this.or.clear(),super.clear()}toString(t){if(void 0===t&&(t=0),t>=2)return this.toJson();{let e=(""!==this.name?this.name:"")+" GraphLinksModel";if(t>0){e+=`
 node data:`;let t=this.nodeDataArray,i=t.length,s=0;for(s=0;s<i;s++){let i=t[s];e+=" "+this.getKeyForNodeData(i)+":"+iR.toString(i)}for(e+=`
 link data:`,i=(t=this.linkDataArray).length,s=0;s<i;s++){let i=t[s];e+=" "+this.Fe(i,!0)+"--\x3e"+this.Fe(i,!1)}}return e}}CN(t,e,i){if(""===this.linkKeyProperty){let t=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=t}let s=super.CN(t,e,i),n=this,l=new tu,r=new tu,o=new tu;t.changes.each(t=>{if(t.model===n){if("linkDataArray"===t.modelChange)3===t.change?l.add(t.newValue):4===t.change&&o.add(t.oldValue);else if(n.containsLinkData(t.object))r.add(t.object);else if(null!==t.object){if(null!==t.object&&i.has(t.object))i.get(t.object).each(t=>{n.containsLinkData(t)&&r.add(t)});else{if(t.object instanceof iE||n.containsNodeData(t.object))return;n._T(t.object).each(t=>r.add(t))}}}});let h=new tu;l.each(t=>{h.add(n.getKeyForLinkData(t)),e||r.add(t)});let a=new tu;o.each(t=>{a.add(n.getKeyForLinkData(t)),e&&r.add(t)});let u=n.cloneDeep(r.toArray());return h.count>0&&(null===s&&(s={}),e?s.removedLinkKeys=h.toArray():s.insertedLinkKeys=h.toArray()),u.length>0&&(null===s&&(s={}),s.modifiedLinkData=u),a.count>0&&(null===s&&(s={}),e?s.insertedLinkKeys=a.toArray():s.removedLinkKeys=a.toArray()),s}lg(){let t=super.lg(),e="";return"category"!==this.linkCategoryProperty&&"string"==typeof this.linkCategoryProperty&&(e+=`,
  "linkCategoryProperty": `+this.ve(this.linkCategoryProperty)),""!==this.linkKeyProperty&&"string"==typeof this.linkKeyProperty&&(e+=`,
  "linkKeyProperty": `+this.ve(this.linkKeyProperty)),"from"!==this.linkFromKeyProperty&&"string"==typeof this.linkFromKeyProperty&&(e+=`,
  "linkFromKeyProperty": `+this.ve(this.linkFromKeyProperty)),"to"!==this.linkToKeyProperty&&"string"==typeof this.linkToKeyProperty&&(e+=`,
  "linkToKeyProperty": `+this.ve(this.linkToKeyProperty)),""!==this.linkFromPortIdProperty&&"string"==typeof this.linkFromPortIdProperty&&(e+=`,
  "linkFromPortIdProperty": `+this.ve(this.linkFromPortIdProperty)),""!==this.linkToPortIdProperty&&"string"==typeof this.linkToPortIdProperty&&(e+=`,
  "linkToPortIdProperty": `+this.ve(this.linkToPortIdProperty)),""!==this.linkLabelKeysProperty&&"string"==typeof this.linkLabelKeysProperty&&(e+=`,
  "linkLabelKeysProperty": `+this.ve(this.linkLabelKeysProperty)),"isGroup"!==this.nodeIsGroupProperty&&"string"==typeof this.nodeIsGroupProperty&&(e+=`,
  "nodeIsGroupProperty": `+this.ve(this.nodeIsGroupProperty)),"group"!==this.nodeGroupKeyProperty&&"string"==typeof this.nodeGroupKeyProperty&&(e+=`,
  "nodeGroupKeyProperty": `+this.ve(this.nodeGroupKeyProperty)),t+e}Ty(t){super.Ty(t),t.linkKeyProperty&&(this.linkKeyProperty=t.linkKeyProperty),t.linkFromKeyProperty&&(this.linkFromKeyProperty=t.linkFromKeyProperty),t.linkToKeyProperty&&(this.linkToKeyProperty=t.linkToKeyProperty),t.linkFromPortIdProperty&&(this.linkFromPortIdProperty=t.linkFromPortIdProperty),t.linkToPortIdProperty&&(this.linkToPortIdProperty=t.linkToPortIdProperty),t.linkCategoryProperty&&(this.linkCategoryProperty=t.linkCategoryProperty),t.linkLabelKeysProperty&&(this.linkLabelKeysProperty=t.linkLabelKeysProperty),t.nodeIsGroupProperty&&(this.nodeIsGroupProperty=t.nodeIsGroupProperty),t.nodeGroupKeyProperty&&(this.nodeGroupKeyProperty=t.nodeGroupKeyProperty)}AN(){return super.AN()+`,
  "linkDataArray": `+this.vh(this.linkDataArray,!0)}TN(t){super.TN(t);let e=t.linkDataArray;Array.isArray(e)&&(this.replaceJsonObjects(e),this.linkDataArray=e)}tD=`,
  "insertedLinkKeys": `;KO=`,
  "modifiedLinkData": `;iD=`,
  "removedLinkKeys": `;_T(t){let e=new tu;for(let i=0;i<this.linkDataArray.length;i++){let s=this.linkDataArray[i];this.v1(t,s,s,e)}return e}FN(t,e,i){if(""===this.linkKeyProperty){let t=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=t}let s=super.FN(t,e,i),n=this,l=new tu,r=new tu,o=new tu;t.changes.each(t=>{if(t.model===n){if("linkDataArray"===t.modelChange)3===t.change?l.add(t.newValue):4===t.change&&o.add(t.oldValue);else if(n.containsLinkData(t.object))r.add(t.object);else if(null!==t.object){if(null!==t.object&&i.has(t.object))i.get(t.object).each(t=>{n.containsLinkData(t)&&r.add(t)});else{if(t.object instanceof iE||n.containsNodeData(t.object))return;n._T(t.object).each(t=>r.add(t))}}}});let h=new tu;l.each(t=>{h.add(n.getKeyForLinkData(t)),e||r.add(t)});let a=new tu;o.each(t=>{a.add(n.getKeyForLinkData(t)),e&&r.add(t)});let u=s;return h.count>0&&(u+=(e?this.iD:this.tD)+this.vh(h.toArray(),!0)),r.count>0&&(u+=this.KO+this.vh(r.toArray(),!0)),a.count>0&&(u+=(e?this.tD:this.iD)+this.vh(a.toArray(),!0)),u}Dy(t){(void 0!==t.linkCategoryProperty&&t.linkCategoryProperty!==this.linkCategoryProperty||void 0!==t.linkKeyProperty&&t.linkKeyProperty!==this.linkKeyProperty||void 0!==t.linkFromKeyProperty&&t.linkFromKeyProperty!==this.linkFromKeyProperty||void 0!==t.linkToKeyProperty&&t.linkToKeyProperty!==this.linkToKeyProperty||void 0!==t.linkFromPortIdProperty&&t.linkFromPortIdProperty!==this.linkFromPortIdProperty||void 0!==t.linkToPortIdProperty&&t.linkToPortIdProperty!==this.linkToPortIdProperty||void 0!==t.linkLabelKeysProperty&&t.linkLabelKeysProperty!==this.linkLabelKeysProperty||void 0!==t.nodeIsGroupProperty&&t.nodeIsGroupProperty!==this.nodeIsGroupProperty||void 0!==t.nodeGroupKeyProperty&&t.nodeGroupKeyProperty!==this.nodeGroupKeyProperty)&&te.o("applyIncrementalJson cannot change Model properties"),super.Dy(t);let e=t.insertedLinkKeys;if(Array.isArray(e)){let t=e.length;for(let i=0;i<t;i++){let t=e[i],s=this.findLinkDataForKey(t);null===s&&(s=this.copyLinkData({}),this.setKeyForLinkData(s,t),this.addLinkData(s))}}let i=t.modifiedLinkData;if(Array.isArray(i)){let t=i.length;for(let e=0;e<t;e++){let t=i[e],s=this.getKeyForLinkData(t),n=this.findLinkDataForKey(s);if(null!==n){for(let e in t)"__gohashid"===e||e===this.linkKeyProperty||this.setDataProperty(n,e,t[e]);this.eD(t,n)}}}let s=t.removedLinkKeys;if(Array.isArray(s)){let t=s.length;for(let e=0;e<t;e++){let t=s[e],i=this.findLinkDataForKey(t);null!==i&&this.removeLinkData(i)}}}changeState(t,e){if(null!==t&&t.model===this){if(2===t.change){let i=t.object,s=t.propertyName;if(s===this.linkKeyProperty&&this.containsLinkData(i)){let n=t.getValue(e),l=t.getValue(!e);void 0!==l&&this.vi.delete(l),void 0!==n&&this.vi.set(n,i),this.et(i,s,n);return}}else if(3===t.change){let i=t.newParam;if("linkDataArray"===t.modelChange){let s=t.newValue;if(te.H(s)&&"number"==typeof i){let t=this.getKeyForLinkData(s);e?(this.or.delete(s),this.Ns[i]===s&&this.Po(this.linkDataArray,i),void 0!==t&&this.vi.delete(t)):(this.or.add(s),this.Ns[i]!==s&&this.nr(this.Ns,i,s),void 0!==t&&this.vi.set(t,s))}return}if("linkLabelKeys"===t.modelChange){let s=t.object,n=this.getLabelKeysForLinkData(s);Array.isArray(n)&&"number"==typeof i&&(e?(i=n.indexOf(t.newValue))>=0&&this.Po(n,i):0>n.indexOf(t.newValue)&&this.nr(n,i,t.newValue));return}}else if(4===t.change){let i=t.oldParam;if("linkDataArray"===t.modelChange){let s=t.oldValue;if(te.H(s)&&"number"==typeof i){let t=this.getKeyForLinkData(s);e?(this.or.add(s),this.Ns[i]!==s&&this.nr(this.Ns,i,s),void 0!==t&&this.vi.set(t,s)):(this.or.delete(s),this.Ns[i]===s&&this.Po(this.linkDataArray,i),void 0!==t&&this.vi.delete(t))}return}if("linkLabelKeys"===t.modelChange){let s=t.object,n=this.getLabelKeysForLinkData(s);Array.isArray(n)&&"number"==typeof i&&(e?0>n.indexOf(t.oldValue)&&this.nr(n,i,t.oldValue):(i=n.indexOf(t.oldValue))>=0&&this.Po(n,i));return}}super.changeState(t,e)}}get archetypeNodeData(){return this.vl}set archetypeNodeData(t){let e=this.vl;e!==t&&(null!==t&&te.lc(t,iI,"archetypeNodeData"),this.vl=t,this.t("archetypeNodeData",e,t))}EN(t){if(void 0===t)return;let e=this.vl;if(null!==e){let i=this.findNodeDataForKey(t);null===i&&(i=this.copyNodeData(e),this.et(i,this.nodeKeyProperty,t),this.addNodeData(i))}return t}get linkFromKeyProperty(){return this.So}set linkFromKeyProperty(t){let e=this.So;e!==t&&(this.Fn(t,iI,"linkFromKeyProperty"),this.So=t,this.t("linkFromKeyProperty",e,t))}getFromKeyForLinkData(t){return this.Fe(t,!0)}setFromKeyForLinkData(t,e){this._d(t,e,!0)}get linkToKeyProperty(){return this.Mo}set linkToKeyProperty(t){let e=this.Mo;e!==t&&(this.Fn(t,iI,"linkToKeyProperty"),this.Mo=t,this.t("linkToKeyProperty",e,t))}getToKeyForLinkData(t){return this.Fe(t,!1)}setToKeyForLinkData(t,e){this._d(t,e,!1)}Fe(t,e){if(null===t)return;let i=e?this.So:this.Mo;if(""===i)return;let s=this.bt(t,i);if(void 0!==s){if(this.isKeyType(s))return s;te.o((e?"FromKey":"ToKey")+" value for link data "+t+" is not a number or a string: "+s)}}_d(t,e,i){if(null===e&&(e=void 0),void 0===e||this.isKeyType(e)||te.te(e,"number or string",iI,i?"setFromKeyForLinkData:key":"setToKeyForLinkData:key"),null===t)return;let s=i?this.So:this.Mo;if(""===s)return;if(e=this.EN(e),!this.containsLinkData(t)){this.et(t,s,e);return}let n=this.bt(t,s);n!==e&&(this._s(n,t),this.et(t,s,e),null===this.findNodeDataForKey(e)&&this.tn(e,t),this.Bt(i?"linkFromKey":"linkToKey",2,s,t,n,e),"string"==typeof s&&this.updateTargetBindings(t,s))}get linkFromPortIdProperty(){return this.$a}set linkFromPortIdProperty(t){let e=this.$a;e!==t&&(this.Fn(t,iI,"linkFromPortIdProperty"),this.$a=t,this.t("linkFromPortIdProperty",e,t))}getFromPortIdForLinkData(t){return this.A1(t,!0)}setFromPortIdForLinkData(t,e){this.tg(t,e,!0)}get linkToPortIdProperty(){return this.Za}set linkToPortIdProperty(t){let e=this.Za;e!==t&&(this.Fn(t,iI,"linkToPortIdProperty"),this.Za=t,this.t("linkToPortIdProperty",e,t))}getToPortIdForLinkData(t){return this.A1(t,!1)}setToPortIdForLinkData(t,e){this.tg(t,e,!1)}A1(t,e){if(null===t)return"";let i=e?this.$a:this.Za;if(""===i)return"";let s=this.bt(t,i);return void 0===s?"":s}tg(t,e,i){if(te.s(e,"string",iI,i?"setFromPortIdForLinkData:portname":"setToPortIdForLinkData:portname"),null===t)return;let s=i?this.$a:this.Za;if(""===s)return;if(!this.containsLinkData(t)){this.et(t,s,e);return}let n=this.bt(t,s);void 0===n&&(n=""),n!==e&&(this.et(t,s,e),this.Bt(i?"linkFromPortId":"linkToPortId",2,s,t,n,e),"string"==typeof s&&this.updateTargetBindings(t,s))}get linkLabelKeysProperty(){return this.en}set linkLabelKeysProperty(t){let e=this.en;e!==t&&(this.Fn(t,iI,"linkLabelKeysProperty"),this.en=t,this.t("linkLabelKeysProperty",e,t))}getLabelKeysForLinkData(t){if(null===t)return iI.EmptyArray;let e=this.en;if(""===e)return iI.EmptyArray;let i=this.bt(t,e);return void 0===i?iI.EmptyArray:i}setLabelKeysForLinkData(t,e){if(this.vN(e,iI,"setLabelKeysForLinkData:arr"),null===t)return;let i=this.en;if(""===i)return;if(!this.containsLinkData(t)){this.et(t,i,e);return}let s=this.bt(t,i);if(void 0===s&&(s=iI.EmptyArray),s!==e){if(Array.isArray(s)){let e=s.length;for(let i=0;i<e;i++){let e=s[i];this._s(e,t)}}this.et(t,i,e);let n=e.length;for(let i=0;i<n;i++){let s=e[i];null===this.findNodeDataForKey(s)&&this.tn(s,t)}this.Bt("linkLabelKeys",2,i,t,s,e),"string"==typeof i&&this.updateTargetBindings(t,i)}}addLabelKeyForLinkData(t,e){if(null==e||(this.isKeyType(e)||te.te(e,"number or string",iI,"addLabelKeyForLinkData:key"),null===t))return;let i=this.en;if(""===i)return;let s=this.bt(t,i);if(void 0===s){let i=[];i.push(e),this.setLabelKeysForLinkData(t,i)}else if(Array.isArray(s)){let n=s.indexOf(e);if(n>=0)return;n=s.length,s.push(e),this.containsLinkData(t)&&(null===this.findNodeDataForKey(e)&&this.tn(e,t),this.Bt("linkLabelKeys",3,i,t,null,e,null,n))}else te.o(i+" property is not an Array; cannot addLabelKeyForLinkData: "+t)}removeLabelKeyForLinkData(t,e){if(null==e||(this.isKeyType(e)||te.te(e,"number or string",iI,"removeLabelKeyForLinkData:key"),null===t))return;let i=this.en;if(""===i)return;let s=this.bt(t,i);if(Array.isArray(s)){let n=s.indexOf(e);if(n<0)return;this.Po(s,n),this.containsLinkData(t)&&(this._s(e,t),this.Bt("linkLabelKeys",4,i,t,e,null,n,null))}else void 0!==s&&te.o(i+" property is not an Array; cannot removeLabelKeyforLinkData: "+t)}get linkDataArray(){return this.Ns}set linkDataArray(t){let e=this.Ns;if(e!==t){this.vN(t,iI,"linkDataArray"),this.vi.clear();let i=t.length;for(let e=0;e<i;e++){let i=t[e];te.H(i)||te.o("GraphLinksModel.linkDataArray must only contain Objects, not: "+i)}if(this.Ns=t,""!==this.linkKeyProperty){let e=new th;for(let s=0;s<i;s++){let i=t[s],n=this.getKeyForLinkData(i);void 0===n||null!==this.vi.get(n)?e.add(i):this.vi.set(n,i)}let s=e.iterator;for(;s.next();){let t=s.value;this.makeLinkDataKeyUnique(t);let e=this.getKeyForLinkData(t);void 0!==e&&this.vi.set(e,t)}}let s=new tu;for(let e=0;e<i;e++){let i=t[e];s.add(i)}this.or=s,this.Bt("linkDataArray",2,"linkDataArray",this,e,t);for(let e=0;e<i;e++){let i=t[e];this.BN(i)}}}get linkKeyProperty(){return this.Oh}set linkKeyProperty(t){let e=this.Oh;if(e!==t){this.Fn(t,iI,"linkKeyProperty"),this.Oh=t,this.vi.clear();let i=this.linkDataArray.length;for(let t=0;t<i;t++){let e=this.linkDataArray[t],i=this.getKeyForLinkData(e);void 0===i&&(this.makeLinkDataKeyUnique(e),i=this.getKeyForLinkData(e)),void 0!==i&&this.vi.set(i,e)}this.t("linkKeyProperty",e,t)}}getKeyForLinkData(t){if(null===t)return;let e=this.Oh;if(""===e)return;let i=this.bt(t,e);if(void 0!==i){if(this.isKeyType(i))return i;te.o("Key value for link data "+t+" is not a number or a string: "+i)}}setKeyForLinkData(t,e){if(null!=e&&this.isKeyType(e)||te.te(e,"number or string",iI,"setKeyForLinkData:key"),null===t)return;let i=this.Oh;if(""===i)return;if(!this.containsLinkData(t)){this.et(t,i,e);return}let s=this.bt(t,i);if(s!==e){if(null!==this.findLinkDataForKey(e))return;this.et(t,i,e),void 0!==s&&this.vi.delete(s),this.vi.set(e,t),this.Bt("linkKey",2,i,t,s,e),"string"==typeof i&&this.updateTargetBindings(t,i)}}get makeUniqueLinkKeyFunction(){return this.Uf}set makeUniqueLinkKeyFunction(t){let e=this.Uf;e!==t&&(null!==t&&te.S(t,iI,"makeUniqueLinkKeyFunction"),this.Uf=t,this.t("makeUniqueLinkKeyFunction",e,t))}findLinkDataForKey(t){return null===t&&te.o("GraphLinksModel.findLinkDataForKey:key must not be null"),void 0!==t&&this.isKeyType(t)?this.vi.get(t):null}E1(t){return void 0!==t&&this.vi.has(t)}makeLinkDataKeyUnique(t){if(null===t)return;let e=this.Oh;if(""===e)return;let i=this.getKeyForLinkData(t);if(void 0!==i&&!this.E1(i))return;let s=this.Uf;if(null!==s&&null!=(i=s(this,t))&&!this.E1(i)){this.et(t,e,i);return}if("string"==typeof i){let s=2;for(;this.E1(i+s);)s++;this.et(t,e,i+s)}else if(void 0===i||"number"==typeof i){let i=-this.vi.count-1;for(;this.E1(i);)i--;this.et(t,e,i)}}containsLinkData(t){return null!==t&&this.or.has(t)}addLinkData(t){null!==t&&(this.containsLinkData(t)||this.VT(t,!0))}VT(t,e){if(""!==this.linkKeyProperty){let e=this.getKeyForLinkData(t);if(void 0===e)this.makeLinkDataKeyUnique(t),e=this.getKeyForLinkData(t);else{if(this.vi.get(e)===t)return;this.makeLinkDataKeyUnique(t),e=this.getKeyForLinkData(t)}void 0===e&&te.o("GraphLinksModel.makeLinkDataKeyUnique failed on "+t+". Data not added to model."),this.vi.set(e,t)}this.or.add(t);let i=null;e&&(i=this.Ns.length,this.nr(this.Ns,i,t)),this.Bt("linkDataArray",3,"linkDataArray",this,null,t,null,i),this.BN(t)}addLinkDataCollection(t){if(Array.isArray(t)){let e=t.length;for(let i=0;i<e;i++)this.addLinkData(t[i])}else{let e=t.iterator;for(;e.next();){let t=e.value;this.addLinkData(t)}}}removeLinkData(t){null!==t&&this.UT(t,!0)}UT(t,e){this.or.delete(t);let i=this.getKeyForLinkData(t);void 0!==i&&this.vi.delete(i);let s=null;if(e){if((s=this.Ns.indexOf(t))<0)return;this.Po(this.Ns,s)}this.Bt("linkDataArray",4,"linkDataArray",this,t,null,s,null),this.GO(t)}removeLinkDataCollection(t){if(Array.isArray(t)){let e=t.length;for(let i=0;i<e;i++)this.removeLinkData(t[i])}else{let e=t.iterator;for(;e.next();){let t=e.value;this.removeLinkData(t)}}}mergeLinkDataArray(t){if(""===this.linkKeyProperty&&te.o("GraphLinksModel.linkKeyProperty must not be an empty string for .mergeLinkDataArray() to succeed."),t===this.linkDataArray||!Array.isArray(t))return;let e=new tu;e.addAll(this.vi.iteratorKeys);let i=new tu,s=t.length;for(let e=0;e<s;e++){let s=t[e],n=this.getKeyForLinkData(s);if(void 0!==n){i.add(n);let t=this.findLinkDataForKey(n);if(t===s)continue;if(null!==t)this.assignAllDataProperties(t,s),this.eD(s,t);else{let t=this.cloneDeep(s);this.setKeyForLinkData(t,n),this.addLinkData(t)}}else{let t=this.cloneDeep(s);this.addLinkData(t),i.add(this.getKeyForLinkData(t))}}let n=e.iterator;for(;n.next();){let t=n.value;if(!i.has(t)){let e=this.findLinkDataForKey(t);e&&this.removeLinkData(e)}}}BN(t){let e=this.Fe(t,!0);e=this.EN(e),null===this.findNodeDataForKey(e)&&this.tn(e,t),e=this.Fe(t,!1),e=this.EN(e),null===this.findNodeDataForKey(e)&&this.tn(e,t);let i=this.getLabelKeysForLinkData(t);if(Array.isArray(i)){let s=i.length;for(let n=0;n<s;n++)e=i[n],null===this.findNodeDataForKey(e)&&this.tn(e,t)}}GO(t){let e=this.Fe(t,!0);this._s(e,t),e=this.Fe(t,!1),this._s(e,t);let i=this.getLabelKeysForLinkData(t);if(Array.isArray(i)){let s=i.length;for(let n=0;n<s;n++)e=i[n],this._s(e,t)}}get copyLinkDataFunction(){return this.Vf}set copyLinkDataFunction(t){let e=this.Vf;e!==t&&(null!==t&&te.S(t,iI,"copyLinkDataFunction"),this.Vf=t,this.t("copyLinkDataFunction",e,t))}copyLinkData(t){if(null===t)return null;let e=null,i=this.Vf;return e=null!==i?i(t,this):this.I1(t,!0),te.H(e)&&(""!==this.So&&this.et(e,this.So,void 0),""!==this.Mo&&this.et(e,this.Mo,void 0),""!==this.en&&this.et(e,this.en,[])),e}get nodeIsGroupProperty(){return this.zf}set nodeIsGroupProperty(t){let e=this.zf;e!==t&&(this.Fn(t,iI,"nodeIsGroupProperty"),this.zf=t,this.t("nodeIsGroupProperty",e,t))}isGroupForNodeData(t){if(null===t)return!1;let e=this.zf;return""!==e&&!!this.bt(t,e)}isGroupForData(t){return this.isGroupForNodeData(t)}get nodeGroupKeyProperty(){return this.Rn}set nodeGroupKeyProperty(t){let e=this.Rn;e!==t&&(this.Fn(t,iI,"nodeGroupKeyProperty"),this.Rn=t,this.t("nodeGroupKeyProperty",e,t))}get copiesGroupKeyOfNodeData(){return this.fg}set copiesGroupKeyOfNodeData(t){this.fg!==t&&(te.s(t,"boolean",iI,"copiesGroupKeyOfNodeData"),this.fg=t)}getGroupKeyForNodeData(t){if(null===t)return;let e=this.Rn;if(""===e)return;let i=this.bt(t,e);if(void 0!==i){if(this.isKeyType(i))return i;te.o("GroupKey value for node data "+t+" is not a number or a string: "+i)}}getGroupForData(t){return this.getGroupKeyForNodeData(t)}setGroupKeyForNodeData(t,e){if(null===e&&(e=void 0),void 0===e||this.isKeyType(e)||te.te(e,"number or string",iI,"setGroupKeyForNodeData:key"),null===t)return;let i=this.Rn;if(""===i)return;if(!this.containsNodeData(t)){this.et(t,i,e);return}let s=this.bt(t,i);s!==e&&(this._s(s,t),this.et(t,i,e),null===this.findNodeDataForKey(e)&&this.tn(e,t),this.Bt("nodeGroupKey",2,i,t,s,e),"string"==typeof i&&this.updateTargetBindings(t,i))}setGroupForData(t,e){this.setGroupKeyForNodeData(t,e)}copyNodeData(t){if(null===t)return null;let e=super.copyNodeData(t);return this.copiesGroupKeyOfNodeData||""===this.Rn||void 0===this.bt(e,this.Rn)||this.et(e,this.Rn,void 0),e}setDataProperty(t,e,i){if(this.containsNodeData(t)){if(e===this.nodeKeyProperty){this.setKeyForNodeData(t,i);return}if(e===this.nodeCategoryProperty){this.setCategoryForNodeData(t,i);return}if(e===this.nodeGroupKeyProperty){this.setGroupKeyForNodeData(t,i);return}}else if(this.containsLinkData(t)){if(e===this.linkFromKeyProperty){this._d(t,i,!0);return}if(e===this.linkToKeyProperty){this._d(t,i,!1);return}if(e===this.linkFromPortIdProperty){this.tg(t,i,!0);return}else if(e===this.linkToPortIdProperty){this.tg(t,i,!1);return}else if(e===this.linkKeyProperty){this.setKeyForLinkData(t,i);return}else if(e===this.linkCategoryProperty){this.setCategoryForLinkData(t,i);return}else if(e===this.linkLabelKeysProperty){this.setLabelKeysForLinkData(t,i);return}}let s=this.bt(t,e);s!==i&&(this.et(t,e,i),this.raiseDataChanged(t,e,s,i))}assignAllDataProperties(t,e){if(!e)return;let i=this.containsNodeData(t),s=this.containsLinkData(t);for(let n in e)if("__gohashid"!==n&&!(i&&n===this.nodeKeyProperty)){if(i&&n===this.nodeIsGroupProperty&&this.bt(t,n)===e[n]||s&&n===this.linkKeyProperty)continue;this.setDataProperty(t,n,e[n])}}Fy(t,e){super.Fy(t,e);let i=this.wi.iterator;for(;i.next();){let s=i.value;this.UN(s,t,e)}let s=this.or.iterator;for(;s.next();){let i=s.value;this.HO(i,t,e)}}UN(t,e,i){if(this.getGroupKeyForNodeData(t)===e){let s=this.Rn;this.et(t,s,i),this.Bt("nodeGroupKey",2,s,t,e,i),"string"==typeof s&&this.updateTargetBindings(t,s)}}HO(t,e,i){if(this.Fe(t,!0)===e){let s=this.So;this.et(t,s,i),this.Bt("linkFromKey",2,s,t,e,i),"string"==typeof s&&this.updateTargetBindings(t,s)}if(this.Fe(t,!1)===e){let s=this.Mo;this.et(t,s,i),this.Bt("linkToKey",2,s,t,e,i),"string"==typeof s&&this.updateTargetBindings(t,s)}let s=this.getLabelKeysForLinkData(t);if(Array.isArray(s)){let n=s.length,l=this.en;for(let r=0;r<n;r++)s[r]===e&&(this.JT(s,r,i),this.Bt("linkLabelKeys",3,l,t,e,i,r,r))}}ON(){super.ON();let t=this.linkDataArray,e=t.length;for(let i=0;i<e;i++){let e=t[i];this.BN(e)}}ag(t){super.ag(t);let e=this.getKeyForNodeData(t),i=this.Ny(e);if(null!==i){let t=te.rt(),s=i.iterator;for(;s.next();){let i=s.value;if(this.containsNodeData(i)){if(this.getGroupKeyForNodeData(i)===e){let s=this.Rn;this.Bt("nodeGroupKey",2,s,i,e,e),"string"==typeof s&&this.updateTargetBindings(i,s),t.push(i)}}else{if(this.Fe(i,!0)===e){let s=this.So;this.Bt("linkFromKey",2,s,i,e,e),"string"==typeof s&&this.updateTargetBindings(i,s),t.push(i)}if(this.Fe(i,!1)===e){let s=this.Mo;this.Bt("linkToKey",2,s,i,e,e),"string"==typeof s&&this.updateTargetBindings(i,s),t.push(i)}let s=this.getLabelKeysForLinkData(i);if(Array.isArray(s)){let n=s.length,l=this.en;for(let r=0;r<n;r++)s[r]===e&&(this.Bt("linkLabelKeys",3,l,i,e,e,r,r),t.push(i))}}}for(let i=0;i<t.length;i++)this._s(e,t[i]);te.tt(t)}}cg(t){super.cg(t);let e=this.getGroupKeyForNodeData(t);null===this.findNodeDataForKey(e)&&this.tn(e,t)}Ry(t){super.Ry(t);let e=this.getGroupKeyForNodeData(t);this._s(e,t)}get linkCategoryProperty(){return this.Qa}set linkCategoryProperty(t){let e=this.Qa;e!==t&&(this.Fn(t,iI,"linkCategoryProperty"),this.Qa=t,this.t("linkCategoryProperty",e,t))}getCategoryForLinkData(t){if(null===t)return"";let e=this.Qa;if(""===e)return"";let i=this.bt(t,e);return void 0===i?"":"string"==typeof i?i:void te.o("getCategoryForLinkData found a non-string category for "+t+": "+i)}getLinkCategoryForData(t){return this.getCategoryForLinkData(t)}setCategoryForLinkData(t,e){if(te.s(e,"string",iI,"setCategoryForLinkData:cat"),null===t)return;let i=this.Qa;if(""===i)return;if(!this.containsLinkData(t)){this.et(t,i,e);return}let s=this.bt(t,i);void 0===s&&(s=""),s!==e&&(this.et(t,i,e),this.Bt("linkCategory",2,i,t,s,e),"string"==typeof i&&this.updateTargetBindings(t,i))}setLinkCategoryForData(t,e){this.setCategoryForLinkData(t,e)}hg(t,e){super.hg(t,e),this.setGroupKeyForNodeData(e,this.getGroupKeyForNodeData(t))}eD(t,e){this.setCategoryForLinkData(e,this.getCategoryForLinkData(t)),this.setFromKeyForLinkData(e,this.getFromKeyForLinkData(t)),this.setToKeyForLinkData(e,this.getToKeyForLinkData(t)),this.setLabelKeysForLinkData(e,this.getLabelKeysForLinkData(t)),this.setFromPortIdForLinkData(e,this.getFromPortIdForLinkData(t)),this.setToPortIdForLinkData(e,this.getToPortIdForLinkData(t))}get type(){return"GraphLinksModel"}bm(){return!0}Ba(){return!0}Uw(){return!0}Qc(){return!0}static EmptyArray=Object.freeze([])}iE.wl(iI,"GraphLinksModel"),iE.WT=()=>new iI,iE.bM=()=>new iI;class iV extends iE{vn;ug;_a;constructor(t,e){if(super(),this.vn="parent",this.ug=!1,this._a="parentLinkCategory",void 0!==t&&(Array.isArray(t)?this.nodeDataArray=t:e=t),e){Object.assign(this,e);let t=e.Changed;t&&(delete this.Changed,this.addChangedListener(t))}}cloneProtected(t){super.cloneProtected(t),t.vn=this.vn,t.ug=this.ug,t._a=this._a}toString(t){if(void 0===t&&(t=0),t>=2)return this.toJson();{let e=(""!==this.name?this.name:"")+" TreeModel";if(t>0){e+=`
 node data:`;let t=this.nodeDataArray,i=t.length;for(let s=0;s<i;s++){let i=t[s];e+=" "+this.getKeyForNodeData(i)+":"+iR.toString(i)}}return e}}lg(){let t=super.lg(),e="";return"parent"!==this.nodeParentKeyProperty&&"string"==typeof this.nodeParentKeyProperty&&(e+=`,
  "nodeParentKeyProperty": `+this.ve(this.nodeParentKeyProperty)),t+e}Ty(t){super.Ty(t),t.nodeParentKeyProperty&&(this.nodeParentKeyProperty=t.nodeParentKeyProperty)}Dy(t){void 0!==t.nodeParentKeyProperty&&t.nodeParentKeyProperty!==this.nodeParentKeyProperty&&te.o("applyIncrementalJson cannot change Model properties"),super.Dy(t)}maybeEnsureLinkReference(t){return t}get nodeParentKeyProperty(){return this.vn}set nodeParentKeyProperty(t){let e=this.vn;e!==t&&(this.Fn(t,iV,"nodeParentKeyProperty"),this.vn=t,this.t("nodeParentKeyProperty",e,t))}get copiesParentKeyOfNodeData(){return this.ug}set copiesParentKeyOfNodeData(t){this.ug!==t&&(te.s(t,"boolean",iV,"copiesParentKeyOfNodeData"),this.ug=t)}getParentKeyForNodeData(t){if(null===t)return;let e=this.vn;if(""===e)return;let i=this.bt(t,e);if(void 0!==i){if(this.isKeyType(i))return i;te.o("ParentKey value for node data "+t+" is not a number or a string: "+i)}}setParentKeyForNodeData(t,e){if(null===e&&(e=void 0),void 0===e||this.isKeyType(e)||te.te(e,"number or string",iV,"setParentKeyForNodeData:key"),null===t)return;let i=this.vn;if(""===i)return;if(e=this.maybeEnsureLinkReference(e),!this.containsNodeData(t)){this.et(t,i,e);return}let s=this.bt(t,i);s!==e&&(this._s(s,t),this.et(t,i,e),null===this.findNodeDataForKey(e)&&this.tn(e,t),this.Bt("nodeParentKey",2,i,t,s,e),"string"==typeof i&&this.updateTargetBindings(t,i))}get parentLinkCategoryProperty(){return this._a}set parentLinkCategoryProperty(t){let e=this._a;e!==t&&(this.Fn(t,iV,"parentLinkCategoryProperty"),this._a=t,this.t("parentLinkCategoryProperty",e,t))}get linkCategoryProperty(){return this.parentLinkCategoryProperty}set linkCategoryProperty(t){this.parentLinkCategoryProperty=t}getParentLinkCategoryForNodeData(t){if(null===t)return"";let e=this._a;if(""===e)return"";let i=this.bt(t,e);return void 0===i?"":"string"==typeof i?i:void te.o("getParentLinkCategoryForNodeData found a non-string category for "+t+": "+i)}getLinkCategoryForData(t){return this.getParentLinkCategoryForNodeData(t)}setParentLinkCategoryForNodeData(t,e){if(te.s(e,"string",iV,"setParentLinkCategoryForNodeData:cat"),null===t)return;let i=this._a;if(""===i)return;if(!this.containsNodeData(t)){this.et(t,i,e);return}let s=this.bt(t,i);void 0===s&&(s=""),s!==e&&(this.et(t,i,e),this.Bt("parentLinkCategory",2,i,t,s,e),"string"==typeof i&&this.updateTargetBindings(t,i))}setLinkCategoryForData(t,e){this.setParentLinkCategoryForNodeData(t,e)}copyNodeData(t){if(null===t)return null;let e=super.copyNodeData(t);return this.copiesParentKeyOfNodeData||""===this.vn||void 0===this.bt(e,this.vn)||this.et(e,this.vn,void 0),e}setDataProperty(t,e,i){if(this.containsNodeData(t)){if(e===this.nodeKeyProperty){this.setKeyForNodeData(t,i);return}if(e===this.nodeCategoryProperty){this.setCategoryForNodeData(t,i);return}if(e===this.nodeParentKeyProperty){this.setParentKeyForNodeData(t,i);return}else if(e===this.parentLinkCategoryProperty){this.setParentLinkCategoryForNodeData(t,i);return}}let s=this.bt(t,e);s!==i&&(this.et(t,e,i),this.raiseDataChanged(t,e,s,i))}Fy(t,e){super.Fy(t,e);let i=this.wi.iterator;for(;i.next();){let s=i.value;this.UN(s,t,e)}}UN(t,e,i){if(this.getParentKeyForNodeData(t)===e){let s=this.vn;this.et(t,s,i),this.Bt("nodeParentKey",2,s,t,e,i),"string"==typeof s&&this.updateTargetBindings(t,s)}}ag(t){super.ag(t);let e=this.getKeyForNodeData(t),i=this.Ny(e);if(null!==i){let t=te.rt(),s=i.iterator;for(;s.next();){let i=s.value;if(this.containsNodeData(i)&&this.getParentKeyForNodeData(i)===e){let s=this.vn;this.Bt("nodeParentKey",2,s,i,e,e),"string"==typeof s&&this.updateTargetBindings(i,s),t.push(i)}}for(let i=0;i<t.length;i++)this._s(e,t[i]);te.tt(t)}}cg(t){super.cg(t);let e=this.getParentKeyForNodeData(t);e=this.maybeEnsureLinkReference(e),null===this.findNodeDataForKey(e)&&this.tn(e,t)}Ry(t){super.Ry(t);let e=this.getParentKeyForNodeData(t);this._s(e,t)}hg(t,e){super.hg(t,e),this.setParentLinkCategoryForNodeData(e,this.getParentLinkCategoryForNodeData(t)),this.setParentKeyForNodeData(e,this.getParentKeyForNodeData(t))}get type(){return"TreeModel"}km(){return!0}Uw(){return!0}}iE.wl(iV,"TreeModel");var iz=((I=iz||{})[I.ConstantSpacing=0]="ConstantSpacing",I[I.ConstantDistance=1]="ConstantDistance",I[I.ConstantAngle=2]="ConstantAngle",I[I.Packed=3]="Packed",I),iK=((V=iK||{})[V.Clockwise=10]="Clockwise",V[V.Counterclockwise=11]="Counterclockwise",V[V.BidirectionalLeft=12]="BidirectionalLeft",V[V.BidirectionalRight=13]="BidirectionalRight",V),iX=((z=iX||{})[z.Forwards=20]="Forwards",z[z.Reverse=21]="Reverse",z[z.Ascending=22]="Ascending",z[z.Descending=23]="Descending",z[z.Optimized=24]="Optimized",z),ij=((K=ij||{})[K.Pythagorean=30]="Pythagorean",K[K.Circular=31]="Circular",K);class iG extends ik{ce;Xf;B1;dg;U1;Ih;VN;zN;XN;Cs;vy;Oy;tc;Iy;sD;gg;mg;pg;Yf;Gi;P;xe;be;Dn;yg;constructor(t){super(),this.ce=0,this.Xf=0,this.B1=0,this.dg=360,this.U1=0,this.Ih=0,this.VN=new ty,this.zN=30,this.XN=0,this.Cs=0,this.vy=0,this.Oy=new iY,this.tc=0,this.Iy=0,this.sD=600,this.gg=NaN,this.mg=1,this.pg=0,this.Yf=360,this.Gi=0,this.P=10,this.xe=24,this.be=iS.standardComparer,this.Dn=6,this.yg=30,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.gg=this.gg,t.mg=this.mg,t.pg=this.pg,t.Yf=this.Yf,t.Gi=this.Gi,t.P=this.P,t.xe=this.xe,t.be=this.be,t.Dn=this.Dn,t.yg=this.yg}hi(t){t in iX?this.sorting=t:t in iK?this.direction=t:t in iz?this.arrangement=t:t in ij?this.nodeDiameterFormula=t:super.hi(t)}createNetwork(){return new iU(this)}jO(t,e,i){t=this.qO(t);let s=this.U1,n=this.zN,l=this.ce,r=this.Xf,o=this.B1,h=this.dg,a=this.Ih,u=this.XN,d=this.Cs,c=this.vy;if(s=this.arrangement,n=this.nodeDiameterFormula,(!isFinite(l=this.radius)||l<=0)&&(l=NaN),(!isFinite(r=this.aspectRatio)||r<=0)&&(r=1),isFinite(o=this.startAngle)||(o=0),(!isFinite(h=this.sweepAngle)||h>360||h<1)&&(h=360),isFinite(a=this.spacing)||(a=NaN),3===s&&31===n?s=0:3===s&&31!==n&&(n=31,s=this.arrangement),(12===this.direction||13===this.direction)&&24!==this.sorting){for(let s=0;!(s>=t.length||(e.add(t.elt(s)),s+1>=t.length));s+=2)i.add(t.elt(s+1));12===this.direction?(3===this.arrangement&&e.reverse(),(t=new th).addAll(e),t.addAll(i)):(3===this.arrangement&&i.reverse(),(t=new th).addAll(i),t.addAll(e))}let g=t.length;u=0;let f=0;for(let e=0;e<t.length;e++){let i=o+h*f*(10===this.direction?1:-1)/g,s=t.elt(e).diameter;isNaN(s)&&(s=t.elt(e).Eh(i)),h<360&&(0===e||e===t.length-1)&&(s/=2),u+=s,f++}if(isNaN(l)||3===s){if(isNaN(a)&&(a=6),0!==s&&3!==s){let e=-1/0;for(let i=0;i<g;i++){let s=t.elt(i),n=t.elt(i===g-1?0:i+1);isNaN(s.diameter)&&s.Eh(0),isNaN(n.diameter)&&n.Eh(0),e=Math.max(e,(s.diameter+n.diameter)/2)}if(c=e+a,2===s){let t=(e+a)/(2*Math.PI/g);r>1?d=(l=t)*r:l=d=t}else l=this.V1(c*(h>=360?g:g-1),r,o*Math.PI/180,h*Math.PI/180)}else l=this.V1(u+(h>=360?g:g-1)*(3!==s?a:1.6*a),r,o*Math.PI/180,h*Math.PI/180);d=l*r}else{d=l*r;let e=this.YN(l,d,o*Math.PI/180,h*Math.PI/180);if(isNaN(a))0===s&&(a=(e-u)/(h>=360?g:g-1));else if(0===s){let t=(e-u)/(h>=360?g:g-1);t<a?d=(l=this.V1(u+a*(h>=360?g:g-1),r,o*Math.PI/180,h*Math.PI/180))*r:a=t}else{let i=-1/0;for(let e=0;e<g;e++){let s=t.elt(e),n=t.elt(e===g-1?0:e+1);isNaN(s.diameter)&&s.Eh(0),isNaN(n.diameter)&&n.Eh(0),i=Math.max(i,(s.diameter+n.diameter)/2)}let s=i+a,n=this.V1(s*(h>=360?g:g-1),r,o*Math.PI/180,h*Math.PI/180);n>l?(d=(l=n)*r,c=s):c=e/(h>=360?g:g-1)}}return this.U1=s,this.zN=n,this.ce=l,this.Xf=r,this.B1=o,this.dg=h,this.Ih=a,this.XN=u,this.Cs=d,this.vy=c,t}doLayout(t){null===this.network&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);let e=this.network.vertexes;if(e.count<=1){if(1===e.count){let t=e.first();t.centerX=0,t.centerY=0}this.updateParts(),this.network=null,this.isValidLayout=!0;return}let i=new th;i.addAll(e.iterator);let s=new th,n=new th;i=this.jO(i,s,n);let l=this.U1,r=this.ce,o=this.B1,h=this.dg,a=this.Ih,u=this.Cs,d=this.vy;if((12===this.direction||13===this.direction)&&3===l)this.nD(i,h,o-h/2,10);else if(12===this.direction||13===this.direction){let t=0;switch(l){case 1:t=180*this.z1(r,u,o,d)/Math.PI;break;case 0:{let e=0,i=0,l=s.first();null!==l&&(e=l.Eh(Math.PI/2));let h=n.first();null!==h&&(i=h.Eh(Math.PI/2)),t=180*this.z1(r,u,o,a+(e+i)/2)/Math.PI;break}case 2:t=h/i.length}if(12===this.direction){switch(l){case 1:this.Ey(s,h/2,o,11);break;case 0:this.By(s,h/2,o,11);break;case 2:this.Uy(s,h/2,o,11)}switch(l){case 1:this.Ey(n,h/2,o+t,10);break;case 0:this.By(n,h/2,o+t,10);break;case 2:this.Uy(n,h/2,o+t,10)}}else{switch(l){case 1:this.Ey(n,h/2,o,11);break;case 0:this.By(n,h/2,o,11);break;case 2:this.Uy(n,h/2,o,11)}switch(l){case 1:this.Ey(s,h/2,o+t,10);break;case 0:this.By(s,h/2,o+t,10);break;case 2:this.Uy(s,h/2,o+t,10)}}}else switch(l){case 1:this.Ey(i,h,o,this.direction);break;case 0:this.By(i,h,o,this.direction);break;case 2:this.Uy(i,h,o,this.direction);break;case 3:this.nD(i,h,o,this.direction)}this.updateParts(),this.network=null,this.isValidLayout=!0}Uy(t,e,i,s){let n=this.dg,l=this.ce,r=this.Cs,o=i*Math.PI/180,h=e*Math.PI/180,a=t.length;for(let e=0;e<a;e++){let i=o+(10===s?e*h/(n>=360?a:a-1):-(e*h)/a),u=t.elt(e),d=l*Math.tan(i)/r,c=Math.sqrt((l*l+r*r*d*d)/(1+d*d));u.centerX=c*Math.cos(i),u.centerY=c*Math.sin(i),u.actualAngle=180*i/Math.PI}}By(t,e,i,s){let n=this.ce,l=this.Cs,r=this.Ih,o=i*Math.PI/180,h=t.length;for(let e=0;e<h;e++){let i=t.elt(e),a=t.elt(e===h-1?0:e+1),u=n*Math.cos(o),d=l*Math.sin(o);i.centerX=u,i.centerY=d,i.actualAngle=180*o/Math.PI,isNaN(i.diameter)&&i.Eh(0),isNaN(a.diameter)&&a.Eh(0);let c=(i.diameter+a.diameter)/2,g=this.z1(n,l,10===s?o:-o,c+r);o+=10===s?g:-g}}Ey(t,e,i,s){let n=this.ce,l=this.Cs,r=this.vy,o=i*Math.PI/180,h=t.length;for(let e=0;e<h;e++){let i=t.elt(e);i.centerX=n*Math.cos(o),i.centerY=l*Math.sin(o),i.actualAngle=180*o/Math.PI;let h=this.z1(n,l,10===s?o:-o,r);o+=10===s?h:-h}}nD(t,e,i,s){let n=this.Iy,l=this.dg;if(this.tc=0,this.Oy=new iY,e<360){for(n=i+(10===s?l:-l);n<0;)n+=360;(n%=360)>180&&(n-=360),n*=Math.PI/180,this.Iy=n,this.oD(t,e,i,s)}else this.rD(t,e,i,s);this.Oy.commit(t)}rD(t,e,i,s){let n=this.ce,l=this.Cs,r=this.Ih,o=this.Xf,h=n*Math.cos(i*Math.PI/180),a=l*Math.sin(i*Math.PI/180),u=t.toArray();if(3===u.length){u[0].centerX=n,u[0].centerY=0,u[1].centerX=u[0].centerX-u[0].width/2-u[1].width/2-r,u[1].y=u[0].y,u[2].centerX=(u[0].centerX+u[1].centerX)/2,u[2].y=u[0].y-u[2].height-r;return}if(4===u.length){u[0].centerX=n,u[0].centerY=0,u[2].centerX=-u[0].centerX,u[2].centerY=u[0].centerY,u[1].centerX=0,u[1].y=Math.min(u[0].y,u[2].y)-u[1].height-r,u[3].centerX=0,u[3].y=Math.max(u[0].y+u[0].height+r,u[2].y+u[2].height+r);return}let d=ty.l();for(let t=0;t<u.length&&(u[t].centerX=h,u[t].centerY=a,!(t>=u.length-1));t++)this.lD(h,a,u,t,s,d)||this.hD(h,a,u,t,s,d),h=d.x,a=d.y;if(ty.e(d),this.tc++,this.tc>23)return;let c=u[0].centerX,g=u[0].centerY,f=u[u.length-1].centerX,m=u[u.length-1].centerY,p=Math.abs(c-f)-((u[0].width+u[u.length-1].width)/2+r),y=Math.abs(g-m)-((u[0].height+u[u.length-1].height)/2+r),x=0;if(1>Math.abs(y)){let t=Math.abs(c-f),e=(u[0].width+u[u.length-1].width)/2;t<e&&(x=0),p=t-e}else x=y>0?y:1>Math.abs(p)?0:p;let w=!1;w=Math.abs(f)>Math.abs(m)?f>0!=g>m:m>0!=c<f,(w=10===s?w:!w)&&(x=Math.min(x=Math.min(x=-Math.abs(x),-u[u.length-1].width),-u[u.length-1].height)),this.Oy.WO(x,u),Math.abs(x)>1&&(this.tc<8?this.ce-=x/(2*Math.PI):u.length<5&&x>10?this.ce/=2:this.ce-=x>0?1.7:-2.3,this.Cs=this.ce*o,this.rD(t,e,i,s))}oD(t,e,i,s){let n=this.ce,l=this.Cs,r=this.Xf,o=n*Math.cos(i*Math.PI/180),h=l*Math.sin(i*Math.PI/180),a=ty.l(),u=t.toArray();for(let t=0;t<u.length&&(u[t].centerX=o,u[t].centerY=h,!(t>=u.length-1));t++)this.lD(o,h,u,t,s,a)||this.hD(o,h,u,t,s,a),o=a.x,h=a.y;if(ty.e(a),this.tc++,this.tc>23)return;let d=Math.atan2(h,o),c=10===s?this.Iy-d:d-this.Iy,g=(c=Math.abs(c)<Math.abs(c-2*Math.PI)?c:c-2*Math.PI)*(n+l)/2;this.Oy.JO(g,u),Math.abs(g)>1&&(this.tc<8?this.ce-=g/(2*Math.PI):this.ce-=g>0?1.7:-2.3,this.Cs=this.ce*r,this.oD(t,e,i,s))}lD(t,e,i,s,n,l){let r=this.Ih,o=this.ce,h=this.Cs,a=0,u=0,d=(i[s].width+i[s+1].width)/2+r,c=!1;if(e>=0!=(10===n)){if((a=t+d)>o){if((a=t-d)<-o)return l.x=a,l.y=u,!1;c=!0}}else if((a=t-d)<-o){if((a=t+d)>o)return l.x=a,l.y=u,!1;c=!0}return u=Math.sqrt(1-Math.min(1,a*a/(o*o)))*h,e<0!==c&&(u=-u),Math.abs(e-u)>(i[s].height+i[s+1].height)/2?(l.x=a,l.y=u,!1):(l.x=a,l.y=u,!0)}hD(t,e,i,s,n,l){let r=this.Ih,o=this.ce,h=this.Cs,a=0,u=0,d=(i[s].height+i[s+1].height)/2+r,c=!1;if(t>=0!=(10===n)){if((u=e-d)<-h){if((u=e+d)>h)return l.x=a,l.y=u,!1;c=!0}}else if((u=e+d)>h){if((u=e-d)<-h)return l.x=a,l.y=u,!1;c=!0}return a=Math.sqrt(1-Math.min(1,u*u/(h*h)))*o,t<0!==c&&(a=-a),Math.abs(t-a)>(i[s].width+i[s+1].width)/2?(l.x=a,l.y=u,!1):(l.x=a,l.y=u,!0)}commitLayout(){this.commitNodes(),this.isRouting&&this.commitLinks()}commitNodes(){let t=null!==this.group&&this.group.hasPlaceholder(),e=t?this.group.location.copy():null,i=this.actualCenter;t?i=new ty(0,0):(i.x=this.arrangementOrigin.x+this.ce,i.y=this.arrangementOrigin.y+this.Cs);let s=this.network.vertexes.iterator;for(;s.next();){let t=s.value;t.x+=i.x,t.y+=i.y,t.commit()}if(t){this.group.ensureBounds();let t=this.group.position.copy(),i=this.group.location.copy(),s=e.subtract(i.subtract(t));this.group.move(s),this.VN=s.subtract(t)}}commitLinks(){let t=this.network.edges.iterator;for(;t.next();)t.value.commit()}YN(t,e,i,s){let n=this.sD;if(.001>Math.abs(this.Xf-1))return void 0!==i&&void 0!==s?s*t:2*Math.PI*t;let l=t>e?Math.sqrt(t*t-e*e)/t:Math.sqrt(e*e-t*t)/e,r=0,o=0;o=void 0!==i&&void 0!==s?s/(n+1):Math.PI/(2*(n+1));let h=0;for(let t=0;t<=n;t++){let e=Math.sin(void 0!==i&&void 0!==s?i+t*s/n:t*Math.PI/(2*n));r+=Math.sqrt(1-l*l*e*e)*o}return void 0!==i&&void 0!==s?(t>e?t:e)*r:4*(t>e?t:e)*r}V1(t,e,i,s){let n=0;return t/(void 0!==i&&void 0!==s?this.YN(1,e,i,s):this.YN(1,e))}z1(t,e,i,s){if(.001>Math.abs(this.Xf-1))return s/t;let n=t>e?Math.sqrt(t*t-e*e)/t:Math.sqrt(e*e-t*t)/e,l=0,r=2*Math.PI/(700*this.network.vertexes.count);t>e&&(i+=Math.PI/2);for(let o=0;;o++){let h=Math.sin(i+o*r);if((l+=(t>e?t:e)*Math.sqrt(1-n*n*h*h)*r)>=s)return o*r}}qO(t){switch(this.sorting){case 20:break;case 21:t.reverse();break;case 22:t.sort(this.comparer);break;case 23:t.sort(this.comparer),t.reverse();break;case 24:return this.$O(this.ZO(t));default:te.o("Invalid sorting type.")}return t}ZO(t){let e=[];for(let i=0;i<t.length;i++)e.push(0);let i=new th;for(let s=0;s<t.length;s++){let n=-1,l=-1;if(0===s)for(let e=0;e<t.length;e++){let i=t.elt(e).edgesCount;i>n&&(n=i,l=e)}else for(let i=0;i<t.length;i++){let t=e[i];t>n&&(n=t,l=i)}i.add(t.elt(l)),e[l]=-1;let r=t.elt(l),o=0,h=r.sourceEdges;for(;h.next();){let i=h.value.fromVertex;!((o=t.indexOf(i))<0)&&e[o]>=0&&e[o]++}let a=r.destinationEdges;for(;a.next();){let i=a.value.toVertex;!((o=t.indexOf(i))<0)&&e[o]>=0&&e[o]++}}return i}$O(t){let e=[];for(let i=0;i<t.length;i++){let s=t.elt(i);e[i]=[];let n=0,l=s.destinationEdges;for(;l.next();){let s=l.value.toVertex;(n=t.indexOf(s))!==i&&0>e[i].indexOf(n)&&e[i].push(n)}let r=s.sourceEdges;for(;r.next();){let s=r.value.fromVertex;(n=t.indexOf(s))!==i&&0>e[i].indexOf(n)&&e[i].push(n)}}let i=[];for(let t=0;t<e.length;t++)i[t]=0;let s=[],n=[],l=[],r=[],o=new th,h=0;for(let a=0;a<e.length;a++){let u=e[a].length;if(1===u){r.push(a);continue}if(0===u){o.add(t.elt(a));continue}if(0===h){s.push(a),h++;continue}let d=1/0,c=1/0,g=-1,f=[];for(let t=0;t<s.length;t++)0>e[s[t]].indexOf(s[t===s.length-1?0:t+1])&&f.push(t===s.length-1?0:t+1);if(0===f.length)for(let t=0;t<s.length;t++)f.push(t);for(let t=0;t<f.length;t++){let r=f[t],o=this.QO(e[a],n,l,i,r,s),h=0;for(let t=0;t<e[a].length;t++){let i=e[a][t],n=s.indexOf(i);if(n>=0){let t=Math.abs(r-(n>=r?n+1:n));h+=t<s.length+1-t?t:s.length+1-t}}for(let t=0;t<n.length;t++){let e=i[n[t]],o=i[l[t]];if(e>=r&&e++,o>=r&&o++,e>o){let t=o;o=e,e=t}o-e<(s.length+2)/2==(e<r&&r<=o)&&h++}(o<d||o===d&&h<c)&&(d=o,c=h,g=r)}s.splice(g,0,a);for(let t=0;t<s.length;t++)i[s[t]]=t;for(let t=0;t<e[a].length;t++){let i=e[a][t];s.indexOf(i)>=0&&(n.push(a),l.push(i))}h++}let a=!1,u=s.length;for(;;){a=!0;for(let t=0;t<r.length;t++){let i=r[t],n=e[i][0],l=s.indexOf(n);if(l>=0){let o=0;for(let t=0;t<e[n].length;t++){let i=e[n][t],r=s.indexOf(i);if(r<0||r===l)continue;let h=r>l?r-l:l-r,a=u-h;o+=r<l!=h>a?1:-1}s.splice(o<0?l:l+1,0,i),r.splice(t,1),t--}else a=!1}if(a)break;s.push(r[0]),r.splice(0,1)}for(let e=0;e<s.length;e++){let i=s[e];o.add(t.elt(i))}return o}QO(t,e,i,s,n,l){let r=0;for(let o=0;o<e.length;o++){let h=e[o],a=i[o],u=s[h],d=s[a],c=0,g=0;if(u<d?(c=u,g=d):(c=d,g=u),c<n&&n<=g)for(let e=0;e<t.length;e++){let i=t[e];0>l.indexOf(i)||c<s[i]&&s[i]<g||c===s[i]||g===s[i]||r++}else for(let e=0;e<t.length;e++){let i=t[e];0>l.indexOf(i)||!(c<s[i]&&s[i]<g)||c===s[i]||g===s[i]||r++}}return r}get radius(){return this.gg}set radius(t){this.gg!==t&&(te.s(t,"number",iG,"radius"),(t>0||isNaN(t))&&(this.gg=t,this.invalidateLayout()))}get aspectRatio(){return this.mg}set aspectRatio(t){this.mg!==t&&(te.s(t,"number",iG,"aspectRatio"),t>0&&(this.mg=t,this.invalidateLayout()))}get startAngle(){return this.pg}set startAngle(t){this.pg!==t&&(te.s(t,"number",iG,"startAngle"),this.pg=t,this.invalidateLayout())}get sweepAngle(){return this.Yf}set sweepAngle(t){this.Yf!==t&&(te.s(t,"number",iG,"sweepAngle"),t>0&&t<=360?this.Yf=t:this.Yf=360,this.invalidateLayout())}get arrangement(){return this.Gi}set arrangement(t){this.Gi!==t&&(3===t||0===t||1===t||2===t)&&(this.Gi=t,this.invalidateLayout())}get direction(){return this.P}set direction(t){this.P!==t&&(10===t||11===t||12===t||13===t)&&(this.P=t,this.invalidateLayout())}get sorting(){return this.xe}set sorting(t){this.xe!==t&&(this.xe=t,this.invalidateLayout())}get comparer(){return this.be}set comparer(t){this.be!==t&&(te.S(t,iG,"comparer"),this.be=t,this.invalidateLayout())}get spacing(){return this.Dn}set spacing(t){this.Dn!==t&&(te.s(t,"number",iG,"spacing"),this.Dn=t,this.invalidateLayout())}get nodeDiameterFormula(){return this.yg}set nodeDiameterFormula(t){this.yg!==t&&(30===t||31===t)&&(this.yg=t,this.invalidateLayout())}get actualXRadius(){return this.ce}get actualYRadius(){return this.Cs}get actualSpacing(){return this.Ih}get actualCenter(){return this.VN}static ConstantSpacing=0;static ConstantDistance=1;static ConstantAngle=2;static Packed=3;static Clockwise=10;static Counterclockwise=11;static BidirectionalLeft=12;static BidirectionalRight=13;static Forwards=20;static Reverse=21;static Ascending=22;static Descending=23;static Optimized=24;static Pythagorean=30;static Circular=31}class iY{Kf;ic;Gf;constructor(){this.Kf=-1/0,this.ic=null,this.Gf=null}WO(t,e){if(t>0&&this.Kf<0||Math.abs(t)<Math.abs(this.Kf)&&!(t<0&&this.Kf>0)){this.Kf=t,this.ic=[],this.Gf=[];for(let t=0;t<e.length;t++)this.ic[t]=e[t].bounds.x,this.Gf[t]=e[t].bounds.y}}JO(t,e){if(Math.abs(t)<Math.abs(this.Kf)){this.Kf=t,this.ic=[],this.Gf=[];for(let t=0;t<e.length;t++)this.ic[t]=e[t].bounds.x,this.Gf[t]=e[t].bounds.y}}commit(t){if(null!==this.ic&&null!==this.Gf)for(let e=0;e<this.ic.length;e++){let i=t.elt(e);i.x=this.ic[e],i.y=this.Gf[e]}}}class iU extends iP{constructor(t){super(t)}createVertex(){return new iq(this)}createEdge(){return new iH(this)}}class iq extends iS{No;X1;constructor(t){super(t),this.No=NaN,this.X1=NaN}Eh(t){let e=this.network;if(null===e)return NaN;let i=e.layout;if(null===i)return NaN;if(3!==i.arrangement)return 31===i.nodeDiameterFormula?this.No=Math.max(this.width,this.height):this.No=Math.sqrt(this.width*this.width+this.height*this.height),this.No;if(31===i.nodeDiameterFormula)return this.No=Math.max(this.width,this.height),this.No;{let e=Math.abs(Math.sin(t)),i=Math.abs(Math.cos(t));return 0===e?this.width:0===i?this.height:(this.No=Math.min(this.height/e,this.width/i),this.No)}}get diameter(){return this.No}set diameter(t){this.No!==t&&(te.s(t,"number",iq,"diameter"),this.No=t)}get actualAngle(){return this.X1}set actualAngle(t){this.X1!==t&&(te.s(t,"number",iq,"actualAngle"),this.X1=t)}}class iH extends iM{constructor(t){super(t)}}class iW extends ik{Vy;Bh;Ls;wg;On;Oe;xg;bg;kg;Hf;Pg;Sg;jf;qf;Wf;Jf;Mg;Ng;$f;ec;constructor(t){super(),this.Vy=0,this.Bh=0,this.Ls=new tx(100,100).u(),this.wg=!1,this.On=!0,this.Oe=!1,this.xg=100,this.bg=300,this.kg=1,this.Hf=1e3,this.Pg=10,this.Sg=Math,this.jf=.05,this.qf=50,this.Wf=150,this.Jf=0,this.Mg=10,this.Ng=5,this.$f=NaN,this.ec=10,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Ls.a(this.Ls),t.wg=this.wg,t.On=this.On,t.Oe=this.Oe,t.xg=this.xg,t.bg=this.bg,t.kg=this.kg,t.Hf=this.Hf,t.Pg=this.Pg,t.Sg=this.Sg,t.jf=this.jf,t.qf=this.qf,t.Wf=this.Wf,t.Jf=this.Jf,t.Mg=this.Mg,t.Ng=this.Ng,t.$f=this.$f,t.ec=this.ec}createNetwork(){return new i_(this)}doLayout(t){this.network=this.makeNetwork(t);let e=this.network.vertexes.iterator,i=this.maxIterations;if(this.network.vertexes.count>0){for(this.network.deleteSelfEdges(),e=this.network.vertexes.iterator;e.next();){let t=e.value;t.charge=this.electricalCharge(t),t.mass=this.gravitationalMass(t)}let t=this.network.edges.iterator;for(;t.next();){let e=t.value;e.stiffness=this.springStiffness(e),e.length=this.springLength(e)}if(this.KN(),this.Bh=0,this.needsPrelayout()){let t=this.network,e=t.splitIntoSubNetworks(!1),i=e.iterator;for(;i.next();){let t=i.value;this.doConnectedSubnetLayout(t)}for(i=e.iterator,this._O(i,t),i=e.iterator;i.next();){let e=i.value,s=e.vertexes.iterator;for(;s.next();){let e=s.value;t.addVertex(e)}let n=e.edges.iterator;for(;n.next();){let e=n.value;t.addEdge(e)}}}else this.aD(this.network,this.maxIterations);this.updateParts()}this.maxIterations=i,this.isValidLayout=!0}needsPrelayout(){if(null===this.network||this.network.vertexes.count<3)return!1;let t=0,e=0,i=this.network.vertexes.first().bounds,s=this.network.vertexes.iterator;for(;s.next();){let n=s.value,l=n.bounds;if(isNaN(n.x)||isNaN(n.y)||l.intersectsRect(i)&&++t>2)return!0;if(e>10)break;e++}return!1}doConnectedSubnetLayout(t){let e=t.vertexes.iterator;for(;e.next();){let t=e.value;t.hierarchicalVertexes.add(t)}let i=t,s=this.$f;if(isNaN(s)&&(s=t.edges.count/t.vertexes.count),s<t.vertexes.count)for(;i.vertexes.count>Math.max(100,Math.sqrt(s*t.vertexes.count));)i=this.coarsenNetwork(i);let n=0;e=i.vertexes.iterator;let l=this.randomNumberGenerator;for(null===l&&(this.randomNumberGenerator=l=new i$(0));e.next();){e.value.idInCluster=n++;let t=10*(l.random()-.5),i=10*(l.random()-.5);this.isFixed(e.value)||(e.value.x=t,e.value.y=i);let s=e.value.hierarchicalVertexes.iterator;for(;s.next();)this.isFixed(s.value)||(s.value.x=t,s.value.y=i)}let r=this.computePairwiseDistances(i);this.tI(i,r,this.maxPrelayoutIterations,t.vertexes.count),this.aD(t,this.maxIterations)}computePairwiseDistances(t){let e=t.vertexes.count,i=Array(e);for(let t=0;t<e;t++)i[t]=Array(e).fill(-1),i[t][t]=0;let s=t.vertexes.iterator,n=new Map,l=[];for(;s.next();){let t=s.value;for(l=[t],(n=new Map).set(t.idInCluster,0);l.length>0;){let t=l.shift(),e=t.vertexes.iterator;for(;e.next();){let i=e.value;n.has(i.idInCluster)||(n.set(i.idInCluster,n.get(t.idInCluster)+1),l.push(i))}}for(let s=0;s<e;s++){let e=Math.min(i[t.idInCluster][s],i[s][t.idInCluster]),l=n.get(s);(e<0||l<e)&&(i[t.idInCluster][s]=l,i[s][t.idInCluster]=l)}}return i}coarsenNetwork(t){let e=this.createNetwork(),i=new Map,s=0,n=t.vertexes.iterator;for(;n.next();)n.value.idInCluster=s++;for(n=t.vertexes.iterator;n.next();){let t=n.value;if(i.has(t.idInCluster))continue;let s=Number.MAX_SAFE_INTEGER,l=null,r=t.vertexes.iterator;for(;r.next();){let t=r.value;i.has(t.idInCluster)||t.hierarchicalVertexes.length<s&&(s=t.hierarchicalVertexes.length,l=t)}let o=e.createVertex();o.hierarchicalVertexes.addAll(t.hierarchicalVertexes),null!=l&&o.hierarchicalVertexes.addAll(l.hierarchicalVertexes),i.set(t.idInCluster,o),null!=l&&i.set(l.idInCluster,o),e.addVertex(o)}let l=t.edges.iterator;for(;l.next();){let t=l.value,s=i.get(t.fromVertex.idInCluster),n=i.get(t.toVertex.idInCluster);if(s===n)continue;let r=e.createEdge();r.fromVertex=s||null,r.toVertex=n||null,e.addEdge(r)}return e}Mw(t,e){let i=!0,s=t.vertexes.iterator;for(;s.next();){let t=s.value;i?(i=!1,e.set(t.bounds)):e.unionRect(t.bounds)}return e}_O(t,e){let i;let s=this.arrangementSpacing,n=t.count,l=!0,r=0,o=0,h=te.rt();for(let t=0;t<n+e.vertexes.count+2;t++)h[t]=null;let a=0;t.reset();let u=tw.l();for(;t.next();){let e=t.value;if(this.Mw(e,u),l)l=!1,r=u.x+u.width/2,o=u.y+u.height/2,h[0]=new ty(u.x+u.width+s.width,u.y),h[1]=new ty(u.x,u.y+u.height+s.height),a=2;else{let t=this.cD(h,a,r,o,u.width,u.height,s),n=h[t],l=new ty(n.x+u.width+s.width,n.y),d=new ty(n.x,n.y+u.height+s.height);t+1<a&&h.splice(t+1,0,null),h[t]=l,h[t+1]=d,a++;let c=n.x-u.x,g=n.y-u.y;for(i=e.vertexes.iterator;i.next();){let t=i.value;this.isFixed(t)||(t.centerX+=c,t.centerY+=g)}}}for(tw.e(u),i=e.vertexes.iterator;i.next();){let t=i.value,e=t.bounds;if(a<2){r=e.x+e.width/2,o=e.y+e.height/2,h[0]=new ty(e.x+e.width+s.width,e.y),h[1]=new ty(e.x,e.y+e.height+s.height),a=2;continue}let n=this.cD(h,a,r,o,e.width,e.height,s),l=h[n],u=new ty(l.x+e.width+s.width,l.y),d=new ty(l.x,l.y+e.height+s.height);n+1<a&&h.splice(n+1,0,null),h[n]=u,h[n+1]=d,a++,this.isFixed(t)||(t.centerX=l.x+t.width/2,t.centerY=l.y+t.height/2)}te.tt(h)}cD(t,e,i,s,n,l,r){let o=9e19,h=-1;t:for(let a=0;a<e;a++){let u=t[a],d=u.x-i,c=u.y-s,g=d*d+c*c;if(g<o){for(let e=a-1;e>=0;e--)if(t[e].y>u.y&&t[e].x-u.x<n+r.width)continue t;for(let i=a+1;i<e;i++)if(t[i].x>u.x&&t[i].y-u.y<l+r.height)continue t;h=a,o=g}}return h}KN(){if(!this.comments)return;let t=this.network.vertexes.iterator;for(;t.next();){let e=t.value;this.addComments(e)}}addComments(t){let e=t.node;if(null!==e){let i=e.findNodesConnected();for(;i.next();){let e=i.value;if("Comment"!==e.category||!e.isVisible())continue;let s=this.network.findVertex(e);null===s&&(s=this.network.addNode(e)),s.charge=this.defaultCommentElectricalCharge;let n=null,l=s.destinationEdges;for(;l.next();){let e=l.value;if(e.toVertex===t){n=e;break}}if(null===n){let e=s.sourceEdges;for(;e.next();){let i=e.value;if(i.fromVertex===t){n=i;break}}}null===n&&(n=this.network.linkVertexes(t,s,null)),n.length=this.defaultCommentSpringLength}}}GN(t,e){let i=t.bounds,s=i.x,n=i.y,l=i.width,r=i.height,o=e.bounds,h=o.x,a=o.y,u=o.width,d=o.height;if(s+l<h){if(n>a+d){let t=s+l-h,e=n-a-d;return tP.xw(t*t+e*e)}{if(!(n+r<a))return h-(s+l);let t=s+l-h,e=n+r-a;return tP.xw(t*t+e*e)}}if(!(s>h+u))return n>a+d?n-(a+d):n+r<a?a-(n+r):.1;if(n>a+d){let t=s-h-u,e=n-a-d;return tP.xw(t*t+e*e)}{if(!(n+r<a))return s-(h+u);let t=s-h-u,e=n+r-a;return tP.xw(t*t+e*e)}}aD(t,e){let i=this.Bh+e;for(;this.Bh<i&&(this.Bh++,this.iI(t)););}iI(t){let e=t.vertexes.toArray();if(e.length<=0)return!1;let i=e[0];i.forceX=0,i.forceY=0;let s=i.centerX,n=s,l=i.centerY,r=l;for(let t=1;t<e.length;t++){let i=e[t];i.forceX=0,i.forceY=0;let o=i.centerX,h=i.centerY;s=Math.min(s,o),n=Math.max(n,o),l=Math.min(l,h),r=Math.max(r,h)}let o=n-s>r-l;o?e.sort((t,e)=>null===t||null===e||t===e?0:t.centerX-e.centerX):e.sort((t,e)=>null===t||null===e||t===e?0:t.centerY-e.centerY);let h=this.Hf,a=0,u=0,d=0;for(let t=0;t<e.length;t++){let i=e[t],s=i.bounds,n=i.focus,l=s.x+n.x,r=s.y+n.y;u=i.charge*this.electricalFieldX(l,r),d=i.charge*this.electricalFieldY(l,r),u+=i.mass*this.gravitationalFieldX(l,r),d+=i.mass*this.gravitationalFieldY(l,r),i.forceX+=u,i.forceY+=d;for(let s=t+1;s<e.length;s++){let n=e[s];if(!this.shouldInteract(i,n)||s===t)continue;let c=n.bounds,g=n.focus,f=c.x+g.x,m=c.y+g.y;if(l-f>h||f-l>h){if(o)break;continue}if(r-m>h||m-r>h){if(!o)break;continue}let p=this.GN(i,n),y=2*i.charge,x=2*n.charge;if(p>1)u=(a=y*x/(p*p))*(l-f)/p,d=a*(r-m)/p;else{let t=this.randomNumberGenerator;null===t&&(this.randomNumberGenerator=t=new i$(0));let e=t.random(),s=t.random();if(l>f)u=y*x*(1+(u=Math.abs(n.bounds.right-i.bounds.x)))*e;else if(l<f)u=-(y*x)*(1+(u=Math.abs(n.bounds.x-i.bounds.right)))*e;else{let t=Math.max(n.width,i.width);u=y*x*((1+t)*e-t/2)}if(r>m)d=y*x*(1+(d=Math.abs(n.bounds.bottom-i.bounds.y)))*s;else if(l<f)d=-(y*x)*(1+(d=Math.abs(n.bounds.y-i.bounds.bottom)))*s;else{let t=Math.max(n.height,i.height);d=y*x*((1+t)*s-t/2)}}i.forceX+=u,i.forceY+=d,n.forceX-=u,n.forceY-=d}}let c=t.edges.iterator;for(;c.next();){let t=c.value,e=t.fromVertex,i=t.toVertex,s=e.bounds,n=e.focus,l=s.x+n.x,r=s.y+n.y,o=i.bounds,h=i.focus,g=o.x+h.x,f=o.y+h.y,m=this.GN(e,i);m>1&&(u=.5*(a=.1*t.stiffness*(m-t.length))*(e.width+i.height)*(l-g)/m,d=.5*a*(e.width+i.height)*(r-f)/m),e.forceX-=u,e.forceY-=d,i.forceX+=u,i.forceY+=d}let g=0;for(let t=0;t<e.length;t++){let i=e[t];this.isFixed(i)?this.moveFixedVertex(i):g=Math.max(g,this.moveVertex(i)||0)}return g>this.epsilonDistance*this.epsilonDistance}tI(t,e,i,s){let n=this.Bh+i,l=Math.sqrt(s);this.Vy=this.ec*t.vertexes.count;let r=t.vertexes.toArray(),o=0,h=0,a=0;for(;this.Bh<n;){this.Bh++,h=o,o=0;for(let t=0;t<r.length;t++){r[t].forceX=0,r[t].forceY=0;for(let i=0;i<r.length;i++){if(t===i)continue;let s=this.GN(r[t],r[i]),n=e[r[t].idInCluster][r[i].idInCluster],o=(s-this.ec*l*n)/s;r[t].forceX+=o*(r[i].x-r[t].x),r[t].forceY+=o*(r[i].y-r[t].y)}let i=Math.sqrt(r[t].forceX*r[t].forceX+r[t].forceY*r[t].forceY);if(i>0){r[t].forceX=this.Vy*r[t].forceX/i,r[t].forceY=this.Vy*r[t].forceY/i,this.isFixed(r[t])||(r[t].x+=r[t].forceX,r[t].y+=r[t].forceY);let e=r[t].hierarchicalVertexes.iterator;for(;e.next();){let i=e.value;this.isFixed(i)||(i.centerX+=r[t].forceX,i.centerY+=r[t].forceY)}}o+=i*i}if(o>=h){if(++a>=5)break}else a=0;this.Vy*=.95}}moveVertex(t){let e=t.forceX,i=t.forceY,s=this.moveLimit;return e<-s?e=-s:e>s&&(e=s),i<-s?i=-s:i>s&&(i=s),t.centerX+=e,t.centerY+=i,e*e+i*i}shouldInteract(t,e){return!0}moveFixedVertex(t){}commitLayout(){this.zy(),this.commitNodes(),this.isRouting&&this.commitLinks()}zy(){if(!this.setsPortSpots)return;let t=this.network.edges.iterator;for(;t.next();){let e=t.value.link;null!==e&&(e.fromSpot=tv.Default,e.toSpot=tv.Default)}}commitNodes(){let t=0,e=0;if(this.arrangesToOrigin){let i=tw.l();this.Mw(this.network,i);let s=this.arrangementOrigin;t=s.x-i.x,e=s.y-i.y,tw.e(i)}let i=tw.l(),s=this.network.vertexes.iterator;for(;s.next();){let n=s.value;(0!==t||0!==e)&&(i.a(n.bounds),i.x+=t,i.y+=e,n.bounds=i),n.commit()}tw.e(i)}commitLinks(){let t=this.network.edges.iterator;for(;t.next();)t.value.commit()}springStiffness(t){let e=t.stiffness;return isNaN(e)?this.jf:e}springLength(t){let e=t.length;return isNaN(e)?this.qf:e}electricalCharge(t){let e=t.charge;return isNaN(e)?this.Wf:e}electricalFieldX(t,e){return 0}electricalFieldY(t,e){return 0}gravitationalMass(t){let e=t.mass;return isNaN(e)?this.Jf:e}gravitationalFieldX(t,e){return 0}gravitationalFieldY(t,e){return 0}isFixed(t){return t.isFixed}get currentIteration(){return this.Bh}get arrangementSpacing(){return this.Ls}set arrangementSpacing(t){this.Ls.equals(t)||(this.Ls.a(t),this.invalidateLayout())}get arrangesToOrigin(){return this.wg}set arrangesToOrigin(t){this.wg!==t&&(te.s(t,"boolean",iW,"arrangesToOrigin"),this.wg=t,this.invalidateLayout())}get setsPortSpots(){return this.On}set setsPortSpots(t){this.On!==t&&(te.s(t,"boolean",iW,"setsPortSpots"),this.On=t,this.invalidateLayout())}get comments(){return this.Oe}set comments(t){this.Oe!==t&&(te.s(t,"boolean",iW,"comments"),this.Oe=t,this.invalidateLayout())}get maxPrelayoutIterations(){return this.xg}set maxPrelayoutIterations(t){this.xg!==t&&(te.s(t,"number",iW,"maxPrelayoutIterations"),t>=0&&(this.xg=t,this.invalidateLayout()))}get maxIterations(){return this.bg}set maxIterations(t){this.bg!==t&&(te.s(t,"number",iW,"maxIterations"),t>=0&&(this.bg=t,this.invalidateLayout()))}get epsilonDistance(){return this.kg}set epsilonDistance(t){this.kg!==t&&(te.s(t,"number",iW,"epsilonDistance"),t>0&&(this.kg=t,this.invalidateLayout()))}get infinityDistance(){return this.Hf}set infinityDistance(t){this.Hf!==t&&(te.s(t,"number",iW,"infinityDistance"),t>1&&(this.Hf=t,this.invalidateLayout()))}get moveLimit(){return this.Pg}set moveLimit(t){this.Pg!==t&&(te.s(t,"number",iW,"moveLimit"),this.Pg=t,this.invalidateLayout())}get randomNumberGenerator(){return this.Sg}set randomNumberGenerator(t){this.Sg!==t&&(null===t||te.ot(t.random)||te.o('ForceDirectedLayout.randomNumberGenerator must have a "random()" function on it: '+t),this.Sg=t)}get defaultSpringStiffness(){return this.jf}set defaultSpringStiffness(t){this.jf!==t&&(te.s(t,"number",iW,"defaultSpringStiffness"),this.jf=t,this.invalidateLayout())}get defaultSpringLength(){return this.qf}set defaultSpringLength(t){this.qf!==t&&(te.s(t,"number",iW,"defaultSpringLength"),this.qf=t,this.invalidateLayout())}get defaultElectricalCharge(){return this.Wf}set defaultElectricalCharge(t){this.Wf!==t&&(te.s(t,"number",iW,"defaultElectricalCharge"),this.Wf=t,this.invalidateLayout())}get defaultGravitationalMass(){return this.Jf}set defaultGravitationalMass(t){this.Jf!==t&&(te.s(t,"number",iW,"defaultGravitationalMass"),this.Jf=t,this.invalidateLayout())}get defaultCommentSpringLength(){return this.Mg}set defaultCommentSpringLength(t){this.Mg!==t&&(te.s(t,"number",iW,"defaultCommentSpringLength"),this.Mg=t,this.invalidateLayout())}get defaultCommentElectricalCharge(){return this.Ng}set defaultCommentElectricalCharge(t){this.Ng!==t&&(te.s(t,"number",iW,"defaultCommentElectricalCharge"),this.Ng=t,this.invalidateLayout())}get prelayoutQuality(){return this.$f}set prelayoutQuality(t){this.$f!==t&&(te.s(t,"number",iW,"prelayoutQuality"),this.$f=t,this.invalidateLayout())}get prelayoutSpread(){return this.ec}set prelayoutSpread(t){this.ec!==t&&(te.s(t,"number",iW,"prelayoutSpread"),this.ec=t,this.invalidateLayout())}}class i_ extends iP{constructor(t){super(t)}createVertex(){return new iJ(this)}createEdge(){return new iZ(this)}}class iJ extends iS{Y1;K1;G1;H1;j1;hierarchicalVertexes;idInCluster;constructor(t){super(t),this.Y1=!1,this.K1=NaN,this.G1=NaN,this.H1=0,this.j1=0,this.hierarchicalVertexes=new th,this.idInCluster=-1}get isFixed(){return this.Y1}set isFixed(t){this.Y1!==t&&(te.s(t,"boolean",iJ,"isFixed"),this.Y1=t)}get charge(){return this.K1}set charge(t){this.K1!==t&&(te.s(t,"number",iJ,"charge"),this.K1=t)}get mass(){return this.G1}set mass(t){this.G1!==t&&(te.s(t,"number",iJ,"mass"),this.G1=t)}get forceX(){return this.H1}set forceX(t){this.H1!==t&&(te.s(t,"number",iJ,"forceX"),this.H1=t)}get forceY(){return this.j1}set forceY(t){this.j1!==t&&(te.s(t,"number",iJ,"forceY"),this.j1=t)}}class iZ extends iM{q1;W1;constructor(t){super(t),this.q1=NaN,this.W1=NaN}get stiffness(){return this.q1}set stiffness(t){this.q1!==t&&(te.s(t,"number",iZ,"stiffness"),this.q1=t)}get length(){return this.W1}set length(t){this.W1!==t&&(te.s(t,"number",iZ,"length"),this.W1=t)}}class i${I;R;Q;M;A;seed;constructor(t){void 0===t&&(t=42),this.seed=t,this.A=48271,this.M=0x7fffffff,this.Q=this.M/this.A,this.R=this.M%this.A,this.I=1/this.M,this.random()}random(){let t=this.seed/this.Q,e=this.seed%this.Q,i=this.A*e-this.R*t;return i>0?this.seed=i:this.seed=i+this.M,this.seed*this.I}}var iQ=((X=iQ||{})[X.DepthFirst=0]="DepthFirst",X[X.Greedy=1]="Greedy",X[X.FromLayers=2]="FromLayers",X),i0=((j=i0||{})[j.OptimalLinkLength=10]="OptimalLinkLength",j[j.LongestPathSink=11]="LongestPathSink",j[j.LongestPathSource=12]="LongestPathSource",j),i1=((G=i1||{})[G.DepthFirstOut=20]="DepthFirstOut",G[G.DepthFirstIn=21]="DepthFirstIn",G[G.Naive=22]="Naive",G),i2=((Y=i2||{})[Y.None=30]="None",Y[Y.Less=31]="Less",Y[Y.More=32]="More",Y),i3=((U=i3||{})[U.None=0]="None",U[U.Expand=1]="Expand",U[U.Straighten=2]="Straighten",U[U.Median=4]="Median",U[U.MaybeExpand=8]="MaybeExpand",U[U.All=15]="All",U),i4=((q=i4||{})[q.None=0]="None",q[q.UpperLeft=1]="UpperLeft",q[q.UpperRight=2]="UpperRight",q[q.LowerLeft=4]="LowerLeft",q[q.LowerRight=8]="LowerRight",q[q.All=15]="All",q);class i5 extends ik{As;Zi;P;Zf;Qf;_f;sc;tu;rr;iu;On;Mt;Xy;Kt;Cg;Ts;di;sn;Ds;Fs;Vt;Lg;nc;Ag;nn;eu;lr;In;En;HN;constructor(t){super(),this.As=25,this.Zi=25,this.P=0,this.Zf=0,this.Qf=10,this._f=20,this.sc=4,this.tu=31,this.rr=15,this.iu=10,this.On=!0,this.Mt=-1,this.Xy=-1,this.Kt=-1,this.Cg=0,this.Ts=0,this.di=null,this.sn=null,this.Ds=null,this.Fs=null,this.Vt=null,this.Lg=0,this.nc=null,this.Ag=null,this.nn=0,this.eu=null,this.lr=new ty,this.In=[],this.In.length=100,this.En=15,this.HN=0,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.As=this.As,t.Zi=this.Zi,t.P=this.P,t.Zf=this.Zf,t.Qf=this.Qf,t._f=this._f,t.sc=this.sc,t.tu=this.tu,t.rr=this.rr,t.iu=this.iu,t.On=this.On,t.En=this.En}hi(t){t in i2?this.aggressiveOption=t:t in iQ?this.cycleRemoveOption=t:t in i1?this.initializeOption=t:t in i0?this.layeringOption=t:super.hi(t)}createNetwork(){return new i8(this)}doLayout(t){null===this.network&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin),this.eI(),this.network.vertexes.count>0&&(this.network.deleteSelfEdges(),2!==this.cycleRemoveOption&&this.removeCycles(),this.sI(),2===this.cycleRemoveOption&&this.removeCycles(),this.nI(),this.oI(),this.rI(),this.reduceCrossings(),this.straightenAndPack(),this.updateParts()),this.network=null,this.isValidLayout=!0}linkMinLength(t){return 1}linkLengthWeight(t){return 1}linkStraightenWeight(t){let e=t.fromVertex.node||t.fromVertex.data,i=t.toVertex.node||t.toVertex.data;return null===e&&null===i?8:null===e||null===i?4:1}nodeMinLayerSpace(t,e){return null===t.node&&null===t.data?0:90===this.P||270===this.P?e?t.focus.y+10:t.bounds.height-t.focus.y+10:e?t.focus.x+10:t.bounds.width-t.focus.x+10}nodeMinColumnSpace(t,e){if(null===t.node&&null===t.data)return 0;let i=e?t.J1:t.$1;if(null!==i)return i;let s=this.P;return 90===s||270===s?e?t.J1=t.focus.x/this.Zi+1|0:t.$1=(t.bounds.width-t.focus.x)/this.Zi+1|0:e?t.J1=t.focus.y/this.Zi+1|0:t.$1=(t.bounds.height-t.focus.y)/this.Zi+1|0}Qi(){null===this.nc&&(this.nc=[]);let t=0,e=this.network.vertexes.iterator;for(;e.next();){let i=e.value;this.nc[t]=i.layer,t++,this.nc[t]=i.column,t++,this.nc[t]=i.index,t++}return this.nc}Ze(t){let e=0,i=this.network.vertexes.iterator;for(;i.next();){let s=i.value;s.layer=t[e],s.column=t[++e],s.index=t[++e],e++}}fD(t,e){let i=this.Uh(t),s=this.di[t];(null===this.Ag||this.Ag.length<s*s)&&(this.Ag=[]);let n=this.Ag;for(let l=0;l<s;l++){let r=0,o=i[l],h=o.near,a=0;null!==h&&h!==o&&h.layer===o.layer&&(r+=Math.max(0,Math.abs(h.index-o.index)-1));let u,d=0,c,g=0,f=0,m=0,p,y=0,x,w=0,b=0,v=0,k;if(e>=0){for(u=i[l].bo,d=0;d<u.length;d++)if((c=u[d]).valid&&c.fromVertex.layer!==t)for(g=c.fromVertex.index,f=c.portToPos,m=c.portFromPos,y=d+1;y<u.length;y++)(x=u[y]).valid&&x.fromVertex.layer!==t&&(w=x.fromVertex.index,b=x.portToPos,v=x.portFromPos,f<b&&(g>w||g===w&&m>v)&&r++,b<f&&(w>g||w===g&&v>m)&&r++)}if(e<=0){for(u=i[l].er,d=0;d<u.length;d++)if((c=u[d]).valid&&c.toVertex.layer!==t)for(g=c.toVertex.index,f=c.portToPos,m=c.portFromPos,y=d+1;y<u.length;y++)(x=u[y]).valid&&x.toVertex.layer!==t&&(w=x.toVertex.index,b=x.portToPos,m<(v=x.portFromPos)&&(g>w||g===w&&f>b)&&r++,v<m&&(w>g||w===g&&b>f)&&r++)}for(n[l*s+l]=r,a=l+1;a<s;a++){let r=0,o=0;if(e>=0){for(p=i[l].bo,k=i[a].bo,d=0;d<p.length;d++)if((c=p[d]).valid&&c.fromVertex.layer!==t)for(g=c.fromVertex.index,f=c.portToPos,m=c.portFromPos,y=0;y<k.length;y++)(x=k[y]).valid&&x.fromVertex.layer!==t&&(w=x.fromVertex.index,b=x.portToPos,v=x.portFromPos,(g<w||g===w&&m<v)&&o++,(w<g||w===g&&v<m)&&r++)}if(e<=0){for(p=i[l].er,k=i[a].er,d=0;d<p.length;d++)if((c=p[d]).valid&&c.toVertex.layer!==t)for(g=c.toVertex.index,f=c.portToPos,m=c.portFromPos,y=0;y<k.length;y++)(x=k[y]).valid&&x.toVertex.layer!==t&&(w=x.toVertex.index,b=x.portToPos,v=x.portFromPos,(g<w||g===w&&f<b)&&o++,(w<g||w===g&&b<f)&&r++)}n[l*s+a]=r,n[a*s+l]=o}}return this.Vh(t,i),n}countCrossings(){let t=0;for(let e=0;e<=this.Mt;e++){let i=this.fD(e,1),s=this.di[e];for(let e=0;e<s;e++)for(let n=e;n<s;n++)t+=i[e*s+n]}return t}lI(t,e,i){let s=this.Uh(t),n=this.di[t],l=0;for(let r=0;r<n;r++){let n=null;e<=0&&(n=s[r].bo);let o=null;e>=0&&(o=s[r].er);let h,a=0,u=0;if(null!==n)for(let e=0;e<n.length;e++)(h=n[e]).valid&&h.fromVertex.layer!==t&&(a=h.fromVertex.column+h.portFromColOffset,u=h.toVertex.column+h.portToColOffset,i?l+=Math.abs(a-u)*this.linkStraightenWeight(h):l+=Math.abs(a-u));if(null!==o)for(let e=0;e<o.length;e++)(h=o[e]).valid&&h.toVertex.layer!==t&&(a=h.fromVertex.column+h.portFromColOffset,u=h.toVertex.column+h.portToColOffset,i?l+=(Math.abs(a-u)+1)*this.linkStraightenWeight(h):l+=Math.abs(a-u))}return this.Vh(t,s),l}Z1(t){let e=0;for(let i=0;i<=this.Mt;i++)e+=this.lI(i,1,t);return e}Yy(){let t=1/0;this.Kt=-1;let e=this.network.vertexes.iterator;for(;e.next();){let i=e.value;t=Math.min(t,i.column-this.nodeMinColumnSpace(i,!0)),this.Kt=Math.max(this.Kt,i.column+this.nodeMinColumnSpace(i,!1))}for(e.reset();e.next();){let i=e.value;i.column-=t}this.Kt-=t}Ky(t,e){let i=this.Uh(t),s=this.di[t],n=[];for(let l=0;l<s;l++){let s;let r=i[l],o=null;e<=0&&(o=r.bo);let h=null;e>=0&&(h=r.er);let a=0,u=0,d=r.near;if(null!==d&&d.layer===r.layer&&(a+=d.column-1,u++),null!==o)for(let e=0;e<o.length;e++){let i=(s=o[e]).fromVertex;s.valid&&!s.rev&&i.layer!==t&&(a+=i.column,u++)}if(null!==h)for(let e=0;e<h.length;e++){let i=(s=h[e]).toVertex;s.valid&&!s.rev&&i.layer!==t&&(a+=i.column,u++)}0===u?n[l]=-1:n[l]=a/u}return this.Vh(t,i),n}uD(t,e){let i=this.Uh(t),s=this.di[t],n=[];for(let l=0;l<s;l++){let s;let r=i[l],o=null;e<=0&&(o=r.bo);let h=null;e>=0&&(h=r.er);let a=0,u=[],d=r.near;if(null!==d&&d.layer===r.layer&&(u[a]=d.column-1,a++),null!==o)for(let e=0;e<o.length;e++){let i=(s=o[e]).fromVertex;s.valid&&!s.rev&&i.layer!==t&&(u[a]=i.column+s.portFromColOffset,a++)}if(null!==h)for(let e=0;e<h.length;e++){let i=(s=h[e]).toVertex;s.valid&&!s.rev&&i.layer!==t&&(u[a]=i.column+s.portToColOffset,a++)}if(0===a)n[l]=-1;else{u.sort((t,e)=>t-e);let t=a>>1;1&a?n[l]=u[t]:n[l]=u[t-1]+u[t]>>1}}return this.Vh(t,i),n}Gy(t,e,i,s,n){if(t.component===i){t.component=e;let l=0,r=0;if(s){let r=t.destinationEdges;for(;r.next();){let o=r.value,h=o.toVertex;(l=t.layer-h.layer)===this.linkMinLength(o)&&this.Gy(h,e,i,s,n)}}if(n){let r=t.sourceEdges;for(;r.next();){let o=r.value,h=o.fromVertex;(l=h.layer-t.layer)===this.linkMinLength(o)&&this.Gy(h,e,i,s,n)}}}}jN(t,e,i,s,n){if(t.component===i){if(t.component=e,s){let l=t.destinationEdges;for(;l.next();){let t=l.value.toVertex;this.jN(t,e,i,s,n)}}if(n){let l=t.sourceEdges;for(;l.next();){let t=l.value.fromVertex;this.jN(t,e,i,s,n)}}}}removeCycles(){let t=this.network.edges.iterator;for(;t.next();)t.value.rev=!1;switch(this.Zf){default:case 1:this.hI();break;case 0:this.aI();break;case 2:this.cI()}}cI(){let t=this.network,e=t.vertexes.iterator,i=1/0;for(;e.next();)i=Math.min(i,e.value.layer);if(i<1/0){if(i<0)for(e.reset();e.next();){let t=e.value;t.layer-=i}let s=[];for(e.reset();e.next();){let t=e.value,i=s[t.layer];void 0===i?s[t.layer]=[t]:i.push(t)}let n=0;for(let t=0;t<s.length;t++){let e=s[t];if(e&&0!==e.length){if(t>0)for(let t=0;t<e.length;t++){let i=e[t];i.layer-=n}}else n++}let l=t.edges.iterator;for(;l.next();){let e=l.value,i=e.fromVertex,s=e.toVertex;i.layer<s.layer&&(t.reverseEdge(e),e.rev=!0)}}}hI(){let t=this.network,e=0,i=t.vertexes.count-1,s=[];s.length=i+1;let n=t.vertexes.iterator;for(;n.next();)n.value._i=!0;for(;null!==this.fI(t);){let n;for(n=this.dD(t);null!==n;)s[i]=n,i--,n._i=!1,n=this.dD(t);for(n=this.gD(t);null!==n;)s[e]=n,e++,n._i=!1,n=this.gD(t);null!==(n=this.uI(t))&&(s[e]=n,e++,n._i=!1)}for(let e=0;e<t.vertexes.count;e++)s[e].index=e;let l=t.edges.iterator;for(;l.next();){let e=l.value,i=e.fromVertex,s=e.toVertex;i.index>s.index&&(t.reverseEdge(e),e.rev=!0)}}fI(t){let e=t.vertexes.iterator;for(;e.next();){let t=e.value;if(t._i)return t}return null}dD(t){let e=t.vertexes.iterator;for(;e.next();){let t=e.value;if(t._i){let e=!0,i=t.destinationEdges;for(;i.next();)if(i.value.toVertex._i){e=!1;break}if(e)return t}}return null}gD(t){let e=t.vertexes.iterator;for(;e.next();){let t=e.value;if(t._i){let e=!0,i=t.sourceEdges;for(;i.next();)if(i.value.fromVertex._i){e=!1;break}if(e)return t}}return null}uI(t){let e=null,i=0,s=this.network.vertexes.iterator;for(;s.next();){let t=s.value;if(t._i){let s=0,n=t.destinationEdges;for(;n.next();)n.value.toVertex._i&&s++;let l=0,r=t.sourceEdges;for(;r.next();)r.value.fromVertex._i&&l++;(null===e||i<s-l)&&(e=t,i=s-l)}}return e}aI(){let t=this.network.vertexes.iterator;for(;t.next();){let e=t.value;e.su=-1,e.$n=-1}let e=this.network.edges.iterator;for(;e.next();)e.value.forest=!1;for(this.Lg=0,t.reset();t.next();){let e=t.value;0===e.sourceEdges.count&&this.qN(e)}for(t.reset();t.next();){let e=t.value;-1===e.su&&this.qN(e)}for(e.reset();e.next();){let t=e.value;if(!t.forest){let e=t.fromVertex,i=e.su,s=e.$n,n=t.toVertex,l=n.su,r=n.$n;l<i&&s<r&&(this.network.reverseEdge(t),t.rev=!0)}}}qN(t){t.su=this.Lg,this.Lg++;let e=t.destinationEdges;for(;e.next();){let t=e.value,i=t.toVertex;-1===i.su&&(t.forest=!0,this.qN(i))}t.$n=this.Lg,this.Lg++}sI(){let t=this.network.vertexes.iterator;for(;t.next();)t.value.layer=-1;for(this.Mt=-1,this.assignLayers(),t.reset();t.next();){let e=t.value;this.Mt=Math.max(this.Mt,e.layer)}}assignLayers(){switch(this.Qf){case 11:this.mD();break;case 12:this.dI();break;default:this.gI()}}mD(){let t=this.network.vertexes.iterator;for(;t.next();){let e=t.value,i=this.pD(e);this.Mt=Math.max(i,this.Mt)}}pD(t){let e=0;if(-1===t.layer){let i=t.destinationEdges;for(;i.next();){let t=i.value,s=t.toVertex,n=this.linkMinLength(t);e=Math.max(e,this.pD(s)+n)}t.layer=e}else e=t.layer;return e}dI(){let t=0,e=this.network.vertexes.iterator;for(;e.next();){let i=e.value;t=this.yD(i),this.Mt=Math.max(t,this.Mt)}for(e.reset();e.next();){let t=e.value;t.layer=this.Mt-t.layer}}yD(t){let e=0;if(-1===t.layer){let i=t.sourceEdges;for(;i.next();){let t=i.value,s=t.fromVertex,n=this.linkMinLength(t);e=Math.max(e,this.yD(s)+n)}t.layer=e}else e=t.layer;return e}gI(){this.mD();let t=this.network.vertexes.iterator;for(;t.next();)t.value._i=!1;for(t.reset();t.next();){let e=t.value;0===e.sourceEdges.count&&this.wD(e)}let e=1/0;for(t.reset();t.next();)e=Math.min(e,t.value.layer);for(this.Mt=-1,t.reset();t.next();){let i=t.value;i.layer-=e,this.Mt=Math.max(this.Mt,i.layer)}}wD(t){if(!t._i){t._i=!0;let e=t.destinationEdges;for(;e.next();){let t=e.value.toVertex;this.wD(t)}this.mI(t),this.pI(t)}}mI(t){let e=this.network.vertexes.iterator;for(;e.next();)e.value.component=-1;let i=t.bo,s=i.length;for(let t=0;t<s;t++){let e=i[t],s=e.fromVertex,n=e.toVertex,l=this.linkMinLength(e);s.layer-n.layer>l&&this.Gy(s,0,-1,!0,!1)}for(this.Gy(t,1,-1,!0,!0);0!==t.component;){let i=0,n=1/0,l=0,r=null,o=this.network.vertexes.iterator;for(;o.next();){let t=o.value;if(1===t.component){let e=0,o=!1,h=t.bo;s=h.length;for(let l=0;l<s;l++){let s=h[l],r=s.fromVertex;e+=this.linkLengthWeight(s),1!==r.component&&(i+=this.linkLengthWeight(s),n=Math.min(n,r.layer-t.layer-this.linkMinLength(s)))}let a=t.er;s=a.length;for(let t=0;t<s;t++){let s=a[t],n=s.toVertex;e-=this.linkLengthWeight(s),1!==n.component?i-=this.linkLengthWeight(s):o=!0}(null===r||e<l)&&!o&&(r=t,l=e)}}if(i>0){for(e.reset();e.next();){let t=e.value;1===t.component&&(t.layer+=n)}t.component=0}else r.component=0}}pI(t){let e=this.network.vertexes.iterator;for(;e.next();)e.value.component=-1;for(this.Gy(t,1,-1,!0,!1);0!==t.component;){let i=0,s=1/0,n=0,l=null,r=this.network.vertexes.iterator;for(;r.next();){let t=r.value;if(1===t.component){let e=0,r=!1,o=t.bo,h=o.length;for(let t=0;t<h;t++){let s=o[t],n=s.fromVertex;e+=this.linkLengthWeight(s),1!==n.component?i+=this.linkLengthWeight(s):r=!0}let a=t.er;h=a.length;for(let n=0;n<h;n++){let l=a[n],r=l.toVertex;e-=this.linkLengthWeight(l),1!==r.component&&(i-=this.linkLengthWeight(l),s=Math.min(s,t.layer-r.layer-this.linkMinLength(l)))}(null===l||e>n)&&!r&&(l=t,n=e)}}if(i<0){for(e.reset();e.next();){let t=e.value;1===t.component&&(t.layer-=s)}t.component=0}else l.component=0}}nI(){let t=this.network,e=[],i=t.edges.iterator;for(;i.next();){let t=i.value;t.valid=!1,e.push(t)}for(let i=0;i<e.length;i++){let s=e[i],n=s.fromVertex,l=s.toVertex;if(s.valid||(null===n.node&&null===n.data||null===l.node&&null===l.data)&&n.layer===l.layer)continue;let r=0,o=0,h=0,a=0;if(null!==s.link){let t=s.link;if(null===t)continue;let e=n.node,i=l.node;if(null===e||null===i)continue;let u=t.fromNode,d=t.toNode,c=t.fromPort;for(;null!==c&&!c.isVisibleObject();)c=c.panel;let g=t.toPort;for(;null!==g&&!g.isVisibleObject();)g=g.panel;if(s.rev){let t=u,e=c;u=d,c=g,d=t,g=e}let f=n.focus,m=l.focus,p=s.rev?l.bounds:n.bounds,y=ty.l();e!==u?p.isReal()&&u.isVisible()?u.actualBounds.isReal()?(u.getRelativePoint(c,tv.Center,y),y.x+=u.actualBounds.x-p.x,y.y+=u.actualBounds.y-p.y):(u.getRelativePoint(c,tv.Center,y),y.isReal()||y.a(f)):y.a(f):p.isReal()?(u.getRelativePoint(c,tv.Center,y),y.isReal()||y.a(f)):y.a(f);let x=s.rev?n.bounds:l.bounds,w=ty.l();i!==d?x.isReal()&&d.isVisible()?d.actualBounds.isReal()?(d.getRelativePoint(g,tv.Center,w),w.x+=d.actualBounds.x-x.x,w.y+=d.actualBounds.y-x.y):(d.getRelativePoint(g,tv.Center,w),w.isReal()||w.a(m)):w.a(m):x.isReal()?(d.getRelativePoint(g,tv.Center,w),w.isReal()||w.a(m)):w.a(m),90===this.P||270===this.P?(r=Math.round((y.x-f.x)/this.Zi),h=y.x,o=Math.round((w.x-m.x)/this.Zi),a=w.x):(r=Math.round((y.y-f.y)/this.Zi),h=y.y,o=Math.round((w.y-m.y)/this.Zi),a=w.y),ty.e(y),ty.e(w),s.portFromColOffset=r,s.portFromPos=h,s.portToColOffset=o,s.portToPos=a}else s.portFromColOffset=0,s.portFromPos=0,s.portToColOffset=0,s.portToPos=0;let u=n.layer,d=l.layer,c=this.yI(s),g=1===c||3===c,f=2===c||3===c,m,p,y=null,x;f&&(y=this.wI(n,l),x=1,(p=t.createVertex()).node=null,p.Q1=1,p.layer=u,p.near=n,t.addVertex(p),(m=t.linkVertexes(n,p,s.link)).valid=!1,m.rev=s.rev,m.portFromColOffset=r,m.portToColOffset=0,m.portFromPos=h,m.portToPos=0,n=p);let w=1;if(g&&w--,u-d>w&&u>0){for(s.valid=!1,(p=t.createVertex()).node=null,p.Q1=2,p.layer=u-1,y&&x<y.length&&p.layer===y[x].layer&&(p.near=y[x++]),t.addVertex(p),(m=t.linkVertexes(n,p,s.link)).valid=!0,m.rev=s.rev,m.portFromColOffset=f?0:r,m.portToColOffset=0,m.portFromPos=f?0:h,m.portToPos=0,n=p,u--;u-d>w&&u>0;)(p=t.createVertex()).node=null,p.Q1=3,p.layer=u-1,y&&x<y.length&&p.layer===y[x].layer&&(p.near=y[x++]),t.addVertex(p),(m=t.linkVertexes(n,p,s.link)).valid=!0,m.rev=s.rev,m.portFromColOffset=0,m.portToColOffset=0,m.portFromPos=0,m.portToPos=0,n=p,u--;(m=t.linkVertexes(p,l,s.link)).valid=!g,g&&(p.near=l),m.rev=s.rev,m.portFromColOffset=0,m.portToColOffset=o,m.portFromPos=0,m.portToPos=a}else s.valid=!0}}yI(t){let e=0,i=t.link;if(null!==i){let s=i.fromPort,n=i.toPort;if(null!==s&&null!==n){let l=i.fromNode,r=i.toNode;if(null!==l&&null!==r){let o=this._1(!0),h=this._1(!1),a=this.setsPortSpots?o:i.computeSpot(!0,s),u=this.setsPortSpots?h:i.computeSpot(!1,n),d=i.isOrthogonal;if(a.isSide()&&a.includesSide(h)&&u.isSide()&&u.includesSide(o))return 0;let c=i.getLinkPoint(l,s,a,!0,d,r,n,ty.l()),g=i.getLinkDirection(l,s,c,a,!0,d,r,n);ty.e(c),(!a.isNone()&&g===this.xD(t,!0)||this.setsPortSpots&&null!==l&&1===l.ports.count&&t.rev)&&(e+=1);let f=i.getLinkPoint(r,n,u,!1,d,l,s,ty.l()),m=i.getLinkDirection(r,n,f,u,!1,d,l,s);ty.e(f),(!u.isNone()&&m===this.xD(t,!1)||this.setsPortSpots&&null!==r&&1===r.ports.count&&t.rev)&&(e+=2)}}}return e}xD(t,e){return 90===this.P?e&&!t.rev||!e&&t.rev?270:90:180===this.P?e&&!t.rev||!e&&t.rev?0:180:270===this.P?e&&!t.rev||!e&&t.rev?90:270:e&&!t.rev||!e&&t.rev?180:0}wI(t,e){let i=[];return i.push(e),this.bD(t,i)?i.reverse():[]}bD(t,e){let i=e[e.length-1].sourceEdges.iterator;for(;i.next();){let s=i.value;if(s.rev||!s.valid)continue;let n=s.fromVertex;if(e.push(n),n===t||this.bD(t,e))return!0;e.pop()}return!1}oI(){let t=this.di=[];for(let e=0;e<=this.Mt;e++)t[e]=0;let e=this.network.vertexes.iterator;for(;e.next();)e.value.index=-1;this.initializeIndices(),this.Xy=-1,this.Cg=0,this.Ts=0;for(let e=0;e<=this.Mt;e++)t[e]>t[this.Ts]&&(this.Xy=t[e]-1,this.Ts=e),t[e]<t[this.Cg]&&(this.Cg=e);this.eu=[];for(let e=0;e<t.length;e++)this.eu[e]=[];for(e.reset();e.next();){let t=e.value,i=t.layer;this.eu[i][t.index]=t}}initializeIndices(){switch(this._f){default:case 22:this.xI();break;case 20:this.bI();break;case 21:this.kI()}}xI(){let t=null,e=this.network.vertexes.iterator;for(;e.next();){let i=e.value;if(i.near&&(null===t&&(t=new Map),i.layer===i.near.layer)){let e=t.get(i.near)||[];e.push(i),t.set(i.near,e)}}for(e.reset();e.next();){let i=e.value;if(i.near)continue;let s=i.layer;if(i.index=this.di[s],this.di[s]++,!t)continue;let n=t.get(i);Array.isArray(n)&&n.forEach(t=>{t.index=this.di[s],this.di[s]++})}}bI(){let t=null,e=this.network.vertexes.iterator;for(;e.next();){let i=e.value;if(i.near&&(null===t&&(t=new Map),i.layer===i.near.layer)){let e=t.get(i.near)||[];e.push(i),t.set(i.near,e)}}for(let i=this.Mt;i>=0;i--)for(e.reset();e.next();){let s=e.value;s.layer===i&&-1===s.index&&this.kD(s,t)}}kD(t,e){if(t.near)return;let i=t.layer;if(t.index=this.di[i],this.di[i]++,e){let s=e.get(t);Array.isArray(s)&&s.forEach(t=>{t.index=this.di[i],this.di[i]++})}let s=t.er,n=!0;for(;n;){n=!1;for(let t=0;t<s.length-1;t++){let e=s[t],i=s[t+1];e.portFromColOffset>i.portFromColOffset&&(n=!0,s[t]=i,s[t+1]=e)}}for(let t=0;t<s.length;t++){let i=s[t];if(i.valid){let t=i.toVertex;-1===t.index&&this.kD(t,e)}}}kI(){let t=null,e=this.network.vertexes.iterator;for(;e.next();){let i=e.value;if(i.near&&(null===t&&(t=new Map),i.layer===i.near.layer)){let e=t.get(i.near)||[];e.push(i),t.set(i.near,e)}}for(let i=0;i<=this.Mt;i++)for(e.reset();e.next();){let s=e.value;s.layer===i&&-1===s.index&&this.PD(s,t)}}PD(t,e){let i,s;if(t.near)return;let n=t.layer;if(t.index=this.di[n],this.di[n]++,e){let i=e.get(t);Array.isArray(i)&&i.forEach(t=>{t.index=this.di[n],this.di[n]++})}let l=t.bo,r=!0,o=0;for(;r;)for(r=!1,o=0;o<l.length-1;o++){let t=l[o],e=l[o+1];t.portToColOffset>e.portToColOffset&&(r=!0,l[o]=e,l[o+1]=t)}for(o=0;o<l.length;o++)(s=l[o]).valid&&-1===(i=s.fromVertex).index&&this.PD(i,e)}rI(){this.Kt=-1;for(let t=0;t<=this.Mt;t++){let e=this.Uh(t),i=0,s=this.di[t];for(let t=0;t<s;t++){let s=e[t];i+=this.nodeMinColumnSpace(s,!0),s.column=i,i+=1,i+=this.nodeMinColumnSpace(s,!1)}this.Kt=Math.max(this.Kt,i-1),this.Vh(t,e)}}reduceCrossings(){let t=this.countCrossings(),e=this.Qi(),i=0,s=0,n=0;for(i=0;i<this.sc;i++){for(s=0;s<=this.Mt;s++)this.tk(s,1),this.as(s,1,!1,1);for((n=this.countCrossings())<t&&(t=n,e=this.Qi()),s=this.Mt;s>=0;s--)this.tk(s,-1),this.as(s,-1,!1,-1);(n=this.countCrossings())<t&&(t=n,e=this.Qi())}for(this.Ze(e),i=0;i<this.sc;i++){for(s=0;s<=this.Mt;s++)this.tk(s,0),this.as(s,0,!1,0);for((n=this.countCrossings())<t&&(t=n,e=this.Qi()),s=this.Mt;s>=0;s--)this.tk(s,0),this.as(s,0,!1,0);(n=this.countCrossings())<t&&(t=n,e=this.Qi())}this.Ze(e);let l=!1,r=0,o=0,h=0,a=0;switch(this.tu){case 30:break;case 32:for(h=t+1;(a=this.countCrossings())<h;)for(h=a,r=this.Mt;r>=0;r--)for(o=0;o<=r;o++){for(l=!0;l;)for(l=!1,s=r;s>=o;s--)l=this.as(s,-1,!1,-1)||l;for((n=this.countCrossings())>=t?this.Ze(e):(t=n,e=this.Qi()),l=!0;l;)for(l=!1,s=r;s>=o;s--)l=this.as(s,1,!1,1)||l;for((n=this.countCrossings())>=t?this.Ze(e):(t=n,e=this.Qi()),l=!0;l;)for(l=!1,s=o;s<=r;s++)l=this.as(s,1,!1,1)||l;for(n>=t?this.Ze(e):(t=n,e=this.Qi()),l=!0;l;)for(l=!1,s=o;s<=r;s++)l=this.as(s,-1,!1,-1)||l;for(n>=t?this.Ze(e):(t=n,e=this.Qi()),l=!0;l;)for(l=!1,s=r;s>=o;s--)l=this.as(s,0,!1,0)||l;for(n>=t?this.Ze(e):(t=n,e=this.Qi()),l=!0;l;)for(l=!1,s=o;s<=r;s++)l=this.as(s,0,!1,0)||l;n>=t?this.Ze(e):(t=n,e=this.Qi())}break;default:for(r=this.Mt,o=0,h=t+1;(a=this.countCrossings())<h;){for(h=a,l=!0;l;)for(l=!1,s=r;s>=o;s--)l=this.as(s,-1,!1,-1)||l;for((n=this.countCrossings())>=t?this.Ze(e):(t=n,e=this.Qi()),l=!0;l;)for(l=!1,s=r;s>=o;s--)l=this.as(s,1,!1,1)||l;for((n=this.countCrossings())>=t?this.Ze(e):(t=n,e=this.Qi()),l=!0;l;)for(l=!1,s=o;s<=r;s++)l=this.as(s,1,!1,1)||l;for(n>=t?this.Ze(e):(t=n,e=this.Qi()),l=!0;l;)for(l=!1,s=o;s<=r;s++)l=this.as(s,-1,!1,-1)||l;for(n>=t?this.Ze(e):(t=n,e=this.Qi()),l=!0;l;)for(l=!1,s=r;s>=o;s--)l=this.as(s,0,!1,0)||l;for(n>=t?this.Ze(e):(t=n,e=this.Qi()),l=!0;l;)for(l=!1,s=o;s<=r;s++)l=this.as(s,0,!1,0)||l;n>=t?this.Ze(e):(t=n,e=this.Qi())}}this.Ze(e)}tk(t,e){let i=0,s=!1,n=this.Uh(t),l=this.di[t],r=this.uD(t,e),o=this.Ky(t,e);for(i=0;i<l;i++)-1===o[i]&&(o[i]=n[i].column),-1===r[i]&&(r[i]=n[i].column);let h=!0,a;for(;h;)for(h=!1,i=0;i<l-1;i++)if(r[i+1]<r[i]||r[i+1]===r[i]&&o[i+1]<o[i]){s=!0,h=!0;let t=r[i];r[i]=r[i+1],r[i+1]=t;let e=o[i];o[i]=o[i+1],o[i+1]=e,a=n[i],n[i]=n[i+1],n[i+1]=a}let u=0;for(i=0;i<l;i++)(a=n[i]).index=i,u+=this.nodeMinColumnSpace(a,!0),a.column=u,u+=1,u+=this.nodeMinColumnSpace(a,!1);return this.Vh(t,n),s}as(t,e,i,s){let n;let l=this.Uh(t),r=this.di[t],o=this.fD(t,e),h=0,a;if(!i||s>0)for(a=[],h=0;h<r;h++)a[h]=-1;else a=this.Ky(t,-1);if(!i||s<0)for(n=[],h=0;h<r;h++)n[h]=-1;else n=this.Ky(t,1);let u=!1,d=!0;for(;d;)for(d=!1,h=0;h<r-1;h++){let e=o[l[h].index*r+l[h+1].index],c=o[l[h+1].index*r+l[h].index],g=0,f=0,m=l[h].column,p=l[h+1].column,y=this.nodeMinColumnSpace(l[h],!0),x=this.nodeMinColumnSpace(l[h],!1),w=this.nodeMinColumnSpace(l[h+1],!0),b=this.nodeMinColumnSpace(l[h+1],!1),v=m-y+w,k=p-x+b,P=0,S=0,M=0,N=0,C=0,L=0,T=0,A,D=0,F,O=0,R=l[h].sourceEdges.iterator;if(i&&s<=0)for(;R.next();){let e=R.value;A=e.fromVertex,e.valid&&A.layer!==t&&(M=this.linkStraightenWeight(e),N=e.portFromColOffset,P+=(Math.abs(m+(C=e.portToColOffset)-((L=A.column)+N))+1)*M,S+=(Math.abs(k+C-(L+N))+1)*M)}for(R.reset();R.next();){let e=R.value;if(A=e.fromVertex,e.valid&&A.layer===t){for(D=0;D<l.length&&l[D]!==A;)D++;D<h&&(g+=2*(h-D),f+=2*(h+1-D)),D===h+1&&(g+=1),D>h+1&&(g+=4*(D-h),f+=4*(D-(h+1)))}}let B=l[h].destinationEdges.iterator;if(i&&s>=0)for(;B.next();){let e=B.value;F=e.toVertex,e.valid&&F.layer!==t&&(M=this.linkStraightenWeight(e),N=e.portFromColOffset,C=e.portToColOffset,P+=(Math.abs(m+N-((T=F.column)+C))+1)*M,S+=(Math.abs(k+N-(T+C))+1)*M)}for(B.reset();B.next();){let e=B.value;if(F=e.toVertex,e.valid&&F.layer===t){for(O=0;O<l.length&&l[O]!==F;)O++;O===h+1&&(f+=1)}}let E=l[h+1].sourceEdges.iterator;if(i&&s<=0)for(;E.next();){let e=E.value;A=e.fromVertex,e.valid&&A.layer!==t&&(M=this.linkStraightenWeight(e),N=e.portFromColOffset,P+=(Math.abs(p+(C=e.portToColOffset)-((L=A.column)+N))+1)*M,S+=(Math.abs(v+C-(L+N))+1)*M)}for(E.reset();E.next();){let e=E.value;if(A=e.fromVertex,e.valid&&A.layer===t){for(D=0;D<l.length&&l[D]!==A;)D++;D<h&&(g+=2*(h+1-D),f+=2*(h-D)),D===h&&(f+=1),D>h+1&&(g+=4*(D-(h+1)),f+=4*(D-h))}}let I=l[h+1].destinationEdges.iterator;if(i&&s>=0)for(;I.next();){let e=I.value;F=e.toVertex,e.valid&&F.layer!==t&&(M=this.linkStraightenWeight(e),N=e.portFromColOffset,C=e.portToColOffset,P+=(Math.abs(p+N-((T=F.column)+C))+1)*M,S+=(Math.abs(v+N-(T+C))+1)*M)}for(I.reset();I.next();){let e=I.value;if(F=e.toVertex,e.valid&&F.layer===t){for(O=0;O<l.length&&l[O]!==F;)O++;O===h&&(g+=1)}}let V=0,z=0,K=a[l[h].index],X=n[l[h].index],j=a[l[h+1].index],G=n[l[h+1].index];if(-1!==K&&(V+=Math.abs(K-m),z+=Math.abs(K-k)),-1!==X&&(V+=Math.abs(X-m),z+=Math.abs(X-k)),-1!==j&&(V+=Math.abs(j-p),z+=Math.abs(j-v)),-1!==G&&(V+=Math.abs(G-p),z+=Math.abs(G-v)),f<g-.5||f===g&&c<e-.5||f===g&&c===e&&S<P-.5||f===g&&c===e&&S===P&&z<V-.5){u=!0,d=!0,l[h].column=k,l[h+1].column=v;let t=l[h];l[h]=l[h+1],l[h+1]=t}}for(h=0;h<r;h++)l[h].index=h;return this.Vh(t,l),u}straightenAndPack(){if(0!==this.En){this.SI();return}let t=0,e=!1,i=(1&this.rr)!=0,s=(8&this.rr)!=0;if(this.network.edges.count>1e3&&s&&(i=!1),i){let e=[],i=0;for(i=0;i<=this.Mt;i++)e[i]=0;let s=0,n=this.network.vertexes.iterator;for(;n.next();){let i=n.value;t=i.layer,s=i.column;let l=this.nodeMinColumnSpace(i,!1);e[t]=Math.max(e[t],s+l)}for(n.reset();n.next();){let i=n.value;t=i.layer,s=i.column,i.column=((this.Kt-e[t])*8>>1)+8*s}this.Kt*=8}if(2&this.rr){e=!0;let i=0;for(;e&&i<this.iu;){for(e=!1,t=this.Ts+1;t<=this.Mt;t++)e=this.Tg(t,1)||e;for(t=this.Ts-1;t>=0;t--)e=this.Tg(t,-1)||e;e=this.Tg(this.Ts,0)||e,i++}}if(4&this.rr){for(t=this.Ts+1;t<=this.Mt;t++)this.WN(t,1);for(t=this.Ts-1;t>=0;t--)this.WN(t,-1);this.WN(this.Ts,0)}if(i&&(this.SD(-1),this.SD(1)),2&this.rr){e=!0;let i=0;for(;e&&i<this.iu;){for(e=!1,e=this.Tg(this.Ts,0)||e,t=this.Ts+1;t<=this.Mt;t++)e=this.Tg(t,0)||e;for(t=this.Ts-1;t>=0;t--)e=this.Tg(t,0)||e;i++}}}Tg(t,e){let i=!1;for(;this.MI(t,e);)i=!0;return i}MI(t,e){let i=0,s=this.Uh(t),n=this.di[t],l=this.Ky(t,-1);if(e>0)for(i=0;i<n;i++)l[i]=-1;let r=this.Ky(t,1);if(e<0)for(i=0;i<n;i++)r[i]=-1;let o=!1,h=!0;for(;h;)for(h=!1,i=0;i<n;i++){let a=s[i].column,u=this.nodeMinColumnSpace(s[i],!0),d=this.nodeMinColumnSpace(s[i],!1),c=0;c=i-1<0||a-s[i-1].column-1>u+this.nodeMinColumnSpace(s[i-1],!1)?a-1:a;let g=0;g=i+1>=n||s[i+1].column-a-1>d+this.nodeMinColumnSpace(s[i+1],!0)?a+1:a;let f=0,m=0,p=0,y=0,x=0,w=0;if(e<=0){let e=s[i].sourceEdges.iterator;for(;e.next();){let i=e.value,s=i.fromVertex;if(i.valid&&s.layer!==t){y=this.linkStraightenWeight(i),x=i.portFromColOffset,w=i.portToColOffset;let t=s.column;f+=(Math.abs(a+w-(t+x))+1)*y,m+=(Math.abs(c+w-(t+x))+1)*y,p+=(Math.abs(g+w-(t+x))+1)*y}}}if(e>=0){let e=s[i].destinationEdges.iterator;for(;e.next();){let i=e.value,s=i.toVertex;if(i.valid&&s.layer!==t){y=this.linkStraightenWeight(i),x=i.portFromColOffset,w=i.portToColOffset;let t=s.column;f+=(Math.abs(a+x-(t+w))+1)*y,m+=(Math.abs(c+x-(t+w))+1)*y,p+=(Math.abs(g+x-(t+w))+1)*y}}}let b=0,v=0,k=0,P=l[s[i].index],S=r[s[i].index];-1!==P&&(b+=Math.abs(P-a),v+=Math.abs(P-c),k+=Math.abs(P-g)),-1!==S&&(b+=Math.abs(S-a),v+=Math.abs(S-c),k+=Math.abs(S-g)),m<f||m===f&&v<b?(o=!0,h=!0,s[i].column=c):(p<f||p===f&&k<b)&&(o=!0,h=!0,s[i].column=g)}return this.Vh(t,s),this.Yy(),o}WN(t,e){let i=0,s=this.Uh(t),n=this.di[t],l=this.uD(t,e),r=[];for(i=0;i<n;i++)r[i]=l[i];let o=!1,h=!0;for(;h;)for(h=!1,i=0;i<n;i++){let t=s[i].column,e=this.nodeMinColumnSpace(s[i],!0),l=this.nodeMinColumnSpace(s[i],!1),a=0,u=0,d=0,c=0,g=0;-1===r[i]?a=0===i&&i===n-1?t:0===i?s[i+1].column-t===l+this.nodeMinColumnSpace(s[i+1],!0)?t-1:t:i===n-1?t-s[i-1].column===e+this.nodeMinColumnSpace(s[i-1],!1)?t+1:t:((g=s[i-1].column+this.nodeMinColumnSpace(s[i-1],!1)+e+1)+(c=s[i+1].column-this.nodeMinColumnSpace(s[i+1],!0)-l-1))/2|0:0===i&&i===n-1?a=r[i]:0===i?(c=s[i+1].column-this.nodeMinColumnSpace(s[i+1],!0)-l-1,a=Math.min(r[i],c)):i===n-1?(g=s[i-1].column+this.nodeMinColumnSpace(s[i-1],!1)+e+1,a=Math.max(r[i],g)):(g=s[i-1].column+this.nodeMinColumnSpace(s[i-1],!1)+e+1,c=s[i+1].column-this.nodeMinColumnSpace(s[i+1],!0)-l-1,g<r[i]&&r[i]<c?a=r[i]:g>=r[i]?a=g:c<=r[i]&&(a=c)),a!==t&&(o=!0,h=!0,s[i].column=a)}return this.Vh(t,s),this.Yy(),o}NI(){for(let t=0;t<=this.Kt;t++)for(;this.CI(t,1););this.Yy()}CI(t,e){let i=!0,s=this.network.vertexes.iterator;for(;s.next();){let e=s.value,n=this.nodeMinColumnSpace(e,!0),l=this.nodeMinColumnSpace(e,!1);if(e.column-n<=t&&e.column+l>=t){i=!1;break}}let n=!1;if(i){if(e>0)for(s.reset();s.next();){let e=s.value;e.column>t&&(e.column-=1,n=!0)}if(e<0)for(s.reset();s.next();){let e=s.value;e.column<t&&(e.column+=1,n=!0)}}return n}LI(){this.NI();for(let t=0;t<this.Kt;t++)for(;this.AI(t,1););this.Yy()}AI(t,e){let i=t;e>0&&(i=t+1),e<0&&(i=t-1);let s=0,n=[],l=[];for(s=0;s<=this.Mt;s++)n[s]=!1,l[s]=!1;let r=this.network.vertexes.iterator;for(;r.next();){let e=r.value,s=e.column-this.nodeMinColumnSpace(e,!0),o=e.column+this.nodeMinColumnSpace(e,!1);s<=t&&o>=t&&(n[e.layer]=!0),s<=i&&o>=i&&(l[e.layer]=!0)}let o=!0,h=!1;for(s=0;s<=this.Mt;s++)o=o&&!(n[s]&&l[s]);if(o){if(e>0)for(r.reset();r.next();){let e=r.value;e.column>t&&(e.column-=1,h=!0)}if(e<0)for(r.reset();r.next();){let e=r.value;e.column<t&&(e.column+=1,h=!0)}}return h}SD(t){this.LI();let e=0,i,s=0,n=0,l=0;if(t>0)for(e=0;e<=this.Kt;e++)for(i=this.Qi(),n=(s=this.Z1(!0))+1;s<n;)n=s,this.MD(e,1),(l=this.Z1(!0))>s?this.Ze(i):l<s&&(s=l,i=this.Qi());if(t<0)for(e=this.Kt;e>=0;e--)for(i=this.Qi(),n=(s=this.Z1(!0))+1;s<n;)n=s,this.MD(e,-1),(l=this.Z1(!0))>s?this.Ze(i):l<s&&(s=l,i=this.Qi());this.Yy()}MD(t,e){this.nn=0;let i=this.network.vertexes.iterator;for(;i.next();)i.value.component=-1;if(e>0)for(i.reset();i.next();){let e=i.value;e.column-this.nodeMinColumnSpace(e,!0)<=t&&(e.component=this.nn)}if(e<0)for(i.reset();i.next();){let e=i.value;e.column+this.nodeMinColumnSpace(e,!1)>=t&&(e.component=this.nn)}for(this.nn++,i.reset();i.next();){let t=i.value;-1===t.component&&(this.jN(t,this.nn,-1,!0,!0),this.nn++)}let s=0,n=[];for(s=0;s<this.nn*this.nn;s++)n[s]=!1;let l=[];for(s=0;s<(this.Mt+1)*(this.Kt+1);s++)l[s]=-1;for(i.reset();i.next();){let t=i.value,e=t.layer,s=Math.max(0,t.column-this.nodeMinColumnSpace(t,!0)),n=Math.min(this.Kt,t.column+this.nodeMinColumnSpace(t,!1));for(let i=s;i<=n;i++)l[e*(this.Kt+1)+i]=t.component}for(let t=0;t<=this.Mt;t++){if(e>0)for(let e=0;e<this.Kt;e++)-1!==l[t*(this.Kt+1)+e]&&-1!==l[t*(this.Kt+1)+e+1]&&l[t*(this.Kt+1)+e]!==l[t*(this.Kt+1)+e+1]&&(n[l[t*(this.Kt+1)+e]*this.nn+l[t*(this.Kt+1)+e+1]]=!0);if(e<0)for(let e=this.Kt;e>0;e--)-1!==l[t*(this.Kt+1)+e]&&-1!==l[t*(this.Kt+1)+e-1]&&l[t*(this.Kt+1)+e]!==l[t*(this.Kt+1)+e-1]&&(n[l[t*(this.Kt+1)+e]*this.nn+l[t*(this.Kt+1)+e-1]]=!0)}let r=[];for(s=0;s<this.nn;s++)r[s]=!0;let o=[];o.push(0);let h=0;for(;0!==o.length;)if(h=o[o.length-1],o.pop(),r[h])for(r[h]=!1,s=0;s<this.nn;s++)n[h*this.nn+s]&&o.splice(0,0,s);let a=!1;if(e>0)for(i.reset();i.next();){let t=i.value;r[t.component]&&(t.column-=1,a=!0)}if(e<0)for(i.reset();i.next();){let t=i.value;r[t.component]&&(t.column+=1,a=!0)}return a}SI(){let t=te.rt(),e=this.eu.length;for(let i=0;i<=e;i++)t[i]=[];let i=this.network.vertexes.iterator;for(;i.next();){let s=i.value;t[e-s.layer][s.index]=s}let s=new tu;this.TI(t,s);let n=null,l=null,r=null,o=null,h=(1&this.En)!=0,a=(2&this.En)!=0,u=(4&this.En)!=0,d=(8&this.En)!=0;for(let e of(h&&(this.ll(t,s,!0),n=this.ik(t,!0,!1)),t.reverse(),u&&(this.ll(t,s,!1),r=this.ik(t,!1,!1)),t))e.reverse();d&&(this.ll(t,s,!1),o=this.ik(t,!1,!0)),t.reverse(),a&&(this.ll(t,s,!0),l=this.ik(t,!0,!0)),te.tt(t),this.DI(n,l,r,o),this.network.vertexes.each(t=>{let e=te.rt();h&&e.push(n.get(t)),a&&e.push(l.get(t)),u&&e.push(r.get(t)),d&&e.push(o.get(t)),e.sort((t,e)=>t-e);let i=e.length,s=Math.floor((i-1)/2),c=Math.ceil((i-1)/2),g=(e[s]+e[c])/2;te.tt(e),t.fe=g})}TI(t,e){let i=t.length;for(let s=1;s<i-1;s++){let i=0,n=0,l=t[s],r=t[s+1];for(let t=0;n<r.length;t++){let s=r[t],o=this.FI(s);if(t===r.length-1||o){let h=l.length-1;for(o&&(h=s.getProperSourceVertexes()[0].index);n<=t;){for(let t of r[n].getProperSourceEdges()){let s=t.fromVertex.index;(s<i||s>h)&&e.add(t)}n++}i=h}}}}FI(t){if(null===t.node){let e=t.getProperSourceVertexes();if(e.length>0)return null===e[0].node}return!1}ll(t,e,i){for(let s of(this.RI(t),t)){let t=-1;for(let n of s){let s=i?n.getProperSourceVertexes():n.getProperDestinationVertexes(),l=s.length;if(l>0){s.sort((t,e)=>t.zh-e.zh);let r=(l-1)/2;for(let l=Math.floor(r),o=Math.ceil(r);l<=o;l++)if(n.Bn===n){let r;let o=s[l];r=i?o.getDestinationEdge(n):n.getDestinationEdge(o),!e.has(r)&&t<o.zh&&(o.Bn=n,n.oc=o.oc,n.Bn=o.oc,t=o.zh)}}}}}RI(t){for(let e=0;e<t.length;e++){let i=t[e];for(let t=0;t<i.length;t++){let s=i[t];s.oc=s,s.Bn=s,s.ND=e,s.zh=t}}}ik(t,e,i){let s=90===this.P||270===this.P;for(let e of t)for(let t of e)t.Qe=t,t.nu=1/0,t.fe=NaN,t.Un=0;for(let s of(this.vI(t,e,i),t))for(let e of s)e.oc===e&&this.CD(e,t);for(let e=0;e<t.length;e++){if(t[e].length<=0)continue;let i=t[e][0];if(i.Qe===i){i.Qe.nu===1/0&&(i.Qe.nu=0);let n=e,l=0,r;do{for(r=t[n][l];r.Bn!==r.oc;)if(r=r.Bn,n++,r.zh>0){let e=this.LD(r,t),i=s?e.width:e.height,n=r.Qe.nu+r.fe+r.Un-(e.fe+e.Un+i+this.columnSpacing);e.Qe.nu=Math.min(e.Qe.nu,n)}l=r.zh+1}while(n<t.length&&l<t[n].length&&r.Qe===t[n][l].Qe)}}let n=new tp;for(let e of t)for(let t of e){t.fe=t.fe+t.Qe.nu+t.Un;let e=s?t.width:t.height;n.set(t,i?-t.fe-e:t.fe)}return n}vI(t,e,i){let s=90===this.P||270===this.P;for(let n of t)for(let t of n)if(t.oc===t){let n=0,l=t;for(;l.Bn!==t;){let t,r,o,h;let a=l.Bn,u=s?l.width:l.height,d=s?a.width:a.height;e?(t=(o=l.getDestinationEdge(a)).portFromPos,r=o.portToPos,null!==o.link&&(l.node&&l.node!==o.link.fromNode&&(t=s?l.focusX:l.focusY),a.node&&a.node!==o.link.toNode&&(r=s?a.focusX:a.focusY))):(t=(o=a.getDestinationEdge(l)).portToPos,r=o.portFromPos,null!==o.link&&(l.node&&l.node!==o.link.toNode&&(t=s?l.focusX:l.focusY),a.node&&a.node!==o.link.fromNode&&(r=s?a.focusX:a.focusY))),a.Un=h=i?l.Un+(u-t)-(d-r):l.Un+t-r,n=Math.min(n,h),l=l.Bn}l=t;do l.Un=l.Un-n,l=l.Bn;while(l!==t)}}CD(t,e){if(!isNaN(t.fe))return;t.fe=0;let i=t;do{if(i.zh>0){let s=this.LD(i,e),n=s.oc;this.CD(n,e),t.Qe===t&&(t.Qe=n.Qe);let l=90===this.P||270===this.P?s.width:s.height;if(t.Qe===n.Qe){let e=n.fe+s.Un+l-i.Un+this.columnSpacing;t.fe=Math.max(t.fe,e)}}i=i.Bn}while(i!==t);for(;i.Bn!==t;)(i=i.Bn).fe=t.fe,i.Qe=t.Qe}LD(t,e){let i=t.ND,s=t.zh;return s<1&&te.o("Could not determine previous vertex in layer"),e[i][s-1]}DI(...t){let e=-1,i=te.rt(),s=te.rt(),n=1/0;for(let l=0;l<4;l++){if(!t[l])continue;let r=this.OI(t[l],i,s,l);r<n&&(e=l,n=r)}for(let n=0;n<4;n++){let l=t[n];if(!l)continue;let r=0===n||2===n?i[e]-i[n]:s[e]-s[n];0!==r&&l.each(t=>{l.set(t.key,t.value+r)})}te.tt(i),te.tt(s)}OI(t,e,i,s){if(!t||0===t.count)return e[s]=0,i[s]=0,1/0;let n=1/0,l=-1/0;return t.each(t=>{let e=t.key,i=t.value,s=90===this.P||270===this.P?e.width:e.height;i<n&&(n=i),i+s>l&&(l=i+s)}),e[s]=n,i[s]=l,l-n}commitLayout(){this.zy(),this.commitNodes(),this.JN(),this.isRouting&&this.commitLinks()}zy(){if(!this.setsPortSpots)return;let t=this._1(!0),e=this._1(!1),i=this.network.edges.iterator;for(;i.next();){let s=i.value.link;null!==s&&(s.fromSpot=t,s.toSpot=e)}}_1(t){return 270===this.P?t?tv.MiddleTop:tv.MiddleBottom:90===this.P?t?tv.MiddleBottom:tv.MiddleTop:180===this.P?t?tv.MiddleLeft:tv.MiddleRight:t?tv.MiddleRight:tv.MiddleLeft}commitNodes(){this.sn=[],this.Ds=[],this.Fs=[],this.Vt=[];for(let t=0;t<=this.Mt;t++)this.sn[t]=0,this.Ds[t]=0,this.Fs[t]=0,this.Vt[t]=0;let t=this.network.vertexes.iterator;for(;t.next();){let e=t.value,i=e.layer;this.sn[i]=Math.max(this.sn[i],this.nodeMinLayerSpace(e,!0)),this.Ds[i]=Math.max(this.Ds[i],this.nodeMinLayerSpace(e,!1))}let e=0,i=this.As;for(let t=0;t<=this.Mt;t++){let s=i;this.sn[t]+this.Ds[t]<=0&&(s=0),t>0&&(e+=s/2),90===this.P||0===this.P?(e+=this.Ds[t],this.Fs[t]=e,e+=this.sn[t]):(e+=this.sn[t],this.Fs[t]=e,e+=this.Ds[t]),t<this.Mt&&(e+=s/2),this.Vt[t]=e}let s=e,n=this.arrangementOrigin;for(let t=0;t<=this.Mt;t++)270===this.P?this.Fs[t]=n.y+this.Fs[t]:90===this.P?(this.Fs[t]=n.y+s-this.Fs[t],this.Vt[t]=s-this.Vt[t]):180===this.P?this.Fs[t]=n.x+this.Fs[t]:(this.Fs[t]=n.x+s-this.Fs[t],this.Vt[t]=s-this.Vt[t]);let l=0!==this.En;t.reset();let r=270===this.P||90===this.P,o=1/0,h=1/0,a=1/0,u=-1/0;for(;t.next();){let e=t.value,i=e.layer,s=0|e.column,d=0,c=0;r?(d=n.x+this.Zi*s,c=this.Fs[i]):(d=this.Fs[i],c=n.y+this.Zi*s),e.centerX=d,e.centerY=c,l&&isFinite(e.fe)&&(r?e.node?e.x=n.x+e.fe:e.centerX=n.x+e.fe:e.node?e.y=n.y+e.fe:e.centerY=n.y+e.fe),o=Math.min(e.x,o),h=Math.min(e.y,h),r?(a=o,u=Math.max(u,e.bounds.right)):(a=h,u=Math.max(u,e.bounds.bottom))}this.HN=u-a;let d=n.x-o,c=n.y-h;for(this.lr=new ty(l&&r?0:d,l&&!r?0:c),t.reset();t.next();){let e=t.value;e.x+=d,e.y+=c,e.commit()}}JN(){let t=0,e=this.As;for(let e=0;e<=this.Mt;e++)t+=this.sn[e],t+=this.Ds[e];t+=this.Mt*e;let i=[],s=0!==this.En?this.HN:this.Zi*this.Kt;for(let e=this.maxLayer;e>=0;e--)270===this.P?0===e?i.push(new tw(0,0,s,Math.abs(this.Vt[0]))):i.push(new tw(0,this.Vt[e-1],s,Math.abs(this.Vt[e-1]-this.Vt[e]))):90===this.P?0===e?i.push(new tw(0,this.Vt[0],s,Math.abs(this.Vt[0]-t))):i.push(new tw(0,this.Vt[e],s,Math.abs(this.Vt[e-1]-this.Vt[e]))):180===this.P?0===e?i.push(new tw(0,0,Math.abs(this.Vt[0]),s)):i.push(new tw(this.Vt[e-1],0,Math.abs(this.Vt[e-1]-this.Vt[e]),s)):0===e?i.push(new tw(this.Vt[0],0,Math.abs(this.Vt[0]-t),s)):i.push(new tw(this.Vt[e],0,Math.abs(this.Vt[e-1]-this.Vt[e]),s));this.commitLayers(i,this.lr)}commitLayers(t,e){}commitLinks(){let t;let e=this.network.edges.iterator;for(;e.next();)null!==(t=e.value.link)&&(t.startRoute(),t.clearPoints(),t.commitRoute());for(e.reset();e.next();)null!==(t=e.value.link)&&t.updateRoute();for(e.reset();e.next();){let i=e.value;if(null===(t=i.link)||0===t.pointsCount)continue;t.startRoute();let s=t,n=s.fromNode,l=s.toNode,r=s.fromPort,o=s.toPort;if(null!==n){let t=n.findVisibleNode();null!==t&&t!==n&&(n=t,r=t.port)}if(null!==l){let t=l.findVisibleNode();null!==t&&t!==l&&(l=t,o=t.port)}let h=t.computeSpot(!0,r),a=t.computeSpot(!1,o),u=i.fromVertex,d=i.toVertex;if(i.valid){if(9===t.curve&&4===t.pointsCount){if(u.column===d.column&&0===this.alignOption){let e=t.getLinkPoint(n,r,h,!0,!1,l,o),i=t.getLinkPoint(l,o,a,!1,!1,n,r);e.isReal()||e.set(n.actualBounds.center),i.isReal()||i.set(l.actualBounds.center),t.clearPoints(),t.addPointAt(e.x,e.y),t.addPointAt((2*e.x+i.x)/3,(2*e.y+i.y)/3),t.addPointAt((e.x+2*i.x)/3,(e.y+2*i.y)/3),t.addPointAt(i.x,i.y)}else{let e=!1,i=!1;if(null!==r&&h===tv.None&&(e=!0),null!==o&&a===tv.None&&(i=!0),e||i){let s=null;e&&((s=t.getLinkPointFromPoint(n,r,r.getDocumentPoint(tv.Center),t.getPoint(3),!0)).isReal()||s.set(n.actualBounds.center),t.setPointAt(0,s.x,s.y));let h=null;if(i&&((h=t.getLinkPointFromPoint(l,o,o.getDocumentPoint(tv.Center),t.getPoint(0),!1)).isReal()||h.set(l.actualBounds.center),t.setPointAt(3,h.x,h.y)),s){let e=t.getPoint(2);t.setPointAt(1,(2*s.x+e.x)/3,(2*s.y+e.y)/3)}if(h){let e=t.getPoint(1);t.setPointAt(2,(2*h.x+e.x)/3,(2*h.y+e.y)/3)}}}}t.commitRoute();continue}if(u.layer===d.layer){t.commitRoute();continue}let c=!1,g=!1,f=this.As,m=0,p=t.firstPickIndex+1;if(t.isOrthogonal)g=!0,(m=t.pointsCount)>4&&t.points.removeRange(2,m-3);else if(9===t.curve)c=!0,(m=t.pointsCount)>4&&t.points.removeRange(2,m-3),4===m&&(p=2);else{m=t.pointsCount;let e=h===tv.None,i=a===tv.None;m>2&&e&&i?t.points.removeRange(1,m-2):m>3&&e&&!i?t.points.removeRange(1,m-3):m>3&&!e&&i?t.points.removeRange(2,m-2):!(m>4)||e||i||t.points.removeRange(2,m-3)}let y,x,w=0,b=0,v=0,k=0,P=0,S=0,M=0;if(i.rev){let e=0;for(;null!==d&&u!==d;){y=null,x=null;let s=d.sourceEdges.iterator;for(;s.next();){let t=s.value;if(t.link===i.link&&(y=t.fromVertex,x=t.toVertex,null===y.node))break}if(null===y)break;if(y!==u){if(w=t.getPoint(p-1).x,b=t.getPoint(p-1).y,v=y.centerX,k=y.centerY,g)180===this.P||0===this.P?p===t.firstPickIndex+1?(t.insertPointAt(p++,w,b),t.insertPointAt(p++,w,k)):(null!==x?x.centerY:b)!==k&&(P=this.Vt[y.layer-1]+this.lr.x,t.insertPointAt(p++,P,b),t.insertPointAt(p++,P,k)):p===t.firstPickIndex+1?(t.insertPointAt(p++,w,b),t.insertPointAt(p++,v,b)):(null!==x?x.centerX:w)!==v&&(P=this.Vt[y.layer-1]+this.lr.y,t.insertPointAt(p++,w,P),t.insertPointAt(p++,v,P));else if(p===t.firstPickIndex+1){if(S=Math.max(10,this.sn[d.layer]),M=Math.max(10,this.Ds[d.layer]),c)180===this.P?v<=d.bounds.x?(e=d.bounds.x,t.insertPointAt(p++,e-S,k),t.insertPointAt(p++,e,k),t.insertPointAt(p++,e+M,k)):(t.insertPointAt(p++,v-S,k),t.insertPointAt(p++,v,k),t.insertPointAt(p++,v+M,k)):90===this.P?k>=d.bounds.bottom?(e=d.bounds.y+d.bounds.height,t.insertPointAt(p++,v,e+M),t.insertPointAt(p++,v,e),t.insertPointAt(p++,v,e-S)):(t.insertPointAt(p++,v,k+M),t.insertPointAt(p++,v,k),t.insertPointAt(p++,v,k-S)):270===this.P?k<=d.bounds.y?(e=d.bounds.y,t.insertPointAt(p++,v,e-S),t.insertPointAt(p++,v,e),t.insertPointAt(p++,v,e+M)):(t.insertPointAt(p++,v,k-S),t.insertPointAt(p++,v,k),t.insertPointAt(p++,v,k+M)):0===this.P&&(v>=d.bounds.right?(e=d.bounds.x+d.bounds.width,t.insertPointAt(p++,e+M,k),t.insertPointAt(p++,e,k),t.insertPointAt(p++,e-S,k)):(t.insertPointAt(p++,v+M,k),t.insertPointAt(p++,v,k),t.insertPointAt(p++,v-S,k)));else{t.insertPointAt(p++,w,b);let e=0;180===this.P||0===this.P?((180===this.P?v>=d.bounds.right:v<=d.bounds.x)&&(e=(0===this.P?-S:M)/2),t.insertPointAt(p++,w+e,k)):((270===this.P?k>=d.bounds.bottom:k<=d.bounds.y)&&(e=(90===this.P?-S:M)/2),t.insertPointAt(p++,v,b+e)),t.insertPointAt(p++,v,k)}}else S=Math.max(10,this.sn[y.layer]),M=Math.max(10,this.Ds[y.layer]),c?180===this.P?(t.insertPointAt(p++,v-S-f,k),t.insertPointAt(p++,Math.min(v-S+f/2,v),k),t.insertPointAt(p++,v,k),t.insertPointAt(p++,v,k),t.insertPointAt(p++,Math.max(v+M-f/2,v),k),t.insertPointAt(p++,v+M+f,k)):90===this.P?(t.insertPointAt(p++,v,k+M+f),t.insertPointAt(p++,v,Math.max(k+M-f/2,k)),t.insertPointAt(p++,v,k),t.insertPointAt(p++,v,k),t.insertPointAt(p++,v,Math.min(k-S+f/2,k)),t.insertPointAt(p++,v,k-S-f)):270===this.P?(t.insertPointAt(p++,v,k-S-f),t.insertPointAt(p++,v,Math.min(k-S+f/2,k)),t.insertPointAt(p++,v,k),t.insertPointAt(p++,v,k),t.insertPointAt(p++,v,Math.max(k+M-f/2,k)),t.insertPointAt(p++,v,k+M+f)):(t.insertPointAt(p++,v+M+f,k),t.insertPointAt(p++,Math.max(v+M-f/2,v),k),t.insertPointAt(p++,v,k),t.insertPointAt(p++,v,k),t.insertPointAt(p++,Math.min(v-S+f/2,v),k),t.insertPointAt(p++,v-S-f,k)):(180===this.P||90===this.P||this.P,t.insertPointAt(p++,v,k))}d=y}if(null===o||h!==tv.None||g){if(w=t.getPoint(p-1).x,b=t.getPoint(p-1).y,v=t.getPoint(p).x,k=t.getPoint(p).y,g){let i=this.Ds[u.layer],s=0;180===this.P||0===this.P?((s=b)>=u.bounds.y&&s<=u.bounds.bottom&&(180===this.P?v>=u.bounds.x:v<=u.bounds.right)&&(e=u.centerX+(180===this.P?-i:i),s=s<u.bounds.y+u.bounds.height/2?u.bounds.y-this.Zi/2:u.bounds.bottom+this.Zi/2,t.insertPointAt(p++,e,b),t.insertPointAt(p++,e,s)),t.insertPointAt(p++,v,s)):((s=w)>=u.bounds.x&&s<=u.bounds.right&&(270===this.P?k>=u.bounds.y:k<=u.bounds.bottom)&&(e=u.centerY+(270===this.P?-i:i),s=s<u.bounds.x+u.bounds.width/2?u.bounds.x-this.Zi/2:u.bounds.right+this.Zi/2,t.insertPointAt(p++,w,e),t.insertPointAt(p++,s,e)),t.insertPointAt(p++,s,k)),t.insertPointAt(p++,v,k)}else if(c)S=Math.max(10,this.sn[u.layer]),M=Math.max(10,this.Ds[u.layer]),180===this.P&&v>=u.bounds.x?(e=u.bounds.x+u.bounds.width,t.setPointAt(p-2,e,b),t.setPointAt(p-1,e+M,b)):90===this.P&&k<=u.bounds.bottom?(e=u.bounds.y,t.setPointAt(p-2,w,e),t.setPointAt(p-1,w,e-S)):270===this.P&&k>=u.bounds.y?(e=u.bounds.y+u.bounds.height,t.setPointAt(p-2,w,e),t.setPointAt(p-1,w,e+M)):0===this.P&&v<=u.bounds.right&&(e=u.bounds.x,t.setPointAt(p-2,e,b),t.setPointAt(p-1,e-S,b));else{S=Math.max(10,this.sn[u.layer]),M=Math.max(10,this.Ds[u.layer]);let e=0;180===this.P||0===this.P?((180===this.P?v<=u.bounds.x:v>=u.bounds.right)&&(e=(0===this.P?M:-S)/2),t.insertPointAt(p++,v+e,b)):((270===this.P?k<=u.bounds.y:k>=u.bounds.bottom)&&(e=(90===this.P?M:-S)/2),t.insertPointAt(p++,w,k+e)),t.insertPointAt(p++,v,k)}}}else{for(;null!==u&&u!==d;){y=null,x=null;let e=u.destinationEdges.iterator;for(;e.next();){let t=e.value;if(t.link===i.link&&(y=t.toVertex,null!==(x=t.fromVertex).node&&(x=null),null===y.node))break}if(null===y)break;y!==d&&(w=t.getPoint(p-1).x,b=t.getPoint(p-1).y,v=y.centerX,k=y.centerY,g?180===this.P||0===this.P?(null!==x?x.centerY:b)!==k&&(P=this.Vt[y.layer]+this.lr.x,p===t.firstPickIndex+1&&(P=0===this.P?Math.max(P,w):Math.min(P,w)),t.insertPointAt(p++,P,b),t.insertPointAt(p++,P,k)):(null!==x?x.centerX:w)!==v&&(P=this.Vt[y.layer]+this.lr.y,p===t.firstPickIndex+1&&(P=90===this.P?Math.max(P,b):Math.min(P,b)),t.insertPointAt(p++,w,P),t.insertPointAt(p++,v,P)):(S=Math.max(10,this.sn[y.layer]),M=Math.max(10,this.Ds[y.layer]),c?180===this.P?(t.insertPointAt(p++,v+M+f,k),t.insertPointAt(p++,Math.max(v+M-f/2,v),k),t.insertPointAt(p++,v,k),t.insertPointAt(p++,v,k),t.insertPointAt(p++,Math.min(v-S+f/2,v),k),t.insertPointAt(p++,v-S-f,k)):90===this.P?(t.insertPointAt(p++,v,k-S-f),t.insertPointAt(p++,v,Math.min(k-S+f/2,k)),t.insertPointAt(p++,v,k),t.insertPointAt(p++,v,k),t.insertPointAt(p++,v,Math.max(k+M-f/2,k)),t.insertPointAt(p++,v,k+M+f)):270===this.P?(t.insertPointAt(p++,v,k+M+f),t.insertPointAt(p++,v,Math.max(k+M-f/2,k)),t.insertPointAt(p++,v,k),t.insertPointAt(p++,v,k),t.insertPointAt(p++,v,Math.min(k-S+f/2,k)),t.insertPointAt(p++,v,k-S-f)):(t.insertPointAt(p++,v-S-f,k),t.insertPointAt(p++,Math.min(v-S+f/2,v),k),t.insertPointAt(p++,v,k),t.insertPointAt(p++,v,k),t.insertPointAt(p++,Math.max(v+M-f/2,v),k),t.insertPointAt(p++,v+M+f,k)):180===this.P?(t.insertPointAt(p++,v+M,k),t.insertPointAt(p++,v-S,k)):90===this.P?(t.insertPointAt(p++,v,k-S),t.insertPointAt(p++,v,k+M)):270===this.P?(t.insertPointAt(p++,v,k+M),t.insertPointAt(p++,v,k-S)):(t.insertPointAt(p++,v-S,k),t.insertPointAt(p++,v+M,k)))),u=y}g&&(w=t.getPoint(p-1).x,b=t.getPoint(p-1).y,v=t.getPoint(p).x,k=t.getPoint(p).y,180===this.P||0===this.P?b!==k&&(P=0===this.P?Math.min(Math.max((v+w)/2,this.Vt[d.layer]+this.lr.x),v):Math.max(Math.min((v+w)/2,this.Vt[d.layer]+this.lr.x),v),t.insertPointAt(p++,P,b),t.insertPointAt(p++,P,k)):w!==v&&(P=90===this.P?Math.min(Math.max((k+b)/2,this.Vt[d.layer]+this.lr.y),k):Math.max(Math.min((k+b)/2,this.Vt[d.layer]+this.lr.y),k),t.insertPointAt(p++,w,P),t.insertPointAt(p++,v,P)))}if(null!==s&&c&&t.pointsCount>=4){if(null!==r){let e=h===tv.None?t.getLinkPointFromPoint(n,r,r.getDocumentPoint(tv.Center),t.getPoint(3),!0):t.getPoint(0);if(h===tv.None){let i=t.getPoint(2),s=t.getPoint(3);90===this.direction||270===this.direction?(t.setPointAt(1,(e.x+i.x)/2,i.y),t.setPointAt(2,s.x,(i.y+s.y)/2)):(t.setPointAt(1,i.x,(e.y+i.y)/2),t.setPointAt(2,(i.x+s.x)/2,s.y))}e.isReal()||e.set(n.actualBounds.center),t.setPointAt(0,e.x,e.y)}if(null!==o){let e=a===tv.None?t.getLinkPointFromPoint(l,o,o.getDocumentPoint(tv.Center),t.getPoint(t.pointsCount-4),!1):t.getPoint(t.pointsCount-1);if(a===tv.None){let i=t.getPoint(t.pointsCount-3),s=t.getPoint(t.pointsCount-4);90===this.direction||270===this.direction?(t.setPointAt(t.pointsCount-2,(e.x+i.x)/2,i.y),t.setPointAt(t.pointsCount-2,s.x,(i.y+s.y)/2)):(t.setPointAt(t.pointsCount-2,i.x,(e.y+i.y)/2),t.setPointAt(t.pointsCount-3,(i.x+s.x)/2,s.y))}e.isReal()||e.set(l.actualBounds.center),t.setPointAt(t.pointsCount-1,e.x,e.y)}}t.commitRoute(),i.commit()}}eI(){this.Xy=-1,this.Cg=0,this.Ts=0,this.nc=null,this.Ag=null,this.eu=null;for(let t=0;t<this.In.length;t++)this.In[t]=null}Uh(t){let e;let i=this.di[t];if(i>=this.In.length){let t=[];for(let e=0;e<this.In.length;e++)t[e]=this.In[e];this.In=t}void 0===this.In[i]||null===this.In[i]?e=[]:(e=this.In[i],this.In[i]=null);let s=this.eu[t];for(let t=0;t<s.length;t++){let i=s[t];e[i.index]=i}return e}Vh(t,e){this.In[this.di[t]]=e}get layerSpacing(){return this.As}set layerSpacing(t){this.As!==t&&(te.s(t,"number",i5,"layerSpacing"),t>=0&&(this.As=t,this.invalidateLayout()))}get columnSpacing(){return this.Zi}set columnSpacing(t){this.Zi!==t&&(te.s(t,"number",i5,"columnSpacing"),t>0&&(this.Zi=t,this.invalidateLayout()))}get direction(){return this.P}set direction(t){this.P!==t&&(te.s(t,"number",i5,"direction"),0===t||90===t||180===t||270===t?(this.P=t,this.invalidateLayout()):te.o("LayeredDigraphLayout.direction must be 0, 90, 180, or 270"))}get cycleRemoveOption(){return this.Zf}set cycleRemoveOption(t){this.Zf!==t&&(1===t||0===t||2===t)&&(this.Zf=t,this.invalidateLayout())}get layeringOption(){return this.Qf}set layeringOption(t){this.Qf!==t&&(10===t||11===t||12===t)&&(this.Qf=t,this.invalidateLayout())}get initializeOption(){return this._f}set initializeOption(t){this._f!==t&&(20===t||21===t||22===t)&&(this._f=t,this.invalidateLayout())}get iterations(){return this.sc}set iterations(t){this.sc!==t&&t>=0&&(this.sc=t,this.invalidateLayout())}get aggressiveOption(){return this.tu}set aggressiveOption(t){this.tu!==t&&(30===t||31===t||32===t)&&(this.tu=t,this.invalidateLayout())}get packOption(){return this.rr}set packOption(t){this.rr!==t&&(te.s(t,"number",i5,"packOption"),t>=0&&t<8&&(this.rr=t,this.invalidateLayout()))}get packIterations(){return this.iu}set packIterations(t){this.iu=t}get alignOption(){return this.En}set alignOption(t){this.En!==t&&(te.s(t,"number",i5,"align"),t>=0&&t<16&&(this.En=t,this.invalidateLayout()))}get setsPortSpots(){return this.On}set setsPortSpots(t){this.On!==t&&(te.s(t,"boolean",i5,"setsPortSpots"),this.On=t,this.invalidateLayout())}get maxLayer(){return this.Mt}get maxIndex(){return this.Xy}get maxColumn(){return this.Kt}get minIndexLayer(){return this.Cg}get maxIndexLayer(){return this.Ts}static CycleDepthFirst=0;static CycleGreedy=1;static CycleFromLayers=2;static LayerOptimalLinkLength=10;static LayerLongestPathSink=11;static LayerLongestPathSource=12;static InitDepthFirstOut=20;static InitDepthFirstIn=21;static InitNaive=22;static AggressiveNone=30;static AggressiveLess=31;static AggressiveMore=32;static PackNone=0;static PackExpand=1;static PackStraighten=2;static PackMedian=4;static PackAll=15;static AlignNone=0;static AlignUpperLeft=1;static AlignUpperRight=2;static AlignLowerLeft=4;static AlignLowerRight=8;static AlignAll=15}class i8 extends iP{constructor(t){super(t)}createVertex(){return new i6(this)}createEdge(){return new i9(this)}}class i6 extends iS{$o;Qr;Ft;ek;sk;_i;su;$n;Q1;J1;$1;oc;Bn;ND;zh;Qe;nu;fe;Un;Hy=null;jy=null;qy=null;Wy=null;constructor(t){super(t),this.$o=-1,this.Qr=-1,this.Ft=-1,this.ek=NaN,this.sk=null,this._i=!1,this.su=NaN,this.$n=NaN,this.Q1=0,this.J1=null,this.$1=null}static AD(t,e){return t.index-e.index}getProperSourceEdges(){if(!this.qy){let t=[];for(let e of this.bo)e.valid&&t.push(e);this.qy=t}return this.qy}getProperDestinationEdges(){if(!this.Wy){let t=[];for(let e of this.er)e.valid&&t.push(e);this.Wy=t}return this.Wy}getDestinationEdge(t){for(let e of this.getProperDestinationEdges())if(e.toVertex===t)return e;te.o("Unable to find destination edge to given vertex")}getProperSourceVertexes(){if(!this.Hy){let t=[];for(let e of this.bo)!e.valid||e.fromVertex.layer<=e.toVertex.layer||t.push(e.fromVertex);t.sort(i6.AD),this.Hy=t}return this.Hy}getProperDestinationVertexes(){if(!this.jy){let t=[];for(let e of this.er)!e.valid||e.fromVertex.layer<=e.toVertex.layer||t.push(e.toVertex);t.sort(i6.AD),this.jy=t}return this.jy}addSourceEdge(t){super.addSourceEdge(t),this.Hy=null,this.qy=null}deleteSourceEdge(t){super.deleteSourceEdge(t),this.Hy=null,this.qy=null}addDestinationEdge(t){super.addDestinationEdge(t),this.jy=null,this.Wy=null}deleteDestinationEdge(t){super.deleteDestinationEdge(t),this.jy=null,this.Wy=null}get layer(){return this.$o}set layer(t){this.$o!==t&&(te.s(t,"number",i6,"layer"),this.$o=t)}get column(){return this.Qr}set column(t){this.Qr!==t&&(te.s(t,"number",i6,"column"),this.Qr=t)}get index(){return this.Ft}set index(t){this.Ft!==t&&(te.s(t,"number",i6,"index"),this.Ft=t)}get component(){return this.ek}set component(t){this.ek!==t&&(te.s(t,"number",i6,"component"),this.ek=t)}get near(){return this.sk}set near(t){this.sk!==t&&(this.sk=t)}}class i9 extends iM{_i;nk;ok;rk;lk;hk;ak;constructor(t){super(t),this._i=!1,this.nk=!1,this.ok=!1,this.rk=NaN,this.lk=NaN,this.hk=0,this.ak=0}get fromVertex(){return this.Je}set fromVertex(t){this.Je!==t&&(this.Je=t)}get toVertex(){return this.$e}set toVertex(t){this.$e!==t&&(this.$e=t)}get valid(){return this._i}set valid(t){this._i!==t&&(te.s(t,"boolean",i9,"valid"),this._i=t)}get rev(){return this.nk}set rev(t){this.nk!==t&&(te.s(t,"boolean",i9,"rev"),this.nk=t)}get forest(){return this.ok}set forest(t){this.ok!==t&&(te.s(t,"boolean",i9,"forest"),this.ok=t)}get portFromPos(){return this.rk}set portFromPos(t){this.rk!==t&&(te.s(t,"number",i9,"portFromPos"),this.rk=t)}get portToPos(){return this.lk}set portToPos(t){this.lk!==t&&(te.s(t,"number",i9,"portToPos"),this.lk=t)}get portFromColOffset(){return this.hk}set portFromColOffset(t){this.hk!==t&&(te.s(t,"number",i9,"portFromColOffset"),this.hk=t)}get portToColOffset(){return this.ak}set portToColOffset(t){this.ak!==t&&(te.s(t,"number",i9,"portToColOffset"),this.ak=t)}}var i7=((H=i7||{})[H.Default=0]="Default",H[H.Destination=1]="Destination",H[H.Source=2]="Source",H),st=((W=st||{})[W.Forwards=10]="Forwards",W[W.Reverse=11]="Reverse",W[W.Ascending=12]="Ascending",W[W.Descending=13]="Descending",W),se=((_=se||{})[_.CenterSubtrees=20]="CenterSubtrees",_[_.CenterChildren=21]="CenterChildren",_[_.Start=22]="Start",_[_.End=23]="End",_[_.Bus=24]="Bus",_[_.BusBranching=25]="BusBranching",_[_.TopLeftBus=26]="TopLeftBus",_[_.BottomRightBus=27]="BottomRightBus",_[_.Custom=28]="Custom",_),si=((J=si||{})[J.None=30]="None",J[J.Block=31]="Block",J),ss=((Z=ss||{})[Z.Layered=40]="Layered",Z[Z.LastParents=41]="LastParents",Z[Z.Alternating=42]="Alternating",Z[Z.RootOnly=43]="RootOnly",Z),sn=(($=sn||{})[$.Vertical=50]="Vertical",$[$.Horizontal=51]="Horizontal",$[$.FixedRoots=52]="FixedRoots",$),sl=((Q=sl||{})[Q.Individual=60]="Individual",Q[Q.Siblings=61]="Siblings",Q[Q.Uniform=62]="Uniform",Q);class sr extends ik{Oi;Di;ou;Dg;$N;Oe;Gi;Ls;V;z;ck;cs;constructor(t){super(),this.Oi=new tu,this.Di=0,this.cs=1,this.ou=40,this.Dg=60,this.$N=[],this.Oe=!0,this.Gi=50,this.Ls=new tx(10,10).u();let e=new so(this);this.V=new sh(e),this.z=new sh(e),this.ck=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Di=this.Di,t.ou=this.ou,t.Dg=this.Dg,t.Oe=this.Oe,t.Gi=this.Gi,t.Ls.a(this.Ls),t.V.copyInheritedPropertiesFrom(this.V),t.z.copyInheritedPropertiesFrom(this.z)}hi(t){t in se?this.alignment=t:t in sn?this.arrangement=t:t in si?this.compaction=t:t in i7?this.path=t:t in st?this.sorting=t:t in ss?this.treeStyle=t:super.hi(t)}createNetwork(){return new so(this)}makeNetwork(t){let e=this.createNetwork(),i=t=>{if(t instanceof io)return!t.isLinkLabel&&"Comment"!==t.category;if(t instanceof ic){let e=t.fromNode;if(null===e||e.isLinkLabel||"Comment"===e.category)return!1;let i=t.toNode;return!(null===i||i.isLinkLabel||"Comment"===i.category)}return!1};return t instanceof eh?(e.addParts(t.nodes,!0,i),e.addParts(t.links,!0,i)):t instanceof ib?e.addParts(t.memberParts,!1,i):e.addParts(t.iterator,!1,i),e}doLayout(t){null===this.network&&(this.network=this.makeNetwork(t)),52!==this.arrangement&&(this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin));let e=this.diagram;null===e&&t instanceof eh&&(e=t),0===this.path&&null!==e?this.cs=e.isTreePathToChildren?1:2:this.cs=0===this.path?1:this.path,this.network.vertexes.count>0&&(this.VI(),this.zI(),this.XI(),this.YI(),this.KN(),this.KI(),this.arrangeTrees(),this.updateParts()),this.network=null,this.Oi=new tu,this.isValidLayout=!0}VI(){this.network.deleteSelfEdges();let t=this.network.vertexes.iterator;for(;t.next();){let e=t.value;e.initialized=!1,e.level=0,e.parent=null,e.children=[]}if(this.Oi.count>0){let t=new tu,e=this.Oi.iterator;for(;e.next();){let i=e.value;if(i instanceof io){let e=this.network.findVertex(i);null!==e&&t.add(e)}else i instanceof sh&&t.add(i)}this.Oi=t}0===this.Oi.count&&this.findRoots();let e=this.Oi.copy().iterator;for(;e.next();){let t=e.value;t.initialized||(t.initialized=!0,this.ZN(t))}let i=this.network.vertexes,s=null;for(;(s=this.GI(i)).count>0;){let t=this.TD(s);null!==t&&this.Oi.add(t),t.initialized=!0,this.ZN(t),i=s}}GI(t){let e=new tu,i=t.iterator;for(;i.next();){let t=i.value;t.initialized||e.add(t)}return e}findRoots(){let t=this.network.vertexes,e=t.iterator;for(;e.next();){let t=e.value;switch(this.cs){case 1:0===t.sourceEdges.count&&this.Oi.add(t);break;case 2:0===t.destinationEdges.count&&this.Oi.add(t);break;default:te.o("Unhandled path value "+this.cs.toString())}}if(0===this.Oi.count){let e=this.TD(t);null!==e&&this.Oi.add(e)}}TD(t){let e=999999,i=null,s=t.iterator;for(;s.next();){let t=s.value;switch(this.cs){case 1:t.sourceEdges.count<e&&(e=t.sourceEdges.count,i=t);break;case 2:t.destinationEdges.count<e&&(e=t.destinationEdges.count,i=t);break;default:te.o("Unhandled path value "+this.cs.toString())}}return i}ZN(t){if(null===t)return;switch(this.cs){case 1:if(t.destinationEdges.count>0){let e=new th,i=t.destinationVertexes;for(;i.next();){let s=i.value;this.DD(t,s)&&e.add(s)}e.count>0&&(t.children=e.toArray())}break;case 2:if(t.sourceEdges.count>0){let e=new th,i=t.sourceVertexes;for(;i.next();){let s=i.value;this.DD(t,s)&&e.add(s)}e.count>0&&(t.children=e.toArray())}break;default:te.o("Unhandled path value"+this.cs.toString())}let e=t.children,i=e.length;for(let s=0;s<i;s++){let i=e[s];i.initialized=!0,i.level=t.level+1,i.parent=t,this.Oi.delete(i)}for(let t=0;t<i;t++){let i=e[t];this.ZN(i)}}DD(t,e){return!e.initialized||!this.HI(e,t)&&!(e.level>t.level)&&(this.jI(e.parent,e),!0)}HI(t,e){if(null===e)return!1;let i=e.parent;for(;null!==i&&i!==t;)i=i.parent;return i===t}jI(t,e){if(null===t||null===e)return;let i=t.children,s=0;for(let t=0;t<i.length;t++)i[t]===e&&s++;if(s>0){let n=Array(i.length-s),l=0;for(let t=0;t<i.length;t++)i[t]!==e&&(n[l++]=i[t]);t.children=n}}zI(){let t=this.Oi.iterator;for(;t.next();){let e=t.value;e instanceof sh&&this.FD(e)}}FD(t){if(null===t)return;this.initializeTreeVertexValues(t),25===t.alignment&&this.sortTreeVertexChildren(t);let e=0,i=t.childrenCount,s=0,n=t.children,l=n.length;for(let t=0;t<l;t++){let l=n[t];this.FD(l),e+=l.descendantCount+1,i=Math.max(i,l.maxChildrenCount),s=Math.max(s,l.maxGenerationCount)}t.descendantCount=e,t.maxChildrenCount=i,t.maxGenerationCount=i>0?s+1:0}qI(t){switch(this.ou){default:case 40:return null!==t.parent?t.parent:this.V;case 43:return null===t.parent?this.V:null===t.parent.parent?this.z:t.parent;case 42:return null!==t.parent?null!==t.parent.parent?t.parent.parent:this.z:this.V;case 41:{let e=!0;if(0===t.childrenCount)e=!1;else{let i=t.children,s=i.length;for(let t=0;t<s;t++)if(i[t].childrenCount>0){e=!1;break}}return e&&null!==t.parent?this.z:null!==t.parent?t.parent:this.V}}}initializeTreeVertexValues(t){let e=this.qI(t);if(t.copyInheritedPropertiesFrom(e),null!==t.parent&&25===t.parent.alignment){let e=t.angle,i=t.parent.children,s=0;for(;s<i.length&&t!==i[s];)s++;s%2==0?s!==i.length-1&&(e=90===e?180:180===e?270:270===e?180:270):e=90===e?0:180===e?90:90*(270!==e),t.angle=e}t.initialized=!0}XI(){let t=this.Oi.iterator;for(;t.next();){let e=t.value;e instanceof sh&&this.RD(e)}}RD(t){if(null===t)return;this.assignTreeVertexValues(t);let e=t.children,i=e.length;for(let t=0;t<i;t++){let i=e[t];this.RD(i)}}assignTreeVertexValues(t){}YI(){let t=this.Oi.iterator;for(;t.next();){let e=t.value;e instanceof sh&&this.vD(e)}}vD(t){if(null===t)return;25!==t.alignment&&this.sortTreeVertexChildren(t);let e=t.children,i=e.length;for(let t=0;t<i;t++){let i=e[t];this.vD(i)}}sortTreeVertexChildren(t){switch(t.sorting){default:case 10:break;case 11:t.children.reverse();break;case 12:t.children.sort(t.comparer);break;case 13:t.children.sort(t.comparer),t.children.reverse()}}KN(){if(!this.comments)return;let t=this.network.vertexes.iterator;for(;t.next();){let e=t.value;this.addComments(e)}}addComments(t){let e=t.angle,i=t.parent,s=0,n=21,l=!1;null!==i&&(s=i.angle,n=i.alignment,l=this.isBusAlignment(n));let r=90===e||270===e,o=90===s||270===s,h=0===t.childrenCount,a=0,u=0,d=0,c=t.commentSpacing;if(null!==t.node){let e=t.node.findNodesConnected();for(;e.next();){let i=e.value;if("Comment"!==i.category||!i.canLayout())continue;null===t.comments&&(t.comments=[]),t.comments.push(i),i.ensureBounds();let s=i.measuredBounds;r&&!h||!l&&!o&&h||l&&o&&h?(a=Math.max(a,s.width),u+=s.height+Math.abs(d)):(a+=s.width+Math.abs(d),u=Math.max(u,s.height)),d=c}}if(null!==t.comments){r&&!h||!l&&!o&&h||l&&o&&h?(a+=Math.abs(t.commentMargin),u=Math.max(0,u-t.height)):(u+=Math.abs(t.commentMargin),a=Math.max(0,a-t.width));let e=tw.X(0,0,t.bounds.width+a,t.bounds.height+u);t.bounds=e,tw.e(e)}}isBusAlignment(t){return 24===t||25===t||26===t||27===t}Jy(t){return 24===t||25===t}QN(t){let e=t.parent;if(null!==e){let i=e.alignment;if(this.isBusAlignment(i)){if(!this.Jy(i))return 26===i;{let i=e.children,s=0;for(;s<i.length&&t!==i[s];)s++;return s%2==0}}}return!1}layoutComments(t){if(null!==t.comments){let e=t.node.measuredBounds,i=t.parent,s=t.angle,n=0,l=21,r=!1;null!==i&&(n=i.angle,l=i.alignment,r=this.isBusAlignment(l));let o=90===s||270===s,h=90===n||270===n,a=0===t.childrenCount,u=this.QN(t),d=0,c=t.comments,g=c.length,f=ty.l();for(let e=0;e<g;e++){let i=c[e],s=i.measuredBounds;if(o&&!a||!r&&!h&&a||r&&h&&a){if(n>135&&!r||h&&u){if(t.commentMargin>=0){f.i(t.bounds.x-t.commentMargin-s.width,t.bounds.y+d),i.move(f);let e=i.findLinksInto();for(;e.next();){let t=e.value;t.fromSpot=tv.MiddleLeft,t.toSpot=tv.MiddleRight}}else{f.i(t.bounds.x+2*t.focus.x-t.commentMargin,t.bounds.y+d),i.move(f);let e=i.findLinksInto();for(;e.next();){let t=e.value;t.fromSpot=tv.MiddleRight,t.toSpot=tv.MiddleLeft}}}else if(t.commentMargin>=0){f.i(t.bounds.x+2*t.focus.x+t.commentMargin,t.bounds.y+d),i.move(f);let e=i.findLinksInto();for(;e.next();){let t=e.value;t.fromSpot=tv.MiddleRight,t.toSpot=tv.MiddleLeft}}else{f.i(t.bounds.x+t.commentMargin-s.width,t.bounds.y+d),i.move(f);let e=i.findLinksInto();for(;e.next();){let t=e.value;t.fromSpot=tv.MiddleLeft,t.toSpot=tv.MiddleRight}}t.commentSpacing>=0?d+=s.height+t.commentSpacing:d+=t.commentSpacing-s.height}else{if(n>135&&!r||!h&&u){if(t.commentMargin>=0){f.i(t.bounds.x+d,t.bounds.y-t.commentMargin-s.height),i.move(f);let e=i.findLinksInto();for(;e.next();){let t=e.value;t.fromSpot=tv.MiddleTop,t.toSpot=tv.MiddleBottom}}else{f.i(t.bounds.x+d,t.bounds.y+2*t.focus.y-t.commentMargin),i.move(f);let e=i.findLinksInto();for(;e.next();){let t=e.value;t.fromSpot=tv.MiddleBottom,t.toSpot=tv.MiddleTop}}}else if(t.commentMargin>=0){f.i(t.bounds.x+d,t.bounds.y+2*t.focus.y+t.commentMargin),i.move(f);let e=i.findLinksInto();for(;e.next();){let t=e.value;t.fromSpot=tv.MiddleBottom,t.toSpot=tv.MiddleTop}}else{f.i(t.bounds.x+d,t.bounds.y+t.commentMargin-s.height),i.move(f);let e=i.findLinksInto();for(;e.next();){let t=e.value;t.fromSpot=tv.MiddleTop,t.toSpot=tv.MiddleBottom}}t.commentSpacing>=0?d+=s.width+t.commentSpacing:d+=t.commentSpacing-s.width}}ty.e(f);let m=d-t.commentSpacing-(o?e.height:e.width);if(1===this.cs){let e=t.destinationEdges;for(;e.next();){let t=e.value.link;null===t||t.isAvoiding||(t.fromEndSegmentLength=m>0?m:NaN)}}else{let e=t.sourceEdges;for(;e.next();){let t=e.value.link;null===t||t.isAvoiding||(t.toEndSegmentLength=m>0?m:NaN)}}}}KI(){if(62===this.layerStyle){let t=[],e=this.network.vertexes.iterator;for(;e.next();){let i=e.value,s=i.parent;null===s&&(s=i);let n=0===s.angle||180===s.angle,l=t[i.level];void 0===l&&(l=0),t[i.level]=Math.max(l,n?i.width:i.height)}for(let e=0;e<t.length;e++)void 0===t[e]&&(t[e]=0);for(this.$N=t,e=this.network.vertexes.iterator;e.next();){let i=e.value,s=i.parent;null===s&&(s=i),0===s.angle||180===s.angle?(180===s.angle&&(i.focusX+=t[i.level]-i.width),i.width=t[i.level]):(270===s.angle&&(i.focusY+=t[i.level]-i.height),i.height=t[i.level])}}else if(61===this.layerStyle){let t=this.network.vertexes.iterator;for(;t.next();){let e=t.value,i=0===e.angle||180===e.angle,s=-1;for(let t=0;t<e.children.length;t++){let n=e.children[t];s=Math.max(s,i?n.width:n.height)}if(s>=0)for(let t=0;t<e.children.length;t++){let n=e.children[t];i?(180===e.angle&&(n.focusX+=s-n.width),n.width=s):(270===e.angle&&(n.focusY+=s-n.height),n.height=s)}}}let t=this.Oi.iterator;for(;t.next();){let e=t.value;e instanceof sh&&this.layoutTree(e)}}layoutTree(t){if(null===t)return;let e=t.children,i=e.length;for(let t=0;t<i;t++){let i=e[t];this.layoutTree(i)}30===t.compaction?this.OD(t):25===t.alignment?this.OD(t):this.WI(t)}OD(t){if(0===t.childrenCount){let e=!1,i=0,s=21;null!==t.parent&&(i=t.parent.angle,s=t.parent.alignment,e=this.isBusAlignment(s));let n=this.QN(t);t.B.i(0,0),t.yt.i(t.width,t.height),null!==t.parent&&null!==t.comments&&((180===i||270===i)&&!e||n)?180===i&&!e||(90===i||270===i)&&n?t.ft.i(t.width-2*t.focus.x,0):t.ft.i(0,t.height-2*t.focus.y):t.ft.i(0,0);return}let e=this.orthoAngle(t),i=90===e||270===e,s=0,n=t.children,l=n.length;for(let t=0;t<l;t++){let e=n[t];s=Math.max(s,i?e.yt.width:e.yt.height)}let r=t.alignment,o=22===r,h=23===r,a=this.isBusAlignment(r),u=Math.max(0,t.breadthLimit),d=this.computeLayerSpacing(t),c=t.nodeSpacing,g=this.computeNodeIndent(t),f=o||h?0:g/2,m=t.rowSpacing,p=0;(o||h)&&(p=Math.max(0,t.rowIndent));let y=t.width,x=t.height,w=0,b=0,v=0,k=0,P=0,S=0,M=0,N=0,C=0,L=0;if(a&&!this.Jy(r)&&e>135&&n.reverse(),this.Jy(r)){if(l>1)for(let t=0;t<l;t++){let e=n[t],s=e.yt;t%2==0&&t!==l-1?C=Math.max(C,(i?s.width:s.height)+this.computeBusNodeSpacing(e)-c):t%2!=0&&(L=Math.max(L,(i?s.width:s.height)+this.computeBusNodeSpacing(e)-c))}else 1===l&&(C=i?n[0].yt.width:n[0].yt.height)}if(a)switch(r){case 24:case 25:let T;C=(T=e<135?this.ID(t,n,C,L,w,b):this.ED(t,n,C,L,w,b)).x,w=T.width,b=T.height;break;case 26:for(let t=0;t<l;t++){let e=n[t],l=e.yt,r=0===M?0:m;i?(e.B.i(s-l.width,P+r),w=Math.max(w,l.width),b=Math.max(b,P+r+l.height),P+=r+l.height):(e.B.i(k+r,s-l.height),w=Math.max(w,k+r+l.width),b=Math.max(b,l.height),k+=r+l.width),M++}break;case 27:for(let e=0;e<l;e++){let s=n[e],l=s.yt,r=0===M?0:m;i?(s.B.i(c/2+t.focus.x,P+r),w=Math.max(w,l.width),b=Math.max(b,P+r+l.height),P+=r+l.height):(s.B.i(k+r,c/2+t.focus.y),w=Math.max(w,k+r+l.width),b=Math.max(b,l.height),k+=r+l.width),M++}}else for(let o=0;o<l;o++){let l=n[o],h=l.yt;if(i){u>0&&M>0&&k+c+h.width>u&&(k<s&&this.rc(t,r,s-k,0,N,o-1),S++,M=0,N=o,v=b,k=0,P=e>135?-b-m:b+m);let i=0===M?f:c;this.fk(l,0,P),l.B.i(k+i,P),w=Math.max(w,k+i+h.width),b=Math.max(b,v+(0===S?0:m)+h.height),k+=i+h.width}else{u>0&&M>0&&P+c+h.height>u&&(P<s&&this.rc(t,r,0,s-P,N,o-1),S++,M=0,N=o,v=w,P=0,k=e>135?-w-m:w+m);let i=0===M?f:c;this.fk(l,k,0),l.B.i(k,P+i),b=Math.max(b,P+i+h.height),w=Math.max(w,v+(0===S?0:m)+h.width),P+=i+h.height}M++}S>0&&(i?(b+=Math.max(0,d),k<w&&this.rc(t,r,w-k,0,N,l-1),p>0&&(h||this.ru(t,p,0,0,l-1),w+=p)):(w+=Math.max(0,d),P<b&&this.rc(t,r,0,b-P,N,l-1),p>0&&(h||this.ru(t,0,p,0,l-1),b+=p)));let A=0,D=0;switch(r){case 20:i?A+=w/2-t.focus.x-g/2:D+=b/2-t.focus.y-g/2;break;default:case 21:if(S>0)i?A+=w/2-t.focus.x-g/2:D+=b/2-t.focus.y-g/2;else if(i){let e=n[0].B.x+n[0].ft.x;A+=e+(n[l-1].B.x+n[l-1].ft.x+2*n[l-1].focus.x-e)/2-t.focus.x-g/2}else{let e=n[0].B.y+n[0].ft.y;D+=e+(n[l-1].B.y+n[l-1].ft.y+2*n[l-1].focus.y-e)/2-t.focus.y-g/2}break;case 22:i?(A-=g,w+=g):(D-=g,b+=g);break;case 23:i?(A+=w-t.width+g,w+=g):(D+=b-t.height+g,b+=g);break;case 24:case 25:i?l>1?A+=C+c/2-t.focus.x:A+=n[0].focus.x-t.focus.x+n[0].ft.x:l>1?D+=C+c/2-t.focus.y:D+=n[0].focus.y-t.focus.y+n[0].ft.y;break;case 26:i?A+=w+c/2-t.focus.x:D+=b+c/2-t.focus.y;break;case 27:break;case 28:let F=this.customAlignment(t,A,D,w,b);A=F[0],D=F[1],w=F[2],b=F[3]}for(let t=0;t<l;t++){let s=n[t];i?s.B.i(s.B.x+s.ft.x-A,s.B.y+(e>135?(a?-b:-s.yt.height)+s.ft.y-d:x+d+s.ft.y)):s.B.i(s.B.x+(e>135?(a?-w:-s.yt.width)+s.ft.x-d:y+d+s.ft.x),s.B.y+s.ft.y-D)}i?(w=this._N(t,w,A),A<0&&(A=0),e>135&&(D+=b+d),b=Math.max(Math.max(b,x),b+x+d)):(e>135&&(A+=w+d),w=Math.max(Math.max(w,y),w+y+d),b=this.tC(t,b,D),D<0&&(D=0)),t.ft.i(A,D),t.yt.i(w,b)}customAlignment(t,e,i,s,n){return[e,i,s,n]}ID(t,e,i,s,n,l){let r=e.length;if(0===r)return new tw(i,0,n,l);if(1===r){let t=e[0];return n=t.yt.width,l=t.yt.height,new tw(i,0,n,l)}let o=t.nodeSpacing,h=t.rowSpacing,a=90===this.orthoAngle(t),u=0,d=0,c=0;for(let t=0;t<r;t++){if(t%2!=0||r>1&&t===r-1)continue;let s=e[t],g=s.yt,f=0===u?0:h;if(a){let t=this.computeBusNodeSpacing(s)-o;s.B.i(i-(g.width+t),c+f),n=Math.max(n,g.width+t),l=Math.max(l,c+f+g.height),c+=f+g.height}else{let t=this.computeBusNodeSpacing(s)-o;s.B.i(d+f,i-(g.height+t)),l=Math.max(l,g.height+t),n=Math.max(n,d+f+g.width),d+=f+g.width}u++}u=0;let g=d,f=c;a?(d=i+o,c=0):(d=0,c=i+o);for(let t=0;t<r;t++){if(t%2==0)continue;let i=e[t],s=i.yt,r=0===u?0:h;if(a){let t=this.computeBusNodeSpacing(i)-o;i.B.i(d+t,c+r),n=Math.max(n,d+s.width+t),l=Math.max(l,c+r+s.height),c+=r+s.height}else{let t=this.computeBusNodeSpacing(i)-o;i.B.i(d+r,c+t),n=Math.max(n,d+r+s.width),l=Math.max(l,c+s.height+t),d+=r+s.width}u++}if(r>1&&r%2==1){let s=e[r-1],h=s.yt,u=this.computeBusLastRowSpacing(s,a?Math.max(Math.abs(f),Math.abs(c)):Math.max(Math.abs(g),Math.abs(d)));if(a){s.B.i(i+o/2-s.focus.x-s.ft.x,l+u);let e=i+o/2-s.focus.x-s.ft.x;n=Math.max(n,e+h.width),e<0&&(n-=e),l=Math.max(l,Math.max(f,c)+u+h.height),s.B.x<0&&(i=this.uk(t,s.B.x,!1,i,o))}else{s.B.i(n+u,i+o/2-s.focus.y-s.ft.y),n=Math.max(n,Math.max(g,d)+u+h.width);let e=i+o/2-s.focus.y-s.ft.y;l=Math.max(l,e+h.height),e<0&&(l-=e),s.B.y<0&&(i=this.uk(t,s.B.y,!0,i,o))}}return new tw(i,0,n,l)}ED(t,e,i,s,n,l){let r=e.length;if(0===r)return new tw(i,0,n,l);if(1===r){let t=e[0];return n=t.yt.width,l=t.yt.height,new tw(i,0,n,l)}let o=t.nodeSpacing,h=t.rowSpacing,a=270===this.orthoAngle(t),u=0,d=0,c=0;for(let t=0;t<r;t++){if(t%2!=0||r>1&&t===r-1)continue;let s=e[t],g=s.yt,f=0===u?0:h;if(a){let t=this.computeBusNodeSpacing(s)-o;c-=f+g.height,s.B.i(i-(g.width+t),c),n=Math.max(n,g.width+t),l=Math.max(l,Math.abs(c))}else{let t=this.computeBusNodeSpacing(s)-o;d-=f+g.width,s.B.i(d,i-(g.height+t)),l=Math.max(l,g.height+t),n=Math.max(n,Math.abs(d))}u++}u=0;let g=d,f=c;a?(d=i+o,c=0):(d=0,c=i+o);for(let t=0;t<r;t++){if(t%2==0)continue;let i=e[t],s=i.yt,r=0===u?0:h;if(a){let t=this.computeBusNodeSpacing(i)-o;c-=r+s.height,i.B.i(d+t,c),n=Math.max(n,d+s.width+t),l=Math.max(l,Math.abs(c))}else{let t=this.computeBusNodeSpacing(i)-o;d-=r+s.width,i.B.i(d,c+t),l=Math.max(l,c+s.height+t),n=Math.max(n,Math.abs(d))}u++}if(r>1&&r%2==1){let s=e[r-1],h=s.yt,u=this.computeBusLastRowSpacing(s,a?Math.max(Math.abs(f),Math.abs(c)):Math.max(Math.abs(g),Math.abs(d)));if(a){s.B.i(i+o/2-s.focus.x-s.ft.x,-l-h.height-u);let e=i+o/2-s.focus.x-s.ft.x;n=Math.max(n,e+h.width),e<0&&(n-=e),l=Math.max(l,Math.abs(Math.min(f,c))+u+h.height),s.B.x<0&&(i=this.uk(t,s.B.x,!1,i,o))}else{s.B.i(-n-h.width-u,i+o/2-s.focus.y-s.ft.y),n=Math.max(n,Math.abs(Math.min(g,d))+u+h.width);let e=i+o/2-s.focus.y-s.ft.y;l=Math.max(l,e+h.height),e<0&&(l-=e),s.B.y<0&&(i=this.uk(t,s.B.y,!0,i,o))}}for(let t=0;t<r;t++){let i=e[t];a?i.B.i(i.B.x,i.B.y+l):i.B.i(i.B.x+n,i.B.y)}return new tw(i,0,n,l)}computeBusNodeSpacing(t){return null===t.parent?0:t.parent.nodeSpacing}computeBusLastRowSpacing(t,e){return null===t.parent?0:t.parent.rowSpacing}uk(t,e,i,s,n){let l=t.children,r=l.length;for(let t=0;t<r;t++)i?l[t].B.i(l[t].B.x,l[t].B.y-e):l[t].B.i(l[t].B.x-e,l[t].B.y);let o=l[r-1];return Math.max(s,i?o.ft.y+o.focus.y-n/2:o.ft.x+o.focus.x-n/2)}_N(t,e,i){switch(t.alignment){case 21:case 20:let s=e;return i+t.width>s&&(s=i+t.width),i<0&&(s-=i),s;case 22:return t.width>e?t.width:e;case 23:return 2*t.focus.x>e?t.width:e+t.width-2*t.focus.x;case 24:case 25:let n=Math.min(0,i),l=Math.max(e,i+t.width);return Math.max(t.width,l-n);case 26:return t.width-t.focus.x+t.nodeSpacing/2+e;case 27:return Math.max(t.width,t.focus.x+t.nodeSpacing/2+e);default:return e}}tC(t,e,i){switch(t.alignment){case 21:case 20:let s=e;return i+t.height>s&&(s=i+t.height),i<0&&(s-=i),s;case 22:return t.height>e?t.height:e;case 23:return 2*t.focus.y>e?t.height:e+t.height-2*t.focus.y;case 24:case 25:let n=Math.min(0,i),l=Math.max(e,i+t.height);return Math.max(t.height,l-n);case 26:return t.height-t.focus.y+t.nodeSpacing/2+e;case 27:return Math.max(t.height,t.focus.y+t.nodeSpacing/2+e);default:return e}}iC(t,e,i){switch(t){case 20:case 21:e/=2,i/=2;break;case 22:e=0,i=0;break;case 23:break;default:te.o("Unhandled alignment value "+t.toString())}return new ty(e,i)}rc(t,e,i,s,n,l){let r=this.iC(e,i,s);this.ru(t,r.x,r.y,n,l)}ru(t,e,i,s,n){if(0===e&&0===i)return;let l=t.children;for(let t=s;t<=n;t++){let s=l[t].B;s.x+=e,s.y+=i}}fk(t,e,i){let s=t.parent;switch(this.cs){case 1:{let n=t.sourceEdges;for(;n.next();){let t=n.value;t.fromVertex===s&&t.relativePoint.i(e,i)}break}case 2:{let n=t.destinationEdges;for(;n.next();){let t=n.value;t.toVertex===s&&t.relativePoint.i(e,i)}break}default:te.o("Unhandled path value "+this.cs.toString())}}WI(t){let e,i;if(0===t.childrenCount){let e=t.parent,i=!1,s=0,n=21;null!==e&&(s=e.angle,n=e.alignment,i=this.isBusAlignment(n));let l=this.QN(t);t.B.i(0,0),t.yt.i(t.width,t.height),null!==t.parent&&null!==t.comments&&((180===s||270===s)&&!i||l)?180===s&&!i||(90===s||270===s)&&l?t.ft.i(t.width-2*t.focus.x,0):t.ft.i(0,t.height-2*t.focus.y):t.ft.i(0,0),t.Fg=null,t.Rg=null;return}let s=this.orthoAngle(t),n=90===s||270===s,l=0,r=t.children,o=r.length;for(let t=0;t<o;t++){let e=r[t];l=Math.max(l,n?e.yt.width:e.yt.height)}let h=t.alignment,a=22===h,u=23===h,d=this.isBusAlignment(h),c=Math.max(0,t.breadthLimit),g=this.computeLayerSpacing(t),f=t.nodeSpacing,m=this.computeNodeIndent(t),p=t.rowSpacing,y=0;(a||u)&&(y=Math.max(0,t.rowIndent));let x=t.width,w=t.height,b=0,v=0,k=0,P=null,S=null,M=0,N=0,C=0,L=0,T=0,A=0,D=0,F=0,O=0;if(d&&!this.Jy(h)&&s>135&&r.reverse(),this.Jy(h)){if(o>1)for(let t=0;t<o;t++)t%2==0&&t!==o-1?F=Math.max(F,n?r[t].yt.width:r[t].yt.height):t%2!=0&&(O=Math.max(O,n?r[t].yt.width:r[t].yt.height));else 1===o&&(F=n?r[0].yt.width:r[0].yt.height)}if(d){switch(h){case 24:let e;F=(e=s<135?this.ID(t,r,F,O,b,v):this.ED(t,r,F,O,b,v)).x,b=e.width,v=e.height;break;case 26:for(let t=0;t<o;t++){let e=r[t],i=e.yt,s=0===A?0:p;n?(e.B.i(l-i.width,L+s),b=Math.max(b,i.width),v=Math.max(v,L+s+i.height),L+=s+i.height):(e.B.i(C+s,l-i.height),b=Math.max(b,C+s+i.width),v=Math.max(v,i.height),C+=s+i.width),A++}break;case 27:for(let e=0;e<o;e++){let i=r[e],s=i.yt,l=0===A?0:p;n?(i.B.i(f/2+t.focus.x,L+l),b=Math.max(b,s.width),v=Math.max(v,L+l+s.height),L+=l+s.height):(i.B.i(C+l,f/2+t.focus.y),b=Math.max(b,C+l+s.width),v=Math.max(v,s.height),C+=l+s.width),A++}}P=this.ue(2),S=this.ue(2),n?(P[0].i(0,0),P[1].i(0,v),S[0].i(b,0)):(P[0].i(0,0),P[1].i(b,0),S[0].i(0,v)),S[1].i(b,v)}else for(let e=0;e<o;e++){let i=r[e],o=i.yt;if(n){c>0&&A>0&&C+f+o.width>c&&(C<l&&this.rc(t,h,l-C,0,D,e-1),T++,A=0,D=e,k=v,C=0,L=s>135?-v-p:v+p),this.fk(i,0,L);let n=0;if(0===A)P=i.Fg,S=i.Rg,M=o.width,N=o.height,(null===P||null===S||s!==this.orthoAngle(i))&&(P=this.ue(2),S=this.ue(2),P[0].i(0,0),P[1].i(0,N),S[0].i(M,0),S[1].i(M,N));else{let s=te.rt(),l=this.BD(t,i,P,S,M,N,s);n=l.x,P=s[0],S=s[1],M=l.width,N=l.height,te.tt(s),C<o.width&&n<0&&(this.ru(t,-n,0,D,e-1),this.dk(P,-n,0),this.dk(S,-n,0),n=0)}i.B.i(n,L),b=Math.max(b,M),v=Math.max(v,k+(0===T?0:p)+o.height),C=M}else{c>0&&A>0&&L+f+o.height>c&&(L<l&&this.rc(t,h,0,l-L,D,e-1),T++,A=0,D=e,k=b,L=0,C=s>135?-b-p:b+p),this.fk(i,C,0);let n=0;if(0===A)P=i.Fg,S=i.Rg,M=o.width,N=o.height,(null===P||null===S||s!==this.orthoAngle(i))&&(P=this.ue(2),S=this.ue(2),P[0].i(0,0),P[1].i(M,0),S[0].i(0,N),S[1].i(M,N));else{let s=te.rt(),l=this.BD(t,i,P,S,M,N,s);n=l.x,P=s[0],S=s[1],M=l.width,N=l.height,te.tt(s),L<o.height&&n<0&&(this.ru(t,0,-n,D,e-1),this.dk(P,0,-n),this.dk(S,0,-n),n=0)}i.B.i(C,n),v=Math.max(v,N),b=Math.max(b,k+(0===T?0:p)+o.width),L=N}A++}T>0&&(n?(v+=Math.max(0,g),C<b&&this.rc(t,h,b-C,0,D,o-1),y>0&&(u||this.ru(t,y,0,0,o-1),b+=y)):(b+=Math.max(0,g),L<v&&this.rc(t,h,0,v-L,D,o-1),y>0&&(u||this.ru(t,0,y,0,o-1),v+=y)));let R=0,B=0;switch(h){case 20:n?R+=b/2-t.focus.x-m/2:B+=v/2-t.focus.y-m/2;break;default:case 21:if(T>0)n?R+=b/2-t.focus.x-m/2:B+=v/2-t.focus.y-m/2;else if(n){let e=r[0].B.x+r[0].ft.x;R+=e+(r[o-1].B.x+r[o-1].ft.x+2*r[o-1].focus.x-e)/2-t.focus.x-m/2}else{let e=r[0].B.y+r[0].ft.y;B+=e+(r[o-1].B.y+r[o-1].ft.y+2*r[o-1].focus.y-e)/2-t.focus.y-m/2}break;case 22:n?(R-=m,b+=m):(B-=m,v+=m);break;case 23:n?(R+=b-t.width+m,b+=m):(B+=v-t.height+m,v+=m);break;case 24:n?o>1?R+=F+f/2-t.focus.x:R+=r[0].focus.x-t.focus.x+r[0].ft.x:o>1?B+=F+f/2-t.focus.y:B+=r[0].focus.y-t.focus.y+r[0].ft.y;break;case 26:n?R+=b+f/2-t.focus.x:B+=v+f/2-t.focus.y;break;case 27:break;case 28:let E=this.customAlignment(t,R,B,b,v);R=E[0],B=E[1],b=E[2],v=E[3]}for(let t=0;t<o;t++){let e=r[t];n?e.B.i(e.B.x+e.ft.x-R,e.B.y+(s>135?(d?-v:-e.yt.height)+e.ft.y-g:w+g+e.ft.y)):e.B.i(e.B.x+(s>135?(d?-b:-e.yt.width)+e.ft.x-g:x+g+e.ft.x),e.B.y+e.ft.y-B)}let I=0,V=0;if(d)n?(b=this._N(t,b,R),R<0&&(R=0),s>135&&(B+=v+g),v+=w+g,27===h&&(I+=f/2+t.focus.x),V+=w+g):(s>135&&(R+=b+g),b+=x+g,v=this.tC(t,v,B),B<0&&(B=0),27===h&&(V+=f/2+t.focus.y),I+=x+g);else if(n){if(null===t.comments){if(x>b){let t=this.iC(h,x-b,0);I=t.x,V=t.y,b=x,R=0}}else b=this._N(t,b,R);R<0&&(I-=R,R=0),s>135&&(B+=v+g),v=Math.max(Math.max(v,w),v+w+g),V+=w+g}else{if(s>135&&(R+=b+g),b=Math.max(Math.max(b,x),b+x+g),null===t.comments){if(w>v){let t=this.iC(h,0,w-v);I=t.x,V=t.y,v=w,B=0}}else v=this.tC(t,v,B);B<0&&(V-=B,B=0),I+=x+g}if(T>0)e=this.ue(4),i=this.ue(4),n?(e[2].i(0,w+g),e[3].i(e[2].x,v),i[2].i(b,e[2].y),i[3].i(i[2].x,e[3].y)):(e[2].i(x+g,0),e[3].i(b,e[2].y),i[2].i(e[2].x,v),i[3].i(e[3].x,i[2].y));else{e=this.ue(P.length+2),i=this.ue(S.length+2);for(let t=0;t<P.length;t++){let i=P[t];e[t+2].i(i.x+I,i.y+V)}for(let t=0;t<S.length;t++){let e=S[t];i[t+2].i(e.x+I,e.y+V)}}n?(e[0].i(R,0),e[1].i(e[0].x,w),e[2].y<e[1].y&&(e[2].x>e[0].x?e[2].a(e[1]):e[1].a(e[2])),e[3].y<e[2].y&&(e[3].x>e[0].x?e[3].a(e[2]):e[2].a(e[3])),i[0].i(R+x,0),i[1].i(i[0].x,w),i[2].y<i[1].y&&(i[2].x<i[0].x?i[2].a(i[1]):i[1].a(i[2])),i[3].y<i[2].y&&(i[3].x<i[0].x?i[3].a(i[2]):i[2].a(i[3])),e[2].y-=g/2,i[2].y-=g/2):(e[0].i(0,B),e[1].i(x,e[0].y),e[2].x<e[1].x&&(e[2].y>e[0].y?e[2].a(e[1]):e[1].a(e[2])),e[3].x<e[2].x&&(e[3].y>e[0].y?e[3].a(e[2]):e[2].a(e[3])),i[0].i(0,B+w),i[1].i(x,i[0].y),i[2].x<i[1].x&&(i[2].y<i[0].y?i[2].a(i[1]):i[1].a(i[2])),i[3].x<i[2].x&&(i[3].y<i[0].y?i[3].a(i[2]):i[2].a(i[3])),e[2].x-=g/2,i[2].x-=g/2),this.on(P),this.on(S),t.Fg=e,t.Rg=i,t.ft.i(R,B),t.yt.i(b,v)}dk(t,e,i){for(let s=0;s<t.length;s++){let n=t[s];n.x+=e,n.y+=i}}BD(t,e,i,s,n,l,r){let o=this.orthoAngle(t),h=90===o||270===o,a=t.nodeSpacing,u=i,d=s,c=n,g=l,f=e.Fg,m=e.Rg,p=e.yt,y=h?Math.max(g,p.height):Math.max(c,p.width);if((null===f||o!==this.orthoAngle(e))&&(f=this.ue(2),m=this.ue(2),h?(f[0].i(0,0),f[1].i(0,p.height),m[0].i(p.width,0),m[1].i(m[0].x,f[1].y)):(f[0].i(0,0),f[1].i(p.width,0),m[0].i(0,p.height),m[1].i(f[1].x,m[0].y))),h){let t=c-this.JI(d,f,c);return t+=a,i=this.$I(u,f,t),s=this.ZI(d,m,t),n=Math.max(0,t)+p.width,l=y,this.on(u),this.on(f),this.on(d),this.on(m),r[0]=i,r[1]=s,new tw(t,0,n,l)}{let t=g-this.QI(d,f,g);return t+=a,i=this._I(u,f,t),s=this.tE(d,m,t),n=y,l=Math.max(0,t)+p.height,this.on(u),this.on(f),this.on(d),this.on(m),r[0]=i,r[1]=s,new tw(t,0,n,l)}}_I(t,e,i){if(null===t||t.length<2||null===e||e.length<2)return null;let s=this.ue(t.length+e.length),n=0,l=0,r=0;for(;l<e.length&&e[l].x<t[0].x;){let t=e[l++];s[r++].i(t.x,t.y+i)}for(;n<t.length;){let e=t[n++];s[r++].i(e.x,e.y)}let o=t[t.length-1].x;for(;l<e.length&&e[l].x<=o;)l++;for(;l<e.length&&e[l].x>o;){let t=e[l++];s[r++].i(t.x,t.y+i)}let h=this.ue(r);for(n=0;n<r;n++)h[n].a(s[n]);return this.on(s),h}$I(t,e,i){if(null===t||t.length<2||null===e||e.length<2)return null;let s=this.ue(t.length+e.length),n=0,l=0,r=0;for(;l<e.length&&e[l].y<t[0].y;){let t=e[l++];s[r++].i(t.x+i,t.y)}for(;n<t.length;){let e=t[n++];s[r++].i(e.x,e.y)}let o=t[t.length-1].y;for(;l<e.length&&e[l].y<=o;)l++;for(;l<e.length&&e[l].y>o;){let t=e[l++];s[r++].i(t.x+i,t.y)}let h=this.ue(r);for(n=0;n<r;n++)h[n].a(s[n]);return this.on(s),h}tE(t,e,i){if(null===t||t.length<2||null===e||e.length<2)return null;let s=this.ue(t.length+e.length),n=0,l=0,r=0;for(;n<t.length&&t[n].x<e[0].x;){let e=t[n++];s[r++].i(e.x,e.y)}for(;l<e.length;){let t=e[l++];s[r++].i(t.x,t.y+i)}let o=e[e.length-1].x;for(;n<t.length&&t[n].x<=o;)n++;for(;n<t.length&&t[n].x>o;){let e=t[n++];s[r++].i(e.x,e.y)}let h=this.ue(r);for(n=0;n<r;n++)h[n].a(s[n]);return this.on(s),h}ZI(t,e,i){if(null===t||t.length<2||null===e||e.length<2)return null;let s=this.ue(t.length+e.length),n=0,l=0,r=0;for(;n<t.length&&t[n].y<e[0].y;){let e=t[n++];s[r++].i(e.x,e.y)}for(;l<e.length;){let t=e[l++];s[r++].i(t.x+i,t.y)}let o=e[e.length-1].y;for(;n<t.length&&t[n].y<=o;)n++;for(;n<t.length&&t[n].y>o;){let e=t[n++];s[r++].i(e.x,e.y)}let h=this.ue(r);for(n=0;n<r;n++)h[n].a(s[n]);return this.on(s),h}QI(t,e,i){let s=9999999;if(null===t||t.length<2||null===e||e.length<2)return s;let n=0,l=0;for(;n<t.length&&l<e.length;){let r=t[n],o=e[l],h=o.x,a=o.y;a+=i;let u=r;n+1<t.length&&(u=t[n+1]);let d=o,c=d.x,g=d.y;l+1<e.length&&(c=(d=e[l+1]).x,g=d.y+i);let f=s;r.x===h?f=a-r.y:r.x>h&&r.x<c?f=a+(r.x-h)/(c-h)*(g-a)-r.y:h>r.x&&h<u.x&&(f=a-(r.y+(h-r.x)/(u.x-r.x)*(u.y-r.y))),f<s&&(s=f),u.x<=r.x?n++:c<=h?l++:(u.x<=c&&n++,c<=u.x&&l++)}return s}JI(t,e,i){let s=9999999;if(null===t||t.length<2||null===e||e.length<2)return s;let n=0,l=0;for(;n<t.length&&l<e.length;){let r=t[n],o=e[l],h=o.x,a=o.y;h+=i;let u=r;n+1<t.length&&(u=t[n+1]);let d=o,c=d.x,g=d.y;l+1<e.length&&(c=(d=e[l+1]).x,g=d.y,c+=i);let f=s;r.y===a?f=h-r.x:r.y>a&&r.y<g?f=h+(r.y-a)/(g-a)*(c-h)-r.x:a>r.y&&a<u.y&&(f=h-(r.x+(a-r.y)/(u.y-r.y)*(u.x-r.x))),f<s&&(s=f),u.y<=r.y?n++:g<=a?l++:(u.y<=g&&n++,g<=u.y&&l++)}return s}ue(t){let e=this.ck[t];if(void 0!==e){let t=e.pop();if(void 0!==t)return t}let i=[];for(let e=0;e<t;e++)i[e]=new ty;return i}on(t){if(!t)return;let e=t.length,i=this.ck[e];void 0===i&&(i=[],this.ck[e]=i),i.push(t)}arrangeTrees(){if(52===this.Gi){let t=this.Oi.iterator;for(;t.next();){let e=t.value;if(!(e instanceof sh))continue;let i=e.node;if(null===i)continue;let s=i.position,n=s.x,l=s.y;isFinite(n)||(n=0),isFinite(l)||(l=0),this.eC(e,n,l)}}else{let t=[],e=this.Oi.iterator;for(;e.next();){let i=e.value;i instanceof sh&&t.push(i)}switch(this.sorting){default:case 10:break;case 11:t.reverse();break;case 12:t.sort(this.comparer);break;case 13:t.sort(this.comparer),t.reverse()}let i=this.arrangementOrigin,s=i.x,n=i.y;for(let e=0;e<t.length;e++){let i=t[e];(this.eC(i,s+i.ft.x,n+i.ft.y),50===this.Gi)?n+=i.yt.height+this.Ls.height:s+=i.yt.width+this.Ls.width}}}eC(t,e,i){if(null===t)return;t.x=e,t.y=i;let s=t.children,n=s.length;for(let t=0;t<n;t++){let n=s[t];this.eC(n,e+n.B.x,i+n.B.y)}}commitLayout(){this.zy(),this.commitNodes(),this.JN(),this.isRouting&&this.commitLinks()}commitNodes(){let t=this.network.vertexes.iterator;for(;t.next();)t.value.commit();for(t.reset();t.next();){let e=t.value;this.layoutComments(e)}}JN(){let t;if(62!==this.layerStyle)return;let e=this.$N,i=[],s=null,n=this.network.vertexes.iterator;for(;n.next();){let t=n.value;null===s?s=t.bounds.copy():s.unionRect(t.bounds);let e=i[t.level];e=void 0===e?this.computeLayerSpacing(t):Math.max(e,this.computeLayerSpacing(t)),i[t.level]=e}for(let t=0;t<i.length;t++)void 0===i[t]&&(i[t]=0);90===this.angle||270===this.angle?(s.inflate(this.nodeSpacing/2,this.layerSpacing),t=new ty(-this.nodeSpacing/2,-this.layerSpacing/2)):(s.inflate(this.layerSpacing,this.nodeSpacing/2),t=new ty(-this.layerSpacing/2,-this.nodeSpacing/2));let l=[],r=90===this.angle||270===this.angle?s.width:s.height,o=0;if(180===this.angle||270===this.angle)for(let t=0;t<e.length;t++)o+=e[t]+i[t];for(let t=0;t<e.length;t++){let s=e[t]+i[t];270===this.angle?(o-=s,l.push(new tw(0,o,r,s))):90===this.angle?(l.push(new tw(0,o,r,s)),o+=s):180===this.angle?(o-=s,l.push(new tw(o,0,s,r))):(l.push(new tw(o,0,s,r)),o+=s)}this.commitLayers(l,t)}commitLayers(t,e){}commitLinks(){let t=this.network.edges.iterator;for(;t.next();)t.value.commit()}zy(){let t=this.Oi.iterator;for(;t.next();){let e=t.value;e instanceof sh&&this.UD(e)}}UD(t){if(null===t)return;this.setPortSpots(t);let e=t.children,i=e.length;for(let t=0;t<i;t++){let i=e[t];this.UD(i)}}setPortSpots(t){let e=t.alignment;if(this.isBusAlignment(e))this.iE(t,e);else{let e=this.orthoAngle(t);if(1===this.cs){let i=t.destinationEdges;for(;i.next();){let s=i.value.link;if(null!==s){if(t.setsPortSpot){if(t.portSpot.isDefault())switch(e){case 0:s.fromSpot=tv.MiddleRight;break;case 90:s.fromSpot=tv.MiddleBottom;break;case 180:s.fromSpot=tv.MiddleLeft;break;default:s.fromSpot=tv.MiddleTop}else s.fromSpot=t.portSpot}if(t.setsChildPortSpot){if(t.childPortSpot.isDefault())switch(e){case 0:s.toSpot=tv.MiddleLeft;break;case 90:s.toSpot=tv.MiddleTop;break;case 180:s.toSpot=tv.MiddleRight;break;default:s.toSpot=tv.MiddleBottom}else s.toSpot=t.childPortSpot}}}}else{let i=t.sourceEdges;for(;i.next();){let s=i.value.link;if(null!==s){if(t.setsPortSpot){if(t.portSpot.isDefault())switch(e){case 0:s.toSpot=tv.MiddleRight;break;case 90:s.toSpot=tv.MiddleBottom;break;case 180:s.toSpot=tv.MiddleLeft;break;default:s.toSpot=tv.MiddleTop}else s.toSpot=t.portSpot}if(t.setsChildPortSpot){if(t.childPortSpot.isDefault())switch(e){case 0:s.fromSpot=tv.MiddleLeft;break;case 90:s.fromSpot=tv.MiddleTop;break;case 180:s.fromSpot=tv.MiddleRight;break;default:s.fromSpot=tv.MiddleBottom}else s.fromSpot=t.childPortSpot}}}}}}iE(t,e){let i;let s=1===this.cs,n=this.orthoAngle(t);switch(n){case 0:i=tv.MiddleRight;break;case 90:i=tv.MiddleBottom;break;case 180:i=tv.MiddleLeft;break;default:i=tv.MiddleTop}let l=t.children,r=l.length;switch(e){case 24:case 25:for(let e=0;e<r;e++){let o=l[e],h=(s?o.sourceEdges:o.destinationEdges).first();if(null===h)continue;let a=h.link;if(null!==a){let l=90===n||270===n?tv.MiddleLeft:tv.MiddleTop;if(1===r||e===r-1&&r%2==1)switch(n){case 0:l=tv.MiddleLeft;break;case 90:l=tv.MiddleTop;break;case 180:l=tv.MiddleRight;break;default:l=tv.MiddleBottom}else e%2==0&&(l=90===n||270===n?tv.MiddleRight:tv.MiddleBottom);s?(t.setsPortSpot&&(a.fromSpot=i),t.setsChildPortSpot&&(a.toSpot=l)):(t.setsPortSpot&&(a.fromSpot=l),t.setsChildPortSpot&&(a.toSpot=i))}}break;case 26:{let e=90===n||270===n?tv.MiddleRight:tv.MiddleBottom,l=s?t.destinationEdges:t.sourceEdges;for(;l.next();){let n=l.value.link;null!==n&&(s?(t.setsPortSpot&&(n.fromSpot=i),t.setsChildPortSpot&&(n.toSpot=e)):(t.setsPortSpot&&(n.fromSpot=e),t.setsChildPortSpot&&(n.toSpot=i)))}break}case 27:{let e=90===n||270===n?tv.MiddleLeft:tv.MiddleTop,l=s?t.destinationEdges:t.sourceEdges;for(;l.next();){let n=l.value.link;null!==n&&(s?(t.setsPortSpot&&(n.fromSpot=i),t.setsChildPortSpot&&(n.toSpot=e)):(t.setsPortSpot&&(n.fromSpot=e),t.setsChildPortSpot&&(n.toSpot=i)))}}}}orthoAngle(t){let e=t.angle;return e<=45?0:e<=135?90:e<=225?180:270*(e<=315)}computeLayerSpacing(t){let e=this.orthoAngle(t),i=90===e||270===e,s=t.layerSpacing;if(t.layerSpacingParentOverlap>0){let e=Math.min(1,t.layerSpacingParentOverlap);s-=i?t.height*e:t.width*e}return s<(i?-t.height:-t.width)&&(s=i?-t.height:-t.width),s}computeNodeIndent(t){let e=this.orthoAngle(t),i=t.nodeIndent;if(t.nodeIndentPastParent>0){let s=Math.min(1,t.nodeIndentPastParent);i+=90===e||270===e?t.width*s:t.height*s}return Math.max(0,i)}get roots(){return this.Oi}set roots(t){this.Oi!==t&&(this.Oi=t,this.invalidateLayout())}get path(){return this.Di}set path(t){this.Di!==t&&(this.Di=t,this.invalidateLayout())}get treeStyle(){return this.ou}set treeStyle(t){this.ou!==t&&(40===t||42===t||41===t||43===t)&&(this.ou=t,this.invalidateLayout())}get layerStyle(){return this.Dg}set layerStyle(t){this.Dg!==t&&(60===t||61===t||62===t)&&(this.Dg=t,this.invalidateLayout())}get comments(){return this.Oe}set comments(t){this.Oe!==t&&(te.s(t,"boolean",sr,"comments"),this.Oe=t,this.invalidateLayout())}get arrangement(){return this.Gi}set arrangement(t){this.Gi!==t&&(50===t||51===t||52===t)&&(this.Gi=t,this.invalidateLayout())}get arrangementSpacing(){return this.Ls}set arrangementSpacing(t){this.Ls.equals(t)||(this.Ls.a(t),this.invalidateLayout())}get rootDefaults(){return this.V}set rootDefaults(t){this.V!==t&&(this.V=t,this.invalidateLayout())}get alternateDefaults(){return this.z}set alternateDefaults(t){this.z!==t&&(this.z=t,this.invalidateLayout())}get sorting(){return this.V.sorting}set sorting(t){this.V.sorting!==t&&(this.V.sorting=t,this.invalidateLayout())}get comparer(){return this.V.comparer}set comparer(t){this.V.comparer!==t&&(te.S(t,sr,"comparer"),this.V.comparer=t,this.invalidateLayout())}get angle(){return this.V.angle}set angle(t){this.V.angle!==t&&(te.s(t,"number",sr,"angle"),0===t||90===t||180===t||270===t?(this.V.angle=t,this.invalidateLayout()):te.o("TreeLayout.angle must be 0, 90, 180, or 270"))}get alignment(){return this.V.alignment}set alignment(t){this.V.alignment!==t&&(this.V.alignment=t,this.invalidateLayout())}get nodeIndent(){return this.V.nodeIndent}set nodeIndent(t){this.V.nodeIndent!==t&&(te.s(t,"number",sr,"nodeIndent"),t>=0&&(this.V.nodeIndent=t,this.invalidateLayout()))}get nodeIndentPastParent(){return this.V.nodeIndentPastParent}set nodeIndentPastParent(t){this.V.nodeIndentPastParent!==t&&(te.s(t,"number",sr,"nodeIndentPastParent"),t>=0&&t<=1&&(this.V.nodeIndentPastParent=t,this.invalidateLayout()))}get nodeSpacing(){return this.V.nodeSpacing}set nodeSpacing(t){this.V.nodeSpacing!==t&&(te.s(t,"number",sr,"nodeSpacing"),this.V.nodeSpacing=t,this.invalidateLayout())}get layerSpacing(){return this.V.layerSpacing}set layerSpacing(t){this.V.layerSpacing!==t&&(te.s(t,"number",sr,"layerSpacing"),this.V.layerSpacing=t,this.invalidateLayout())}get layerSpacingParentOverlap(){return this.V.layerSpacingParentOverlap}set layerSpacingParentOverlap(t){this.V.layerSpacingParentOverlap!==t&&(te.s(t,"number",sr,"layerSpacingParentOverlap"),t>=0&&t<=1&&(this.V.layerSpacingParentOverlap=t,this.invalidateLayout()))}get compaction(){return this.V.compaction}set compaction(t){this.V.compaction!==t&&(30===t||31===t)&&(this.V.compaction=t,this.invalidateLayout())}get breadthLimit(){return this.V.breadthLimit}set breadthLimit(t){this.V.breadthLimit!==t&&(te.s(t,"number",sr,"breadthLimit"),t>=0&&(this.V.breadthLimit=t,this.invalidateLayout()))}get rowSpacing(){return this.V.rowSpacing}set rowSpacing(t){this.V.rowSpacing!==t&&(te.s(t,"number",sr,"rowSpacing"),this.V.rowSpacing=t,this.invalidateLayout())}get rowIndent(){return this.V.rowIndent}set rowIndent(t){this.V.rowIndent!==t&&(te.s(t,"number",sr,"rowIndent"),t>=0&&(this.V.rowIndent=t,this.invalidateLayout()))}get commentSpacing(){return this.V.commentSpacing}set commentSpacing(t){this.V.commentSpacing!==t&&(te.s(t,"number",sr,"commentSpacing"),this.V.commentSpacing=t,this.invalidateLayout())}get commentMargin(){return this.V.commentMargin}set commentMargin(t){this.V.commentMargin!==t&&(te.s(t,"number",sr,"commentMargin"),this.V.commentMargin=t,this.invalidateLayout())}get setsPortSpot(){return this.V.setsPortSpot}set setsPortSpot(t){this.V.setsPortSpot!==t&&(te.s(t,"boolean",sr,"setsPortSpot"),this.V.setsPortSpot=t,this.invalidateLayout())}get portSpot(){return this.V.portSpot}set portSpot(t){this.V.portSpot.equals(t)||(this.V.portSpot=t,this.invalidateLayout())}get setsChildPortSpot(){return this.V.setsChildPortSpot}set setsChildPortSpot(t){this.V.setsChildPortSpot!==t&&(te.s(t,"boolean",sr,"setsChildPortSpot"),this.V.setsChildPortSpot=t,this.invalidateLayout())}get childPortSpot(){return this.V.childPortSpot}set childPortSpot(t){this.V.childPortSpot.equals(t)||(this.V.childPortSpot=t,this.invalidateLayout())}get alternateSorting(){return this.z.sorting}set alternateSorting(t){this.z.sorting!==t&&(this.z.sorting=t,this.invalidateLayout())}get alternateComparer(){return this.z.comparer}set alternateComparer(t){this.z.comparer!==t&&(te.S(t,sr,"alternateComparer"),this.z.comparer=t,this.invalidateLayout())}get alternateAngle(){return this.z.angle}set alternateAngle(t){this.z.angle!==t&&(te.s(t,"number",sr,"alternateAngle"),(0===t||90===t||180===t||270===t)&&(this.z.angle=t,this.invalidateLayout()))}get alternateAlignment(){return this.z.alignment}set alternateAlignment(t){this.z.alignment!==t&&(this.z.alignment=t,this.invalidateLayout())}get alternateNodeIndent(){return this.z.nodeIndent}set alternateNodeIndent(t){this.z.nodeIndent!==t&&(te.s(t,"number",sr,"alternateNodeIndent"),t>=0&&(this.z.nodeIndent=t,this.invalidateLayout()))}get alternateNodeIndentPastParent(){return this.z.nodeIndentPastParent}set alternateNodeIndentPastParent(t){this.z.nodeIndentPastParent!==t&&(te.s(t,"number",sr,"alternateNodeIndentPastParent"),t>=0&&t<=1&&(this.z.nodeIndentPastParent=t,this.invalidateLayout()))}get alternateNodeSpacing(){return this.z.nodeSpacing}set alternateNodeSpacing(t){this.z.nodeSpacing!==t&&(te.s(t,"number",sr,"alternateNodeSpacing"),this.z.nodeSpacing=t,this.invalidateLayout())}get alternateLayerSpacing(){return this.z.layerSpacing}set alternateLayerSpacing(t){this.z.layerSpacing!==t&&(te.s(t,"number",sr,"alternateLayerSpacing"),this.z.layerSpacing=t,this.invalidateLayout())}get alternateLayerSpacingParentOverlap(){return this.z.layerSpacingParentOverlap}set alternateLayerSpacingParentOverlap(t){this.z.layerSpacingParentOverlap!==t&&(te.s(t,"number",sr,"alternateLayerSpacingParentOverlap"),t>=0&&t<=1&&(this.z.layerSpacingParentOverlap=t,this.invalidateLayout()))}get alternateCompaction(){return this.z.compaction}set alternateCompaction(t){this.z.compaction!==t&&(30===t||31===t)&&(this.z.compaction=t,this.invalidateLayout())}get alternateBreadthLimit(){return this.z.breadthLimit}set alternateBreadthLimit(t){this.z.breadthLimit!==t&&(te.s(t,"number",sr,"alternateBreadthLimit"),t>=0&&(this.z.breadthLimit=t,this.invalidateLayout()))}get alternateRowSpacing(){return this.z.rowSpacing}set alternateRowSpacing(t){this.z.rowSpacing!==t&&(te.s(t,"number",sr,"alternateRowSpacing"),this.z.rowSpacing=t,this.invalidateLayout())}get alternateRowIndent(){return this.z.rowIndent}set alternateRowIndent(t){this.z.rowIndent!==t&&(te.s(t,"number",sr,"alternateRowIndent"),t>=0&&(this.z.rowIndent=t,this.invalidateLayout()))}get alternateCommentSpacing(){return this.z.commentSpacing}set alternateCommentSpacing(t){this.z.commentSpacing!==t&&(te.s(t,"number",sr,"alternateCommentSpacing"),this.z.commentSpacing=t,this.invalidateLayout())}get alternateCommentMargin(){return this.z.commentMargin}set alternateCommentMargin(t){this.z.commentMargin!==t&&(te.s(t,"number",sr,"alternateCommentMargin"),this.z.commentMargin=t,this.invalidateLayout())}get alternateSetsPortSpot(){return this.z.setsPortSpot}set alternateSetsPortSpot(t){this.z.setsPortSpot!==t&&(te.s(t,"boolean",sr,"alternateSetsPortSpot"),this.z.setsPortSpot=t,this.invalidateLayout())}get alternatePortSpot(){return this.z.portSpot}set alternatePortSpot(t){this.z.portSpot.equals(t)||(this.z.portSpot=t,this.invalidateLayout())}get alternateSetsChildPortSpot(){return this.z.setsChildPortSpot}set alternateSetsChildPortSpot(t){this.z.setsChildPortSpot!==t&&(te.s(t,"boolean",sr,"alternateSetsChildPortSpot"),this.z.setsChildPortSpot=t,this.invalidateLayout())}get alternateChildPortSpot(){return this.z.childPortSpot}set alternateChildPortSpot(t){this.z.childPortSpot.equals(t)||(this.z.childPortSpot=t,this.invalidateLayout())}static PathDefault=0;static PathDestination=1;static PathSource=2;static SortingForwards=10;static SortingReverse=11;static SortingAscending=12;static SortingDescending=13;static AlignmentCenterSubtrees=20;static AlignmentCenterChildren=21;static AlignmentStart=22;static AlignmentEnd=23;static AlignmentBus=24;static AlignmentBusBranching=25;static AlignmentTopLeftBus=26;static AlignmentBottomRightBus=27;static CompactionNone=30;static CompactionBlock=31;static StyleLayered=40;static StyleLastParents=41;static StyleAlternating=42;static StyleRootOnly=43;static ArrangementVertical=50;static ArrangementHorizontal=51;static ArrangementFixedRoots=52;static LayerIndividual=60;static LayerSiblings=61;static LayerUniform=62}class so extends iP{constructor(t){super(t)}createVertex(){return new sh(this)}createEdge(){return new sa(this)}}class sh extends iS{B;yt;ft;gk;mk;pk;yk;wk;xk;bk;Oe;Fg;Rg;xe;be;Ht;fi;$y;Zy;Qy;As;_y;tw;iw;ew;sw;nw;ow;rw;lw;hw;aw;constructor(t){super(t),this.gk=!1,this.mk=null,this.pk=[],this.yk=0,this.wk=0,this.xk=0,this.bk=0,this.Oe=null,this.B=new ty(0,0),this.yt=new tx(0,0),this.ft=new ty(0,0),this.Fg=null,this.Rg=null,this.xe=10,this.be=iS.standardComparer,this.Ht=0,this.fi=21,this.$y=0,this.Zy=0,this.Qy=20,this.As=50,this._y=0,this.tw=31,this.iw=0,this.ew=25,this.sw=10,this.nw=10,this.ow=20,this.rw=!0,this.lw=tv.Default,this.hw=!0,this.aw=tv.Default}copyInheritedPropertiesFrom(t){null!==t&&(this.xe=t.sorting,this.be=t.comparer,this.Ht=t.angle,this.fi=t.alignment,this.$y=t.nodeIndent,this.Zy=t.nodeIndentPastParent,this.Qy=t.nodeSpacing,this.As=t.layerSpacing,this._y=t.layerSpacingParentOverlap,this.tw=t.compaction,this.iw=t.breadthLimit,this.ew=t.rowSpacing,this.sw=t.rowIndent,this.nw=t.commentSpacing,this.ow=t.commentMargin,this.rw=t.setsPortSpot,this.lw=t.portSpot,this.hw=t.setsChildPortSpot,this.aw=t.childPortSpot)}get initialized(){return this.gk}set initialized(t){this.gk!==t&&(te.s(t,"boolean",sh,"initialized"),this.gk=t)}get parent(){return this.mk}set parent(t){this.mk!==t&&(this.mk=t)}get children(){return this.pk}set children(t){if(this.pk!==t){if(null===t||Array.isArray(t)||te.te(t,"Array",sh,"children:value"),null!==t){let e=t.length;for(let i=0;i<e;i++)t[i]}this.pk=t}}get level(){return this.yk}set level(t){this.yk!==t&&(te.s(t,"number",sh,"level"),this.yk=t)}get descendantCount(){return this.wk}set descendantCount(t){this.wk!==t&&(te.s(t,"number",sh,"descendantCount"),this.wk=t)}get maxChildrenCount(){return this.xk}set maxChildrenCount(t){this.xk!==t&&(te.s(t,"number",sh,"maxChildrenCount"),this.xk=t)}get maxGenerationCount(){return this.bk}set maxGenerationCount(t){this.bk!==t&&(te.s(t,"number",sh,"maxGenerationCount"),this.bk=t)}get comments(){return this.Oe}set comments(t){if(this.Oe!==t){if(null===t||Array.isArray(t)||te.te(t,"Array",sh,"comments:value"),null!==t){let e=t.length;for(let i=0;i<e;i++)t[i]}this.Oe=t}}get sorting(){return this.xe}set sorting(t){this.xe!==t&&(this.xe=t)}get comparer(){return this.be}set comparer(t){this.be!==t&&(te.S(t,sh,"comparer"),this.be=t)}get angle(){return this.Ht}set angle(t){this.Ht!==t&&(te.s(t,"number",sh,"angle"),this.Ht=t)}get alignment(){return this.fi}set alignment(t){this.fi!==t&&(this.fi=t)}get nodeIndent(){return this.$y}set nodeIndent(t){this.$y!==t&&(te.s(t,"number",sh,"nodeIndent"),this.$y=t)}get nodeIndentPastParent(){return this.Zy}set nodeIndentPastParent(t){this.Zy!==t&&(te.s(t,"number",sh,"nodeIndentPastParent"),this.Zy=t)}get nodeSpacing(){return this.Qy}set nodeSpacing(t){this.Qy!==t&&(te.s(t,"number",sh,"nodeSpacing"),this.Qy=t)}get layerSpacing(){return this.As}set layerSpacing(t){this.As!==t&&(te.s(t,"number",sh,"layerSpacing"),this.As=t)}get layerSpacingParentOverlap(){return this._y}set layerSpacingParentOverlap(t){this._y!==t&&(te.s(t,"number",sh,"layerSpacingParentOverlap"),this._y=t)}get compaction(){return this.tw}set compaction(t){this.tw!==t&&(this.tw=t)}get breadthLimit(){return this.iw}set breadthLimit(t){this.iw!==t&&(te.s(t,"number",sh,"breadthLimit"),this.iw=t)}get rowSpacing(){return this.ew}set rowSpacing(t){this.ew!==t&&(te.s(t,"number",sh,"rowSpacing"),this.ew=t)}get rowIndent(){return this.sw}set rowIndent(t){this.sw!==t&&(te.s(t,"number",sh,"rowIndent"),this.sw=t)}get commentSpacing(){return this.nw}set commentSpacing(t){this.nw!==t&&(te.s(t,"number",sh,"commentSpacing"),this.nw=t)}get commentMargin(){return this.ow}set commentMargin(t){this.ow!==t&&(te.s(t,"number",sh,"commentMargin"),this.ow=t)}get setsPortSpot(){return this.rw}set setsPortSpot(t){this.rw!==t&&(te.s(t,"boolean",sh,"setsPortSpot"),this.rw=t)}get portSpot(){return this.lw}set portSpot(t){this.lw.equals(t)||(this.lw=t)}get setsChildPortSpot(){return this.hw}set setsChildPortSpot(t){this.hw!==t&&(te.s(t,"boolean",sh,"setsChildPortSpot"),this.hw=t)}get childPortSpot(){return this.aw}set childPortSpot(t){this.aw.equals(t)||(this.aw=t)}get childrenCount(){return this.children.length}get relativePosition(){return this.B}set relativePosition(t){this.B.set(t)}get subtreeSize(){return this.yt}set subtreeSize(t){this.yt.set(t)}get subtreeOffset(){return this.ft}set subtreeOffset(t){this.ft.set(t)}}class sa extends iM{kk;constructor(t){super(t),this.kk=new ty(0,0)}commit(){let t=this.link;if(null===t||t.isAvoiding)return;let e=this.network.layout,i=null,s=null;switch(e.cs){case 1:i=this.fromVertex,s=this.toVertex;break;case 2:i=this.toVertex,s=this.fromVertex;break;default:te.o("Unhandled path value "+e.cs.toString())}if(null===i||null===s)return;let n=this.kk;if(0===n.x&&0===n.y){this.eE(i,s);return}let l=i.bounds,r=e.orthoAngle(i),o=e.computeLayerSpacing(i),h=i.rowSpacing;t.updateRoute();let a=9===t.curve,u=t.isOrthogonal,d=0,c,g;if(t.startRoute(),u||a){for(d=2;t.pointsCount>4;)t.removePoint(2);c=t.getPoint(1),g=t.getPoint(2)}else{for(d=1;t.pointsCount>3;)t.removePoint(1);c=t.getPoint(0),g=t.getPoint(t.pointsCount-1)}let f=t.getPoint(t.pointsCount-1),m=0;0===r?(23===i.alignment?(m=l.bottom+n.y,0===n.y&&c.y>f.y+i.rowIndent&&(m=Math.min(m,Math.max(c.y,m-e.computeNodeIndent(i))))):22===i.alignment?(m=l.top+n.y,0===n.y&&c.y<f.y-i.rowIndent&&(m=Math.max(m,Math.min(c.y,m+e.computeNodeIndent(i))))):m=l.y+l.height/2+n.y,a?(t.insertPointAt(d,c.x,m),d++,t.insertPointAt(d,l.right+o,m),d++,t.insertPointAt(d,l.right+o+(n.x-h)/3,m),d++,t.insertPointAt(d,l.right+o+(n.x-h)*2/3,m),d++,t.insertPointAt(d,l.right+o+(n.x-h),m),d++,t.insertPointAt(d,g.x,m),d++):(u&&(t.insertPointAt(d,l.right+o/2,c.y),d++),t.insertPointAt(d,l.right+o/2,m),d++,t.insertPointAt(d,l.right+o+n.x-(u?h/2:h),m),d++,u&&(t.insertPointAt(d,t.getPoint(d-1).x,g.y),d++))):90===r?(23===i.alignment?(m=l.right+n.x,0===n.x&&c.x>f.x+i.rowIndent&&(m=Math.min(m,Math.max(c.x,m-e.computeNodeIndent(i))))):22===i.alignment?(m=l.left+n.x,0===n.x&&c.x<f.x-i.rowIndent&&(m=Math.max(m,Math.min(c.x,m+e.computeNodeIndent(i))))):m=l.x+l.width/2+n.x,a?(t.insertPointAt(d,m,c.y),d++,t.insertPointAt(d,m,l.bottom+o),d++,t.insertPointAt(d,m,l.bottom+o+(n.y-h)/3),d++,t.insertPointAt(d,m,l.bottom+o+(n.y-h)*2/3),d++,t.insertPointAt(d,m,l.bottom+o+(n.y-h)),d++,t.insertPointAt(d,m,g.y),d++):(u&&(t.insertPointAt(d,c.x,l.bottom+o/2),d++),t.insertPointAt(d,m,l.bottom+o/2),d++,t.insertPointAt(d,m,l.bottom+o+n.y-(u?h/2:h)),d++,u&&(t.insertPointAt(d,g.x,t.getPoint(d-1).y),d++))):180===r?(23===i.alignment?(m=l.bottom+n.y,0===n.y&&c.y>f.y+i.rowIndent&&(m=Math.min(m,Math.max(c.y,m-e.computeNodeIndent(i))))):22===i.alignment?(m=l.top+n.y,0===n.y&&c.y<f.y-i.rowIndent&&(m=Math.max(m,Math.min(c.y,m+e.computeNodeIndent(i))))):m=l.y+l.height/2+n.y,a?(t.insertPointAt(d,c.x,m),d++,t.insertPointAt(d,l.left-o,m),d++,t.insertPointAt(d,l.left-o+(n.x+h)/3,m),d++,t.insertPointAt(d,l.left-o+(n.x+h)*2/3,m),d++,t.insertPointAt(d,l.left-o+(n.x+h),m),d++,t.insertPointAt(d,g.x,m),d++):(u&&(t.insertPointAt(d,l.left-o/2,c.y),d++),t.insertPointAt(d,l.left-o/2,m),d++,t.insertPointAt(d,l.left-o+n.x+(u?h/2:h),m),d++,u&&(t.insertPointAt(d,t.getPoint(d-1).x,g.y),d++))):270===r?(23===i.alignment?(m=l.right+n.x,0===n.x&&c.x>f.x+i.rowIndent&&(m=Math.min(m,Math.max(c.x,m-e.computeNodeIndent(i))))):22===i.alignment?(m=l.left+n.x,0===n.x&&c.x<f.x-i.rowIndent&&(m=Math.max(m,Math.min(c.x,m+e.computeNodeIndent(i))))):m=l.x+l.width/2+n.x,a?(t.insertPointAt(d,m,c.y),d++,t.insertPointAt(d,m,l.top-o),d++,t.insertPointAt(d,m,l.top-o+(n.y+h)/3),d++,t.insertPointAt(d,m,l.top-o+(n.y+h)*2/3),d++,t.insertPointAt(d,m,l.top-o+(n.y+h)),d++,t.insertPointAt(d,m,g.y),d++):(u&&(t.insertPointAt(d,c.x,l.top-o/2),d++),t.insertPointAt(d,m,l.top-o/2),d++,t.insertPointAt(d,m,l.top-o+n.y+(u?h/2:h)),d++,u&&(t.insertPointAt(d,g.x,t.getPoint(d-1).y),d++))):te.o("Invalid angle "+r),t.commitRoute()}eE(t,e){let i=this.link;if(null===i)return;let s=this.network.layout,n=s.orthoAngle(t);if(n===s.orthoAngle(e))return;let l=s.computeLayerSpacing(t),r=t.bounds,o=e.bounds;if(0===n&&o.left-r.right<l+1||90===n&&o.top-r.bottom<l+1||180===n&&r.left-o.right<l+1||270===n&&r.top-o.bottom<l+1)return;i.updateRoute();let h=9===i.curve,a=i.isOrthogonal,u=this.fromVertex,d=s.isBusAlignment(u.alignment);if(i.startRoute(),0===n){let t=r.right+l/2;if(h){if(4===i.pointsCount){let e=i.getPoint(3).y;i.setPointAt(1,t-20,i.getPoint(1).y),i.insertPointAt(2,t-20,e),i.insertPointAt(3,t,e),i.insertPointAt(4,t+20,e),i.setPointAt(5,i.getPoint(5).x,e)}}else a?d?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):6===i.pointsCount&&(i.setPointAt(2,t,i.getPoint(2).y),i.setPointAt(3,t,i.getPoint(3).y)):4===i.pointsCount?i.insertPointAt(2,t,i.getPoint(2).y):3===i.pointsCount?i.setPointAt(1,t,i.getPoint(2).y):2===i.pointsCount&&i.insertPointAt(1,t,i.getPoint(1).y)}else if(90===n){let t=r.bottom+l/2;if(h){if(4===i.pointsCount){let e=i.getPoint(3).x;i.setPointAt(1,i.getPoint(1).x,t-20),i.insertPointAt(2,e,t-20),i.insertPointAt(3,e,t),i.insertPointAt(4,e,t+20),i.setPointAt(5,e,i.getPoint(5).y)}}else a?d?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):6===i.pointsCount&&(i.setPointAt(2,i.getPoint(2).x,t),i.setPointAt(3,i.getPoint(3).x,t)):4===i.pointsCount?i.insertPointAt(2,i.getPoint(2).x,t):3===i.pointsCount?i.setPointAt(1,i.getPoint(2).x,t):2===i.pointsCount&&i.insertPointAt(1,i.getPoint(1).x,t)}else if(180===n){let t=r.left-l/2;if(h){if(4===i.pointsCount){let e=i.getPoint(3).y;i.setPointAt(1,t+20,i.getPoint(1).y),i.insertPointAt(2,t+20,e),i.insertPointAt(3,t,e),i.insertPointAt(4,t-20,e),i.setPointAt(5,i.getPoint(5).x,e)}}else a?d?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):6===i.pointsCount&&(i.setPointAt(2,t,i.getPoint(2).y),i.setPointAt(3,t,i.getPoint(3).y)):4===i.pointsCount?i.insertPointAt(2,t,i.getPoint(2).y):3===i.pointsCount?i.setPointAt(1,t,i.getPoint(2).y):2===i.pointsCount&&i.insertPointAt(1,t,i.getPoint(1).y)}else if(270===n){let t=r.top-l/2;if(h){if(4===i.pointsCount){let e=i.getPoint(3).x;i.setPointAt(1,i.getPoint(1).x,t+20),i.insertPointAt(2,e,t+20),i.insertPointAt(3,e,t),i.insertPointAt(4,e,t-20),i.setPointAt(5,e,i.getPoint(5).y)}}else a?d?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):6===i.pointsCount&&(i.setPointAt(2,i.getPoint(2).x,t),i.setPointAt(3,i.getPoint(3).x,t)):4===i.pointsCount?i.insertPointAt(2,i.getPoint(2).x,t):3===i.pointsCount?i.setPointAt(1,i.getPoint(2).x,t):2===i.pointsCount&&i.insertPointAt(1,i.getPoint(1).x,t)}i.commitRoute()}get fromVertex(){return this.Je}set fromVertex(t){this.Je!==t&&(this.Je=t)}get toVertex(){return this.$e}set toVertex(t){this.$e!==t&&(this.$e=t)}get relativePoint(){return this.kk}set relativePoint(t){this.kk.set(t)}}class su{constructor(){}static Light={colors:{text:"#0a0a0a",comment:"#ca8a04",link:"#0a0a0a",group:"#a3a3a344",outline:"#a3a3a3",selection:"#0ea5e9",div:"#fff",gridMinor:"#e5e5e5",gridMajor:"#a3a3a3",overviewBox:"#c026d3",tempLink:"#2563eb",tempPort:"#c026d3",adornmentFill:"#0ea5e9",adornmentStroke:"#1e40af",dragSelect:"#c026d3"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new tb(5)},arrowheads:{toArrow:"Standard"}};static Dark={colors:{text:"#f5f5f5",comment:"#facc15",link:"#f5f5f5",group:"#a3a3a388",outline:"#a3a3a3",selection:"#38bdf8",div:"#171717",gridMinor:"#262626",gridMajor:"#404040",overviewBox:"#e879f9",tempLink:"#60a5fa",tempPort:"#e879f9",adornmentFill:"#38bdf8",adornmentStroke:"#2563eb",dragSelect:"#e879f9"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new tb(5)},arrowheads:{toArrow:"Standard"}}}class sd{ss=new Set;lu=new tp;Pk="light";Sk="light";Mk=!1;vg="light";VD=t=>{let e=t.matches?"dark":"light";e!==this.vg&&(this.vg=e,"system"===this.Sk&&this.cw())};constructor(t){t&&Object.assign(this,t),t?.themeMap||(this.lu.set("light",{colors:{...su.Light.colors},fonts:{...su.Light.fonts},numbers:{...su.Light.numbers},margins:{...su.Light.margins},arrowheads:{...su.Light.arrowheads}}),this.lu.set("dark",{colors:{...su.Dark.colors},fonts:{...su.Dark.fonts},numbers:{...su.Dark.numbers},margins:{...su.Dark.margins},arrowheads:{...su.Dark.arrowheads}})),tt.matchMedia&&(this.vg=tt.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}get themeMap(){return this.lu}set themeMap(t){this.lu!==t&&(this.lu=t,this.cw())}get defaultTheme(){return this.Pk}set defaultTheme(t){this.Pk!==t&&(te.s(t,"string",sd,"defaultTheme"),this.Pk=t,this.cw())}get currentTheme(){return this.Sk}set currentTheme(t){this.Sk!==t&&(te.s(t,"string",sd,"currentTheme"),this.Sk=t,this.cw())}get changesDivBackground(){return this.Mk}set changesDivBackground(t){if(this.Mk!==t&&(this.Mk=t,t))for(let t of this.ss)t.setDivBackground(this.findValue("div","","fill")),t.v("ThemeChanged",this)}get preferredColorScheme(){return this.vg}addDiagram(t){return this.ss.add(t),this.sC(t),this}removeDiagram(t){return this.ss.delete(t),this.sC(t),this}iR(){0===this.ss.size&&tt.matchMedia&&tt.matchMedia("(prefers-color-scheme: dark)")?.addEventListener("change",this.VD)}eR(){0===this.ss.size&&tt.matchMedia&&tt.matchMedia("(prefers-color-scheme: dark)")?.removeEventListener("change",this.VD)}set(t,e){""===t&&(t=this.Pk),"system"===t&&(t=this.vg);let i=this.lu.get(t);return i=i?this.zD(i,e):e,this.lu.set(t,i),this.cw(),this}findValue(t,e,i){return this.getValue(this.findTheme(this.currentTheme),t,e,i)||this.getValue(this.findTheme(this.defaultTheme),t,e,i)}getValue(t,e,i,s){if(!t)return;null==i&&(i="");let n=t,l=t=>{if(void 0===n||""===t)return;if("number"==typeof t||!(Array.isArray(t)||t.includes(".")))return n[t];let e=Array.isArray(t)?t:t.split(".");for(let t=0;t<e.length;t++){let i=e[t];if(""!==i&&void 0===(n=n[i]))return}return n},r=()=>{if(""===i||void 0!==(n=l(i)))return n=Array.isArray(n)&&"number"==typeof e?n[e%n.length]:l(e)};if(void 0===(n=r())&&"string"==typeof s&&s.length>0){let e=t.targetPropertyMap?.get(s);n=e?t[e]:(e=sd.sE.get(s))?t[e]:t.colors,n=r()}return n}findTheme(t){return this.themeMap.get("system"===t?this.vg:t)}sC(t){let e=t.skipsUndoManager;t.skipsUndoManager=!0,t.updateAllThemeBindings(),this.Mk&&t.setDivBackground(this.findValue("div","","fill")),t.skipsUndoManager=e,t.v("ThemeChanged",this)}cw(){for(let t of this.ss)this.sC(t)}zD(t,e){for(let i in e)if(te.fw(e,i))try{e[i].constructor===Object?t[i]=this.zD(t[i]??{},e[i]):t[i]=e[i]}catch{delete t[i]}return t}static sE=new Map([["background","colors"],["defaultColumnSeparatorStroke","colors"],["defaultRowSeparatorStroke","colors"],["shadowColor","colors"],["fill","colors"],["stroke","colors"],["font","fonts"],["angle","numbers"],["fromEndSegmentLength","numbers"],["fromShortLength","numbers"],["height","numbers"],["opacity","numbers"],["scale","numbers"],["toEndSegmentLength","numbers"],["toShortLength","numbers"],["width","numbers"],["defaultColumnSeparatorStrokeWidth","numbers"],["defaultRowSeparatorStrokeWidth","numbers"],["shadowBlur","numbers"],["corner","numbers"],["curviness","numbers"],["smoothness","numbers"],["parameter1","numbers"],["parameter2","numbers"],["strokeWidth","numbers"],["strokeDashOffset","numbers"],["maxLines","numbers"],["spacingAbove","numbers"],["spacingBelow","numbers"],["position","points"],["shadowOffset","points"],["desiredSize","sizes"],["maxSize","sizes"],["minSize","sizes"],["margin","margins"],["defaultSeparatorPadding","margins"],["padding","margins"],["alignment","spots"],["alignmentFocus","spots"],["fromSpot","spots"],["toSpot","spots"],["defaultAlignment","spots"],["spot1","spots"],["spot2","spots"],["verticalAlignment","spots"],["imageAlignment","spots"],["fromArrow","arrowheads"],["toArrow","arrowheads"]])}class sc{Nt;L;Bi;yl;constructor(){this.L=eh.ym(),this.Nt="",this.Bi=!0,this.yl=!0}get name(){return this.Nt}set name(t){this.Nt=t}get isEnabled(){return this.Bi}set isEnabled(t){this.Bi=t}get isRealtime(){return this.yl}set isRealtime(t){this.yl=t}get diagram(){return this.L}set diagram(t){this.L!==t&&(this.L=t,t.Cl=!0,t.requestUpdate())}invalidateRouter(){null!==this.L&&(this.L.Cl=!0,this.L.requestUpdate())}canRoute(t){if(!this.isEnabled)return!1;let e=this.diagram;return!(e&&(!this.isRealtime&&e.xu||e.animationManager.isTicking))}routeLinks(t,e){}toString(){return""!==this.name?this.name+" Router":te.Vn(this.constructor)}}class sg extends sc{constructor(t){super(),this.name="AvoidsNodes",t&&Object.assign(this,t)}canRoute(t){return(t instanceof eh?!!t.Gm:!!t.diagram.Gm)&&super.canRoute(t)}routeLinks(t,e){let i=e instanceof eh?null:e,s=t.iterator,n=this.diagram.getPositions(!0,i,null);for(;s.next();){let t=s.value;if(!t.isAvoiding||t.containingGroup!==i||null===t.toNode||null===t.fromNode||t.pointsCount<4)continue;t.startRoute();let e=t.pointsCount,l=t.getPoint(1),r=t.getPoint(e-2),o=t.fromNode.actualBounds.copy();o.inflate(ic.Ya,ic.Ya),o.unionPoint(t.getPoint(0));let h=t.toNode.actualBounds.copy();h.inflate(ic.Ya,ic.Ya),h.unionPoint(t.getPoint(e-1)),this.nE(t,o,h,n)&&this.oE(t,l,t.rN,r,t.lN,o,h,n),t.commitRoute()}}nE(t,e,i,s){let n=t.diagram,l=t.pointsCount;if(null===n||t.fromNode===t.toNode||t.layer.isTemporary||e.containsPoint(t.getPoint(l-1))&&!t.toNode.isMemberOf(t.fromNode)||i.containsPoint(t.getPoint(0))&&!t.fromNode.isMemberOf(t.toNode)||!t.isOrthogonal)return!1;if(17===t.segmentIndex)return!0;let r=t.getPoint(1),o=t.getPoint(l-2),h=t.getPoint(2);if(!s.isUnoccupied(Math.min(r.x,h.x),Math.min(r.y,h.y),Math.abs(r.x-h.x),Math.abs(r.y-h.y)))return!0;for(let e=2;e<l-3;e++){let i=t.getPoint(e),n=t.getPoint(e+1);if(!s.isUnoccupied(Math.min(i.x,n.x),Math.min(i.y,n.y),Math.abs(i.x-n.x),Math.abs(i.y-n.y)))return!0}let a=t.getPoint(l-3);return!s.isUnoccupied(Math.min(a.x,o.x),Math.min(a.y,o.y),Math.abs(a.x-o.x),Math.abs(a.y-o.y))}oE(t,e,i,s,n,l,r,o){let h=t.diagram,a=e,u=s,d=null,c=null;if(h.isVirtualized){let l=o.bounds.copy(),r=t.getPoint(2),h=t.getPoint(t.pointsCount-3);l.inflate(-o.cellWidth,-o.cellHeight);let a=ty.l();o.Ud(e.x,e.y)||(tP.kl(l.x,l.y,l.x+l.width,l.y+l.height,e.x,e.y,r.x,r.y,a)?(d=e=a.copy(),i=a.directionPoint(r)):tP.kl(l.x,l.y,l.x+l.width,l.y+l.height,r.x,r.y,h.x,h.y,a)?(d=e=a.copy(),i=a.directionPoint(h)):tP.kl(l.x,l.y,l.x+l.width,l.y+l.height,h.x,h.y,s.x,s.y,a)&&(d=e=a.copy(),i=a.directionPoint(s))),o.Ud(s.x,s.y)||(tP.kl(l.x,l.y,l.x+l.width,l.y+l.height,s.x,s.y,h.x,h.y,a)?(c=s=a.copy(),n=h.directionPoint(a)):tP.kl(l.x,l.y,l.x+l.width,l.y+l.height,h.x,h.y,r.x,r.y,a)?(c=s=a.copy(),n=r.directionPoint(a)):tP.kl(l.x,l.y,l.x+l.width,l.y+l.height,r.x,r.y,e.x,e.y,a)&&(c=s=a.copy(),n=e.directionPoint(a))),ty.e(a)}let g=l.copy().unionRect(r);g.inflate(o.cellWidth*o.Jc,o.cellHeight*o.Jc),o.xT(e,i,s,n,g,!0);let f=o.po(s.x,s.y);if(!o.by&&f>=im.Bd&&(o.tA(),g.inflate(o.cellWidth*o.VM,o.cellHeight*o.zM),o.xT(e,i,s,n,g,!1),f=o.po(s.x,s.y)),!o.by&&f<im.Bd&&!o.SO(s.x,s.y)){t.points.removeRange(2,t.pointsCount-3),this.nC(t,o,s.x,s.y,n,!0);let l=t.getPoint(2);if(t.pointsCount<4)0===i||180===i?(l.x=e.x,l.y=s.y):(l.x=s.x,l.y=e.y),t.setPointAt(2,l.x,l.y),t.insertPointAt(3,l.x,l.y);else{let s=t.getPoint(3);if(0===i||180===i){if(tP.f(l.x,s.x)){let n=0===i?Math.max(l.x,e.x):Math.min(l.x,e.x);t.setPointAt(2,n,e.y),t.setPointAt(3,n,s.y)}else tP.f(l.y,s.y)?(Math.abs(e.y-l.y)<=o.cellHeight/2&&(t.setPointAt(2,l.x,e.y),t.setPointAt(3,s.x,e.y)),t.insertPointAt(2,l.x,e.y)):t.setPointAt(2,e.x,l.y)}else if(90===i||270===i){if(tP.f(l.y,s.y)){let n=90===i?Math.max(l.y,e.y):Math.min(l.y,e.y);t.setPointAt(2,e.x,n),t.setPointAt(3,s.x,n)}else tP.f(l.x,s.x)?(Math.abs(e.x-l.x)<=o.cellWidth/2&&(t.setPointAt(2,e.x,l.y),t.setPointAt(3,e.x,s.y)),t.insertPointAt(2,e.x,l.y)):t.setPointAt(2,l.x,e.y)}}if(null!==d){let e=t.getPoint(1),s=t.getPoint(2);e.x!==s.x&&e.y!==s.y?0===i||180===i?t.insertPointAt(2,e.x,s.y):t.insertPointAt(2,s.x,e.y):0===i||180===i?t.insertPointAt(2,a.x,d.y):t.insertPointAt(2,d.x,a.y)}null!==c&&(0===n||180===n?t.insertPointAt(t.pointsCount-2,u.x,c.y):t.insertPointAt(t.pointsCount-2,c.x,u.y))}}nC(t,e,i,s,n,l){let r=e.cellWidth,o=e.cellHeight,h=e.po(i,s),a=i,u=s,d=a,c=u;for(0===n?d+=r:90===n?c+=o:180===n?d-=r:c-=o,t.cN&&h>im.ja&&e.po(d,c)!==h-1&&(e.po(a-r,u)===h-1?(n=180,d=a-r,c=u):e.po(a+r,u)===h-1?(n=0,d=a+r,c=u):e.po(a,u-o)===h-1?(n=270,d=a,c=u-o):e.po(a,u+o)===h-1&&(n=90,d=a,c=u+o));h>im.ja&&e.po(d,c)===h-1;)a=d,u=c,0===n?d+=r:90===n?c+=o:180===n?d-=r:c-=o,h-=1;if(l?h>im.ja&&(180===n||0===n?a=Math.floor(a/r)*r+r/2:(90===n||270===n)&&(u=Math.floor(u/o)*o+o/2)):(a=Math.floor(a/r)*r+r/2,u=Math.floor(u/o)*o+o/2),h>im.ja){let i=n,s=a,l=u;if(0===n?(i=90,l+=o):90===n?(i=180,s-=r):180===n?(i=270,l-=o):270===n&&(i=0,s+=r),e.po(s,l)===h-1)this.nC(t,e,s,l,i,!1);else{let s=a,l=u;0===n?(i=270,l-=o):90===n?(i=0,s+=r):180===n?(i=90,l+=o):270===n&&(i=180,s-=r),e.po(s,l)===h-1&&this.nC(t,e,s,l,i,!1)}}t.insertPointAt(t.pointsCount-2,a,u)}}tz.prototype.initializeStandardTools=function(){this.Qt("Action",new tJ,this.mouseDownTools),this.Qt("Relinking",new tY,this.mouseDownTools),this.Qt("LinkReshaping",new tq,this.mouseDownTools),this.Qt("Rotating",new tW,this.mouseDownTools),this.Qt("Resizing",new tH,this.mouseDownTools),this.Qt("Linking",new tG,this.mouseMoveTools),this.Qt("Dragging",new tK,this.mouseMoveTools),this.Qt("DragSelecting",new t$,this.mouseMoveTools),this.Qt("Panning",new tQ,this.mouseMoveTools),this.Qt("ContextMenu",new t2,this.mouseUpTools),this.Qt("TextEditing",new t8,this.mouseUpTools),this.Qt("ClickCreating",new tZ,this.mouseUpTools),this.Qt("ClickSelecting",new t_,this.mouseUpTools)},eh.xM("GraphLinksModel",iD),eh.xM("TreeModel",iF);let sf=tt.go,sm={get version(){return eh.version},Group:ib,List:th,Set:tu,Map:tp,Point:ty,Size:tx,Rect:tw,Margin:tb,Spot:tv,Geometry:tN,PathFigure:tC,PathSegment:tT,InputEvent:tA,DiagramEvent:tD,ChangedEvent:tO,Model:iE,GraphLinksModel:iI,TreeModel:iV,Binding:iR,ThemeBinding:iB,Transaction:tR,UndoManager:tB,CommandHandler:ep,Tool:tE,DraggingTool:tK,DraggingInfo:eu,DraggingOptions:ec,LinkingBaseTool:tX,LinkingTool:tG,RelinkingTool:tY,LinkReshapingTool:tq,ResizingTool:tH,RotatingTool:tW,ClickSelectingTool:t_,ActionTool:tJ,ClickCreatingTool:tZ,HTMLInfo:t0,ContextMenuTool:t2,DragSelectingTool:t$,PanningTool:tQ,TextEditingTool:t8,ToolManager:tz,Animation:t7,AnimationManager:t9,AnimationTrigger:ei,Layer:es,Diagram:eh,Palette:eg,Overview:ef,Brush:eD,GraphObject:eb,Panel:eq,RowColumnDefinition:eZ,Shape:e$,TextBlock:e3,Picture:e6,Part:ii,Adornment:il,Node:io,Link:ic,Placeholder:iv,Layout:ik,LayoutNetwork:iP,LayoutVertex:iS,LayoutEdge:iM,GridLayout:iT,PanelLayout:eF,CircularLayout:iG,CircularNetwork:iU,CircularVertex:iq,CircularEdge:iH,ForceDirectedLayout:iW,ForceDirectedNetwork:i_,ForceDirectedVertex:iJ,ForceDirectedEdge:iZ,LayeredDigraphLayout:i5,LayeredDigraphNetwork:i8,LayeredDigraphVertex:i6,LayeredDigraphEdge:i9,TreeLayout:sr,TreeNetwork:so,TreeVertex:sh,TreeEdge:sa,Themes:su,ThemeManager:sd,Router:sc,AnimationStyle:t6,AutoScale:en,CycleMode:el,Flip:ew,TextFormat:e2,ImageStretch:e8,LayoutConditions:ie,LinkAdjusting:ia,Curve:id,Routing:iu,Orientation:ex,TextOverflow:e1,PortSpreading:ir,ScrollMode:er,CollapsePolicy:eo,Sizing:eJ,TriggerStart:ee,Stretch:ey,ViewboxStretch:eU,Wrap:e0,BrushType:eL,ColorSpace:eT,GeometryStretch:tM,GeometryType:tS,SegmentType:tL,BindingMode:iO,ChangeType:tF,CircularArrangement:iz,CircularDirection:iK,CircularNodeDiameterFormula:ij,CircularSorting:iX,GridAlignment:iN,GridArrangement:iC,GridSorting:iL,LayeredDigraphAggressive:i2,LayeredDigraphAlign:i4,LayeredDigraphCycleRemove:iQ,LayeredDigraphInit:i1,LayeredDigraphLayering:i0,LayeredDigraphPack:i3,TreeAlignment:se,TreeArrangement:sn,TreeCompaction:si,TreeLayerStyle:sl,TreePath:i7,TreeSorting:st,TreeStyle:ss,GestureMode:tV,LinkingDirection:tj,ReshapingBehavior:tU,TextEditingAccept:t3,TextEditingStarting:t4,TextEditingState:t5,WheelMode:tI};for(let t in sm){let e=sm[t];te.ot(e)&&e!==e2&&(e.className=t)}te.H(sf)&&sf.version&&te.li("WARNING: a `go` object on the root object is already defined.  "+("Debug"in sf?"debug ":"")+"version: "+sf.version+", replaced with version: "+sm.version),eh.prototype.go=sm,tt.go=sm}(),"undefined"!=typeof global?global.go:self.go;let s="undefined"!=typeof global?global.go:self.go,n=s.Group;s.List;let l=s.Set,r=s.Map,o=s.Point,h=s.Size,a=s.Rect,u=s.Margin,d=s.Spot,c=s.Geometry,g=s.PathFigure,f=s.PathSegment;s.InputEvent,s.DiagramEvent,s.ChangedEvent,s.Model;let m=s.GraphLinksModel;s.TreeModel;let p=s.Binding;s.ThemeBinding,s.Transaction,s.UndoManager,s.CommandHandler,s.Tool;let y=s.DraggingTool;s.DraggingInfo,s.DraggingOptions,s.LinkingBaseTool,s.LinkingTool,s.RelinkingTool,s.LinkReshapingTool,s.ResizingTool,s.RotatingTool,s.ClickSelectingTool,s.ActionTool,s.ClickCreatingTool,s.HTMLInfo;let x=s.ContextMenuTool;s.DragSelectingTool,s.PanningTool,s.TextEditingTool;let w=s.ToolManager;s.Animation,s.AnimationManager,s.AnimationTrigger,s.Layer;let b=s.Diagram,v=s.Palette,k=s.Overview,P=s.Brush,S=s.GraphObject,M=s.Panel,N=s.RowColumnDefinition,C=s.Shape,L=s.TextBlock,T=s.Picture,A=s.Part,D=s.Adornment,F=s.Node,O=s.Link,R=s.Placeholder,B=s.Layout;s.LayoutNetwork,s.LayoutVertex,s.LayoutEdge;let E=s.GridLayout;s.PanelLayout;let I=s.CircularLayout;s.CircularNetwork,s.CircularVertex,s.CircularEdge;let V=s.ForceDirectedLayout;s.ForceDirectedNetwork,s.ForceDirectedVertex,s.ForceDirectedEdge;let z=s.LayeredDigraphLayout;s.LayeredDigraphNetwork,s.LayeredDigraphVertex,s.LayeredDigraphEdge;let K=s.TreeLayout;s.TreeNetwork,s.TreeVertex,s.TreeEdge,s.Themes,s.ThemeManager,s.Router,s.version,s.AnimationStyle,s.AutoScale,s.Curve,s.CycleMode,s.Flip,s.ImageStretch,s.LayoutConditions,s.LinkAdjusting,s.Orientation,s.PortSpreading,s.Routing,s.ScrollMode,s.CollapsePolicy,s.Sizing,s.TriggerStart,s.Stretch,s.TextFormat,s.TextOverflow,s.ViewboxStretch,s.Wrap,s.BrushType,s.ColorSpace,s.GeometryStretch,s.GeometryType,s.SegmentType,s.BindingMode,s.ChangeType,s.CircularArrangement,s.CircularDirection,s.CircularNodeDiameterFormula,s.CircularSorting,s.GridAlignment,s.GridArrangement,s.GridSorting,s.LayeredDigraphAggressive,s.LayeredDigraphAlign,s.LayeredDigraphCycleRemove,s.LayeredDigraphInit,s.LayeredDigraphLayering,s.LayeredDigraphPack,s.TreeAlignment,s.TreeArrangement,s.TreeCompaction,s.TreeLayerStyle,s.TreePath,s.TreeSorting,s.TreeStyle,s.GestureMode,s.LinkingDirection,s.ReshapingBehavior,s.TextEditingAccept,s.TextEditingStarting,s.TextEditingState,s.WheelMode}}]);